(function(){var undefined;var VERSION="3.10.0";var BIND_FLAG=1,BIND_KEY_FLAG=2,CURRY_BOUND_FLAG=4,CURRY_FLAG=8,CURRY_RIGHT_FLAG=16,PARTIAL_FLAG=32,PARTIAL_RIGHT_FLAG=64,ARY_FLAG=128,REARG_FLAG=256;var DEFAULT_TRUNC_LENGTH=30,DEFAULT_TRUNC_OMISSION="...";var HOT_COUNT=150,HOT_SPAN=16;var LARGE_ARRAY_SIZE=200;var LAZY_FILTER_FLAG=1,LAZY_MAP_FLAG=2;var FUNC_ERROR_TEXT="Expected a function";var PLACEHOLDER="__lodash_placeholder__";var argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",mapTag="[object Map]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",weakMapTag="[object WeakMap]";var arrayBufferTag="[object ArrayBuffer]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]";var reEmptyStringLeading=/\b__p \+= '';/g,reEmptyStringMiddle=/\b(__p \+=) '' \+/g,reEmptyStringTrailing=/(__e\(.*?\)|\b__t\)) \+\n'';/g;var reEscapedHtml=/&(?:amp|lt|gt|quot|#39|#96);/g,reUnescapedHtml=/[&<>"'`]/g,reHasEscapedHtml=RegExp(reEscapedHtml.source),reHasUnescapedHtml=RegExp(reUnescapedHtml.source);var reEscape=/<%-([\s\S]+?)%>/g,reEvaluate=/<%([\s\S]+?)%>/g,reInterpolate=/<%=([\s\S]+?)%>/g;var reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g;var reRegExpChars=/^[:!,]|[\\^$.*+?()[\]{}|\/]|(^[0-9a-fA-Fnrtuvx])|([\n\r\u2028\u2029])/g,reHasRegExpChars=RegExp(reRegExpChars.source);var reComboMark=/[\u0300-\u036f\ufe20-\ufe23]/g;var reEscapeChar=/\\(\\)?/g;var reEsTemplate=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g;var reFlags=/\w*$/;var reHasHexPrefix=/^0[xX]/;var reIsHostCtor=/^\[object .+?Constructor\]$/;var reIsUint=/^\d+$/;var reLatin1=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g;var reNoMatch=/($^)/;var reUnescapedString=/['\n\r\u2028\u2029\\]/g;var reWords=function(){var upper="[A-Z\\xc0-\\xd6\\xd8-\\xde]",lower="[a-z\\xdf-\\xf6\\xf8-\\xff]+";return RegExp(upper+"+(?="+upper+lower+")|"+upper+"?"+lower+"|"+upper+"+|[0-9]+","g")}();var contextProps=["Array","ArrayBuffer","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Math","Number","Object","RegExp","Set","String","_","clearTimeout","isFinite","parseFloat","parseInt","setTimeout","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap"];var templateCounter=-1;var typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=true;typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=false;var cloneableTags={};cloneableTags[argsTag]=cloneableTags[arrayTag]=cloneableTags[arrayBufferTag]=cloneableTags[boolTag]=cloneableTags[dateTag]=cloneableTags[float32Tag]=cloneableTags[float64Tag]=cloneableTags[int8Tag]=cloneableTags[int16Tag]=cloneableTags[int32Tag]=cloneableTags[numberTag]=cloneableTags[objectTag]=cloneableTags[regexpTag]=cloneableTags[stringTag]=cloneableTags[uint8Tag]=cloneableTags[uint8ClampedTag]=cloneableTags[uint16Tag]=cloneableTags[uint32Tag]=true;cloneableTags[errorTag]=cloneableTags[funcTag]=cloneableTags[mapTag]=cloneableTags[setTag]=cloneableTags[weakMapTag]=false;var deburredLetters={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss"};var htmlEscapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"};var htmlUnescapes={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"};var objectTypes={"function":true,object:true};var regexpEscapes={0:"x30",1:"x31",2:"x32",3:"x33",4:"x34",5:"x35",6:"x36",7:"x37",8:"x38",9:"x39",A:"x41",B:"x42",C:"x43",D:"x44",E:"x45",F:"x46",a:"x61",b:"x62",c:"x63",d:"x64",e:"x65",f:"x66",n:"x6e",r:"x72",t:"x74",u:"x75",v:"x76",x:"x78"};var stringEscapes={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"};var freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports;var freeModule=objectTypes[typeof module]&&module&&!module.nodeType&&module;var freeGlobal=freeExports&&freeModule&&typeof global=="object"&&global&&global.Object&&global;var freeSelf=objectTypes[typeof self]&&self&&self.Object&&self;var freeWindow=objectTypes[typeof window]&&window&&window.Object&&window;var moduleExports=freeModule&&freeModule.exports===freeExports&&freeExports;var root=freeGlobal||freeWindow!==(this&&this.window)&&freeWindow||freeSelf||this;function baseCompareAscending(value,other){if(value!==other){var valIsNull=value===null,valIsUndef=value===undefined,valIsReflexive=value===value;var othIsNull=other===null,othIsUndef=other===undefined,othIsReflexive=other===other;if(value>other&&!othIsNull||!valIsReflexive||valIsNull&&!othIsUndef&&othIsReflexive||valIsUndef&&othIsReflexive){return 1}if(value<other&&!valIsNull||!othIsReflexive||othIsNull&&!valIsUndef&&valIsReflexive||othIsUndef&&valIsReflexive){return-1}}return 0}function baseFindIndex(array,predicate,fromRight){var length=array.length,index=fromRight?length:-1;while(fromRight?index--:++index<length){if(predicate(array[index],index,array)){return index}}return-1}function baseIndexOf(array,value,fromIndex){if(value!==value){return indexOfNaN(array,fromIndex)}var index=fromIndex-1,length=array.length;while(++index<length){if(array[index]===value){return index}}return-1}function baseIsFunction(value){return typeof value=="function"||false}function baseToString(value){return value==null?"":value+""}function charsLeftIndex(string,chars){var index=-1,length=string.length;while(++index<length&&chars.indexOf(string.charAt(index))>-1){}return index}function charsRightIndex(string,chars){var index=string.length;while(index--&&chars.indexOf(string.charAt(index))>-1){}return index}function compareAscending(object,other){return baseCompareAscending(object.criteria,other.criteria)||object.index-other.index}function compareMultiple(object,other,orders){var index=-1,objCriteria=object.criteria,othCriteria=other.criteria,length=objCriteria.length,ordersLength=orders.length;while(++index<length){var result=baseCompareAscending(objCriteria[index],othCriteria[index]);if(result){if(index>=ordersLength){return result}var order=orders[index];return result*(order==="asc"||order===true?1:-1)}}return object.index-other.index}function deburrLetter(letter){return deburredLetters[letter]}function escapeHtmlChar(chr){return htmlEscapes[chr]}function escapeRegExpChar(chr,leadingChar,whitespaceChar){if(leadingChar){chr=regexpEscapes[chr]}else if(whitespaceChar){chr=stringEscapes[chr]}return"\\"+chr}function escapeStringChar(chr){return"\\"+stringEscapes[chr]}function indexOfNaN(array,fromIndex,fromRight){var length=array.length,index=fromIndex+(fromRight?0:-1);while(fromRight?index--:++index<length){var other=array[index];if(other!==other){return index}}return-1}function isObjectLike(value){return!!value&&typeof value=="object"}function isSpace(charCode){return charCode<=160&&(charCode>=9&&charCode<=13)||charCode==32||charCode==160||charCode==5760||charCode==6158||charCode>=8192&&(charCode<=8202||charCode==8232||charCode==8233||charCode==8239||charCode==8287||charCode==12288||charCode==65279)}function replaceHolders(array,placeholder){var index=-1,length=array.length,resIndex=-1,result=[];while(++index<length){if(array[index]===placeholder){array[index]=PLACEHOLDER;result[++resIndex]=index}}return result}function sortedUniq(array,iteratee){var seen,index=-1,length=array.length,resIndex=-1,result=[];while(++index<length){var value=array[index],computed=iteratee?iteratee(value,index,array):value;if(!index||seen!==computed){seen=computed;result[++resIndex]=value}}return result}function trimmedLeftIndex(string){var index=-1,length=string.length;while(++index<length&&isSpace(string.charCodeAt(index))){}return index}function trimmedRightIndex(string){var index=string.length;while(index--&&isSpace(string.charCodeAt(index))){}return index}function unescapeHtmlChar(chr){return htmlUnescapes[chr]}function runInContext(context){context=context?_.defaults(root.Object(),context,_.pick(root,contextProps)):root;var Array=context.Array,Date=context.Date,Error=context.Error,Function=context.Function,Math=context.Math,Number=context.Number,Object=context.Object,RegExp=context.RegExp,String=context.String,TypeError=context.TypeError;var arrayProto=Array.prototype,objectProto=Object.prototype,stringProto=String.prototype;var fnToString=Function.prototype.toString;var hasOwnProperty=objectProto.hasOwnProperty;var idCounter=0;var objToString=objectProto.toString;var oldDash=root._;var reIsNative=RegExp("^"+fnToString.call(hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var ArrayBuffer=context.ArrayBuffer,clearTimeout=context.clearTimeout,parseFloat=context.parseFloat,pow=Math.pow,propertyIsEnumerable=objectProto.propertyIsEnumerable,Set=getNative(context,"Set"),setTimeout=context.setTimeout,splice=arrayProto.splice,Uint8Array=context.Uint8Array,WeakMap=getNative(context,"WeakMap");var nativeCeil=Math.ceil,nativeCreate=getNative(Object,"create"),nativeFloor=Math.floor,nativeIsArray=getNative(Array,"isArray"),nativeIsFinite=context.isFinite,nativeKeys=getNative(Object,"keys"),nativeMax=Math.max,nativeMin=Math.min,nativeNow=getNative(Date,"now"),nativeParseInt=context.parseInt,nativeRandom=Math.random;var NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,POSITIVE_INFINITY=Number.POSITIVE_INFINITY;var MAX_ARRAY_LENGTH=4294967295,MAX_ARRAY_INDEX=MAX_ARRAY_LENGTH-1,HALF_MAX_ARRAY_LENGTH=MAX_ARRAY_LENGTH>>>1;var MAX_SAFE_INTEGER=9007199254740991;var metaMap=WeakMap&&new WeakMap;var realNames={};function lodash(value){if(isObjectLike(value)&&!isArray(value)&&!(value instanceof LazyWrapper)){if(value instanceof LodashWrapper){return value}if(hasOwnProperty.call(value,"__chain__")&&hasOwnProperty.call(value,"__wrapped__")){return wrapperClone(value)}}return new LodashWrapper(value)}function baseLodash(){}function LodashWrapper(value,chainAll,actions){this.__wrapped__=value;this.__actions__=actions||[];this.__chain__=!!chainAll}var support=lodash.support={};lodash.templateSettings={escape:reEscape,evaluate:reEvaluate,interpolate:reInterpolate,variable:"",imports:{_:lodash}};function LazyWrapper(value){this.__wrapped__=value;this.__actions__=[];this.__dir__=1;this.__filtered__=false;this.__iteratees__=[];this.__takeCount__=POSITIVE_INFINITY;this.__views__=[]}function lazyClone(){var result=new LazyWrapper(this.__wrapped__);result.__actions__=arrayCopy(this.__actions__);result.__dir__=this.__dir__;result.__filtered__=this.__filtered__;result.__iteratees__=arrayCopy(this.__iteratees__);result.__takeCount__=this.__takeCount__;result.__views__=arrayCopy(this.__views__);return result}function lazyReverse(){if(this.__filtered__){var result=new LazyWrapper(this);result.__dir__=-1;result.__filtered__=true}else{result=this.clone();result.__dir__*=-1}return result}function lazyValue(){var array=this.__wrapped__.value(),dir=this.__dir__,isArr=isArray(array),isRight=dir<0,arrLength=isArr?array.length:0,view=getView(0,arrLength,this.__views__),start=view.start,end=view.end,length=end-start,index=isRight?end:start-1,iteratees=this.__iteratees__,iterLength=iteratees.length,resIndex=0,takeCount=nativeMin(length,this.__takeCount__);if(!isArr||arrLength<LARGE_ARRAY_SIZE||arrLength==length&&takeCount==length){return baseWrapperValue(isRight&&isArr?array.reverse():array,this.__actions__)}var result=[];outer:while(length--&&resIndex<takeCount){index+=dir;var iterIndex=-1,value=array[index];while(++iterIndex<iterLength){var data=iteratees[iterIndex],iteratee=data.iteratee,type=data.type,computed=iteratee(value);if(type==LAZY_MAP_FLAG){value=computed}else if(!computed){if(type==LAZY_FILTER_FLAG){continue outer}else{break outer}}}result[resIndex++]=value}return result}function MapCache(){this.__data__={}}function mapDelete(key){return this.has(key)&&delete this.__data__[key]}function mapGet(key){return key=="__proto__"?undefined:this.__data__[key]}function mapHas(key){return key!="__proto__"&&hasOwnProperty.call(this.__data__,key)}function mapSet(key,value){if(key!="__proto__"){this.__data__[key]=value}return this}function SetCache(values){var length=values?values.length:0;this.data={hash:nativeCreate(null),set:new Set};while(length--){this.push(values[length])}}function cacheIndexOf(cache,value){var data=cache.data,result=typeof value=="string"||isObject(value)?data.set.has(value):data.hash[value];return result?0:-1}function cachePush(value){var data=this.data;if(typeof value=="string"||isObject(value)){data.set.add(value)}else{data.hash[value]=true}}function arrayConcat(array,other){var index=-1,length=array.length,othIndex=-1,othLength=other.length,result=Array(length+othLength);while(++index<length){result[index]=array[index]}while(++othIndex<othLength){result[index++]=other[othIndex]}return result}function arrayCopy(source,array){var index=-1,length=source.length;array||(array=Array(length));while(++index<length){array[index]=source[index]}return array}function arrayEach(array,iteratee){var index=-1,length=array.length;while(++index<length){if(iteratee(array[index],index,array)===false){break}}return array}function arrayEachRight(array,iteratee){var length=array.length;while(length--){if(iteratee(array[length],length,array)===false){break}}return array}function arrayEvery(array,predicate){var index=-1,length=array.length;while(++index<length){if(!predicate(array[index],index,array)){return false}}return true}function arrayExtremum(array,iteratee,comparator,exValue){var index=-1,length=array.length,computed=exValue,result=computed;while(++index<length){var value=array[index],current=+iteratee(value);if(comparator(current,computed)){computed=current;result=value}}return result}function arrayFilter(array,predicate){var index=-1,length=array.length,resIndex=-1,result=[];while(++index<length){var value=array[index];if(predicate(value,index,array)){result[++resIndex]=value}}return result}function arrayMap(array,iteratee){var index=-1,length=array.length,result=Array(length);while(++index<length){result[index]=iteratee(array[index],index,array)}return result}function arrayPush(array,values){var index=-1,length=values.length,offset=array.length;while(++index<length){array[offset+index]=values[index]}return array}function arrayReduce(array,iteratee,accumulator,initFromArray){var index=-1,length=array.length;if(initFromArray&&length){accumulator=array[++index]}while(++index<length){accumulator=iteratee(accumulator,array[index],index,array)}return accumulator}function arrayReduceRight(array,iteratee,accumulator,initFromArray){var length=array.length;if(initFromArray&&length){accumulator=array[--length]}while(length--){accumulator=iteratee(accumulator,array[length],length,array)}return accumulator}function arraySome(array,predicate){var index=-1,length=array.length;while(++index<length){if(predicate(array[index],index,array)){return true}}return false}function arraySum(array,iteratee){var length=array.length,result=0;while(length--){result+=+iteratee(array[length])||0}return result}function assignDefaults(objectValue,sourceValue){return objectValue===undefined?sourceValue:objectValue}function assignOwnDefaults(objectValue,sourceValue,key,object){return objectValue===undefined||!hasOwnProperty.call(object,key)?sourceValue:objectValue}function assignWith(object,source,customizer){var index=-1,props=keys(source),length=props.length;while(++index<length){var key=props[index],value=object[key],result=customizer(value,source[key],key,object,source);if((result===result?result!==value:value===value)||value===undefined&&!(key in object)){object[key]=result}}return object}function baseAssign(object,source){return source==null?object:baseCopy(source,keys(source),object)}function baseAt(collection,props){var index=-1,isNil=collection==null,isArr=!isNil&&isArrayLike(collection),length=isArr?collection.length:0,propsLength=props.length,result=Array(propsLength);while(++index<propsLength){var key=props[index];if(isArr){result[index]=isIndex(key,length)?collection[key]:undefined}else{result[index]=isNil?undefined:collection[key]}}return result}function baseCopy(source,props,object){object||(object={});var index=-1,length=props.length;while(++index<length){var key=props[index];object[key]=source[key]}return object}function baseCallback(func,thisArg,argCount){var type=typeof func;if(type=="function"){return thisArg===undefined?func:bindCallback(func,thisArg,argCount)}if(func==null){return identity}if(type=="object"){return baseMatches(func)}return thisArg===undefined?property(func):baseMatchesProperty(func,thisArg)}function baseClone(value,isDeep,customizer,key,object,stackA,stackB){var result;if(customizer){result=object?customizer(value,key,object):customizer(value)}if(result!==undefined){return result}if(!isObject(value)){return value}var isArr=isArray(value);if(isArr){result=initCloneArray(value);if(!isDeep){return arrayCopy(value,result)}}else{var tag=objToString.call(value),isFunc=tag==funcTag;if(tag==objectTag||tag==argsTag||isFunc&&!object){result=initCloneObject(isFunc?{}:value);if(!isDeep){return baseAssign(result,value)}}else{return cloneableTags[tag]?initCloneByTag(value,tag,isDeep):object?value:{}}}stackA||(stackA=[]);stackB||(stackB=[]);var length=stackA.length;while(length--){if(stackA[length]==value){return stackB[length]}}stackA.push(value);stackB.push(result);(isArr?arrayEach:baseForOwn)(value,function(subValue,key){result[key]=baseClone(subValue,isDeep,customizer,key,value,stackA,stackB)});return result}var baseCreate=function(){function object(){}return function(prototype){if(isObject(prototype)){object.prototype=prototype;var result=new object;object.prototype=undefined}return result||{}}}();function baseDelay(func,wait,args){if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}return setTimeout(function(){func.apply(undefined,args)},wait)}function baseDifference(array,values){var length=array?array.length:0,result=[];if(!length){return result}var index=-1,indexOf=getIndexOf(),isCommon=indexOf==baseIndexOf,cache=isCommon&&values.length>=LARGE_ARRAY_SIZE?createCache(values):null,valuesLength=values.length;if(cache){indexOf=cacheIndexOf;isCommon=false;values=cache}outer:while(++index<length){var value=array[index];if(isCommon&&value===value){var valuesIndex=valuesLength;while(valuesIndex--){if(values[valuesIndex]===value){continue outer}}result.push(value)}else if(indexOf(values,value,0)<0){result.push(value)}}return result}var baseEach=createBaseEach(baseForOwn);var baseEachRight=createBaseEach(baseForOwnRight,true);function baseEvery(collection,predicate){var result=true;baseEach(collection,function(value,index,collection){result=!!predicate(value,index,collection);return result});return result}function baseExtremum(collection,iteratee,comparator,exValue){var computed=exValue,result=computed;baseEach(collection,function(value,index,collection){var current=+iteratee(value,index,collection);if(comparator(current,computed)||current===exValue&&current===result){computed=current;result=value}});return result}function baseFill(array,value,start,end){var length=array.length;start=start==null?0:+start||0;if(start<0){start=-start>length?0:length+start}end=end===undefined||end>length?length:+end||0;if(end<0){end+=length}length=start>end?0:end>>>0;start>>>=0;while(start<length){array[start++]=value}return array}function baseFilter(collection,predicate){var result=[];baseEach(collection,function(value,index,collection){if(predicate(value,index,collection)){result.push(value)}});return result}function baseFind(collection,predicate,eachFunc,retKey){var result;eachFunc(collection,function(value,key,collection){if(predicate(value,key,collection)){result=retKey?key:value;return false}});return result}function baseFlatten(array,isDeep,isStrict,result){result||(result=[]);var index=-1,length=array.length;while(++index<length){var value=array[index];if(isObjectLike(value)&&isArrayLike(value)&&(isStrict||isArray(value)||isArguments(value))){if(isDeep){baseFlatten(value,isDeep,isStrict,result)}else{arrayPush(result,value)}}else if(!isStrict){result[result.length]=value}}return result}var baseFor=createBaseFor();var baseForRight=createBaseFor(true);function baseForIn(object,iteratee){return baseFor(object,iteratee,keysIn)}function baseForOwn(object,iteratee){return baseFor(object,iteratee,keys)}function baseForOwnRight(object,iteratee){return baseForRight(object,iteratee,keys)}function baseFunctions(object,props){var index=-1,length=props.length,resIndex=-1,result=[];while(++index<length){var key=props[index];if(isFunction(object[key])){result[++resIndex]=key}}return result}function baseGet(object,path,pathKey){if(object==null){return}if(pathKey!==undefined&&pathKey in toObject(object)){path=[pathKey]}var index=0,length=path.length;while(object!=null&&index<length){object=object[path[index++]]}return index&&index==length?object:undefined}function baseIsEqual(value,other,customizer,isLoose,stackA,stackB){if(value===other){return true}if(value==null||other==null||!isObject(value)&&!isObjectLike(other)){return value!==value&&other!==other}return baseIsEqualDeep(value,other,baseIsEqual,customizer,isLoose,stackA,stackB)}function baseIsEqualDeep(object,other,equalFunc,customizer,isLoose,stackA,stackB){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=arrayTag,othTag=arrayTag;if(!objIsArr){objTag=objToString.call(object);if(objTag==argsTag){objTag=objectTag}else if(objTag!=objectTag){objIsArr=isTypedArray(object)}}if(!othIsArr){othTag=objToString.call(other);if(othTag==argsTag){othTag=objectTag}else if(othTag!=objectTag){othIsArr=isTypedArray(other)}}var objIsObj=objTag==objectTag,othIsObj=othTag==objectTag,isSameTag=objTag==othTag;if(isSameTag&&!(objIsArr||objIsObj)){return equalByTag(object,other,objTag)}if(!isLoose){var objIsWrapped=objIsObj&&hasOwnProperty.call(object,"__wrapped__"),othIsWrapped=othIsObj&&hasOwnProperty.call(other,"__wrapped__");if(objIsWrapped||othIsWrapped){return equalFunc(objIsWrapped?object.value():object,othIsWrapped?other.value():other,customizer,isLoose,stackA,stackB)}}if(!isSameTag){return false}stackA||(stackA=[]);stackB||(stackB=[]);var length=stackA.length;while(length--){if(stackA[length]==object){return stackB[length]==other}}stackA.push(object);stackB.push(other);var result=(objIsArr?equalArrays:equalObjects)(object,other,equalFunc,customizer,isLoose,stackA,stackB);stackA.pop();stackB.pop();return result}function baseIsMatch(object,matchData,customizer){var index=matchData.length,length=index,noCustomizer=!customizer;if(object==null){return!length}object=toObject(object);while(index--){var data=matchData[index];if(noCustomizer&&data[2]?data[1]!==object[data[0]]:!(data[0]in object)){return false}}while(++index<length){data=matchData[index];var key=data[0],objValue=object[key],srcValue=data[1];if(noCustomizer&&data[2]){if(objValue===undefined&&!(key in object)){return false}}else{var result=customizer?customizer(objValue,srcValue,key):undefined;if(!(result===undefined?baseIsEqual(srcValue,objValue,customizer,true):result)){return false}}}return true}function baseMap(collection,iteratee){var index=-1,result=isArrayLike(collection)?Array(collection.length):[];baseEach(collection,function(value,key,collection){result[++index]=iteratee(value,key,collection)});return result}function baseMatches(source){var matchData=getMatchData(source);if(matchData.length==1&&matchData[0][2]){var key=matchData[0][0],value=matchData[0][1];return function(object){if(object==null){return false}return object[key]===value&&(value!==undefined||key in toObject(object))}}return function(object){return baseIsMatch(object,matchData)}}function baseMatchesProperty(path,srcValue){var isArr=isArray(path),isCommon=isKey(path)&&isStrictComparable(srcValue),pathKey=path+"";path=toPath(path);return function(object){if(object==null){return false}var key=pathKey;object=toObject(object);if((isArr||!isCommon)&&!(key in object)){object=path.length==1?object:baseGet(object,baseSlice(path,0,-1));if(object==null){return false}key=last(path);object=toObject(object)}return object[key]===srcValue?srcValue!==undefined||key in object:baseIsEqual(srcValue,object[key],undefined,true)}}function baseMerge(object,source,customizer,stackA,stackB){if(!isObject(object)){return object}var isSrcArr=isArrayLike(source)&&(isArray(source)||isTypedArray(source)),props=isSrcArr?undefined:keys(source);arrayEach(props||source,function(srcValue,key){if(props){key=srcValue;srcValue=source[key]}if(isObjectLike(srcValue)){stackA||(stackA=[]);stackB||(stackB=[]);baseMergeDeep(object,source,key,baseMerge,customizer,stackA,stackB)}else{var value=object[key],result=customizer?customizer(value,srcValue,key,object,source):undefined,isCommon=result===undefined;if(isCommon){result=srcValue}if((result!==undefined||isSrcArr&&!(key in object))&&(isCommon||(result===result?result!==value:value===value))){object[key]=result}}});return object}function baseMergeDeep(object,source,key,mergeFunc,customizer,stackA,stackB){var length=stackA.length,srcValue=source[key];while(length--){if(stackA[length]==srcValue){object[key]=stackB[length];return}}var value=object[key],result=customizer?customizer(value,srcValue,key,object,source):undefined,isCommon=result===undefined;if(isCommon){result=srcValue;if(isArrayLike(srcValue)&&(isArray(srcValue)||isTypedArray(srcValue))){result=isArray(value)?value:isArrayLike(value)?arrayCopy(value):[]}else if(isPlainObject(srcValue)||isArguments(srcValue)){result=isArguments(value)?toPlainObject(value):isPlainObject(value)?value:{}}else{isCommon=false}}stackA.push(srcValue);stackB.push(result);if(isCommon){object[key]=mergeFunc(result,srcValue,customizer,stackA,stackB)}else if(result===result?result!==value:value===value){object[key]=result}}function baseProperty(key){return function(object){return object==null?undefined:object[key]}}function basePropertyDeep(path){var pathKey=path+"";path=toPath(path);return function(object){return baseGet(object,path,pathKey)}}function basePullAt(array,indexes){var length=array?indexes.length:0;while(length--){var index=indexes[length];if(index!=previous&&isIndex(index)){var previous=index;splice.call(array,index,1)}}return array}function baseRandom(min,max){return min+nativeFloor(nativeRandom()*(max-min+1))}function baseReduce(collection,iteratee,accumulator,initFromCollection,eachFunc){eachFunc(collection,function(value,index,collection){accumulator=initFromCollection?(initFromCollection=false,value):iteratee(accumulator,value,index,collection)});return accumulator}var baseSetData=!metaMap?identity:function(func,data){metaMap.set(func,data);return func};function baseSlice(array,start,end){var index=-1,length=array.length;start=start==null?0:+start||0;if(start<0){start=-start>length?0:length+start}end=end===undefined||end>length?length:+end||0;if(end<0){end+=length}length=start>end?0:end-start>>>0;start>>>=0;var result=Array(length);while(++index<length){result[index]=array[index+start]}return result}function baseSome(collection,predicate){var result;baseEach(collection,function(value,index,collection){result=predicate(value,index,collection);return!result});return!!result}function baseSortBy(array,comparer){var length=array.length;array.sort(comparer);while(length--){array[length]=array[length].value}return array}function baseSortByOrder(collection,iteratees,orders){var callback=getCallback(),index=-1;iteratees=arrayMap(iteratees,function(iteratee){return callback(iteratee)});var result=baseMap(collection,function(value){var criteria=arrayMap(iteratees,function(iteratee){return iteratee(value)});return{criteria:criteria,index:++index,value:value}});return baseSortBy(result,function(object,other){return compareMultiple(object,other,orders)})}function baseSum(collection,iteratee){var result=0;baseEach(collection,function(value,index,collection){result+=+iteratee(value,index,collection)||0});return result}function baseUniq(array,iteratee){var index=-1,indexOf=getIndexOf(),length=array.length,isCommon=indexOf==baseIndexOf,isLarge=isCommon&&length>=LARGE_ARRAY_SIZE,seen=isLarge?createCache():null,result=[];if(seen){indexOf=cacheIndexOf;isCommon=false}else{isLarge=false;seen=iteratee?[]:result}outer:while(++index<length){var value=array[index],computed=iteratee?iteratee(value,index,array):value;if(isCommon&&value===value){var seenIndex=seen.length;while(seenIndex--){if(seen[seenIndex]===computed){continue outer}}if(iteratee){seen.push(computed)}result.push(value)}else if(indexOf(seen,computed,0)<0){if(iteratee||isLarge){seen.push(computed)}result.push(value)}}return result}function baseValues(object,props){var index=-1,length=props.length,result=Array(length);while(++index<length){result[index]=object[props[index]]}return result}function baseWhile(array,predicate,isDrop,fromRight){var length=array.length,index=fromRight?length:-1;while((fromRight?index--:++index<length)&&predicate(array[index],index,array)){}return isDrop?baseSlice(array,fromRight?0:index,fromRight?index+1:length):baseSlice(array,fromRight?index+1:0,fromRight?length:index)}function baseWrapperValue(value,actions){var result=value;if(result instanceof LazyWrapper){result=result.value()}var index=-1,length=actions.length;while(++index<length){var action=actions[index];result=action.func.apply(action.thisArg,arrayPush([result],action.args))}return result}function binaryIndex(array,value,retHighest){var low=0,high=array?array.length:low;if(typeof value=="number"&&value===value&&high<=HALF_MAX_ARRAY_LENGTH){while(low<high){var mid=low+high>>>1,computed=array[mid];if((retHighest?computed<=value:computed<value)&&computed!==null){low=mid+1}else{high=mid}}return high}return binaryIndexBy(array,value,identity,retHighest)}function binaryIndexBy(array,value,iteratee,retHighest){value=iteratee(value);var low=0,high=array?array.length:0,valIsNaN=value!==value,valIsNull=value===null,valIsUndef=value===undefined;while(low<high){var mid=nativeFloor((low+high)/2),computed=iteratee(array[mid]),isDef=computed!==undefined,isReflexive=computed===computed;if(valIsNaN){var setLow=isReflexive||retHighest}else if(valIsNull){setLow=isReflexive&&isDef&&(retHighest||computed!=null)}else if(valIsUndef){setLow=isReflexive&&(retHighest||isDef)}else if(computed==null){setLow=false}else{setLow=retHighest?computed<=value:computed<value}if(setLow){low=mid+1}else{high=mid}}return nativeMin(high,MAX_ARRAY_INDEX)}function bindCallback(func,thisArg,argCount){if(typeof func!="function"){return identity}if(thisArg===undefined){return func}switch(argCount){case 1:return function(value){return func.call(thisArg,value)};case 3:return function(value,index,collection){return func.call(thisArg,value,index,collection)};case 4:return function(accumulator,value,index,collection){
return func.call(thisArg,accumulator,value,index,collection)};case 5:return function(value,other,key,object,source){return func.call(thisArg,value,other,key,object,source)}}return function(){return func.apply(thisArg,arguments)}}function bufferClone(buffer){var result=new ArrayBuffer(buffer.byteLength),view=new Uint8Array(result);view.set(new Uint8Array(buffer));return result}function composeArgs(args,partials,holders){var holdersLength=holders.length,argsIndex=-1,argsLength=nativeMax(args.length-holdersLength,0),leftIndex=-1,leftLength=partials.length,result=Array(leftLength+argsLength);while(++leftIndex<leftLength){result[leftIndex]=partials[leftIndex]}while(++argsIndex<holdersLength){result[holders[argsIndex]]=args[argsIndex]}while(argsLength--){result[leftIndex++]=args[argsIndex++]}return result}function composeArgsRight(args,partials,holders){var holdersIndex=-1,holdersLength=holders.length,argsIndex=-1,argsLength=nativeMax(args.length-holdersLength,0),rightIndex=-1,rightLength=partials.length,result=Array(argsLength+rightLength);while(++argsIndex<argsLength){result[argsIndex]=args[argsIndex]}var offset=argsIndex;while(++rightIndex<rightLength){result[offset+rightIndex]=partials[rightIndex]}while(++holdersIndex<holdersLength){result[offset+holders[holdersIndex]]=args[argsIndex++]}return result}function createAggregator(setter,initializer){return function(collection,iteratee,thisArg){var result=initializer?initializer():{};iteratee=getCallback(iteratee,thisArg,3);if(isArray(collection)){var index=-1,length=collection.length;while(++index<length){var value=collection[index];setter(result,value,iteratee(value,index,collection),collection)}}else{baseEach(collection,function(value,key,collection){setter(result,value,iteratee(value,key,collection),collection)})}return result}}function createAssigner(assigner){return restParam(function(object,sources){var index=-1,length=object==null?0:sources.length,customizer=length>2?sources[length-2]:undefined,guard=length>2?sources[2]:undefined,thisArg=length>1?sources[length-1]:undefined;if(typeof customizer=="function"){customizer=bindCallback(customizer,thisArg,5);length-=2}else{customizer=typeof thisArg=="function"?thisArg:undefined;length-=customizer?1:0}if(guard&&isIterateeCall(sources[0],sources[1],guard)){customizer=length<3?undefined:customizer;length=1}while(++index<length){var source=sources[index];if(source){assigner(object,source,customizer)}}return object})}function createBaseEach(eachFunc,fromRight){return function(collection,iteratee){var length=collection?getLength(collection):0;if(!isLength(length)){return eachFunc(collection,iteratee)}var index=fromRight?length:-1,iterable=toObject(collection);while(fromRight?index--:++index<length){if(iteratee(iterable[index],index,iterable)===false){break}}return collection}}function createBaseFor(fromRight){return function(object,iteratee,keysFunc){var iterable=toObject(object),props=keysFunc(object),length=props.length,index=fromRight?length:-1;while(fromRight?index--:++index<length){var key=props[index];if(iteratee(iterable[key],key,iterable)===false){break}}return object}}function createBindWrapper(func,thisArg){var Ctor=createCtorWrapper(func);function wrapper(){var fn=this&&this!==root&&this instanceof wrapper?Ctor:func;return fn.apply(thisArg,arguments)}return wrapper}function createCache(values){return nativeCreate&&Set?new SetCache(values):null}function createCompounder(callback){return function(string){var index=-1,array=words(deburr(string)),length=array.length,result="";while(++index<length){result=callback(result,array[index],index)}return result}}function createCtorWrapper(Ctor){return function(){var args=arguments;switch(args.length){case 0:return new Ctor;case 1:return new Ctor(args[0]);case 2:return new Ctor(args[0],args[1]);case 3:return new Ctor(args[0],args[1],args[2]);case 4:return new Ctor(args[0],args[1],args[2],args[3]);case 5:return new Ctor(args[0],args[1],args[2],args[3],args[4]);case 6:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5]);case 7:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5],args[6])}var thisBinding=baseCreate(Ctor.prototype),result=Ctor.apply(thisBinding,args);return isObject(result)?result:thisBinding}}function createCurry(flag){function curryFunc(func,arity,guard){if(guard&&isIterateeCall(func,arity,guard)){arity=undefined}var result=createWrapper(func,flag,undefined,undefined,undefined,undefined,undefined,arity);result.placeholder=curryFunc.placeholder;return result}return curryFunc}function createDefaults(assigner,customizer){return restParam(function(args){var object=args[0];if(object==null){return object}args.push(customizer);return assigner.apply(undefined,args)})}function createExtremum(comparator,exValue){return function(collection,iteratee,thisArg){if(thisArg&&isIterateeCall(collection,iteratee,thisArg)){iteratee=undefined}iteratee=getCallback(iteratee,thisArg,3);if(iteratee.length==1){collection=isArray(collection)?collection:toIterable(collection);var result=arrayExtremum(collection,iteratee,comparator,exValue);if(!(collection.length&&result===exValue)){return result}}return baseExtremum(collection,iteratee,comparator,exValue)}}function createFind(eachFunc,fromRight){return function(collection,predicate,thisArg){predicate=getCallback(predicate,thisArg,3);if(isArray(collection)){var index=baseFindIndex(collection,predicate,fromRight);return index>-1?collection[index]:undefined}return baseFind(collection,predicate,eachFunc)}}function createFindIndex(fromRight){return function(array,predicate,thisArg){if(!(array&&array.length)){return-1}predicate=getCallback(predicate,thisArg,3);return baseFindIndex(array,predicate,fromRight)}}function createFindKey(objectFunc){return function(object,predicate,thisArg){predicate=getCallback(predicate,thisArg,3);return baseFind(object,predicate,objectFunc,true)}}function createFlow(fromRight){return function(){var wrapper,length=arguments.length,index=fromRight?length:-1,leftIndex=0,funcs=Array(length);while(fromRight?index--:++index<length){var func=funcs[leftIndex++]=arguments[index];if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}if(!wrapper&&LodashWrapper.prototype.thru&&getFuncName(func)=="wrapper"){wrapper=new LodashWrapper([],true)}}index=wrapper?-1:length;while(++index<length){func=funcs[index];var funcName=getFuncName(func),data=funcName=="wrapper"?getData(func):undefined;if(data&&isLaziable(data[0])&&data[1]==(ARY_FLAG|CURRY_FLAG|PARTIAL_FLAG|REARG_FLAG)&&!data[4].length&&data[9]==1){wrapper=wrapper[getFuncName(data[0])].apply(wrapper,data[3])}else{wrapper=func.length==1&&isLaziable(func)?wrapper[funcName]():wrapper.thru(func)}}return function(){var args=arguments,value=args[0];if(wrapper&&args.length==1&&isArray(value)&&value.length>=LARGE_ARRAY_SIZE){return wrapper.plant(value).value()}var index=0,result=length?funcs[index].apply(this,args):value;while(++index<length){result=funcs[index].call(this,result)}return result}}}function createForEach(arrayFunc,eachFunc){return function(collection,iteratee,thisArg){return typeof iteratee=="function"&&thisArg===undefined&&isArray(collection)?arrayFunc(collection,iteratee):eachFunc(collection,bindCallback(iteratee,thisArg,3))}}function createForIn(objectFunc){return function(object,iteratee,thisArg){if(typeof iteratee!="function"||thisArg!==undefined){iteratee=bindCallback(iteratee,thisArg,3)}return objectFunc(object,iteratee,keysIn)}}function createForOwn(objectFunc){return function(object,iteratee,thisArg){if(typeof iteratee!="function"||thisArg!==undefined){iteratee=bindCallback(iteratee,thisArg,3)}return objectFunc(object,iteratee)}}function createObjectMapper(isMapKeys){return function(object,iteratee,thisArg){var result={};iteratee=getCallback(iteratee,thisArg,3);baseForOwn(object,function(value,key,object){var mapped=iteratee(value,key,object);key=isMapKeys?mapped:key;value=isMapKeys?value:mapped;result[key]=value});return result}}function createPadDir(fromRight){return function(string,length,chars){string=baseToString(string);return(fromRight?string:"")+createPadding(string,length,chars)+(fromRight?"":string)}}function createPartial(flag){var partialFunc=restParam(function(func,partials){var holders=replaceHolders(partials,partialFunc.placeholder);return createWrapper(func,flag,undefined,partials,holders)});return partialFunc}function createReduce(arrayFunc,eachFunc){return function(collection,iteratee,accumulator,thisArg){var initFromArray=arguments.length<3;return typeof iteratee=="function"&&thisArg===undefined&&isArray(collection)?arrayFunc(collection,iteratee,accumulator,initFromArray):baseReduce(collection,getCallback(iteratee,thisArg,4),accumulator,initFromArray,eachFunc)}}function createHybridWrapper(func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity){var isAry=bitmask&ARY_FLAG,isBind=bitmask&BIND_FLAG,isBindKey=bitmask&BIND_KEY_FLAG,isCurry=bitmask&CURRY_FLAG,isCurryBound=bitmask&CURRY_BOUND_FLAG,isCurryRight=bitmask&CURRY_RIGHT_FLAG,Ctor=isBindKey?undefined:createCtorWrapper(func);function wrapper(){var length=arguments.length,index=length,args=Array(length);while(index--){args[index]=arguments[index]}if(partials){args=composeArgs(args,partials,holders)}if(partialsRight){args=composeArgsRight(args,partialsRight,holdersRight)}if(isCurry||isCurryRight){var placeholder=wrapper.placeholder,argsHolders=replaceHolders(args,placeholder);length-=argsHolders.length;if(length<arity){var newArgPos=argPos?arrayCopy(argPos):undefined,newArity=nativeMax(arity-length,0),newsHolders=isCurry?argsHolders:undefined,newHoldersRight=isCurry?undefined:argsHolders,newPartials=isCurry?args:undefined,newPartialsRight=isCurry?undefined:args;bitmask|=isCurry?PARTIAL_FLAG:PARTIAL_RIGHT_FLAG;bitmask&=~(isCurry?PARTIAL_RIGHT_FLAG:PARTIAL_FLAG);if(!isCurryBound){bitmask&=~(BIND_FLAG|BIND_KEY_FLAG)}var newData=[func,bitmask,thisArg,newPartials,newsHolders,newPartialsRight,newHoldersRight,newArgPos,ary,newArity],result=createHybridWrapper.apply(undefined,newData);if(isLaziable(func)){setData(result,newData)}result.placeholder=placeholder;return result}}var thisBinding=isBind?thisArg:this,fn=isBindKey?thisBinding[func]:func;if(argPos){args=reorder(args,argPos)}if(isAry&&ary<args.length){args.length=ary}if(this&&this!==root&&this instanceof wrapper){fn=Ctor||createCtorWrapper(func)}return fn.apply(thisBinding,args)}return wrapper}function createPadding(string,length,chars){var strLength=string.length;length=+length;if(strLength>=length||!nativeIsFinite(length)){return""}var padLength=length-strLength;chars=chars==null?" ":chars+"";return repeat(chars,nativeCeil(padLength/chars.length)).slice(0,padLength)}function createPartialWrapper(func,bitmask,thisArg,partials){var isBind=bitmask&BIND_FLAG,Ctor=createCtorWrapper(func);function wrapper(){var argsIndex=-1,argsLength=arguments.length,leftIndex=-1,leftLength=partials.length,args=Array(leftLength+argsLength);while(++leftIndex<leftLength){args[leftIndex]=partials[leftIndex]}while(argsLength--){args[leftIndex++]=arguments[++argsIndex]}var fn=this&&this!==root&&this instanceof wrapper?Ctor:func;return fn.apply(isBind?thisArg:this,args)}return wrapper}function createRound(methodName){var func=Math[methodName];return function(number,precision){precision=precision===undefined?0:+precision||0;if(precision){precision=pow(10,precision);return func(number*precision)/precision}return func(number)}}function createSortedIndex(retHighest){return function(array,value,iteratee,thisArg){var callback=getCallback(iteratee);return iteratee==null&&callback===baseCallback?binaryIndex(array,value,retHighest):binaryIndexBy(array,value,callback(iteratee,thisArg,1),retHighest)}}function createWrapper(func,bitmask,thisArg,partials,holders,argPos,ary,arity){var isBindKey=bitmask&BIND_KEY_FLAG;if(!isBindKey&&typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}var length=partials?partials.length:0;if(!length){bitmask&=~(PARTIAL_FLAG|PARTIAL_RIGHT_FLAG);partials=holders=undefined}length-=holders?holders.length:0;if(bitmask&PARTIAL_RIGHT_FLAG){var partialsRight=partials,holdersRight=holders;partials=holders=undefined}var data=isBindKey?undefined:getData(func),newData=[func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity];if(data){mergeData(newData,data);bitmask=newData[1];arity=newData[9]}newData[9]=arity==null?isBindKey?0:func.length:nativeMax(arity-length,0)||0;if(bitmask==BIND_FLAG){var result=createBindWrapper(newData[0],newData[2])}else if((bitmask==PARTIAL_FLAG||bitmask==(BIND_FLAG|PARTIAL_FLAG))&&!newData[4].length){result=createPartialWrapper.apply(undefined,newData)}else{result=createHybridWrapper.apply(undefined,newData)}var setter=data?baseSetData:setData;return setter(result,newData)}function equalArrays(array,other,equalFunc,customizer,isLoose,stackA,stackB){var index=-1,arrLength=array.length,othLength=other.length;if(arrLength!=othLength&&!(isLoose&&othLength>arrLength)){return false}while(++index<arrLength){var arrValue=array[index],othValue=other[index],result=customizer?customizer(isLoose?othValue:arrValue,isLoose?arrValue:othValue,index):undefined;if(result!==undefined){if(result){continue}return false}if(isLoose){if(!arraySome(other,function(othValue){return arrValue===othValue||equalFunc(arrValue,othValue,customizer,isLoose,stackA,stackB)})){return false}}else if(!(arrValue===othValue||equalFunc(arrValue,othValue,customizer,isLoose,stackA,stackB))){return false}}return true}function equalByTag(object,other,tag){switch(tag){case boolTag:case dateTag:return+object==+other;case errorTag:return object.name==other.name&&object.message==other.message;case numberTag:return object!=+object?other!=+other:object==+other;case regexpTag:case stringTag:return object==other+""}return false}function equalObjects(object,other,equalFunc,customizer,isLoose,stackA,stackB){var objProps=keys(object),objLength=objProps.length,othProps=keys(other),othLength=othProps.length;if(objLength!=othLength&&!isLoose){return false}var index=objLength;while(index--){var key=objProps[index];if(!(isLoose?key in other:hasOwnProperty.call(other,key))){return false}}var skipCtor=isLoose;while(++index<objLength){key=objProps[index];var objValue=object[key],othValue=other[key],result=customizer?customizer(isLoose?othValue:objValue,isLoose?objValue:othValue,key):undefined;if(!(result===undefined?equalFunc(objValue,othValue,customizer,isLoose,stackA,stackB):result)){return false}skipCtor||(skipCtor=key=="constructor")}if(!skipCtor){var objCtor=object.constructor,othCtor=other.constructor;if(objCtor!=othCtor&&("constructor"in object&&"constructor"in other)&&!(typeof objCtor=="function"&&objCtor instanceof objCtor&&typeof othCtor=="function"&&othCtor instanceof othCtor)){return false}}return true}function getCallback(func,thisArg,argCount){var result=lodash.callback||callback;result=result===callback?baseCallback:result;return argCount?result(func,thisArg,argCount):result}var getData=!metaMap?noop:function(func){return metaMap.get(func)};function getFuncName(func){var result=func.name,array=realNames[result],length=array?array.length:0;while(length--){var data=array[length],otherFunc=data.func;if(otherFunc==null||otherFunc==func){return data.name}}return result}function getIndexOf(collection,target,fromIndex){var result=lodash.indexOf||indexOf;result=result===indexOf?baseIndexOf:result;return collection?result(collection,target,fromIndex):result}var getLength=baseProperty("length");function getMatchData(object){var result=pairs(object),length=result.length;while(length--){result[length][2]=isStrictComparable(result[length][1])}return result}function getNative(object,key){var value=object==null?undefined:object[key];return isNative(value)?value:undefined}function getView(start,end,transforms){var index=-1,length=transforms.length;while(++index<length){var data=transforms[index],size=data.size;switch(data.type){case"drop":start+=size;break;case"dropRight":end-=size;break;case"take":end=nativeMin(end,start+size);break;case"takeRight":start=nativeMax(start,end-size);break}}return{start:start,end:end}}function initCloneArray(array){var length=array.length,result=new array.constructor(length);if(length&&typeof array[0]=="string"&&hasOwnProperty.call(array,"index")){result.index=array.index;result.input=array.input}return result}function initCloneObject(object){var Ctor=object.constructor;if(!(typeof Ctor=="function"&&Ctor instanceof Ctor)){Ctor=Object}return new Ctor}function initCloneByTag(object,tag,isDeep){var Ctor=object.constructor;switch(tag){case arrayBufferTag:return bufferClone(object);case boolTag:case dateTag:return new Ctor(+object);case float32Tag:case float64Tag:case int8Tag:case int16Tag:case int32Tag:case uint8Tag:case uint8ClampedTag:case uint16Tag:case uint32Tag:var buffer=object.buffer;return new Ctor(isDeep?bufferClone(buffer):buffer,object.byteOffset,object.length);case numberTag:case stringTag:return new Ctor(object);case regexpTag:var result=new Ctor(object.source,reFlags.exec(object));result.lastIndex=object.lastIndex}return result}function invokePath(object,path,args){if(object!=null&&!isKey(path,object)){path=toPath(path);object=path.length==1?object:baseGet(object,baseSlice(path,0,-1));path=last(path)}var func=object==null?object:object[path];return func==null?undefined:func.apply(object,args)}function isArrayLike(value){return value!=null&&isLength(getLength(value))}function isIndex(value,length){value=typeof value=="number"||reIsUint.test(value)?+value:-1;length=length==null?MAX_SAFE_INTEGER:length;return value>-1&&value%1==0&&value<length}function isIterateeCall(value,index,object){if(!isObject(object)){return false}var type=typeof index;if(type=="number"?isArrayLike(object)&&isIndex(index,object.length):type=="string"&&index in object){var other=object[index];return value===value?value===other:other!==other}return false}function isKey(value,object){var type=typeof value;if(type=="string"&&reIsPlainProp.test(value)||type=="number"){return true}if(isArray(value)){return false}var result=!reIsDeepProp.test(value);return result||object!=null&&value in toObject(object)}function isLaziable(func){var funcName=getFuncName(func);if(!(funcName in LazyWrapper.prototype)){return false}var other=lodash[funcName];if(func===other){return true}var data=getData(other);return!!data&&func===data[0]}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function isStrictComparable(value){return value===value&&!isObject(value)}function mergeData(data,source){var bitmask=data[1],srcBitmask=source[1],newBitmask=bitmask|srcBitmask,isCommon=newBitmask<ARY_FLAG;var isCombo=srcBitmask==ARY_FLAG&&bitmask==CURRY_FLAG||srcBitmask==ARY_FLAG&&bitmask==REARG_FLAG&&data[7].length<=source[8]||srcBitmask==(ARY_FLAG|REARG_FLAG)&&bitmask==CURRY_FLAG;if(!(isCommon||isCombo)){return data}if(srcBitmask&BIND_FLAG){data[2]=source[2];newBitmask|=bitmask&BIND_FLAG?0:CURRY_BOUND_FLAG}var value=source[3];if(value){var partials=data[3];data[3]=partials?composeArgs(partials,value,source[4]):arrayCopy(value);data[4]=partials?replaceHolders(data[3],PLACEHOLDER):arrayCopy(source[4])}value=source[5];if(value){partials=data[5];data[5]=partials?composeArgsRight(partials,value,source[6]):arrayCopy(value);data[6]=partials?replaceHolders(data[5],PLACEHOLDER):arrayCopy(source[6])}value=source[7];if(value){data[7]=arrayCopy(value)}if(srcBitmask&ARY_FLAG){data[8]=data[8]==null?source[8]:nativeMin(data[8],source[8])}if(data[9]==null){data[9]=source[9]}data[0]=source[0];data[1]=newBitmask;return data}function mergeDefaults(objectValue,sourceValue){return objectValue===undefined?sourceValue:merge(objectValue,sourceValue,mergeDefaults)}function pickByArray(object,props){object=toObject(object);var index=-1,length=props.length,result={};while(++index<length){var key=props[index];if(key in object){result[key]=object[key]}}return result}function pickByCallback(object,predicate){var result={};baseForIn(object,function(value,key,object){if(predicate(value,key,object)){result[key]=value}});return result}function reorder(array,indexes){var arrLength=array.length,length=nativeMin(indexes.length,arrLength),oldArray=arrayCopy(array);while(length--){var index=indexes[length];array[length]=isIndex(index,arrLength)?oldArray[index]:undefined}return array}var setData=function(){var count=0,lastCalled=0;return function(key,value){var stamp=now(),remaining=HOT_SPAN-(stamp-lastCalled);lastCalled=stamp;if(remaining>0){if(++count>=HOT_COUNT){return key}}else{count=0}return baseSetData(key,value)}}();function shimKeys(object){var props=keysIn(object),propsLength=props.length,length=propsLength&&object.length;var allowIndexes=!!length&&isLength(length)&&(isArray(object)||isArguments(object));var index=-1,result=[];while(++index<propsLength){var key=props[index];if(allowIndexes&&isIndex(key,length)||hasOwnProperty.call(object,key)){result.push(key)}}return result}function toIterable(value){if(value==null){return[]}if(!isArrayLike(value)){return values(value)}return isObject(value)?value:Object(value)}function toObject(value){return isObject(value)?value:Object(value)}function toPath(value){if(isArray(value)){return value}var result=[];baseToString(value).replace(rePropName,function(match,number,quote,string){result.push(quote?string.replace(reEscapeChar,"$1"):number||match)});return result}function wrapperClone(wrapper){return wrapper instanceof LazyWrapper?wrapper.clone():new LodashWrapper(wrapper.__wrapped__,wrapper.__chain__,arrayCopy(wrapper.__actions__))}function chunk(array,size,guard){if(guard?isIterateeCall(array,size,guard):size==null){size=1}else{size=nativeMax(nativeFloor(size)||1,1)}var index=0,length=array?array.length:0,resIndex=-1,result=Array(nativeCeil(length/size));while(index<length){result[++resIndex]=baseSlice(array,index,index+=size)}return result}function compact(array){var index=-1,length=array?array.length:0,resIndex=-1,result=[];while(++index<length){var value=array[index];if(value){result[++resIndex]=value}}return result}var difference=restParam(function(array,values){return isObjectLike(array)&&isArrayLike(array)?baseDifference(array,baseFlatten(values,false,true)):[]});function drop(array,n,guard){var length=array?array.length:0;if(!length){return[]}if(guard?isIterateeCall(array,n,guard):n==null){n=1}return baseSlice(array,n<0?0:n)}function dropRight(array,n,guard){var length=array?array.length:0;if(!length){return[]}if(guard?isIterateeCall(array,n,guard):n==null){n=1}n=length-(+n||0);return baseSlice(array,0,n<0?0:n)}function dropRightWhile(array,predicate,thisArg){return array&&array.length?baseWhile(array,getCallback(predicate,thisArg,3),true,true):[]}function dropWhile(array,predicate,thisArg){return array&&array.length?baseWhile(array,getCallback(predicate,thisArg,3),true):[]}function fill(array,value,start,end){var length=array?array.length:0;if(!length){return[]}if(start&&typeof start!="number"&&isIterateeCall(array,value,start)){start=0;end=length}return baseFill(array,value,start,end)}var findIndex=createFindIndex();var findLastIndex=createFindIndex(true);function first(array){return array?array[0]:undefined}function flatten(array,isDeep,guard){var length=array?array.length:0;if(guard&&isIterateeCall(array,isDeep,guard)){isDeep=false}return length?baseFlatten(array,isDeep):[]}function flattenDeep(array){var length=array?array.length:0;return length?baseFlatten(array,true):[]}function indexOf(array,value,fromIndex){var length=array?array.length:0;if(!length){return-1}if(typeof fromIndex=="number"){fromIndex=fromIndex<0?nativeMax(length+fromIndex,0):fromIndex}else if(fromIndex){var index=binaryIndex(array,value);if(index<length&&(value===value?value===array[index]:array[index]!==array[index])){return index}return-1}return baseIndexOf(array,value,fromIndex||0)}function initial(array){return dropRight(array,1)}var intersection=restParam(function(arrays){var othLength=arrays.length,othIndex=othLength,caches=Array(length),indexOf=getIndexOf(),isCommon=indexOf==baseIndexOf,result=[];while(othIndex--){var value=arrays[othIndex]=isArrayLike(value=arrays[othIndex])?value:[];caches[othIndex]=isCommon&&value.length>=120?createCache(othIndex&&value):null}var array=arrays[0],index=-1,length=array?array.length:0,seen=caches[0];outer:while(++index<length){value=array[index];if((seen?cacheIndexOf(seen,value):indexOf(result,value,0))<0){var othIndex=othLength;while(--othIndex){var cache=caches[othIndex];if((cache?cacheIndexOf(cache,value):indexOf(arrays[othIndex],value,0))<0){continue outer}}if(seen){seen.push(value)}result.push(value)}}return result});function last(array){var length=array?array.length:0;return length?array[length-1]:undefined}function lastIndexOf(array,value,fromIndex){var length=array?array.length:0;if(!length){return-1}var index=length;if(typeof fromIndex=="number"){index=(fromIndex<0?nativeMax(length+fromIndex,0):nativeMin(fromIndex||0,length-1))+1}else if(fromIndex){index=binaryIndex(array,value,true)-1;var other=array[index];if(value===value?value===other:other!==other){return index}return-1}if(value!==value){return indexOfNaN(array,index,true)}while(index--){if(array[index]===value){return index}}return-1}function pull(){var args=arguments,array=args[0];if(!(array&&array.length)){return array}var index=0,indexOf=getIndexOf(),length=args.length;while(++index<length){var fromIndex=0,value=args[index];while((fromIndex=indexOf(array,value,fromIndex))>-1){splice.call(array,fromIndex,1)}}return array}var pullAt=restParam(function(array,indexes){indexes=baseFlatten(indexes);var result=baseAt(array,indexes);basePullAt(array,indexes.sort(baseCompareAscending));return result});function remove(array,predicate,thisArg){var result=[];if(!(array&&array.length)){return result}var index=-1,indexes=[],length=array.length;predicate=getCallback(predicate,thisArg,3);while(++index<length){var value=array[index];if(predicate(value,index,array)){result.push(value);indexes.push(index)}}basePullAt(array,indexes);return result}function rest(array){return drop(array,1)}function slice(array,start,end){var length=array?array.length:0;if(!length){return[]}if(end&&typeof end!="number"&&isIterateeCall(array,start,end)){start=0;end=length}return baseSlice(array,start,end)}var sortedIndex=createSortedIndex();var sortedLastIndex=createSortedIndex(true);function take(array,n,guard){var length=array?array.length:0;if(!length){return[]}if(guard?isIterateeCall(array,n,guard):n==null){n=1}return baseSlice(array,0,n<0?0:n)}function takeRight(array,n,guard){var length=array?array.length:0;if(!length){return[]}if(guard?isIterateeCall(array,n,guard):n==null){n=1}n=length-(+n||0);return baseSlice(array,n<0?0:n)}function takeRightWhile(array,predicate,thisArg){return array&&array.length?baseWhile(array,getCallback(predicate,thisArg,3),false,true):[]}function takeWhile(array,predicate,thisArg){return array&&array.length?baseWhile(array,getCallback(predicate,thisArg,3)):[]}var union=restParam(function(arrays){return baseUniq(baseFlatten(arrays,false,true))});function uniq(array,isSorted,iteratee,thisArg){var length=array?array.length:0;if(!length){return[]}if(isSorted!=null&&typeof isSorted!="boolean"){thisArg=iteratee;iteratee=isIterateeCall(array,isSorted,thisArg)?undefined:isSorted;isSorted=false}var callback=getCallback();if(!(iteratee==null&&callback===baseCallback)){iteratee=callback(iteratee,thisArg,3)}return isSorted&&getIndexOf()==baseIndexOf?sortedUniq(array,iteratee):baseUniq(array,iteratee)}function unzip(array){if(!(array&&array.length)){return[]}var index=-1,length=0;array=arrayFilter(array,function(group){if(isArrayLike(group)){length=nativeMax(group.length,length);return true}});var result=Array(length);while(++index<length){result[index]=arrayMap(array,baseProperty(index))}return result}function unzipWith(array,iteratee,thisArg){var length=array?array.length:0;if(!length){return[]}var result=unzip(array);if(iteratee==null){return result}iteratee=bindCallback(iteratee,thisArg,4);return arrayMap(result,function(group){return arrayReduce(group,iteratee,undefined,true)})}var without=restParam(function(array,values){return isArrayLike(array)?baseDifference(array,values):[]});function xor(){var index=-1,length=arguments.length;while(++index<length){var array=arguments[index];if(isArrayLike(array)){var result=result?arrayPush(baseDifference(result,array),baseDifference(array,result)):array}}return result?baseUniq(result):[]}var zip=restParam(unzip);function zipObject(props,values){var index=-1,length=props?props.length:0,result={};if(length&&!values&&!isArray(props[0])){values=[]}while(++index<length){var key=props[index];if(values){result[key]=values[index]}else if(key){result[key[0]]=key[1]}}return result}var zipWith=restParam(function(arrays){var length=arrays.length,iteratee=length>2?arrays[length-2]:undefined,thisArg=length>1?arrays[length-1]:undefined;if(length>2&&typeof iteratee=="function"){length-=2}else{iteratee=length>1&&typeof thisArg=="function"?(--length,thisArg):undefined;thisArg=undefined}arrays.length=length;return unzipWith(arrays,iteratee,thisArg)});function chain(value){var result=lodash(value);result.__chain__=true;return result}function tap(value,interceptor,thisArg){interceptor.call(thisArg,value);return value}function thru(value,interceptor,thisArg){return interceptor.call(thisArg,value)}function wrapperChain(){return chain(this)}function wrapperCommit(){return new LodashWrapper(this.value(),this.__chain__)}var wrapperConcat=restParam(function(values){values=baseFlatten(values);return this.thru(function(array){return arrayConcat(isArray(array)?array:[toObject(array)],values)})});function wrapperPlant(value){var result,parent=this;while(parent instanceof baseLodash){var clone=wrapperClone(parent);if(result){previous.__wrapped__=clone}else{result=clone}var previous=clone;parent=parent.__wrapped__}previous.__wrapped__=value;return result}function wrapperReverse(){var value=this.__wrapped__;var interceptor=function(value){return wrapped&&wrapped.__dir__<0?value:value.reverse()};if(value instanceof LazyWrapper){var wrapped=value;if(this.__actions__.length){wrapped=new LazyWrapper(this)}wrapped=wrapped.reverse();wrapped.__actions__.push({func:thru,args:[interceptor],thisArg:undefined});return new LodashWrapper(wrapped,this.__chain__)}return this.thru(interceptor)}function wrapperToString(){return this.value()+""}function wrapperValue(){return baseWrapperValue(this.__wrapped__,this.__actions__)}var at=restParam(function(collection,props){return baseAt(collection,baseFlatten(props))});var countBy=createAggregator(function(result,value,key){hasOwnProperty.call(result,key)?++result[key]:result[key]=1});function every(collection,predicate,thisArg){var func=isArray(collection)?arrayEvery:baseEvery;if(thisArg&&isIterateeCall(collection,predicate,thisArg)){predicate=undefined}if(typeof predicate!="function"||thisArg!==undefined){predicate=getCallback(predicate,thisArg,3)}return func(collection,predicate)}function filter(collection,predicate,thisArg){var func=isArray(collection)?arrayFilter:baseFilter;predicate=getCallback(predicate,thisArg,3);return func(collection,predicate)}var find=createFind(baseEach);var findLast=createFind(baseEachRight,true);function findWhere(collection,source){return find(collection,baseMatches(source))}var forEach=createForEach(arrayEach,baseEach);var forEachRight=createForEach(arrayEachRight,baseEachRight);var groupBy=createAggregator(function(result,value,key){if(hasOwnProperty.call(result,key)){result[key].push(value)}else{result[key]=[value]}});function includes(collection,target,fromIndex,guard){var length=collection?getLength(collection):0;if(!isLength(length)){collection=values(collection);length=collection.length}if(typeof fromIndex!="number"||guard&&isIterateeCall(target,fromIndex,guard)){fromIndex=0}else{fromIndex=fromIndex<0?nativeMax(length+fromIndex,0):fromIndex||0}return typeof collection=="string"||!isArray(collection)&&isString(collection)?fromIndex<=length&&collection.indexOf(target,fromIndex)>-1:!!length&&getIndexOf(collection,target,fromIndex)>-1;
}var indexBy=createAggregator(function(result,value,key){result[key]=value});var invoke=restParam(function(collection,path,args){var index=-1,isFunc=typeof path=="function",isProp=isKey(path),result=isArrayLike(collection)?Array(collection.length):[];baseEach(collection,function(value){var func=isFunc?path:isProp&&value!=null?value[path]:undefined;result[++index]=func?func.apply(value,args):invokePath(value,path,args)});return result});function map(collection,iteratee,thisArg){var func=isArray(collection)?arrayMap:baseMap;iteratee=getCallback(iteratee,thisArg,3);return func(collection,iteratee)}var partition=createAggregator(function(result,value,key){result[key?0:1].push(value)},function(){return[[],[]]});function pluck(collection,path){return map(collection,property(path))}var reduce=createReduce(arrayReduce,baseEach);var reduceRight=createReduce(arrayReduceRight,baseEachRight);function reject(collection,predicate,thisArg){var func=isArray(collection)?arrayFilter:baseFilter;predicate=getCallback(predicate,thisArg,3);return func(collection,function(value,index,collection){return!predicate(value,index,collection)})}function sample(collection,n,guard){if(guard?isIterateeCall(collection,n,guard):n==null){collection=toIterable(collection);var length=collection.length;return length>0?collection[baseRandom(0,length-1)]:undefined}var index=-1,result=toArray(collection),length=result.length,lastIndex=length-1;n=nativeMin(n<0?0:+n||0,length);while(++index<n){var rand=baseRandom(index,lastIndex),value=result[rand];result[rand]=result[index];result[index]=value}result.length=n;return result}function shuffle(collection){return sample(collection,POSITIVE_INFINITY)}function size(collection){var length=collection?getLength(collection):0;return isLength(length)?length:keys(collection).length}function some(collection,predicate,thisArg){var func=isArray(collection)?arraySome:baseSome;if(thisArg&&isIterateeCall(collection,predicate,thisArg)){predicate=undefined}if(typeof predicate!="function"||thisArg!==undefined){predicate=getCallback(predicate,thisArg,3)}return func(collection,predicate)}function sortBy(collection,iteratee,thisArg){if(collection==null){return[]}if(thisArg&&isIterateeCall(collection,iteratee,thisArg)){iteratee=undefined}var index=-1;iteratee=getCallback(iteratee,thisArg,3);var result=baseMap(collection,function(value,key,collection){return{criteria:iteratee(value,key,collection),index:++index,value:value}});return baseSortBy(result,compareAscending)}var sortByAll=restParam(function(collection,iteratees){if(collection==null){return[]}var guard=iteratees[2];if(guard&&isIterateeCall(iteratees[0],iteratees[1],guard)){iteratees.length=1}return baseSortByOrder(collection,baseFlatten(iteratees),[])});function sortByOrder(collection,iteratees,orders,guard){if(collection==null){return[]}if(guard&&isIterateeCall(iteratees,orders,guard)){orders=undefined}if(!isArray(iteratees)){iteratees=iteratees==null?[]:[iteratees]}if(!isArray(orders)){orders=orders==null?[]:[orders]}return baseSortByOrder(collection,iteratees,orders)}function where(collection,source){return filter(collection,baseMatches(source))}var now=nativeNow||function(){return(new Date).getTime()};function after(n,func){if(typeof func!="function"){if(typeof n=="function"){var temp=n;n=func;func=temp}else{throw new TypeError(FUNC_ERROR_TEXT)}}n=nativeIsFinite(n=+n)?n:0;return function(){if(--n<1){return func.apply(this,arguments)}}}function ary(func,n,guard){if(guard&&isIterateeCall(func,n,guard)){n=undefined}n=func&&n==null?func.length:nativeMax(+n||0,0);return createWrapper(func,ARY_FLAG,undefined,undefined,undefined,undefined,n)}function before(n,func){var result;if(typeof func!="function"){if(typeof n=="function"){var temp=n;n=func;func=temp}else{throw new TypeError(FUNC_ERROR_TEXT)}}return function(){if(--n>0){result=func.apply(this,arguments)}if(n<=1){func=undefined}return result}}var bind=restParam(function(func,thisArg,partials){var bitmask=BIND_FLAG;if(partials.length){var holders=replaceHolders(partials,bind.placeholder);bitmask|=PARTIAL_FLAG}return createWrapper(func,bitmask,thisArg,partials,holders)});var bindAll=restParam(function(object,methodNames){methodNames=methodNames.length?baseFlatten(methodNames):functions(object);var index=-1,length=methodNames.length;while(++index<length){var key=methodNames[index];object[key]=createWrapper(object[key],BIND_FLAG,object)}return object});var bindKey=restParam(function(object,key,partials){var bitmask=BIND_FLAG|BIND_KEY_FLAG;if(partials.length){var holders=replaceHolders(partials,bindKey.placeholder);bitmask|=PARTIAL_FLAG}return createWrapper(key,bitmask,object,partials,holders)});var curry=createCurry(CURRY_FLAG);var curryRight=createCurry(CURRY_RIGHT_FLAG);function debounce(func,wait,options){var args,maxTimeoutId,result,stamp,thisArg,timeoutId,trailingCall,lastCalled=0,maxWait=false,trailing=true;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}wait=wait<0?0:+wait||0;if(options===true){var leading=true;trailing=false}else if(isObject(options)){leading=!!options.leading;maxWait="maxWait"in options&&nativeMax(+options.maxWait||0,wait);trailing="trailing"in options?!!options.trailing:trailing}function cancel(){if(timeoutId){clearTimeout(timeoutId)}if(maxTimeoutId){clearTimeout(maxTimeoutId)}lastCalled=0;maxTimeoutId=timeoutId=trailingCall=undefined}function complete(isCalled,id){if(id){clearTimeout(id)}maxTimeoutId=timeoutId=trailingCall=undefined;if(isCalled){lastCalled=now();result=func.apply(thisArg,args);if(!timeoutId&&!maxTimeoutId){args=thisArg=undefined}}}function delayed(){var remaining=wait-(now()-stamp);if(remaining<=0||remaining>wait){complete(trailingCall,maxTimeoutId)}else{timeoutId=setTimeout(delayed,remaining)}}function maxDelayed(){complete(trailing,timeoutId)}function debounced(){args=arguments;stamp=now();thisArg=this;trailingCall=trailing&&(timeoutId||!leading);if(maxWait===false){var leadingCall=leading&&!timeoutId}else{if(!maxTimeoutId&&!leading){lastCalled=stamp}var remaining=maxWait-(stamp-lastCalled),isCalled=remaining<=0||remaining>maxWait;if(isCalled){if(maxTimeoutId){maxTimeoutId=clearTimeout(maxTimeoutId)}lastCalled=stamp;result=func.apply(thisArg,args)}else if(!maxTimeoutId){maxTimeoutId=setTimeout(maxDelayed,remaining)}}if(isCalled&&timeoutId){timeoutId=clearTimeout(timeoutId)}else if(!timeoutId&&wait!==maxWait){timeoutId=setTimeout(delayed,wait)}if(leadingCall){isCalled=true;result=func.apply(thisArg,args)}if(isCalled&&!timeoutId&&!maxTimeoutId){args=thisArg=undefined}return result}debounced.cancel=cancel;return debounced}var defer=restParam(function(func,args){return baseDelay(func,1,args)});var delay=restParam(function(func,wait,args){return baseDelay(func,wait,args)});var flow=createFlow();var flowRight=createFlow(true);function memoize(func,resolver){if(typeof func!="function"||resolver&&typeof resolver!="function"){throw new TypeError(FUNC_ERROR_TEXT)}var memoized=function(){var args=arguments,key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key)){return cache.get(key)}var result=func.apply(this,args);memoized.cache=cache.set(key,result);return result};memoized.cache=new memoize.Cache;return memoized}var modArgs=restParam(function(func,transforms){transforms=baseFlatten(transforms);if(typeof func!="function"||!arrayEvery(transforms,baseIsFunction)){throw new TypeError(FUNC_ERROR_TEXT)}var length=transforms.length;return restParam(function(args){var index=nativeMin(args.length,length);while(index--){args[index]=transforms[index](args[index])}return func.apply(this,args)})});function negate(predicate){if(typeof predicate!="function"){throw new TypeError(FUNC_ERROR_TEXT)}return function(){return!predicate.apply(this,arguments)}}function once(func){return before(2,func)}var partial=createPartial(PARTIAL_FLAG);var partialRight=createPartial(PARTIAL_RIGHT_FLAG);var rearg=restParam(function(func,indexes){return createWrapper(func,REARG_FLAG,undefined,undefined,undefined,baseFlatten(indexes))});function restParam(func,start){if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}start=nativeMax(start===undefined?func.length-1:+start||0,0);return function(){var args=arguments,index=-1,length=nativeMax(args.length-start,0),rest=Array(length);while(++index<length){rest[index]=args[start+index]}switch(start){case 0:return func.call(this,rest);case 1:return func.call(this,args[0],rest);case 2:return func.call(this,args[0],args[1],rest)}var otherArgs=Array(start+1);index=-1;while(++index<start){otherArgs[index]=args[index]}otherArgs[start]=rest;return func.apply(this,otherArgs)}}function spread(func){if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}return function(array){return func.apply(this,array)}}function throttle(func,wait,options){var leading=true,trailing=true;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}if(options===false){leading=false}else if(isObject(options)){leading="leading"in options?!!options.leading:leading;trailing="trailing"in options?!!options.trailing:trailing}return debounce(func,wait,{leading:leading,maxWait:+wait,trailing:trailing})}function wrap(value,wrapper){wrapper=wrapper==null?identity:wrapper;return createWrapper(wrapper,PARTIAL_FLAG,undefined,[value],[])}function clone(value,isDeep,customizer,thisArg){if(isDeep&&typeof isDeep!="boolean"&&isIterateeCall(value,isDeep,customizer)){isDeep=false}else if(typeof isDeep=="function"){thisArg=customizer;customizer=isDeep;isDeep=false}return typeof customizer=="function"?baseClone(value,isDeep,bindCallback(customizer,thisArg,1)):baseClone(value,isDeep)}function cloneDeep(value,customizer,thisArg){return typeof customizer=="function"?baseClone(value,true,bindCallback(customizer,thisArg,1)):baseClone(value,true)}function gt(value,other){return value>other}function gte(value,other){return value>=other}function isArguments(value){return isObjectLike(value)&&isArrayLike(value)&&hasOwnProperty.call(value,"callee")&&!propertyIsEnumerable.call(value,"callee")}var isArray=nativeIsArray||function(value){return isObjectLike(value)&&isLength(value.length)&&objToString.call(value)==arrayTag};function isBoolean(value){return value===true||value===false||isObjectLike(value)&&objToString.call(value)==boolTag}function isDate(value){return isObjectLike(value)&&objToString.call(value)==dateTag}function isElement(value){return!!value&&value.nodeType===1&&isObjectLike(value)&&!isPlainObject(value)}function isEmpty(value){if(value==null){return true}if(isArrayLike(value)&&(isArray(value)||isString(value)||isArguments(value)||isObjectLike(value)&&isFunction(value.splice))){return!value.length}return!keys(value).length}function isEqual(value,other,customizer,thisArg){customizer=typeof customizer=="function"?bindCallback(customizer,thisArg,3):undefined;var result=customizer?customizer(value,other):undefined;return result===undefined?baseIsEqual(value,other,customizer):!!result}function isError(value){return isObjectLike(value)&&typeof value.message=="string"&&objToString.call(value)==errorTag}function isFinite(value){return typeof value=="number"&&nativeIsFinite(value)}function isFunction(value){return isObject(value)&&objToString.call(value)==funcTag}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isMatch(object,source,customizer,thisArg){customizer=typeof customizer=="function"?bindCallback(customizer,thisArg,3):undefined;return baseIsMatch(object,getMatchData(source),customizer)}function isNaN(value){return isNumber(value)&&value!=+value}function isNative(value){if(value==null){return false}if(isFunction(value)){return reIsNative.test(fnToString.call(value))}return isObjectLike(value)&&reIsHostCtor.test(value)}function isNull(value){return value===null}function isNumber(value){return typeof value=="number"||isObjectLike(value)&&objToString.call(value)==numberTag}function isPlainObject(value){var Ctor;if(!(isObjectLike(value)&&objToString.call(value)==objectTag&&!isArguments(value))||!hasOwnProperty.call(value,"constructor")&&(Ctor=value.constructor,typeof Ctor=="function"&&!(Ctor instanceof Ctor))){return false}var result;baseForIn(value,function(subValue,key){result=key});return result===undefined||hasOwnProperty.call(value,result)}function isRegExp(value){return isObject(value)&&objToString.call(value)==regexpTag}function isString(value){return typeof value=="string"||isObjectLike(value)&&objToString.call(value)==stringTag}function isTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[objToString.call(value)]}function isUndefined(value){return value===undefined}function lt(value,other){return value<other}function lte(value,other){return value<=other}function toArray(value){var length=value?getLength(value):0;if(!isLength(length)){return values(value)}if(!length){return[]}return arrayCopy(value)}function toPlainObject(value){return baseCopy(value,keysIn(value))}var merge=createAssigner(baseMerge);var assign=createAssigner(function(object,source,customizer){return customizer?assignWith(object,source,customizer):baseAssign(object,source)});function create(prototype,properties,guard){var result=baseCreate(prototype);if(guard&&isIterateeCall(prototype,properties,guard)){properties=undefined}return properties?baseAssign(result,properties):result}var defaults=createDefaults(assign,assignDefaults);var defaultsDeep=createDefaults(merge,mergeDefaults);var findKey=createFindKey(baseForOwn);var findLastKey=createFindKey(baseForOwnRight);var forIn=createForIn(baseFor);var forInRight=createForIn(baseForRight);var forOwn=createForOwn(baseForOwn);var forOwnRight=createForOwn(baseForOwnRight);function functions(object){return baseFunctions(object,keysIn(object))}function get(object,path,defaultValue){var result=object==null?undefined:baseGet(object,toPath(path),path+"");return result===undefined?defaultValue:result}function has(object,path){if(object==null){return false}var result=hasOwnProperty.call(object,path);if(!result&&!isKey(path)){path=toPath(path);object=path.length==1?object:baseGet(object,baseSlice(path,0,-1));if(object==null){return false}path=last(path);result=hasOwnProperty.call(object,path)}return result||isLength(object.length)&&isIndex(path,object.length)&&(isArray(object)||isArguments(object))}function invert(object,multiValue,guard){if(guard&&isIterateeCall(object,multiValue,guard)){multiValue=undefined}var index=-1,props=keys(object),length=props.length,result={};while(++index<length){var key=props[index],value=object[key];if(multiValue){if(hasOwnProperty.call(result,value)){result[value].push(key)}else{result[value]=[key]}}else{result[value]=key}}return result}var keys=!nativeKeys?shimKeys:function(object){var Ctor=object==null?undefined:object.constructor;if(typeof Ctor=="function"&&Ctor.prototype===object||typeof object!="function"&&isArrayLike(object)){return shimKeys(object)}return isObject(object)?nativeKeys(object):[]};function keysIn(object){if(object==null){return[]}if(!isObject(object)){object=Object(object)}var length=object.length;length=length&&isLength(length)&&(isArray(object)||isArguments(object))&&length||0;var Ctor=object.constructor,index=-1,isProto=typeof Ctor=="function"&&Ctor.prototype===object,result=Array(length),skipIndexes=length>0;while(++index<length){result[index]=index+""}for(var key in object){if(!(skipIndexes&&isIndex(key,length))&&!(key=="constructor"&&(isProto||!hasOwnProperty.call(object,key)))){result.push(key)}}return result}var mapKeys=createObjectMapper(true);var mapValues=createObjectMapper();var omit=restParam(function(object,props){if(object==null){return{}}if(typeof props[0]!="function"){var props=arrayMap(baseFlatten(props),String);return pickByArray(object,baseDifference(keysIn(object),props))}var predicate=bindCallback(props[0],props[1],3);return pickByCallback(object,function(value,key,object){return!predicate(value,key,object)})});function pairs(object){object=toObject(object);var index=-1,props=keys(object),length=props.length,result=Array(length);while(++index<length){var key=props[index];result[index]=[key,object[key]]}return result}var pick=restParam(function(object,props){if(object==null){return{}}return typeof props[0]=="function"?pickByCallback(object,bindCallback(props[0],props[1],3)):pickByArray(object,baseFlatten(props))});function result(object,path,defaultValue){var result=object==null?undefined:object[path];if(result===undefined){if(object!=null&&!isKey(path,object)){path=toPath(path);object=path.length==1?object:baseGet(object,baseSlice(path,0,-1));result=object==null?undefined:object[last(path)]}result=result===undefined?defaultValue:result}return isFunction(result)?result.call(object):result}function set(object,path,value){if(object==null){return object}var pathKey=path+"";path=object[pathKey]!=null||isKey(path,object)?[pathKey]:toPath(path);var index=-1,length=path.length,lastIndex=length-1,nested=object;while(nested!=null&&++index<length){var key=path[index];if(isObject(nested)){if(index==lastIndex){nested[key]=value}else if(nested[key]==null){nested[key]=isIndex(path[index+1])?[]:{}}}nested=nested[key]}return object}function transform(object,iteratee,accumulator,thisArg){var isArr=isArray(object)||isTypedArray(object);iteratee=getCallback(iteratee,thisArg,4);if(accumulator==null){if(isArr||isObject(object)){var Ctor=object.constructor;if(isArr){accumulator=isArray(object)?new Ctor:[]}else{accumulator=baseCreate(isFunction(Ctor)?Ctor.prototype:undefined)}}else{accumulator={}}}(isArr?arrayEach:baseForOwn)(object,function(value,index,object){return iteratee(accumulator,value,index,object)});return accumulator}function values(object){return baseValues(object,keys(object))}function valuesIn(object){return baseValues(object,keysIn(object))}function inRange(value,start,end){start=+start||0;if(end===undefined){end=start;start=0}else{end=+end||0}return value>=nativeMin(start,end)&&value<nativeMax(start,end)}function random(min,max,floating){if(floating&&isIterateeCall(min,max,floating)){max=floating=undefined}var noMin=min==null,noMax=max==null;if(floating==null){if(noMax&&typeof min=="boolean"){floating=min;min=1}else if(typeof max=="boolean"){floating=max;noMax=true}}if(noMin&&noMax){max=1;noMax=false}min=+min||0;if(noMax){max=min;min=0}else{max=+max||0}if(floating||min%1||max%1){var rand=nativeRandom();return nativeMin(min+rand*(max-min+parseFloat("1e-"+((rand+"").length-1))),max)}return baseRandom(min,max)}var camelCase=createCompounder(function(result,word,index){word=word.toLowerCase();return result+(index?word.charAt(0).toUpperCase()+word.slice(1):word)});function capitalize(string){string=baseToString(string);return string&&string.charAt(0).toUpperCase()+string.slice(1)}function deburr(string){string=baseToString(string);return string&&string.replace(reLatin1,deburrLetter).replace(reComboMark,"")}function endsWith(string,target,position){string=baseToString(string);target=target+"";var length=string.length;position=position===undefined?length:nativeMin(position<0?0:+position||0,length);position-=target.length;return position>=0&&string.indexOf(target,position)==position}function escape(string){string=baseToString(string);return string&&reHasUnescapedHtml.test(string)?string.replace(reUnescapedHtml,escapeHtmlChar):string}function escapeRegExp(string){string=baseToString(string);return string&&reHasRegExpChars.test(string)?string.replace(reRegExpChars,escapeRegExpChar):string||"(?:)"}var kebabCase=createCompounder(function(result,word,index){return result+(index?"-":"")+word.toLowerCase()});function pad(string,length,chars){string=baseToString(string);length=+length;var strLength=string.length;if(strLength>=length||!nativeIsFinite(length)){return string}var mid=(length-strLength)/2,leftLength=nativeFloor(mid),rightLength=nativeCeil(mid);chars=createPadding("",rightLength,chars);return chars.slice(0,leftLength)+string+chars}var padLeft=createPadDir();var padRight=createPadDir(true);function parseInt(string,radix,guard){if(guard?isIterateeCall(string,radix,guard):radix==null){radix=0}else if(radix){radix=+radix}string=trim(string);return nativeParseInt(string,radix||(reHasHexPrefix.test(string)?16:10))}function repeat(string,n){var result="";string=baseToString(string);n=+n;if(n<1||!string||!nativeIsFinite(n)){return result}do{if(n%2){result+=string}n=nativeFloor(n/2);string+=string}while(n);return result}var snakeCase=createCompounder(function(result,word,index){return result+(index?"_":"")+word.toLowerCase()});var startCase=createCompounder(function(result,word,index){return result+(index?" ":"")+(word.charAt(0).toUpperCase()+word.slice(1))});function startsWith(string,target,position){string=baseToString(string);position=position==null?0:nativeMin(position<0?0:+position||0,string.length);return string.lastIndexOf(target,position)==position}function template(string,options,otherOptions){var settings=lodash.templateSettings;if(otherOptions&&isIterateeCall(string,options,otherOptions)){options=otherOptions=undefined}string=baseToString(string);options=assignWith(baseAssign({},otherOptions||options),settings,assignOwnDefaults);var imports=assignWith(baseAssign({},options.imports),settings.imports,assignOwnDefaults),importsKeys=keys(imports),importsValues=baseValues(imports,importsKeys);var isEscaping,isEvaluating,index=0,interpolate=options.interpolate||reNoMatch,source="__p += '";var reDelimiters=RegExp((options.escape||reNoMatch).source+"|"+interpolate.source+"|"+(interpolate===reInterpolate?reEsTemplate:reNoMatch).source+"|"+(options.evaluate||reNoMatch).source+"|$","g");var sourceURL="//# sourceURL="+("sourceURL"in options?options.sourceURL:"lodash.templateSources["+ ++templateCounter+"]")+"\n";string.replace(reDelimiters,function(match,escapeValue,interpolateValue,esTemplateValue,evaluateValue,offset){interpolateValue||(interpolateValue=esTemplateValue);source+=string.slice(index,offset).replace(reUnescapedString,escapeStringChar);if(escapeValue){isEscaping=true;source+="' +\n__e("+escapeValue+") +\n'"}if(evaluateValue){isEvaluating=true;source+="';\n"+evaluateValue+";\n__p += '"}if(interpolateValue){source+="' +\n((__t = ("+interpolateValue+")) == null ? '' : __t) +\n'"}index=offset+match.length;return match});source+="';\n";var variable=options.variable;if(!variable){source="with (obj) {\n"+source+"\n}\n"}source=(isEvaluating?source.replace(reEmptyStringLeading,""):source).replace(reEmptyStringMiddle,"$1").replace(reEmptyStringTrailing,"$1;");source="function("+(variable||"obj")+") {\n"+(variable?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(isEscaping?", __e = _.escape":"")+(isEvaluating?", __j = Array.prototype.join;\n"+"function print() { __p += __j.call(arguments, '') }\n":";\n")+source+"return __p\n}";var result=attempt(function(){return Function(importsKeys,sourceURL+"return "+source).apply(undefined,importsValues)});result.source=source;if(isError(result)){throw result}return result}function trim(string,chars,guard){var value=string;string=baseToString(string);if(!string){return string}if(guard?isIterateeCall(value,chars,guard):chars==null){return string.slice(trimmedLeftIndex(string),trimmedRightIndex(string)+1)}chars=chars+"";return string.slice(charsLeftIndex(string,chars),charsRightIndex(string,chars)+1)}function trimLeft(string,chars,guard){var value=string;string=baseToString(string);if(!string){return string}if(guard?isIterateeCall(value,chars,guard):chars==null){return string.slice(trimmedLeftIndex(string))}return string.slice(charsLeftIndex(string,chars+""))}function trimRight(string,chars,guard){var value=string;string=baseToString(string);if(!string){return string}if(guard?isIterateeCall(value,chars,guard):chars==null){return string.slice(0,trimmedRightIndex(string)+1)}return string.slice(0,charsRightIndex(string,chars+"")+1)}function trunc(string,options,guard){if(guard&&isIterateeCall(string,options,guard)){options=undefined}var length=DEFAULT_TRUNC_LENGTH,omission=DEFAULT_TRUNC_OMISSION;if(options!=null){if(isObject(options)){var separator="separator"in options?options.separator:separator;length="length"in options?+options.length||0:length;omission="omission"in options?baseToString(options.omission):omission}else{length=+options||0}}string=baseToString(string);if(length>=string.length){return string}var end=length-omission.length;if(end<1){return omission}var result=string.slice(0,end);if(separator==null){return result+omission}if(isRegExp(separator)){if(string.slice(end).search(separator)){var match,newEnd,substring=string.slice(0,end);if(!separator.global){separator=RegExp(separator.source,(reFlags.exec(separator)||"")+"g")}separator.lastIndex=0;while(match=separator.exec(substring)){newEnd=match.index}result=result.slice(0,newEnd==null?end:newEnd)}}else if(string.indexOf(separator,end)!=end){var index=result.lastIndexOf(separator);if(index>-1){result=result.slice(0,index)}}return result+omission}function unescape(string){string=baseToString(string);return string&&reHasEscapedHtml.test(string)?string.replace(reEscapedHtml,unescapeHtmlChar):string}function words(string,pattern,guard){if(guard&&isIterateeCall(string,pattern,guard)){pattern=undefined}string=baseToString(string);return string.match(pattern||reWords)||[]}var attempt=restParam(function(func,args){try{return func.apply(undefined,args)}catch(e){return isError(e)?e:new Error(e)}});function callback(func,thisArg,guard){if(guard&&isIterateeCall(func,thisArg,guard)){thisArg=undefined}return isObjectLike(func)?matches(func):baseCallback(func,thisArg)}function constant(value){return function(){return value}}function identity(value){return value}function matches(source){return baseMatches(baseClone(source,true))}function matchesProperty(path,srcValue){return baseMatchesProperty(path,baseClone(srcValue,true))}var method=restParam(function(path,args){return function(object){return invokePath(object,path,args)}});var methodOf=restParam(function(object,args){return function(path){return invokePath(object,path,args)}});function mixin(object,source,options){if(options==null){var isObj=isObject(source),props=isObj?keys(source):undefined,methodNames=props&&props.length?baseFunctions(source,props):undefined;if(!(methodNames?methodNames.length:isObj)){methodNames=false;options=source;source=object;object=this}}if(!methodNames){methodNames=baseFunctions(source,keys(source))}var chain=true,index=-1,isFunc=isFunction(object),length=methodNames.length;if(options===false){chain=false}else if(isObject(options)&&"chain"in options){chain=options.chain}while(++index<length){var methodName=methodNames[index],func=source[methodName];object[methodName]=func;if(isFunc){object.prototype[methodName]=function(func){return function(){var chainAll=this.__chain__;if(chain||chainAll){var result=object(this.__wrapped__),actions=result.__actions__=arrayCopy(this.__actions__);actions.push({func:func,args:arguments,thisArg:object});result.__chain__=chainAll;return result}return func.apply(object,arrayPush([this.value()],arguments))}}(func)}}return object}function noConflict(){root._=oldDash;return this}function noop(){}function property(path){return isKey(path)?baseProperty(path):basePropertyDeep(path)}function propertyOf(object){return function(path){return baseGet(object,toPath(path),path+"")}}function range(start,end,step){if(step&&isIterateeCall(start,end,step)){end=step=undefined}start=+start||0;step=step==null?1:+step||0;if(end==null){end=start;start=0}else{end=+end||0}var index=-1,length=nativeMax(nativeCeil((end-start)/(step||1)),0),result=Array(length);while(++index<length){result[index]=start;start+=step}return result}function times(n,iteratee,thisArg){n=nativeFloor(n);if(n<1||!nativeIsFinite(n)){return[]}var index=-1,result=Array(nativeMin(n,MAX_ARRAY_LENGTH));iteratee=bindCallback(iteratee,thisArg,1);while(++index<n){if(index<MAX_ARRAY_LENGTH){result[index]=iteratee(index)}else{iteratee(index)}}return result}function uniqueId(prefix){var id=++idCounter;return baseToString(prefix)+id}function add(augend,addend){return(+augend||0)+(+addend||0)}var ceil=createRound("ceil");var floor=createRound("floor");var max=createExtremum(gt,NEGATIVE_INFINITY);var min=createExtremum(lt,POSITIVE_INFINITY);var round=createRound("round");function sum(collection,iteratee,thisArg){if(thisArg&&isIterateeCall(collection,iteratee,thisArg)){iteratee=undefined}iteratee=getCallback(iteratee,thisArg,3);return iteratee.length==1?arraySum(isArray(collection)?collection:toIterable(collection),iteratee):baseSum(collection,iteratee)}lodash.prototype=baseLodash.prototype;LodashWrapper.prototype=baseCreate(baseLodash.prototype);LodashWrapper.prototype.constructor=LodashWrapper;LazyWrapper.prototype=baseCreate(baseLodash.prototype);LazyWrapper.prototype.constructor=LazyWrapper;MapCache.prototype["delete"]=mapDelete;MapCache.prototype.get=mapGet;MapCache.prototype.has=mapHas;MapCache.prototype.set=mapSet;SetCache.prototype.push=cachePush;memoize.Cache=MapCache;lodash.after=after;lodash.ary=ary;lodash.assign=assign;lodash.at=at;lodash.before=before;lodash.bind=bind;lodash.bindAll=bindAll;lodash.bindKey=bindKey;lodash.callback=callback;lodash.chain=chain;lodash.chunk=chunk;lodash.compact=compact;lodash.constant=constant;lodash.countBy=countBy;lodash.create=create;lodash.curry=curry;lodash.curryRight=curryRight;lodash.debounce=debounce;lodash.defaults=defaults;lodash.defaultsDeep=defaultsDeep;lodash.defer=defer;lodash.delay=delay;lodash.difference=difference;lodash.drop=drop;lodash.dropRight=dropRight;lodash.dropRightWhile=dropRightWhile;lodash.dropWhile=dropWhile;lodash.fill=fill;lodash.filter=filter;lodash.flatten=flatten;lodash.flattenDeep=flattenDeep;lodash.flow=flow;lodash.flowRight=flowRight;lodash.forEach=forEach;lodash.forEachRight=forEachRight;lodash.forIn=forIn;lodash.forInRight=forInRight;lodash.forOwn=forOwn;lodash.forOwnRight=forOwnRight;lodash.functions=functions;lodash.groupBy=groupBy;lodash.indexBy=indexBy;lodash.initial=initial;lodash.intersection=intersection;lodash.invert=invert;lodash.invoke=invoke;lodash.keys=keys;lodash.keysIn=keysIn;lodash.map=map;lodash.mapKeys=mapKeys;lodash.mapValues=mapValues;lodash.matches=matches;lodash.matchesProperty=matchesProperty;lodash.memoize=memoize;lodash.merge=merge;lodash.method=method;lodash.methodOf=methodOf;lodash.mixin=mixin;lodash.modArgs=modArgs;lodash.negate=negate;lodash.omit=omit;lodash.once=once;lodash.pairs=pairs;lodash.partial=partial;lodash.partialRight=partialRight;lodash.partition=partition;lodash.pick=pick;lodash.pluck=pluck;lodash.property=property;lodash.propertyOf=propertyOf;lodash.pull=pull;lodash.pullAt=pullAt;lodash.range=range;lodash.rearg=rearg;lodash.reject=reject;lodash.remove=remove;lodash.rest=rest;lodash.restParam=restParam;lodash.set=set;lodash.shuffle=shuffle;lodash.slice=slice;lodash.sortBy=sortBy;lodash.sortByAll=sortByAll;lodash.sortByOrder=sortByOrder;lodash.spread=spread;lodash.take=take;lodash.takeRight=takeRight;lodash.takeRightWhile=takeRightWhile;lodash.takeWhile=takeWhile;lodash.tap=tap;lodash.throttle=throttle;lodash.thru=thru;lodash.times=times;lodash.toArray=toArray;lodash.toPlainObject=toPlainObject;lodash.transform=transform;lodash.union=union;lodash.uniq=uniq;lodash.unzip=unzip;lodash.unzipWith=unzipWith;lodash.values=values;lodash.valuesIn=valuesIn;lodash.where=where;lodash.without=without;lodash.wrap=wrap;lodash.xor=xor;lodash.zip=zip;lodash.zipObject=zipObject;lodash.zipWith=zipWith;lodash.backflow=flowRight;lodash.collect=map;lodash.compose=flowRight;lodash.each=forEach;lodash.eachRight=forEachRight;lodash.extend=assign;lodash.iteratee=callback;lodash.methods=functions;lodash.object=zipObject;lodash.select=filter;lodash.tail=rest;lodash.unique=uniq;mixin(lodash,lodash);lodash.add=add;lodash.attempt=attempt;lodash.camelCase=camelCase;lodash.capitalize=capitalize;lodash.ceil=ceil;lodash.clone=clone;lodash.cloneDeep=cloneDeep;lodash.deburr=deburr;lodash.endsWith=endsWith;lodash.escape=escape;lodash.escapeRegExp=escapeRegExp;lodash.every=every;
lodash.find=find;lodash.findIndex=findIndex;lodash.findKey=findKey;lodash.findLast=findLast;lodash.findLastIndex=findLastIndex;lodash.findLastKey=findLastKey;lodash.findWhere=findWhere;lodash.first=first;lodash.floor=floor;lodash.get=get;lodash.gt=gt;lodash.gte=gte;lodash.has=has;lodash.identity=identity;lodash.includes=includes;lodash.indexOf=indexOf;lodash.inRange=inRange;lodash.isArguments=isArguments;lodash.isArray=isArray;lodash.isBoolean=isBoolean;lodash.isDate=isDate;lodash.isElement=isElement;lodash.isEmpty=isEmpty;lodash.isEqual=isEqual;lodash.isError=isError;lodash.isFinite=isFinite;lodash.isFunction=isFunction;lodash.isMatch=isMatch;lodash.isNaN=isNaN;lodash.isNative=isNative;lodash.isNull=isNull;lodash.isNumber=isNumber;lodash.isObject=isObject;lodash.isPlainObject=isPlainObject;lodash.isRegExp=isRegExp;lodash.isString=isString;lodash.isTypedArray=isTypedArray;lodash.isUndefined=isUndefined;lodash.kebabCase=kebabCase;lodash.last=last;lodash.lastIndexOf=lastIndexOf;lodash.lt=lt;lodash.lte=lte;lodash.max=max;lodash.min=min;lodash.noConflict=noConflict;lodash.noop=noop;lodash.now=now;lodash.pad=pad;lodash.padLeft=padLeft;lodash.padRight=padRight;lodash.parseInt=parseInt;lodash.random=random;lodash.reduce=reduce;lodash.reduceRight=reduceRight;lodash.repeat=repeat;lodash.result=result;lodash.round=round;lodash.runInContext=runInContext;lodash.size=size;lodash.snakeCase=snakeCase;lodash.some=some;lodash.sortedIndex=sortedIndex;lodash.sortedLastIndex=sortedLastIndex;lodash.startCase=startCase;lodash.startsWith=startsWith;lodash.sum=sum;lodash.template=template;lodash.trim=trim;lodash.trimLeft=trimLeft;lodash.trimRight=trimRight;lodash.trunc=trunc;lodash.unescape=unescape;lodash.uniqueId=uniqueId;lodash.words=words;lodash.all=every;lodash.any=some;lodash.contains=includes;lodash.eq=isEqual;lodash.detect=find;lodash.foldl=reduce;lodash.foldr=reduceRight;lodash.head=first;lodash.include=includes;lodash.inject=reduce;mixin(lodash,function(){var source={};baseForOwn(lodash,function(func,methodName){if(!lodash.prototype[methodName]){source[methodName]=func}});return source}(),false);lodash.sample=sample;lodash.prototype.sample=function(n){if(!this.__chain__&&n==null){return sample(this.value())}return this.thru(function(value){return sample(value,n)})};lodash.VERSION=VERSION;arrayEach(["bind","bindKey","curry","curryRight","partial","partialRight"],function(methodName){lodash[methodName].placeholder=lodash});arrayEach(["drop","take"],function(methodName,index){LazyWrapper.prototype[methodName]=function(n){var filtered=this.__filtered__;if(filtered&&!index){return new LazyWrapper(this)}n=n==null?1:nativeMax(nativeFloor(n)||0,0);var result=this.clone();if(filtered){result.__takeCount__=nativeMin(result.__takeCount__,n)}else{result.__views__.push({size:n,type:methodName+(result.__dir__<0?"Right":"")})}return result};LazyWrapper.prototype[methodName+"Right"]=function(n){return this.reverse()[methodName](n).reverse()}});arrayEach(["filter","map","takeWhile"],function(methodName,index){var type=index+1,isFilter=type!=LAZY_MAP_FLAG;LazyWrapper.prototype[methodName]=function(iteratee,thisArg){var result=this.clone();result.__iteratees__.push({iteratee:getCallback(iteratee,thisArg,1),type:type});result.__filtered__=result.__filtered__||isFilter;return result}});arrayEach(["first","last"],function(methodName,index){var takeName="take"+(index?"Right":"");LazyWrapper.prototype[methodName]=function(){return this[takeName](1).value()[0]}});arrayEach(["initial","rest"],function(methodName,index){var dropName="drop"+(index?"":"Right");LazyWrapper.prototype[methodName]=function(){return this.__filtered__?new LazyWrapper(this):this[dropName](1)}});arrayEach(["pluck","where"],function(methodName,index){var operationName=index?"filter":"map",createCallback=index?baseMatches:property;LazyWrapper.prototype[methodName]=function(value){return this[operationName](createCallback(value))}});LazyWrapper.prototype.compact=function(){return this.filter(identity)};LazyWrapper.prototype.reject=function(predicate,thisArg){predicate=getCallback(predicate,thisArg,1);return this.filter(function(value){return!predicate(value)})};LazyWrapper.prototype.slice=function(start,end){start=start==null?0:+start||0;var result=this;if(result.__filtered__&&(start>0||end<0)){return new LazyWrapper(result)}if(start<0){result=result.takeRight(-start)}else if(start){result=result.drop(start)}if(end!==undefined){end=+end||0;result=end<0?result.dropRight(-end):result.take(end-start)}return result};LazyWrapper.prototype.takeRightWhile=function(predicate,thisArg){return this.reverse().takeWhile(predicate,thisArg).reverse()};LazyWrapper.prototype.toArray=function(){return this.take(POSITIVE_INFINITY)};baseForOwn(LazyWrapper.prototype,function(func,methodName){var checkIteratee=/^(?:filter|map|reject)|While$/.test(methodName),retUnwrapped=/^(?:first|last)$/.test(methodName),lodashFunc=lodash[retUnwrapped?"take"+(methodName=="last"?"Right":""):methodName];if(!lodashFunc){return}lodash.prototype[methodName]=function(){var args=retUnwrapped?[1]:arguments,chainAll=this.__chain__,value=this.__wrapped__,isHybrid=!!this.__actions__.length,isLazy=value instanceof LazyWrapper,iteratee=args[0],useLazy=isLazy||isArray(value);if(useLazy&&checkIteratee&&typeof iteratee=="function"&&iteratee.length!=1){isLazy=useLazy=false}var interceptor=function(value){return retUnwrapped&&chainAll?lodashFunc(value,1)[0]:lodashFunc.apply(undefined,arrayPush([value],args))};var action={func:thru,args:[interceptor],thisArg:undefined},onlyLazy=isLazy&&!isHybrid;if(retUnwrapped&&!chainAll){if(onlyLazy){value=value.clone();value.__actions__.push(action);return func.call(value)}return lodashFunc.call(undefined,this.value())[0]}if(!retUnwrapped&&useLazy){value=onlyLazy?value:new LazyWrapper(this);var result=func.apply(value,args);result.__actions__.push(action);return new LodashWrapper(result,chainAll)}return this.thru(interceptor)}});arrayEach(["join","pop","push","replace","shift","sort","splice","split","unshift"],function(methodName){var func=(/^(?:replace|split)$/.test(methodName)?stringProto:arrayProto)[methodName],chainName=/^(?:push|sort|unshift)$/.test(methodName)?"tap":"thru",retUnwrapped=/^(?:join|pop|replace|shift)$/.test(methodName);lodash.prototype[methodName]=function(){var args=arguments;if(retUnwrapped&&!this.__chain__){return func.apply(this.value(),args)}return this[chainName](function(value){return func.apply(value,args)})}});baseForOwn(LazyWrapper.prototype,function(func,methodName){var lodashFunc=lodash[methodName];if(lodashFunc){var key=lodashFunc.name,names=realNames[key]||(realNames[key]=[]);names.push({name:methodName,func:lodashFunc})}});realNames[createHybridWrapper(undefined,BIND_KEY_FLAG).name]=[{name:"wrapper",func:undefined}];LazyWrapper.prototype.clone=lazyClone;LazyWrapper.prototype.reverse=lazyReverse;LazyWrapper.prototype.value=lazyValue;lodash.prototype.chain=wrapperChain;lodash.prototype.commit=wrapperCommit;lodash.prototype.concat=wrapperConcat;lodash.prototype.plant=wrapperPlant;lodash.prototype.reverse=wrapperReverse;lodash.prototype.toString=wrapperToString;lodash.prototype.run=lodash.prototype.toJSON=lodash.prototype.valueOf=lodash.prototype.value=wrapperValue;lodash.prototype.collect=lodash.prototype.map;lodash.prototype.head=lodash.prototype.first;lodash.prototype.select=lodash.prototype.filter;lodash.prototype.tail=lodash.prototype.rest;return lodash}var _=runInContext();if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){root._=_;define(function(){return _})}else if(freeExports&&freeModule){if(moduleExports){(freeModule.exports=_)._=_}else{freeExports._=_}}else{root._=_}}).call(this);(function(window,document,undefined){var L={version:"1.0.0-beta.2"};function expose(){var oldL=window.L;L.noConflict=function(){window.L=oldL;return this};window.L=L}if(typeof module==="object"&&typeof module.exports==="object"){module.exports=L}else if(typeof define==="function"&&define.amd){define(L)}if(typeof window!=="undefined"){expose()}L.Util={extend:function(dest){var i,j,len,src;for(j=1,len=arguments.length;j<len;j++){src=arguments[j];for(i in src){dest[i]=src[i]}}return dest},create:Object.create||function(){function F(){}return function(proto){F.prototype=proto;return new F}}(),bind:function(fn,obj){var slice=Array.prototype.slice;if(fn.bind){return fn.bind.apply(fn,slice.call(arguments,1))}var args=slice.call(arguments,2);return function(){return fn.apply(obj,args.length?args.concat(slice.call(arguments)):arguments)}},stamp:function(obj){obj._leaflet_id=obj._leaflet_id||++L.Util.lastId;return obj._leaflet_id},lastId:0,throttle:function(fn,time,context){var lock,args,wrapperFn,later;later=function(){lock=false;if(args){wrapperFn.apply(context,args);args=false}};wrapperFn=function(){if(lock){args=arguments}else{fn.apply(context,arguments);setTimeout(later,time);lock=true}};return wrapperFn},wrapNum:function(x,range,includeMax){var max=range[1],min=range[0],d=max-min;return x===max&&includeMax?x:((x-min)%d+d)%d+min},falseFn:function(){return false},formatNum:function(num,digits){var pow=Math.pow(10,digits||5);return Math.round(num*pow)/pow},trim:function(str){return str.trim?str.trim():str.replace(/^\s+|\s+$/g,"")},splitWords:function(str){return L.Util.trim(str).split(/\s+/)},setOptions:function(obj,options){if(!obj.hasOwnProperty("options")){obj.options=obj.options?L.Util.create(obj.options):{}}for(var i in options){obj.options[i]=options[i]}return obj.options},getParamString:function(obj,existingUrl,uppercase){var params=[];for(var i in obj){params.push(encodeURIComponent(uppercase?i.toUpperCase():i)+"="+encodeURIComponent(obj[i]))}return(!existingUrl||existingUrl.indexOf("?")===-1?"?":"&")+params.join("&")},template:function(str,data){return str.replace(L.Util.templateRe,function(str,key){var value=data[key];if(value===undefined){throw new Error("No value provided for variable "+str)}else if(typeof value==="function"){value=value(data)}return value})},templateRe:/\{ *([\w_]+) *\}/g,isArray:Array.isArray||function(obj){return Object.prototype.toString.call(obj)==="[object Array]"},indexOf:function(array,el){for(var i=0;i<array.length;i++){if(array[i]===el){return i}}return-1},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="};(function(){function getPrefixed(name){return window["webkit"+name]||window["moz"+name]||window["ms"+name]}var lastTime=0;function timeoutDefer(fn){var time=+new Date,timeToCall=Math.max(0,16-(time-lastTime));lastTime=time+timeToCall;return window.setTimeout(fn,timeToCall)}var requestFn=window.requestAnimationFrame||getPrefixed("RequestAnimationFrame")||timeoutDefer,cancelFn=window.cancelAnimationFrame||getPrefixed("CancelAnimationFrame")||getPrefixed("CancelRequestAnimationFrame")||function(id){window.clearTimeout(id)};L.Util.requestAnimFrame=function(fn,context,immediate){if(immediate&&requestFn===timeoutDefer){fn.call(context)}else{return requestFn.call(window,L.bind(fn,context))}};L.Util.cancelAnimFrame=function(id){if(id){cancelFn.call(window,id)}}})();L.extend=L.Util.extend;L.bind=L.Util.bind;L.stamp=L.Util.stamp;L.setOptions=L.Util.setOptions;L.Class=function(){};L.Class.extend=function(props){var NewClass=function(){if(this.initialize){this.initialize.apply(this,arguments)}this.callInitHooks()};var parentProto=NewClass.__super__=this.prototype;var proto=L.Util.create(parentProto);proto.constructor=NewClass;NewClass.prototype=proto;for(var i in this){if(this.hasOwnProperty(i)&&i!=="prototype"){NewClass[i]=this[i]}}if(props.statics){L.extend(NewClass,props.statics);delete props.statics}if(props.includes){L.Util.extend.apply(null,[proto].concat(props.includes));delete props.includes}if(proto.options){props.options=L.Util.extend(L.Util.create(proto.options),props.options)}L.extend(proto,props);proto._initHooks=[];proto.callInitHooks=function(){if(this._initHooksCalled){return}if(parentProto.callInitHooks){parentProto.callInitHooks.call(this)}this._initHooksCalled=true;for(var i=0,len=proto._initHooks.length;i<len;i++){proto._initHooks[i].call(this)}};return NewClass};L.Class.include=function(props){L.extend(this.prototype,props)};L.Class.mergeOptions=function(options){L.extend(this.prototype.options,options)};L.Class.addInitHook=function(fn){var args=Array.prototype.slice.call(arguments,1);var init=typeof fn==="function"?fn:function(){this[fn].apply(this,args)};this.prototype._initHooks=this.prototype._initHooks||[];this.prototype._initHooks.push(init)};L.Evented=L.Class.extend({on:function(types,fn,context){if(typeof types==="object"){for(var type in types){this._on(type,types[type],fn)}}else{types=L.Util.splitWords(types);for(var i=0,len=types.length;i<len;i++){this._on(types[i],fn,context)}}return this},off:function(types,fn,context){if(!types){delete this._events}else if(typeof types==="object"){for(var type in types){this._off(type,types[type],fn)}}else{types=L.Util.splitWords(types);for(var i=0,len=types.length;i<len;i++){this._off(types[i],fn,context)}}return this},_on:function(type,fn,context){var events=this._events=this._events||{},contextId=context&&context!==this&&L.stamp(context);if(contextId){var indexKey=type+"_idx",indexLenKey=type+"_len",typeIndex=events[indexKey]=events[indexKey]||{},id=L.stamp(fn)+"_"+contextId;if(!typeIndex[id]){typeIndex[id]={fn:fn,ctx:context};events[indexLenKey]=(events[indexLenKey]||0)+1}}else{events[type]=events[type]||[];events[type].push({fn:fn})}},_off:function(type,fn,context){var events=this._events,indexKey=type+"_idx",indexLenKey=type+"_len";if(!events){return}if(!fn){delete events[type];delete events[indexKey];delete events[indexLenKey];return}var contextId=context&&context!==this&&L.stamp(context),listeners,i,len,listener,id;if(contextId){id=L.stamp(fn)+"_"+contextId;listeners=events[indexKey];if(listeners&&listeners[id]){listener=listeners[id];delete listeners[id];events[indexLenKey]--}}else{listeners=events[type];if(listeners){for(i=0,len=listeners.length;i<len;i++){if(listeners[i].fn===fn){listener=listeners[i];listeners.splice(i,1);break}}}}if(listener){listener.fn=L.Util.falseFn}},fire:function(type,data,propagate){if(!this.listens(type,propagate)){return this}var event=L.Util.extend({},data,{type:type,target:this}),events=this._events;if(events){var typeIndex=events[type+"_idx"],i,len,listeners,id;if(events[type]){listeners=events[type].slice();for(i=0,len=listeners.length;i<len;i++){listeners[i].fn.call(this,event)}}for(id in typeIndex){typeIndex[id].fn.call(typeIndex[id].ctx,event)}}if(propagate){this._propagateEvent(event)}return this},listens:function(type,propagate){var events=this._events;if(events&&(events[type]||events[type+"_len"])){return true}if(propagate){for(var id in this._eventParents){if(this._eventParents[id].listens(type,propagate)){return true}}}return false},once:function(types,fn,context){if(typeof types==="object"){for(var type in types){this.once(type,types[type],fn)}return this}var handler=L.bind(function(){this.off(types,fn,context).off(types,handler,context)},this);return this.on(types,fn,context).on(types,handler,context)},addEventParent:function(obj){this._eventParents=this._eventParents||{};this._eventParents[L.stamp(obj)]=obj;return this},removeEventParent:function(obj){if(this._eventParents){delete this._eventParents[L.stamp(obj)]}return this},_propagateEvent:function(e){for(var id in this._eventParents){this._eventParents[id].fire(e.type,L.extend({layer:e.target},e),true)}}});var proto=L.Evented.prototype;proto.addEventListener=proto.on;proto.removeEventListener=proto.clearAllEventListeners=proto.off;proto.addOneTimeEventListener=proto.once;proto.fireEvent=proto.fire;proto.hasEventListeners=proto.listens;L.Mixin={Events:proto};(function(){var ua=navigator.userAgent.toLowerCase(),doc=document.documentElement,ie="ActiveXObject"in window,webkit=ua.indexOf("webkit")!==-1,phantomjs=ua.indexOf("phantom")!==-1,android23=ua.search("android [23]")!==-1,chrome=ua.indexOf("chrome")!==-1,gecko=ua.indexOf("gecko")!==-1&&!webkit&&!window.opera&&!ie,mobile=typeof orientation!=="undefined"||ua.indexOf("mobile")!==-1,msPointer=navigator.msPointerEnabled&&navigator.msMaxTouchPoints&&!window.PointerEvent,pointer=window.PointerEvent&&navigator.pointerEnabled&&navigator.maxTouchPoints||msPointer,ie3d=ie&&"transition"in doc.style,webkit3d="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!android23,gecko3d="MozPerspective"in doc.style,opera12="OTransition"in doc.style;var touch=!window.L_NO_TOUCH&&!phantomjs&&(pointer||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch);L.Browser={ie:ie,ielt9:ie&&!document.addEventListener,webkit:webkit,gecko:gecko,android:ua.indexOf("android")!==-1,android23:android23,chrome:chrome,safari:!chrome&&ua.indexOf("safari")!==-1,ie3d:ie3d,webkit3d:webkit3d,gecko3d:gecko3d,opera12:opera12,any3d:!window.L_DISABLE_3D&&(ie3d||webkit3d||gecko3d)&&!opera12&&!phantomjs,mobile:mobile,mobileWebkit:mobile&&webkit,mobileWebkit3d:mobile&&webkit3d,mobileOpera:mobile&&window.opera,mobileGecko:mobile&&gecko,touch:!!touch,msPointer:!!msPointer,pointer:!!pointer,retina:(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1}})();L.Point=function(x,y,round){this.x=round?Math.round(x):x;this.y=round?Math.round(y):y};L.Point.prototype={clone:function(){return new L.Point(this.x,this.y)},add:function(point){return this.clone()._add(L.point(point))},_add:function(point){this.x+=point.x;this.y+=point.y;return this},subtract:function(point){return this.clone()._subtract(L.point(point))},_subtract:function(point){this.x-=point.x;this.y-=point.y;return this},divideBy:function(num){return this.clone()._divideBy(num)},_divideBy:function(num){this.x/=num;this.y/=num;return this},multiplyBy:function(num){return this.clone()._multiplyBy(num)},_multiplyBy:function(num){this.x*=num;this.y*=num;return this},scaleBy:function(point){return new L.Point(this.x*point.x,this.y*point.y)},unscaleBy:function(point){return new L.Point(this.x/point.x,this.y/point.y)},round:function(){return this.clone()._round()},_round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},floor:function(){return this.clone()._floor()},_floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){return this.clone()._ceil()},_ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},distanceTo:function(point){point=L.point(point);var x=point.x-this.x,y=point.y-this.y;return Math.sqrt(x*x+y*y)},equals:function(point){point=L.point(point);return point.x===this.x&&point.y===this.y},contains:function(point){point=L.point(point);return Math.abs(point.x)<=Math.abs(this.x)&&Math.abs(point.y)<=Math.abs(this.y)},toString:function(){return"Point("+L.Util.formatNum(this.x)+", "+L.Util.formatNum(this.y)+")"}};L.point=function(x,y,round){if(x instanceof L.Point){return x}if(L.Util.isArray(x)){return new L.Point(x[0],x[1])}if(x===undefined||x===null){return x}return new L.Point(x,y,round)};L.Bounds=function(a,b){if(!a){return}var points=b?[a,b]:a;for(var i=0,len=points.length;i<len;i++){this.extend(points[i])}};L.Bounds.prototype={extend:function(point){point=L.point(point);if(!this.min&&!this.max){this.min=point.clone();this.max=point.clone()}else{this.min.x=Math.min(point.x,this.min.x);this.max.x=Math.max(point.x,this.max.x);this.min.y=Math.min(point.y,this.min.y);this.max.y=Math.max(point.y,this.max.y)}return this},getCenter:function(round){return new L.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,round)},getBottomLeft:function(){return new L.Point(this.min.x,this.max.y)},getTopRight:function(){return new L.Point(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(obj){var min,max;if(typeof obj[0]==="number"||obj instanceof L.Point){obj=L.point(obj)}else{obj=L.bounds(obj)}if(obj instanceof L.Bounds){min=obj.min;max=obj.max}else{min=max=obj}return min.x>=this.min.x&&max.x<=this.max.x&&min.y>=this.min.y&&max.y<=this.max.y},intersects:function(bounds){bounds=L.bounds(bounds);var min=this.min,max=this.max,min2=bounds.min,max2=bounds.max,xIntersects=max2.x>=min.x&&min2.x<=max.x,yIntersects=max2.y>=min.y&&min2.y<=max.y;return xIntersects&&yIntersects},overlaps:function(bounds){bounds=L.bounds(bounds);var min=this.min,max=this.max,min2=bounds.min,max2=bounds.max,xOverlaps=max2.x>min.x&&min2.x<max.x,yOverlaps=max2.y>min.y&&min2.y<max.y;return xOverlaps&&yOverlaps},isValid:function(){return!!(this.min&&this.max)}};L.bounds=function(a,b){if(!a||a instanceof L.Bounds){return a}return new L.Bounds(a,b)};L.Transformation=function(a,b,c,d){this._a=a;this._b=b;this._c=c;this._d=d};L.Transformation.prototype={transform:function(point,scale){return this._transform(point.clone(),scale)},_transform:function(point,scale){scale=scale||1;point.x=scale*(this._a*point.x+this._b);point.y=scale*(this._c*point.y+this._d);return point},untransform:function(point,scale){scale=scale||1;return new L.Point((point.x/scale-this._b)/this._a,(point.y/scale-this._d)/this._c)}};L.DomUtil={get:function(id){return typeof id==="string"?document.getElementById(id):id},getStyle:function(el,style){var value=el.style[style]||el.currentStyle&&el.currentStyle[style];if((!value||value==="auto")&&document.defaultView){var css=document.defaultView.getComputedStyle(el,null);value=css?css[style]:null}return value==="auto"?null:value},create:function(tagName,className,container){var el=document.createElement(tagName);el.className=className;if(container){container.appendChild(el)}return el},remove:function(el){var parent=el.parentNode;if(parent){parent.removeChild(el)}},empty:function(el){while(el.firstChild){el.removeChild(el.firstChild)}},toFront:function(el){el.parentNode.appendChild(el)},toBack:function(el){var parent=el.parentNode;parent.insertBefore(el,parent.firstChild)},hasClass:function(el,name){if(el.classList!==undefined){return el.classList.contains(name)}var className=L.DomUtil.getClass(el);return className.length>0&&new RegExp("(^|\\s)"+name+"(\\s|$)").test(className)},addClass:function(el,name){if(el.classList!==undefined){var classes=L.Util.splitWords(name);for(var i=0,len=classes.length;i<len;i++){el.classList.add(classes[i])}}else if(!L.DomUtil.hasClass(el,name)){var className=L.DomUtil.getClass(el);L.DomUtil.setClass(el,(className?className+" ":"")+name)}},removeClass:function(el,name){if(el.classList!==undefined){el.classList.remove(name)}else{L.DomUtil.setClass(el,L.Util.trim((" "+L.DomUtil.getClass(el)+" ").replace(" "+name+" "," ")))}},setClass:function(el,name){if(el.className.baseVal===undefined){el.className=name}else{el.className.baseVal=name}},getClass:function(el){return el.className.baseVal===undefined?el.className:el.className.baseVal},setOpacity:function(el,value){if("opacity"in el.style){el.style.opacity=value}else if("filter"in el.style){L.DomUtil._setOpacityIE(el,value)}},_setOpacityIE:function(el,value){var filter=false,filterName="DXImageTransform.Microsoft.Alpha";try{filter=el.filters.item(filterName)}catch(e){if(value===1){return}}value=Math.round(value*100);if(filter){filter.Enabled=value!==100;filter.Opacity=value}else{el.style.filter+=" progid:"+filterName+"(opacity="+value+")"}},testProp:function(props){var style=document.documentElement.style;for(var i=0;i<props.length;i++){if(props[i]in style){return props[i]}}return false},setTransform:function(el,offset,scale){var pos=offset||new L.Point(0,0);el.style[L.DomUtil.TRANSFORM]="translate3d("+pos.x+"px,"+pos.y+"px"+",0)"+(scale?" scale("+scale+")":"")},setPosition:function(el,point){el._leaflet_pos=point;if(L.Browser.any3d){L.DomUtil.setTransform(el,point)}else{el.style.left=point.x+"px";el.style.top=point.y+"px"}},getPosition:function(el){return el._leaflet_pos}};(function(){L.DomUtil.TRANSFORM=L.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]);var transition=L.DomUtil.TRANSITION=L.DomUtil.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]);L.DomUtil.TRANSITION_END=transition==="webkitTransition"||transition==="OTransition"?transition+"End":"transitionend";if("onselectstart"in document){L.DomUtil.disableTextSelection=function(){L.DomEvent.on(window,"selectstart",L.DomEvent.preventDefault)};L.DomUtil.enableTextSelection=function(){L.DomEvent.off(window,"selectstart",L.DomEvent.preventDefault)}}else{var userSelectProperty=L.DomUtil.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);L.DomUtil.disableTextSelection=function(){if(userSelectProperty){var style=document.documentElement.style;this._userSelect=style[userSelectProperty];style[userSelectProperty]="none"}};L.DomUtil.enableTextSelection=function(){if(userSelectProperty){document.documentElement.style[userSelectProperty]=this._userSelect;delete this._userSelect}}}L.DomUtil.disableImageDrag=function(){L.DomEvent.on(window,"dragstart",L.DomEvent.preventDefault)};L.DomUtil.enableImageDrag=function(){L.DomEvent.off(window,"dragstart",L.DomEvent.preventDefault)};L.DomUtil.preventOutline=function(element){while(element.tabIndex===-1){element=element.parentNode}if(!element||!element.style){return}L.DomUtil.restoreOutline();this._outlineElement=element;this._outlineStyle=element.style.outline;element.style.outline="none";L.DomEvent.on(window,"keydown",L.DomUtil.restoreOutline,this)};L.DomUtil.restoreOutline=function(){if(!this._outlineElement){return}this._outlineElement.style.outline=this._outlineStyle;delete this._outlineElement;delete this._outlineStyle;L.DomEvent.off(window,"keydown",L.DomUtil.restoreOutline,this)}})();L.LatLng=function(lat,lng,alt){if(isNaN(lat)||isNaN(lng)){throw new Error("Invalid LatLng object: ("+lat+", "+lng+")")}this.lat=+lat;this.lng=+lng;if(alt!==undefined){this.alt=+alt}};L.LatLng.prototype={equals:function(obj,maxMargin){if(!obj){return false}obj=L.latLng(obj);var margin=Math.max(Math.abs(this.lat-obj.lat),Math.abs(this.lng-obj.lng));return margin<=(maxMargin===undefined?1e-9:maxMargin)},toString:function(precision){return"LatLng("+L.Util.formatNum(this.lat,precision)+", "+L.Util.formatNum(this.lng,precision)+")"},distanceTo:function(other){return L.CRS.Earth.distance(this,L.latLng(other))},wrap:function(){return L.CRS.Earth.wrapLatLng(this)},toBounds:function(sizeInMeters){var latAccuracy=180*sizeInMeters/40075017,lngAccuracy=latAccuracy/Math.cos(Math.PI/180*this.lat);return L.latLngBounds([this.lat-latAccuracy,this.lng-lngAccuracy],[this.lat+latAccuracy,this.lng+lngAccuracy])},clone:function(){return new L.LatLng(this.lat,this.lng,this.alt)}};L.latLng=function(a,b,c){if(a instanceof L.LatLng){return a}if(L.Util.isArray(a)&&typeof a[0]!=="object"){if(a.length===3){return new L.LatLng(a[0],a[1],a[2])}if(a.length===2){return new L.LatLng(a[0],a[1])}return null}if(a===undefined||a===null){return a}if(typeof a==="object"&&"lat"in a){return new L.LatLng(a.lat,"lng"in a?a.lng:a.lon,a.alt)}if(b===undefined){return null}return new L.LatLng(a,b,c)};L.LatLngBounds=function(southWest,northEast){if(!southWest){return}var latlngs=northEast?[southWest,northEast]:southWest;for(var i=0,len=latlngs.length;i<len;i++){this.extend(latlngs[i])}};L.LatLngBounds.prototype={extend:function(obj){var sw=this._southWest,ne=this._northEast,sw2,ne2;if(obj instanceof L.LatLng){sw2=obj;ne2=obj}else if(obj instanceof L.LatLngBounds){sw2=obj._southWest;ne2=obj._northEast;if(!sw2||!ne2){return this}}else{return obj?this.extend(L.latLng(obj)||L.latLngBounds(obj)):this}if(!sw&&!ne){this._southWest=new L.LatLng(sw2.lat,sw2.lng);this._northEast=new L.LatLng(ne2.lat,ne2.lng)}else{sw.lat=Math.min(sw2.lat,sw.lat);sw.lng=Math.min(sw2.lng,sw.lng);ne.lat=Math.max(ne2.lat,ne.lat);ne.lng=Math.max(ne2.lng,ne.lng)}return this},pad:function(bufferRatio){var sw=this._southWest,ne=this._northEast,heightBuffer=Math.abs(sw.lat-ne.lat)*bufferRatio,widthBuffer=Math.abs(sw.lng-ne.lng)*bufferRatio;return new L.LatLngBounds(new L.LatLng(sw.lat-heightBuffer,sw.lng-widthBuffer),new L.LatLng(ne.lat+heightBuffer,ne.lng+widthBuffer))},getCenter:function(){return new L.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new L.LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new L.LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(obj){if(typeof obj[0]==="number"||obj instanceof L.LatLng){obj=L.latLng(obj)}else{obj=L.latLngBounds(obj)}var sw=this._southWest,ne=this._northEast,sw2,ne2;if(obj instanceof L.LatLngBounds){sw2=obj.getSouthWest();ne2=obj.getNorthEast()}else{sw2=ne2=obj}return sw2.lat>=sw.lat&&ne2.lat<=ne.lat&&sw2.lng>=sw.lng&&ne2.lng<=ne.lng},intersects:function(bounds){bounds=L.latLngBounds(bounds);var sw=this._southWest,ne=this._northEast,sw2=bounds.getSouthWest(),ne2=bounds.getNorthEast(),latIntersects=ne2.lat>=sw.lat&&sw2.lat<=ne.lat,lngIntersects=ne2.lng>=sw.lng&&sw2.lng<=ne.lng;return latIntersects&&lngIntersects},overlaps:function(bounds){bounds=L.latLngBounds(bounds);var sw=this._southWest,ne=this._northEast,sw2=bounds.getSouthWest(),ne2=bounds.getNorthEast(),latOverlaps=ne2.lat>sw.lat&&sw2.lat<ne.lat,lngOverlaps=ne2.lng>sw.lng&&sw2.lng<ne.lng;return latOverlaps&&lngOverlaps},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(bounds){if(!bounds){return false}bounds=L.latLngBounds(bounds);return this._southWest.equals(bounds.getSouthWest())&&this._northEast.equals(bounds.getNorthEast())},isValid:function(){return!!(this._southWest&&this._northEast)}};L.latLngBounds=function(a,b){if(!a||a instanceof L.LatLngBounds){return a}return new L.LatLngBounds(a,b)};L.Projection={};L.Projection.LonLat={project:function(latlng){return new L.Point(latlng.lng,latlng.lat)},unproject:function(point){return new L.LatLng(point.y,point.x)},bounds:L.bounds([-180,-90],[180,90])};L.Projection.SphericalMercator={R:6378137,project:function(latlng){var d=Math.PI/180,max=1-1e-15,sin=Math.max(Math.min(Math.sin(latlng.lat*d),max),-max);return new L.Point(this.R*latlng.lng*d,this.R*Math.log((1+sin)/(1-sin))/2)},unproject:function(point){var d=180/Math.PI;return new L.LatLng((2*Math.atan(Math.exp(point.y/this.R))-Math.PI/2)*d,point.x*d/this.R)},bounds:function(){var d=6378137*Math.PI;return L.bounds([-d,-d],[d,d])}()};L.CRS={latLngToPoint:function(latlng,zoom){var projectedPoint=this.projection.project(latlng),scale=this.scale(zoom);return this.transformation._transform(projectedPoint,scale)},pointToLatLng:function(point,zoom){var scale=this.scale(zoom),untransformedPoint=this.transformation.untransform(point,scale);return this.projection.unproject(untransformedPoint)},project:function(latlng){return this.projection.project(latlng)},unproject:function(point){return this.projection.unproject(point)},scale:function(zoom){return 256*Math.pow(2,zoom)},getProjectedBounds:function(zoom){if(this.infinite){return null}var b=this.projection.bounds,s=this.scale(zoom),min=this.transformation.transform(b.min,s),max=this.transformation.transform(b.max,s);return L.bounds(min,max)},wrapLatLng:function(latlng){var lng=this.wrapLng?L.Util.wrapNum(latlng.lng,this.wrapLng,true):latlng.lng,lat=this.wrapLat?L.Util.wrapNum(latlng.lat,this.wrapLat,true):latlng.lat,alt=latlng.alt;return L.latLng(lat,lng,alt)}};L.CRS.Simple=L.extend({},L.CRS,{projection:L.Projection.LonLat,transformation:new L.Transformation(1,0,-1,0),scale:function(zoom){return Math.pow(2,zoom)},distance:function(latlng1,latlng2){var dx=latlng2.lng-latlng1.lng,dy=latlng2.lat-latlng1.lat;return Math.sqrt(dx*dx+dy*dy)},infinite:true});L.CRS.Earth=L.extend({},L.CRS,{wrapLng:[-180,180],R:6378137,
distance:function(latlng1,latlng2){var rad=Math.PI/180,lat1=latlng1.lat*rad,lat2=latlng2.lat*rad,a=Math.sin(lat1)*Math.sin(lat2)+Math.cos(lat1)*Math.cos(lat2)*Math.cos((latlng2.lng-latlng1.lng)*rad);return this.R*Math.acos(Math.min(a,1))}});L.CRS.EPSG3857=L.extend({},L.CRS.Earth,{code:"EPSG:3857",projection:L.Projection.SphericalMercator,transformation:function(){var scale=.5/(Math.PI*L.Projection.SphericalMercator.R);return new L.Transformation(scale,.5,-scale,.5)}()});L.CRS.EPSG900913=L.extend({},L.CRS.EPSG3857,{code:"EPSG:900913"});L.CRS.EPSG4326=L.extend({},L.CRS.Earth,{code:"EPSG:4326",projection:L.Projection.LonLat,transformation:new L.Transformation(1/180,1,-1/180,.5)});L.Map=L.Evented.extend({options:{crs:L.CRS.EPSG3857,fadeAnimation:true,trackResize:true,markerZoomAnimation:true,maxBoundsViscosity:0},initialize:function(id,options){options=L.setOptions(this,options);this._initContainer(id);this._initLayout();this._onResize=L.bind(this._onResize,this);this._initEvents();if(options.maxBounds){this.setMaxBounds(options.maxBounds)}if(options.zoom!==undefined){this._zoom=this._limitZoom(options.zoom)}if(options.center&&options.zoom!==undefined){this.setView(L.latLng(options.center),options.zoom,{reset:true})}this._handlers=[];this._layers={};this._zoomBoundLayers={};this._sizeChanged=true;this.callInitHooks();this._addLayers(this.options.layers)},setView:function(center,zoom){zoom=zoom===undefined?this.getZoom():zoom;this._resetView(L.latLng(center),zoom);return this},setZoom:function(zoom,options){if(!this._loaded){this._zoom=zoom;return this}return this.setView(this.getCenter(),zoom,{zoom:options})},zoomIn:function(delta,options){return this.setZoom(this._zoom+(delta||1),options)},zoomOut:function(delta,options){return this.setZoom(this._zoom-(delta||1),options)},setZoomAround:function(latlng,zoom,options){var scale=this.getZoomScale(zoom),viewHalf=this.getSize().divideBy(2),containerPoint=latlng instanceof L.Point?latlng:this.latLngToContainerPoint(latlng),centerOffset=containerPoint.subtract(viewHalf).multiplyBy(1-1/scale),newCenter=this.containerPointToLatLng(viewHalf.add(centerOffset));return this.setView(newCenter,zoom,{zoom:options})},_getBoundsCenterZoom:function(bounds,options){options=options||{};bounds=bounds.getBounds?bounds.getBounds():L.latLngBounds(bounds);var paddingTL=L.point(options.paddingTopLeft||options.padding||[0,0]),paddingBR=L.point(options.paddingBottomRight||options.padding||[0,0]),zoom=this.getBoundsZoom(bounds,false,paddingTL.add(paddingBR));zoom=options.maxZoom?Math.min(options.maxZoom,zoom):zoom;var paddingOffset=paddingBR.subtract(paddingTL).divideBy(2),swPoint=this.project(bounds.getSouthWest(),zoom),nePoint=this.project(bounds.getNorthEast(),zoom),center=this.unproject(swPoint.add(nePoint).divideBy(2).add(paddingOffset),zoom);return{center:center,zoom:zoom}},fitBounds:function(bounds,options){var target=this._getBoundsCenterZoom(bounds,options);return this.setView(target.center,target.zoom,options)},fitWorld:function(options){return this.fitBounds([[-90,-180],[90,180]],options)},panTo:function(center,options){return this.setView(center,this._zoom,{pan:options})},panBy:function(offset){this.fire("movestart");this._rawPanBy(L.point(offset));this.fire("move");return this.fire("moveend")},setMaxBounds:function(bounds){bounds=L.latLngBounds(bounds);if(!bounds){return this.off("moveend",this._panInsideMaxBounds)}else if(this.options.maxBounds){this.off("moveend",this._panInsideMaxBounds)}this.options.maxBounds=bounds;if(this._loaded){this._panInsideMaxBounds()}return this.on("moveend",this._panInsideMaxBounds)},setMinZoom:function(zoom){this.options.minZoom=zoom;if(this._loaded&&this.getZoom()<this.options.minZoom){return this.setZoom(zoom)}return this},setMaxZoom:function(zoom){this.options.maxZoom=zoom;if(this._loaded&&this.getZoom()>this.options.maxZoom){return this.setZoom(zoom)}return this},panInsideBounds:function(bounds,options){var center=this.getCenter(),newCenter=this._limitCenter(center,this._zoom,L.latLngBounds(bounds));if(center.equals(newCenter)){return this}return this.panTo(newCenter,options)},invalidateSize:function(options){if(!this._loaded){return this}options=L.extend({animate:false,pan:true},options===true?{animate:true}:options);var oldSize=this.getSize();this._sizeChanged=true;this._lastCenter=null;var newSize=this.getSize(),oldCenter=oldSize.divideBy(2).round(),newCenter=newSize.divideBy(2).round(),offset=oldCenter.subtract(newCenter);if(!offset.x&&!offset.y){return this}if(options.animate&&options.pan){this.panBy(offset)}else{if(options.pan){this._rawPanBy(offset)}this.fire("move");if(options.debounceMoveend){clearTimeout(this._sizeTimer);this._sizeTimer=setTimeout(L.bind(this.fire,this,"moveend"),200)}else{this.fire("moveend")}}return this.fire("resize",{oldSize:oldSize,newSize:newSize})},stop:function(){L.Util.cancelAnimFrame(this._flyToFrame);if(this._panAnim){this._panAnim.stop()}return this},addHandler:function(name,HandlerClass){if(!HandlerClass){return this}var handler=this[name]=new HandlerClass(this);this._handlers.push(handler);if(this.options[name]){handler.enable()}return this},remove:function(){this._initEvents(true);try{delete this._container._leaflet}catch(e){this._container._leaflet=undefined}L.DomUtil.remove(this._mapPane);if(this._clearControlPos){this._clearControlPos()}this._clearHandlers();if(this._loaded){this.fire("unload")}for(var i in this._layers){this._layers[i].remove()}return this},createPane:function(name,container){var className="leaflet-pane"+(name?" leaflet-"+name.replace("Pane","")+"-pane":""),pane=L.DomUtil.create("div",className,container||this._mapPane);if(name){this._panes[name]=pane}return pane},getCenter:function(){this._checkIfLoaded();if(this._lastCenter&&!this._moved()){return this._lastCenter}return this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var bounds=this.getPixelBounds(),sw=this.unproject(bounds.getBottomLeft()),ne=this.unproject(bounds.getTopRight());return new L.LatLngBounds(sw,ne)},getMinZoom:function(){return this.options.minZoom===undefined?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===undefined?this._layersMaxZoom===undefined?Infinity:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(bounds,inside,padding){bounds=L.latLngBounds(bounds);var zoom=this.getMinZoom()-(inside?1:0),maxZoom=this.getMaxZoom(),size=this.getSize(),nw=bounds.getNorthWest(),se=bounds.getSouthEast(),zoomNotFound=true,boundsSize;padding=L.point(padding||[0,0]);do{zoom++;boundsSize=this.project(se,zoom).subtract(this.project(nw,zoom)).add(padding).floor();zoomNotFound=!inside?size.contains(boundsSize):boundsSize.x<size.x||boundsSize.y<size.y}while(zoomNotFound&&zoom<=maxZoom);if(zoomNotFound&&inside){return null}return inside?zoom:zoom-1},getSize:function(){if(!this._size||this._sizeChanged){this._size=new L.Point(this._container.clientWidth,this._container.clientHeight);this._sizeChanged=false}return this._size.clone()},getPixelBounds:function(center,zoom){var topLeftPoint=this._getTopLeftPoint(center,zoom);return new L.Bounds(topLeftPoint,topLeftPoint.add(this.getSize()))},getPixelOrigin:function(){this._checkIfLoaded();return this._pixelOrigin},getPixelWorldBounds:function(zoom){return this.options.crs.getProjectedBounds(zoom===undefined?this.getZoom():zoom)},getPane:function(pane){return typeof pane==="string"?this._panes[pane]:pane},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(toZoom,fromZoom){var crs=this.options.crs;fromZoom=fromZoom===undefined?this._zoom:fromZoom;return crs.scale(toZoom)/crs.scale(fromZoom)},getScaleZoom:function(scale,fromZoom){fromZoom=fromZoom===undefined?this._zoom:fromZoom;return fromZoom+Math.log(scale)/Math.LN2},project:function(latlng,zoom){zoom=zoom===undefined?this._zoom:zoom;return this.options.crs.latLngToPoint(L.latLng(latlng),zoom)},unproject:function(point,zoom){zoom=zoom===undefined?this._zoom:zoom;return this.options.crs.pointToLatLng(L.point(point),zoom)},layerPointToLatLng:function(point){var projectedPoint=L.point(point).add(this.getPixelOrigin());return this.unproject(projectedPoint)},latLngToLayerPoint:function(latlng){var projectedPoint=this.project(L.latLng(latlng))._round();return projectedPoint._subtract(this.getPixelOrigin())},wrapLatLng:function(latlng){return this.options.crs.wrapLatLng(L.latLng(latlng))},distance:function(latlng1,latlng2){return this.options.crs.distance(L.latLng(latlng1),L.latLng(latlng2))},containerPointToLayerPoint:function(point){return L.point(point).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(point){return L.point(point).add(this._getMapPanePos())},containerPointToLatLng:function(point){var layerPoint=this.containerPointToLayerPoint(L.point(point));return this.layerPointToLatLng(layerPoint)},latLngToContainerPoint:function(latlng){return this.layerPointToContainerPoint(this.latLngToLayerPoint(L.latLng(latlng)))},mouseEventToContainerPoint:function(e){return L.DomEvent.getMousePosition(e,this._container)},mouseEventToLayerPoint:function(e){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(e))},mouseEventToLatLng:function(e){return this.layerPointToLatLng(this.mouseEventToLayerPoint(e))},_initContainer:function(id){var container=this._container=L.DomUtil.get(id);if(!container){throw new Error("Map container not found.")}else if(container._leaflet){throw new Error("Map container is already initialized.")}L.DomEvent.addListener(container,"scroll",this._onScroll,this);container._leaflet=true},_initLayout:function(){var container=this._container;this._fadeAnimated=this.options.fadeAnimation&&L.Browser.any3d;L.DomUtil.addClass(container,"leaflet-container"+(L.Browser.touch?" leaflet-touch":"")+(L.Browser.retina?" leaflet-retina":"")+(L.Browser.ielt9?" leaflet-oldie":"")+(L.Browser.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var position=L.DomUtil.getStyle(container,"position");if(position!=="absolute"&&position!=="relative"&&position!=="fixed"){container.style.position="relative"}this._initPanes();if(this._initControlPos){this._initControlPos()}},_initPanes:function(){var panes=this._panes={};this._paneRenderers={};this._mapPane=this.createPane("mapPane",this._container);L.DomUtil.setPosition(this._mapPane,new L.Point(0,0));this.createPane("tilePane");this.createPane("shadowPane");this.createPane("overlayPane");this.createPane("markerPane");this.createPane("popupPane");if(!this.options.markerZoomAnimation){L.DomUtil.addClass(panes.markerPane,"leaflet-zoom-hide");L.DomUtil.addClass(panes.shadowPane,"leaflet-zoom-hide")}},_resetView:function(center,zoom){L.DomUtil.setPosition(this._mapPane,new L.Point(0,0));var loading=!this._loaded;this._loaded=true;zoom=this._limitZoom(zoom);var zoomChanged=this._zoom!==zoom;this._moveStart(zoomChanged)._move(center,zoom)._moveEnd(zoomChanged);this.fire("viewreset");if(loading){this.fire("load")}},_moveStart:function(zoomChanged){if(zoomChanged){this.fire("zoomstart")}return this.fire("movestart")},_move:function(center,zoom,data){if(zoom===undefined){zoom=this._zoom}var zoomChanged=this._zoom!==zoom;this._zoom=zoom;this._lastCenter=center;this._pixelOrigin=this._getNewPixelOrigin(center);if(zoomChanged){this.fire("zoom",data)}return this.fire("move",data)},_moveEnd:function(zoomChanged){if(zoomChanged){this.fire("zoomend")}return this.fire("moveend")},_rawPanBy:function(offset){L.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(offset))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded){throw new Error("Set map center and zoom first.")}},_initEvents:function(remove){if(!L.DomEvent){return}this._targets={};this._targets[L.stamp(this._container)]=this;var onOff=remove?"off":"on";L.DomEvent[onOff](this._container,"click dblclick mousedown mouseup "+"mouseover mouseout mousemove contextmenu keypress",this._handleDOMEvent,this);if(this.options.trackResize){L.DomEvent[onOff](window,"resize",this._onResize,this)}},_onResize:function(){L.Util.cancelAnimFrame(this._resizeRequest);this._resizeRequest=L.Util.requestAnimFrame(function(){this.invalidateSize({debounceMoveend:true})},this,false,this._container)},_onScroll:function(){this._container.scrollTop=0;this._container.scrollLeft=0},_findEventTargets:function(src,type,bubble){var targets=[],target;while(src){target=this._targets[L.stamp(src)];if(target&&target.listens(type,true)){targets.push(target)}if(!bubble){break}if(src===this._container){break}src=src.parentNode}return targets},_handleDOMEvent:function(e){if(!this._loaded||L.DomEvent._skipped(e)){return}var type=e.type==="keypress"&&e.keyCode===13?"click":e.type;if(e.type==="click"){var synth=L.Util.extend({},e);synth.type="preclick";this._handleDOMEvent(synth)}if(type==="mousedown"){L.DomUtil.preventOutline(e.target||e.srcElement)}this._fireDOMEvent(e,type)},_fireDOMEvent:function(e,type,targets){var isHover=type==="mouseover"||type==="mouseout";targets=(targets||[]).concat(this._findEventTargets(e.target||e.srcElement,type,!isHover));if(!targets.length){targets=[this];if(isHover&&!L.DomEvent._checkMouse(this._container,e)){return}}else if(type==="contextmenu"){L.DomEvent.preventDefault(e)}var target=targets[0];if((e.type==="click"||e.type==="preclick")&&!e._simulated&&this._draggableMoved(target)){return}var data={originalEvent:e};if(e.type!=="keypress"){var isMarker=target instanceof L.Marker;data.containerPoint=isMarker?this.latLngToContainerPoint(target.getLatLng()):this.mouseEventToContainerPoint(e);data.layerPoint=this.containerPointToLayerPoint(data.containerPoint);data.latlng=isMarker?target.getLatLng():this.layerPointToLatLng(data.layerPoint)}for(var i=0;i<targets.length;i++){targets[i].fire(type,data,true);if(data.originalEvent._stopped||targets[i].options.nonBubblingEvents&&L.Util.indexOf(targets[i].options.nonBubblingEvents,type)!==-1){return}}},_draggableMoved:function(obj){obj=obj.options.draggable?obj:this;return obj.dragging&&obj.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var i=0,len=this._handlers.length;i<len;i++){this._handlers[i].disable()}},whenReady:function(callback,context){if(this._loaded){callback.call(context||this,{target:this})}else{this.on("load",callback,context)}return this},_getMapPanePos:function(){return L.DomUtil.getPosition(this._mapPane)||new L.Point(0,0)},_moved:function(){var pos=this._getMapPanePos();return pos&&!pos.equals([0,0])},_getTopLeftPoint:function(center,zoom){var pixelOrigin=center&&zoom!==undefined?this._getNewPixelOrigin(center,zoom):this.getPixelOrigin();return pixelOrigin.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(center,zoom){var viewHalf=this.getSize()._divideBy(2);return this.project(center,zoom)._subtract(viewHalf)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(latlng,zoom,center){var topLeft=this._getNewPixelOrigin(center,zoom);return this.project(latlng,zoom)._subtract(topLeft)},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(latlng){return this.latLngToLayerPoint(latlng).subtract(this._getCenterLayerPoint())},_limitCenter:function(center,zoom,bounds){if(!bounds){return center}var centerPoint=this.project(center,zoom),viewHalf=this.getSize().divideBy(2),viewBounds=new L.Bounds(centerPoint.subtract(viewHalf),centerPoint.add(viewHalf)),offset=this._getBoundsOffset(viewBounds,bounds,zoom);return this.unproject(centerPoint.add(offset),zoom)},_limitOffset:function(offset,bounds){if(!bounds){return offset}var viewBounds=this.getPixelBounds(),newBounds=new L.Bounds(viewBounds.min.add(offset),viewBounds.max.add(offset));return offset.add(this._getBoundsOffset(newBounds,bounds))},_getBoundsOffset:function(pxBounds,maxBounds,zoom){var nwOffset=this.project(maxBounds.getNorthWest(),zoom).subtract(pxBounds.min),seOffset=this.project(maxBounds.getSouthEast(),zoom).subtract(pxBounds.max),dx=this._rebound(nwOffset.x,-seOffset.x),dy=this._rebound(nwOffset.y,-seOffset.y);return new L.Point(dx,dy)},_rebound:function(left,right){return left+right>0?Math.round(left-right)/2:Math.max(0,Math.ceil(left))-Math.max(0,Math.floor(right))},_limitZoom:function(zoom){var min=this.getMinZoom(),max=this.getMaxZoom();if(!L.Browser.any3d){zoom=Math.round(zoom)}return Math.max(min,Math.min(max,zoom))}});L.map=function(id,options){return new L.Map(id,options)};L.Layer=L.Evented.extend({options:{pane:"overlayPane",nonBubblingEvents:[]},addTo:function(map){map.addLayer(this);return this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(obj){if(obj){obj.removeLayer(this)}return this},getPane:function(name){return this._map.getPane(name?this.options[name]||name:this.options.pane)},addInteractiveTarget:function(targetEl){this._map._targets[L.stamp(targetEl)]=this;return this},removeInteractiveTarget:function(targetEl){delete this._map._targets[L.stamp(targetEl)];return this},isPopupOpen:function(){return this._popup.isOpen()},_layerAdd:function(e){var map=e.target;if(!map.hasLayer(this)){return}this._map=map;this._zoomAnimated=map._zoomAnimated;this.onAdd(map);if(this.getAttribution&&this._map.attributionControl){this._map.attributionControl.addAttribution(this.getAttribution())}if(this.getEvents){map.on(this.getEvents(),this)}this.fire("add");map.fire("layeradd",{layer:this})}});L.Map.include({addLayer:function(layer){var id=L.stamp(layer);if(this._layers[id]){return layer}this._layers[id]=layer;layer._mapToAdd=this;if(layer.beforeAdd){layer.beforeAdd(this)}this.whenReady(layer._layerAdd,layer);return this},removeLayer:function(layer){var id=L.stamp(layer);if(!this._layers[id]){return this}if(this._loaded){layer.onRemove(this)}if(layer.getAttribution&&this.attributionControl){this.attributionControl.removeAttribution(layer.getAttribution())}if(layer.getEvents){this.off(layer.getEvents(),layer)}delete this._layers[id];if(this._loaded){this.fire("layerremove",{layer:layer});layer.fire("remove")}layer._map=layer._mapToAdd=null;return this},hasLayer:function(layer){return!!layer&&L.stamp(layer)in this._layers},eachLayer:function(method,context){for(var i in this._layers){method.call(context,this._layers[i])}return this},_addLayers:function(layers){layers=layers?L.Util.isArray(layers)?layers:[layers]:[];for(var i=0,len=layers.length;i<len;i++){this.addLayer(layers[i])}},_addZoomLimit:function(layer){if(isNaN(layer.options.maxZoom)||!isNaN(layer.options.minZoom)){this._zoomBoundLayers[L.stamp(layer)]=layer;this._updateZoomLevels()}},_removeZoomLimit:function(layer){var id=L.stamp(layer);if(this._zoomBoundLayers[id]){delete this._zoomBoundLayers[id];this._updateZoomLevels()}},_updateZoomLevels:function(){var minZoom=Infinity,maxZoom=-Infinity,oldZoomSpan=this._getZoomSpan();for(var i in this._zoomBoundLayers){var options=this._zoomBoundLayers[i].options;minZoom=options.minZoom===undefined?minZoom:Math.min(minZoom,options.minZoom);maxZoom=options.maxZoom===undefined?maxZoom:Math.max(maxZoom,options.maxZoom)}this._layersMaxZoom=maxZoom===-Infinity?undefined:maxZoom;this._layersMinZoom=minZoom===Infinity?undefined:minZoom;if(oldZoomSpan!==this._getZoomSpan()){this.fire("zoomlevelschange")}}});L.Projection.Mercator={R:6378137,R_MINOR:6356752.314245179,bounds:L.bounds([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(latlng){var d=Math.PI/180,r=this.R,y=latlng.lat*d,tmp=this.R_MINOR/r,e=Math.sqrt(1-tmp*tmp),con=e*Math.sin(y);var ts=Math.tan(Math.PI/4-y/2)/Math.pow((1-con)/(1+con),e/2);y=-r*Math.log(Math.max(ts,1e-10));return new L.Point(latlng.lng*d*r,y)},unproject:function(point){var d=180/Math.PI,r=this.R,tmp=this.R_MINOR/r,e=Math.sqrt(1-tmp*tmp),ts=Math.exp(-point.y/r),phi=Math.PI/2-2*Math.atan(ts);for(var i=0,dphi=.1,con;i<15&&Math.abs(dphi)>1e-7;i++){con=e*Math.sin(phi);con=Math.pow((1-con)/(1+con),e/2);dphi=Math.PI/2-2*Math.atan(ts*con)-phi;phi+=dphi}return new L.LatLng(phi*d,point.x*d/r)}};L.CRS.EPSG3395=L.extend({},L.CRS.Earth,{code:"EPSG:3395",projection:L.Projection.Mercator,transformation:function(){var scale=.5/(Math.PI*L.Projection.Mercator.R);return new L.Transformation(scale,.5,-scale,.5)}()});L.GridLayer=L.Layer.extend({options:{pane:"tilePane",tileSize:256,opacity:1,updateWhenIdle:L.Browser.mobile,updateInterval:200,attribution:null,zIndex:null,bounds:null,minZoom:0},initialize:function(options){options=L.setOptions(this,options)},onAdd:function(){this._initContainer();this._levels={};this._tiles={};this._resetView();this._update()},beforeAdd:function(map){map._addZoomLimit(this)},onRemove:function(map){L.DomUtil.remove(this._container);map._removeZoomLimit(this);this._container=null;this._tileZoom=null},bringToFront:function(){if(this._map){L.DomUtil.toFront(this._container);this._setAutoZIndex(Math.max)}return this},bringToBack:function(){if(this._map){L.DomUtil.toBack(this._container);this._setAutoZIndex(Math.min)}return this},getAttribution:function(){return this.options.attribution},getContainer:function(){return this._container},setOpacity:function(opacity){this.options.opacity=opacity;this._updateOpacity();return this},setZIndex:function(zIndex){this.options.zIndex=zIndex;this._updateZIndex();return this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();this._update()}return this},getEvents:function(){var events={viewreset:this._resetAll,zoom:this._resetView,moveend:this._onMoveEnd};if(!this.options.updateWhenIdle){if(!this._onMove){this._onMove=L.Util.throttle(this._onMoveEnd,this.options.updateInterval,this)}events.move=this._onMove}if(this._zoomAnimated){events.zoomanim=this._animateZoom}return events},createTile:function(){return document.createElement("div")},getTileSize:function(){var s=this.options.tileSize;return s instanceof L.Point?s:new L.Point(s,s)},_updateZIndex:function(){if(this._container&&this.options.zIndex!==undefined&&this.options.zIndex!==null){this._container.style.zIndex=this.options.zIndex}},_setAutoZIndex:function(compare){var layers=this.getPane().children,edgeZIndex=-compare(-Infinity,Infinity);for(var i=0,len=layers.length,zIndex;i<len;i++){zIndex=layers[i].style.zIndex;if(layers[i]!==this._container&&zIndex){edgeZIndex=compare(edgeZIndex,+zIndex)}}if(isFinite(edgeZIndex)){this.options.zIndex=edgeZIndex+compare(-1,1);this._updateZIndex()}},_updateOpacity:function(){if(!this._map){return}if(L.Browser.ielt9||!this._map._fadeAnimated){return}L.DomUtil.setOpacity(this._container,this.options.opacity);var now=+new Date,nextFrame=false,willPrune=false;for(var key in this._tiles){var tile=this._tiles[key];if(!tile.current||!tile.loaded){continue}var fade=Math.min(1,(now-tile.loaded)/200);L.DomUtil.setOpacity(tile.el,fade);if(fade<1){nextFrame=true}else{if(tile.active){willPrune=true}tile.active=true}}if(willPrune){this._pruneTiles()}if(nextFrame){L.Util.cancelAnimFrame(this._fadeFrame);this._fadeFrame=L.Util.requestAnimFrame(this._updateOpacity,this)}},_initContainer:function(){if(this._container){return}this._container=L.DomUtil.create("div","leaflet-layer");this._updateZIndex();if(this.options.opacity<1){this._updateOpacity()}this.getPane().appendChild(this._container)},_updateLevels:function(){var zoom=this._tileZoom,maxZoom=this.options.maxZoom;for(var z in this._levels){if(this._levels[z].el.children.length||z===zoom){this._levels[z].el.style.zIndex=maxZoom-Math.abs(zoom-z)}else{L.DomUtil.remove(this._levels[z].el);delete this._levels[z]}}var level=this._levels[zoom],map=this._map;if(!level){level=this._levels[zoom]={};level.el=L.DomUtil.create("div","leaflet-tile-container leaflet-zoom-animated",this._container);level.el.style.zIndex=maxZoom;level.origin=map.project(map.unproject(map.getPixelOrigin()),zoom).round();level.zoom=zoom;this._setZoomTransform(level,map.getCenter(),map.getZoom());L.Util.falseFn(level.el.offsetWidth)}this._level=level;return level},_pruneTiles:function(){var key,tile;var zoom=this._map.getZoom();if(zoom>this.options.maxZoom||zoom<this.options.minZoom){return this._removeAllTiles()}for(key in this._tiles){tile=this._tiles[key];tile.retain=tile.current}for(key in this._tiles){tile=this._tiles[key];if(tile.current&&!tile.active){var coords=tile.coords;if(!this._retainParent(coords.x,coords.y,coords.z,coords.z-5)){this._retainChildren(coords.x,coords.y,coords.z,coords.z+2)}}}for(key in this._tiles){if(!this._tiles[key].retain){this._removeTile(key)}}},_removeAllTiles:function(){for(var key in this._tiles){this._removeTile(key)}},_resetAll:function(){for(var z in this._levels){L.DomUtil.remove(this._levels[z].el);delete this._levels[z]}this._removeAllTiles();this._tileZoom=null;this._resetView()},_retainParent:function(x,y,z,minZoom){var x2=Math.floor(x/2),y2=Math.floor(y/2),z2=z-1;var key=x2+":"+y2+":"+z2,tile=this._tiles[key];if(tile&&tile.active){tile.retain=true;return true}else if(tile&&tile.loaded){tile.retain=true}if(z2>minZoom){return this._retainParent(x2,y2,z2,minZoom)}return false},_retainChildren:function(x,y,z,maxZoom){for(var i=2*x;i<2*x+2;i++){for(var j=2*y;j<2*y+2;j++){var key=i+":"+j+":"+(z+1),tile=this._tiles[key];if(tile&&tile.active){tile.retain=true;continue}else if(tile&&tile.loaded){tile.retain=true}if(z+1<maxZoom){this._retainChildren(i,j,z+1,maxZoom)}}}},_resetView:function(e){var pinch=e&&e.pinch;this._setView(this._map.getCenter(),this._map.getZoom(),pinch,pinch)},_animateZoom:function(e){this._setView(e.center,e.zoom,true,e.noUpdate)},_setView:function(center,zoom,noPrune,noUpdate){var tileZoom=Math.round(zoom),tileZoomChanged=this._tileZoom!==tileZoom;if(!noUpdate&&tileZoomChanged){if(this._abortLoading){this._abortLoading()}this._tileZoom=tileZoom;this._updateLevels();this._resetGrid();if(!L.Browser.mobileWebkit){this._update(center,tileZoom)}if(!noPrune){this._pruneTiles()}}this._setZoomTransforms(center,zoom)},_setZoomTransforms:function(center,zoom){for(var i in this._levels){this._setZoomTransform(this._levels[i],center,zoom)}},_setZoomTransform:function(level,center,zoom){var scale=this._map.getZoomScale(zoom,level.zoom),translate=level.origin.multiplyBy(scale).subtract(this._map._getNewPixelOrigin(center,zoom)).round();if(L.Browser.any3d){L.DomUtil.setTransform(level.el,translate,scale)}else{L.DomUtil.setPosition(level.el,translate)}},_resetGrid:function(){var map=this._map,crs=map.options.crs,tileSize=this._tileSize=this.getTileSize(),tileZoom=this._tileZoom;var bounds=this._map.getPixelWorldBounds(this._tileZoom);if(bounds){this._globalTileRange=this._pxBoundsToTileRange(bounds)}this._wrapX=crs.wrapLng&&[Math.floor(map.project([0,crs.wrapLng[0]],tileZoom).x/tileSize.x),Math.ceil(map.project([0,crs.wrapLng[1]],tileZoom).x/tileSize.y)];this._wrapY=crs.wrapLat&&[Math.floor(map.project([crs.wrapLat[0],0],tileZoom).y/tileSize.x),Math.ceil(map.project([crs.wrapLat[1],0],tileZoom).y/tileSize.y)]},_onMoveEnd:function(){if(!this._map){return}this._update();this._pruneTiles()},_getTiledPixelBounds:function(center,zoom,tileZoom){var map=this._map;var scale=map.getZoomScale(zoom,tileZoom),pixelCenter=map.project(center,tileZoom).floor(),halfSize=map.getSize().divideBy(scale*2);return new L.Bounds(pixelCenter.subtract(halfSize),pixelCenter.add(halfSize))},_update:function(center,zoom){var map=this._map;if(!map){return}if(center===undefined){center=map.getCenter()}if(zoom===undefined){zoom=map.getZoom()}var tileZoom=Math.round(zoom);if(tileZoom>this.options.maxZoom||tileZoom<this.options.minZoom){return}var pixelBounds=this._getTiledPixelBounds(center,zoom,tileZoom);var tileRange=this._pxBoundsToTileRange(pixelBounds),tileCenter=tileRange.getCenter(),queue=[];for(var key in this._tiles){this._tiles[key].current=false}for(var j=tileRange.min.y;j<=tileRange.max.y;j++){for(var i=tileRange.min.x;i<=tileRange.max.x;i++){var coords=new L.Point(i,j);coords.z=tileZoom;if(!this._isValidTile(coords)){continue}var tile=this._tiles[this._tileCoordsToKey(coords)];if(tile){tile.current=true}else{queue.push(coords)}}}queue.sort(function(a,b){return a.distanceTo(tileCenter)-b.distanceTo(tileCenter)});if(queue.length!==0){if(!this._loading){this._loading=true;this.fire("loading")}var fragment=document.createDocumentFragment();for(i=0;i<queue.length;i++){this._addTile(queue[i],fragment)}this._level.el.appendChild(fragment)}},_isValidTile:function(coords){var crs=this._map.options.crs;if(!crs.infinite){var bounds=this._globalTileRange;if(!crs.wrapLng&&(coords.x<bounds.min.x||coords.x>bounds.max.x)||!crs.wrapLat&&(coords.y<bounds.min.y||coords.y>bounds.max.y)){return false}}if(!this.options.bounds){return true}var tileBounds=this._tileCoordsToBounds(coords);return L.latLngBounds(this.options.bounds).overlaps(tileBounds)},_keyToBounds:function(key){return this._tileCoordsToBounds(this._keyToTileCoords(key))},_tileCoordsToBounds:function(coords){var map=this._map,tileSize=this.getTileSize(),nwPoint=coords.scaleBy(tileSize),sePoint=nwPoint.add(tileSize),nw=map.wrapLatLng(map.unproject(nwPoint,coords.z)),se=map.wrapLatLng(map.unproject(sePoint,coords.z));return new L.LatLngBounds(nw,se)},_tileCoordsToKey:function(coords){return coords.x+":"+coords.y+":"+coords.z},_keyToTileCoords:function(key){var k=key.split(":"),coords=new L.Point(+k[0],+k[1]);coords.z=+k[2];return coords},_removeTile:function(key){var tile=this._tiles[key];if(!tile){return}L.DomUtil.remove(tile.el);delete this._tiles[key];this.fire("tileunload",{tile:tile.el,coords:this._keyToTileCoords(key)})},_initTile:function(tile){L.DomUtil.addClass(tile,"leaflet-tile");var tileSize=this.getTileSize();tile.style.width=tileSize.x+"px";tile.style.height=tileSize.y+"px";tile.onselectstart=L.Util.falseFn;tile.onmousemove=L.Util.falseFn;if(L.Browser.ielt9&&this.options.opacity<1){L.DomUtil.setOpacity(tile,this.options.opacity)}if(L.Browser.android&&!L.Browser.android23){tile.style.WebkitBackfaceVisibility="hidden"}},_addTile:function(coords,container){var tilePos=this._getTilePos(coords),key=this._tileCoordsToKey(coords);var tile=this.createTile(this._wrapCoords(coords),L.bind(this._tileReady,this,coords));this._initTile(tile);if(this.createTile.length<2){setTimeout(L.bind(this._tileReady,this,coords,null,tile),0)}L.DomUtil.setPosition(tile,tilePos);this._tiles[key]={el:tile,coords:coords,current:true};container.appendChild(tile);this.fire("tileloadstart",{tile:tile,coords:coords})},_tileReady:function(coords,err,tile){if(!this._map){return}if(err){this.fire("tileerror",{error:err,tile:tile,coords:coords})}var key=this._tileCoordsToKey(coords);tile=this._tiles[key];if(!tile){return}tile.loaded=+new Date;if(this._map._fadeAnimated){L.DomUtil.setOpacity(tile.el,0);L.Util.cancelAnimFrame(this._fadeFrame);this._fadeFrame=L.Util.requestAnimFrame(this._updateOpacity,this)}else{tile.active=true;this._pruneTiles()}L.DomUtil.addClass(tile.el,"leaflet-tile-loaded");this.fire("tileload",{tile:tile.el,coords:coords});if(this._noTilesToLoad()){this._loading=false;this.fire("load")}},_getTilePos:function(coords){return coords.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(coords){var newCoords=new L.Point(this._wrapX?L.Util.wrapNum(coords.x,this._wrapX):coords.x,this._wrapY?L.Util.wrapNum(coords.y,this._wrapY):coords.y);newCoords.z=coords.z;return newCoords},_pxBoundsToTileRange:function(bounds){var tileSize=this.getTileSize();return new L.Bounds(bounds.min.unscaleBy(tileSize).floor(),bounds.max.unscaleBy(tileSize).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var key in this._tiles){if(!this._tiles[key].loaded){return false}}return true}});L.gridLayer=function(options){return new L.GridLayer(options)};L.TileLayer=L.GridLayer.extend({options:{maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,maxNativeZoom:null,tms:false,zoomReverse:false,
detectRetina:false,crossOrigin:false},initialize:function(url,options){this._url=url;options=L.setOptions(this,options);if(options.detectRetina&&L.Browser.retina&&options.maxZoom>0){options.tileSize=Math.floor(options.tileSize/2);options.zoomOffset++;options.minZoom=Math.max(0,options.minZoom);options.maxZoom--}if(typeof options.subdomains==="string"){options.subdomains=options.subdomains.split("")}if(!L.Browser.android){this.on("tileunload",this._onTileRemove)}},setUrl:function(url,noRedraw){this._url=url;if(!noRedraw){this.redraw()}return this},createTile:function(coords,done){var tile=document.createElement("img");tile.onload=L.bind(this._tileOnLoad,this,done,tile);tile.onerror=L.bind(this._tileOnError,this,done,tile);if(this.options.crossOrigin){tile.crossOrigin=""}tile.alt="";tile.src=this.getTileUrl(coords);return tile},getTileUrl:function(coords){return L.Util.template(this._url,L.extend({r:this.options.detectRetina&&L.Browser.retina&&this.options.maxZoom>0?"@2x":"",s:this._getSubdomain(coords),x:coords.x,y:this.options.tms?this._globalTileRange.max.y-coords.y:coords.y,z:this._getZoomForUrl()},this.options))},_tileOnLoad:function(done,tile){if(L.Browser.ielt9){setTimeout(L.bind(done,this,null,tile),0)}else{done(null,tile)}},_tileOnError:function(done,tile,e){var errorUrl=this.options.errorTileUrl;if(errorUrl){tile.src=errorUrl}done(e,tile)},getTileSize:function(){var map=this._map,tileSize=L.GridLayer.prototype.getTileSize.call(this),zoom=this._tileZoom+this.options.zoomOffset,zoomN=this.options.maxNativeZoom;return zoomN!==null&&zoom>zoomN?tileSize.divideBy(map.getZoomScale(zoomN,zoom)).round():tileSize},_onTileRemove:function(e){e.tile.onload=null},_getZoomForUrl:function(){var options=this.options,zoom=this._tileZoom;if(options.zoomReverse){zoom=options.maxZoom-zoom}zoom+=options.zoomOffset;return options.maxNativeZoom?Math.min(zoom,options.maxNativeZoom):zoom},_getSubdomain:function(tilePoint){var index=Math.abs(tilePoint.x+tilePoint.y)%this.options.subdomains.length;return this.options.subdomains[index]},_abortLoading:function(){var i,tile;for(i in this._tiles){tile=this._tiles[i].el;tile.onload=L.Util.falseFn;tile.onerror=L.Util.falseFn;if(!tile.complete){tile.src=L.Util.emptyImageUrl;L.DomUtil.remove(tile)}}}});L.tileLayer=function(url,options){return new L.TileLayer(url,options)};L.TileLayer.WMS=L.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:false},options:{crs:null,uppercase:false},initialize:function(url,options){this._url=url;var wmsParams=L.extend({},this.defaultWmsParams);for(var i in options){if(!(i in this.options)){wmsParams[i]=options[i]}}options=L.setOptions(this,options);wmsParams.width=wmsParams.height=options.tileSize*(options.detectRetina&&L.Browser.retina?2:1);this.wmsParams=wmsParams},onAdd:function(map){this._crs=this.options.crs||map.options.crs;this._wmsVersion=parseFloat(this.wmsParams.version);var projectionKey=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[projectionKey]=this._crs.code;L.TileLayer.prototype.onAdd.call(this,map)},getTileUrl:function(coords){var tileBounds=this._tileCoordsToBounds(coords),nw=this._crs.project(tileBounds.getNorthWest()),se=this._crs.project(tileBounds.getSouthEast()),bbox=(this._wmsVersion>=1.3&&this._crs===L.CRS.EPSG4326?[se.y,nw.x,nw.y,se.x]:[nw.x,se.y,se.x,nw.y]).join(","),url=L.TileLayer.prototype.getTileUrl.call(this,coords);return url+L.Util.getParamString(this.wmsParams,url,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+bbox},setParams:function(params,noRedraw){L.extend(this.wmsParams,params);if(!noRedraw){this.redraw()}return this}});L.tileLayer.wms=function(url,options){return new L.TileLayer.WMS(url,options)};L.ImageOverlay=L.Layer.extend({options:{opacity:1,alt:"",interactive:false},initialize:function(url,bounds,options){this._url=url;this._bounds=L.latLngBounds(bounds);L.setOptions(this,options)},onAdd:function(){if(!this._image){this._initImage();if(this.options.opacity<1){this._updateOpacity()}}if(this.options.interactive){L.DomUtil.addClass(this._image,"leaflet-interactive");this.addInteractiveTarget(this._image)}this.getPane().appendChild(this._image);this._reset()},onRemove:function(){L.DomUtil.remove(this._image);if(this.options.interactive){this.removeInteractiveTarget(this._image)}},setOpacity:function(opacity){this.options.opacity=opacity;if(this._image){this._updateOpacity()}return this},setStyle:function(styleOpts){if(styleOpts.opacity){this.setOpacity(styleOpts.opacity)}return this},bringToFront:function(){if(this._map){L.DomUtil.toFront(this._image)}return this},bringToBack:function(){if(this._map){L.DomUtil.toBack(this._image)}return this},setUrl:function(url){this._url=url;if(this._image){this._image.src=url}return this},getAttribution:function(){return this.options.attribution},getEvents:function(){var events={zoom:this._reset,viewreset:this._reset};if(this._zoomAnimated){events.zoomanim=this._animateZoom}return events},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var img=this._image=L.DomUtil.create("img","leaflet-image-layer "+(this._zoomAnimated?"leaflet-zoom-animated":""));img.onselectstart=L.Util.falseFn;img.onmousemove=L.Util.falseFn;img.onload=L.bind(this.fire,this,"load");if(this.options.crossOrigin){img.crossOrigin=""}img.src=this._url;img.alt=this.options.alt},_animateZoom:function(e){var scale=this._map.getZoomScale(e.zoom),offset=this._map._latLngToNewLayerPoint(this._bounds.getNorthWest(),e.zoom,e.center);L.DomUtil.setTransform(this._image,offset,scale)},_reset:function(){var image=this._image,bounds=new L.Bounds(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),size=bounds.getSize();L.DomUtil.setPosition(image,bounds.min);image.style.width=size.x+"px";image.style.height=size.y+"px"},_updateOpacity:function(){L.DomUtil.setOpacity(this._image,this.options.opacity)}});L.imageOverlay=function(url,bounds,options){return new L.ImageOverlay(url,bounds,options)};L.Icon=L.Class.extend({initialize:function(options){L.setOptions(this,options)},createIcon:function(oldIcon){return this._createIcon("icon",oldIcon)},createShadow:function(oldIcon){return this._createIcon("shadow",oldIcon)},_createIcon:function(name,oldIcon){var src=this._getIconUrl(name);if(!src){if(name==="icon"){throw new Error("iconUrl not set in Icon options (see the docs).")}return null}var img=this._createImg(src,oldIcon&&oldIcon.tagName==="IMG"?oldIcon:null);this._setIconStyles(img,name);return img},_setIconStyles:function(img,name){var options=this.options,size=L.point(options[name+"Size"]),anchor=L.point(name==="shadow"&&options.shadowAnchor||options.iconAnchor||size&&size.divideBy(2,true));img.className="leaflet-marker-"+name+" "+(options.className||"");if(anchor){img.style.marginLeft=-anchor.x+"px";img.style.marginTop=-anchor.y+"px"}if(size){img.style.width=size.x+"px";img.style.height=size.y+"px"}},_createImg:function(src,el){el=el||document.createElement("img");el.src=src;return el},_getIconUrl:function(name){return L.Browser.retina&&this.options[name+"RetinaUrl"]||this.options[name+"Url"]}});L.icon=function(options){return new L.Icon(options)};L.Icon.Default=L.Icon.extend({options:{iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]},_getIconUrl:function(name){var key=name+"Url";if(this.options[key]){return this.options[key]}var path=L.Icon.Default.imagePath;if(!path){throw new Error("Couldn't autodetect L.Icon.Default.imagePath, set it manually.")}return path+"/marker-"+name+(L.Browser.retina&&name==="icon"?"-2x":"")+".png"}});L.Icon.Default.imagePath=function(){var scripts=document.getElementsByTagName("script"),leafletRe=/[\/^]leaflet[\-\._]?([\w\-\._]*)\.js\??/;var i,len,src,path;for(i=0,len=scripts.length;i<len;i++){src=scripts[i].src;if(src.match(leafletRe)){path=src.split(leafletRe)[0];return(path?path+"/":"")+"images"}}}();L.Marker=L.Layer.extend({options:{pane:"markerPane",nonBubblingEvents:["click","dblclick","mouseover","mouseout","contextmenu"],icon:new L.Icon.Default,interactive:true,keyboard:true,zIndexOffset:0,opacity:1,riseOffset:250},initialize:function(latlng,options){L.setOptions(this,options);this._latlng=L.latLng(latlng)},onAdd:function(map){this._zoomAnimated=this._zoomAnimated&&map.options.markerZoomAnimation;this._initIcon();this.update()},onRemove:function(){if(this.dragging&&this.dragging.enabled()){this.options.draggable=true;this.dragging.removeHooks()}this._removeIcon();this._removeShadow()},getEvents:function(){var events={zoom:this.update,viewreset:this.update};if(this._zoomAnimated){events.zoomanim=this._animateZoom}return events},getLatLng:function(){return this._latlng},setLatLng:function(latlng){var oldLatLng=this._latlng;this._latlng=L.latLng(latlng);this.update();return this.fire("move",{oldLatLng:oldLatLng,latlng:this._latlng})},setZIndexOffset:function(offset){this.options.zIndexOffset=offset;return this.update()},setIcon:function(icon){this.options.icon=icon;if(this._map){this._initIcon();this.update()}if(this._popup){this.bindPopup(this._popup,this._popup.options)}return this},getElement:function(){return this._icon},update:function(){if(this._icon){var pos=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(pos)}return this},_initIcon:function(){var options=this.options,classToAdd="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");var icon=options.icon.createIcon(this._icon),addIcon=false;if(icon!==this._icon){if(this._icon){this._removeIcon()}addIcon=true;if(options.title){icon.title=options.title}if(options.alt){icon.alt=options.alt}}L.DomUtil.addClass(icon,classToAdd);if(options.keyboard){icon.tabIndex="0"}this._icon=icon;this._initInteraction();if(options.riseOnHover){this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex})}var newShadow=options.icon.createShadow(this._shadow),addShadow=false;if(newShadow!==this._shadow){this._removeShadow();addShadow=true}if(newShadow){L.DomUtil.addClass(newShadow,classToAdd)}this._shadow=newShadow;if(options.opacity<1){this._updateOpacity()}if(addIcon){this.getPane().appendChild(this._icon)}if(newShadow&&addShadow){this.getPane("shadowPane").appendChild(this._shadow)}},_removeIcon:function(){if(this.options.riseOnHover){this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex})}L.DomUtil.remove(this._icon);this.removeInteractiveTarget(this._icon);this._icon=null},_removeShadow:function(){if(this._shadow){L.DomUtil.remove(this._shadow)}this._shadow=null},_setPos:function(pos){L.DomUtil.setPosition(this._icon,pos);if(this._shadow){L.DomUtil.setPosition(this._shadow,pos)}this._zIndex=pos.y+this.options.zIndexOffset;this._resetZIndex()},_updateZIndex:function(offset){this._icon.style.zIndex=this._zIndex+offset},_animateZoom:function(opt){var pos=this._map._latLngToNewLayerPoint(this._latlng,opt.zoom,opt.center).round();this._setPos(pos)},_initInteraction:function(){if(!this.options.interactive){return}L.DomUtil.addClass(this._icon,"leaflet-interactive");this.addInteractiveTarget(this._icon);if(L.Handler.MarkerDrag){var draggable=this.options.draggable;if(this.dragging){draggable=this.dragging.enabled();this.dragging.disable()}this.dragging=new L.Handler.MarkerDrag(this);if(draggable){this.dragging.enable()}}},setOpacity:function(opacity){this.options.opacity=opacity;if(this._map){this._updateOpacity()}return this},_updateOpacity:function(){var opacity=this.options.opacity;L.DomUtil.setOpacity(this._icon,opacity);if(this._shadow){L.DomUtil.setOpacity(this._shadow,opacity)}},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)}});L.marker=function(latlng,options){return new L.Marker(latlng,options)};L.DivIcon=L.Icon.extend({options:{iconSize:[12,12],className:"leaflet-div-icon",html:false},createIcon:function(oldIcon){var div=oldIcon&&oldIcon.tagName==="DIV"?oldIcon:document.createElement("div"),options=this.options;div.innerHTML=options.html!==false?options.html:"";if(options.bgPos){div.style.backgroundPosition=-options.bgPos.x+"px "+-options.bgPos.y+"px"}this._setIconStyles(div,"icon");return div},createShadow:function(){return null}});L.divIcon=function(options){return new L.DivIcon(options)};L.Map.mergeOptions({closePopupOnClick:true});L.Popup=L.Layer.extend({options:{pane:"popupPane",minWidth:50,maxWidth:300,offset:[0,7],autoPan:true,autoPanPadding:[5,5],closeButton:true,autoClose:true,zoomAnimation:true},initialize:function(options,source){L.setOptions(this,options);this._source=source},onAdd:function(map){this._zoomAnimated=this._zoomAnimated&&this.options.zoomAnimation;if(!this._container){this._initLayout()}if(map._fadeAnimated){L.DomUtil.setOpacity(this._container,0)}clearTimeout(this._removeTimeout);this.getPane().appendChild(this._container);this.update();if(map._fadeAnimated){L.DomUtil.setOpacity(this._container,1)}map.fire("popupopen",{popup:this});if(this._source){this._source.fire("popupopen",{popup:this},true)}},openOn:function(map){map.openPopup(this);return this},onRemove:function(map){if(map._fadeAnimated){L.DomUtil.setOpacity(this._container,0);this._removeTimeout=setTimeout(L.bind(L.DomUtil.remove,L.DomUtil,this._container),200)}else{L.DomUtil.remove(this._container)}map.fire("popupclose",{popup:this});if(this._source){this._source.fire("popupclose",{popup:this},true)}},getLatLng:function(){return this._latlng},setLatLng:function(latlng){this._latlng=L.latLng(latlng);if(this._map){this._updatePosition();this._adjustPan()}return this},getContent:function(){return this._content},setContent:function(content){this._content=content;this.update();return this},getElement:function(){return this._container},update:function(){if(!this._map){return}this._container.style.visibility="hidden";this._updateContent();this._updateLayout();this._updatePosition();this._container.style.visibility="";this._adjustPan()},getEvents:function(){var events={zoom:this._updatePosition,viewreset:this._updatePosition};if(this._zoomAnimated){events.zoomanim=this._animateZoom}if("closeOnClick"in this.options?this.options.closeOnClick:this._map.options.closePopupOnClick){events.preclick=this._close}if(this.options.keepInView){events.moveend=this._adjustPan}return events},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},_close:function(){if(this._map){this._map.closePopup(this)}},_initLayout:function(){var prefix="leaflet-popup",container=this._container=L.DomUtil.create("div",prefix+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"));if(this.options.closeButton){var closeButton=this._closeButton=L.DomUtil.create("a",prefix+"-close-button",container);closeButton.href="#close";closeButton.innerHTML="&#215;";L.DomEvent.on(closeButton,"click",this._onCloseButtonClick,this)}var wrapper=this._wrapper=L.DomUtil.create("div",prefix+"-content-wrapper",container);this._contentNode=L.DomUtil.create("div",prefix+"-content",wrapper);L.DomEvent.disableClickPropagation(wrapper).disableScrollPropagation(this._contentNode).on(wrapper,"contextmenu",L.DomEvent.stopPropagation);this._tipContainer=L.DomUtil.create("div",prefix+"-tip-container",container);this._tip=L.DomUtil.create("div",prefix+"-tip",this._tipContainer)},_updateContent:function(){if(!this._content){return}var node=this._contentNode;var content=typeof this._content==="function"?this._content(this._source||this):this._content;if(typeof content==="string"){node.innerHTML=content}else{while(node.hasChildNodes()){node.removeChild(node.firstChild)}node.appendChild(content)}this.fire("contentupdate")},_updateLayout:function(){var container=this._contentNode,style=container.style;style.width="";style.whiteSpace="nowrap";var width=container.offsetWidth;width=Math.min(width,this.options.maxWidth);width=Math.max(width,this.options.minWidth);style.width=width+1+"px";style.whiteSpace="";style.height="";var height=container.offsetHeight,maxHeight=this.options.maxHeight,scrolledClass="leaflet-popup-scrolled";if(maxHeight&&height>maxHeight){style.height=maxHeight+"px";L.DomUtil.addClass(container,scrolledClass)}else{L.DomUtil.removeClass(container,scrolledClass)}this._containerWidth=this._container.offsetWidth},_updatePosition:function(){if(!this._map){return}var pos=this._map.latLngToLayerPoint(this._latlng),offset=L.point(this.options.offset);if(this._zoomAnimated){L.DomUtil.setPosition(this._container,pos)}else{offset=offset.add(pos)}var bottom=this._containerBottom=-offset.y,left=this._containerLeft=-Math.round(this._containerWidth/2)+offset.x;this._container.style.bottom=bottom+"px";this._container.style.left=left+"px"},_animateZoom:function(e){var pos=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center);L.DomUtil.setPosition(this._container,pos)},_adjustPan:function(){if(!this.options.autoPan){return}var map=this._map,containerHeight=this._container.offsetHeight,containerWidth=this._containerWidth,layerPos=new L.Point(this._containerLeft,-containerHeight-this._containerBottom);if(this._zoomAnimated){layerPos._add(L.DomUtil.getPosition(this._container))}var containerPos=map.layerPointToContainerPoint(layerPos),padding=L.point(this.options.autoPanPadding),paddingTL=L.point(this.options.autoPanPaddingTopLeft||padding),paddingBR=L.point(this.options.autoPanPaddingBottomRight||padding),size=map.getSize(),dx=0,dy=0;if(containerPos.x+containerWidth+paddingBR.x>size.x){dx=containerPos.x+containerWidth-size.x+paddingBR.x}if(containerPos.x-dx-paddingTL.x<0){dx=containerPos.x-paddingTL.x}if(containerPos.y+containerHeight+paddingBR.y>size.y){dy=containerPos.y+containerHeight-size.y+paddingBR.y}if(containerPos.y-dy-paddingTL.y<0){dy=containerPos.y-paddingTL.y}if(dx||dy){map.fire("autopanstart").panBy([dx,dy])}},_onCloseButtonClick:function(e){this._close();L.DomEvent.stop(e)}});L.popup=function(options,source){return new L.Popup(options,source)};L.Map.include({openPopup:function(popup,latlng,options){if(!(popup instanceof L.Popup)){popup=new L.Popup(options).setContent(popup)}if(latlng){popup.setLatLng(latlng)}if(this.hasLayer(popup)){return this}if(this._popup&&this._popup.options.autoClose){this.closePopup()}this._popup=popup;return this.addLayer(popup)},closePopup:function(popup){if(!popup||popup===this._popup){popup=this._popup;this._popup=null}if(popup){this.removeLayer(popup)}return this}});L.Layer.include({bindPopup:function(content,options){if(content instanceof L.Popup){L.setOptions(content,options);this._popup=content;content._source=this}else{if(!this._popup||options){this._popup=new L.Popup(options,this)}this._popup.setContent(content)}if(!this._popupHandlersAdded){this.on({click:this._openPopup,remove:this.closePopup,move:this._movePopup});this._popupHandlersAdded=true}this._originalPopupOffset=this._popup.options.offset;return this},unbindPopup:function(){if(this._popup){this.off({click:this._openPopup,remove:this.closePopup,move:this._movePopup});this._popupHandlersAdded=false;this._popup=null}return this},openPopup:function(layer,latlng){if(!(layer instanceof L.Layer)){latlng=layer;layer=this}if(layer instanceof L.FeatureGroup){for(var id in this._layers){layer=this._layers[id];break}}if(!latlng){latlng=layer.getCenter?layer.getCenter():layer.getLatLng()}if(this._popup&&this._map){this._popup.options.offset=this._popupAnchor(layer);this._popup._source=layer;this._popup.update();this._map.openPopup(this._popup,latlng)}return this},closePopup:function(){if(this._popup){this._popup._close()}return this},togglePopup:function(target){if(this._popup){if(this._popup._map){this.closePopup()}else{this.openPopup(target)}}return this},setPopupContent:function(content){if(this._popup){this._popup.setContent(content)}return this},getPopup:function(){return this._popup},_openPopup:function(e){var layer=e.layer||e.target;if(!this._popup){return}if(!this._map){return}if(layer instanceof L.Path){this.openPopup(e.layer||e.target,e.latlng);return}if(this._map.hasLayer(this._popup)&&this._popup._source===layer){this.closePopup()}else{this.openPopup(layer,e.latlng)}},_popupAnchor:function(layer){var anchor=layer._getPopupAnchor?layer._getPopupAnchor():[0,0];var offsetToAdd=this._originalPopupOffset||L.Popup.prototype.options.offset;return L.point(anchor).add(offsetToAdd)},_movePopup:function(e){this._popup.setLatLng(e.latlng)}});L.Marker.include({_getPopupAnchor:function(){return this.options.icon.options.popupAnchor||[0,0]}});L.LayerGroup=L.Layer.extend({initialize:function(layers){this._layers={};var i,len;if(layers){for(i=0,len=layers.length;i<len;i++){this.addLayer(layers[i])}}},addLayer:function(layer){var id=this.getLayerId(layer);this._layers[id]=layer;if(this._map){this._map.addLayer(layer)}return this},removeLayer:function(layer){var id=layer in this._layers?layer:this.getLayerId(layer);if(this._map&&this._layers[id]){this._map.removeLayer(this._layers[id])}delete this._layers[id];return this},hasLayer:function(layer){return!!layer&&(layer in this._layers||this.getLayerId(layer)in this._layers)},clearLayers:function(){for(var i in this._layers){this.removeLayer(this._layers[i])}return this},invoke:function(methodName){var args=Array.prototype.slice.call(arguments,1),i,layer;for(i in this._layers){layer=this._layers[i];if(layer[methodName]){layer[methodName].apply(layer,args)}}return this},onAdd:function(map){for(var i in this._layers){map.addLayer(this._layers[i])}},onRemove:function(map){for(var i in this._layers){map.removeLayer(this._layers[i])}},eachLayer:function(method,context){for(var i in this._layers){method.call(context,this._layers[i])}return this},getLayer:function(id){return this._layers[id]},getLayers:function(){var layers=[];for(var i in this._layers){layers.push(this._layers[i])}return layers},setZIndex:function(zIndex){return this.invoke("setZIndex",zIndex)},getLayerId:function(layer){return L.stamp(layer)}});L.layerGroup=function(layers){return new L.LayerGroup(layers)};L.FeatureGroup=L.LayerGroup.extend({addLayer:function(layer){if(this.hasLayer(layer)){return this}layer.addEventParent(this);L.LayerGroup.prototype.addLayer.call(this,layer);return this.fire("layeradd",{layer:layer})},removeLayer:function(layer){if(!this.hasLayer(layer)){return this}if(layer in this._layers){layer=this._layers[layer]}layer.removeEventParent(this);L.LayerGroup.prototype.removeLayer.call(this,layer);return this.fire("layerremove",{layer:layer})},setStyle:function(style){return this.invoke("setStyle",style)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var bounds=new L.LatLngBounds;for(var id in this._layers){var layer=this._layers[id];bounds.extend(layer.getBounds?layer.getBounds():layer.getLatLng())}return bounds}});L.featureGroup=function(layers){return new L.FeatureGroup(layers)};L.Renderer=L.Layer.extend({options:{padding:.1},initialize:function(options){L.setOptions(this,options);L.stamp(this)},onAdd:function(){if(!this._container){this._initContainer();if(this._zoomAnimated){L.DomUtil.addClass(this._container,"leaflet-zoom-animated")}}this.getPane().appendChild(this._container);this._update()},onRemove:function(){L.DomUtil.remove(this._container)},getEvents:function(){var events={viewreset:this._reset,zoom:this._updateTransform,moveend:this._update};if(this._zoomAnimated){events.zoomanim=this._animateZoom}return events},_animateZoom:function(e){var scale=this._map.getZoomScale(e.zoom,this._zoom),offset=this._map._latLngToNewLayerPoint(this._topLeft,e.zoom,e.center);L.DomUtil.setTransform(this._container,offset,scale)},_updateTransform:function(){var zoom=this._map.getZoom(),center=this._map.getCenter(),scale=this._map.getZoomScale(zoom,this._zoom),offset=this._map._latLngToNewLayerPoint(this._topLeft,zoom,center);L.DomUtil.setTransform(this._container,offset,scale)},_reset:function(){this._update();this._updateTransform()},_update:function(){var p=this.options.padding,size=this._map.getSize(),min=this._map.containerPointToLayerPoint(size.multiplyBy(-p)).round();this._bounds=new L.Bounds(min,min.add(size.multiplyBy(1+p*2)).round());this._topLeft=this._map.layerPointToLatLng(min);this._zoom=this._map.getZoom()}});L.Map.include({getRenderer:function(layer){var renderer=layer.options.renderer||this._getPaneRenderer(layer.options.pane)||this.options.renderer||this._renderer;if(!renderer){renderer=this._renderer=this.options.preferCanvas&&L.canvas()||L.svg()}if(!this.hasLayer(renderer)){this.addLayer(renderer)}return renderer},_getPaneRenderer:function(name){if(name==="overlayPane"||name===undefined){return false}var renderer=this._paneRenderers[name];if(renderer===undefined){renderer=L.SVG&&L.svg({pane:name})||L.Canvas&&L.canvas({pane:name});this._paneRenderers[name]=renderer}return renderer}});L.Path=L.Layer.extend({options:{stroke:true,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",fillOpacity:.2,fillRule:"evenodd",interactive:true},onAdd:function(){this._renderer=this._map.getRenderer(this);this._renderer._initPath(this);this._reset();this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},getEvents:function(){return{zoomend:this._project,moveend:this._update,viewreset:this._reset}},redraw:function(){if(this._map){this._renderer._updatePath(this)}return this},setStyle:function(style){L.setOptions(this,style);if(this._renderer){this._renderer._updateStyle(this)}return this},bringToFront:function(){if(this._renderer){this._renderer._bringToFront(this)}return this},bringToBack:function(){if(this._renderer){this._renderer._bringToBack(this)}return this},getElement:function(){return this._path},_reset:function(){this._project();this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(L.Browser.touch?10:0)}});L.LineUtil={simplify:function(points,tolerance){if(!tolerance||!points.length){return points.slice()}var sqTolerance=tolerance*tolerance;points=this._reducePoints(points,sqTolerance);points=this._simplifyDP(points,sqTolerance);return points},pointToSegmentDistance:function(p,p1,p2){return Math.sqrt(this._sqClosestPointOnSegment(p,p1,p2,true))},closestPointOnSegment:function(p,p1,p2){return this._sqClosestPointOnSegment(p,p1,p2)},_simplifyDP:function(points,sqTolerance){var len=points.length,ArrayConstructor=typeof Uint8Array!==undefined+""?Uint8Array:Array,markers=new ArrayConstructor(len);markers[0]=markers[len-1]=1;this._simplifyDPStep(points,markers,sqTolerance,0,len-1);var i,newPoints=[];for(i=0;i<len;i++){if(markers[i]){newPoints.push(points[i])}}return newPoints},_simplifyDPStep:function(points,markers,sqTolerance,first,last){var maxSqDist=0,index,i,sqDist;for(i=first+1;i<=last-1;i++){sqDist=this._sqClosestPointOnSegment(points[i],points[first],points[last],true);if(sqDist>maxSqDist){index=i;maxSqDist=sqDist}}if(maxSqDist>sqTolerance){markers[index]=1;this._simplifyDPStep(points,markers,sqTolerance,first,index);this._simplifyDPStep(points,markers,sqTolerance,index,last)}},_reducePoints:function(points,sqTolerance){var reducedPoints=[points[0]];for(var i=1,prev=0,len=points.length;i<len;i++){if(this._sqDist(points[i],points[prev])>sqTolerance){reducedPoints.push(points[i]);prev=i}}if(prev<len-1){reducedPoints.push(points[len-1])}return reducedPoints},clipSegment:function(a,b,bounds,useLastCode,round){var codeA=useLastCode?this._lastCode:this._getBitCode(a,bounds),codeB=this._getBitCode(b,bounds),codeOut,p,newCode;this._lastCode=codeB;while(true){if(!(codeA|codeB)){return[a,b]}else if(codeA&codeB){return false}else{codeOut=codeA||codeB;p=this._getEdgeIntersection(a,b,codeOut,bounds,round);newCode=this._getBitCode(p,bounds);if(codeOut===codeA){a=p;codeA=newCode}else{b=p;codeB=newCode}}}},_getEdgeIntersection:function(a,b,code,bounds,round){var dx=b.x-a.x,dy=b.y-a.y,min=bounds.min,max=bounds.max,x,y;if(code&8){x=a.x+dx*(max.y-a.y)/dy;y=max.y}else if(code&4){x=a.x+dx*(min.y-a.y)/dy;y=min.y}else if(code&2){x=max.x;y=a.y+dy*(max.x-a.x)/dx}else if(code&1){x=min.x;y=a.y+dy*(min.x-a.x)/dx}return new L.Point(x,y,round)},_getBitCode:function(p,bounds){var code=0;if(p.x<bounds.min.x){code|=1}else if(p.x>bounds.max.x){code|=2}if(p.y<bounds.min.y){code|=4}else if(p.y>bounds.max.y){code|=8}return code},_sqDist:function(p1,p2){var dx=p2.x-p1.x,dy=p2.y-p1.y;return dx*dx+dy*dy},_sqClosestPointOnSegment:function(p,p1,p2,sqDist){var x=p1.x,y=p1.y,dx=p2.x-x,dy=p2.y-y,dot=dx*dx+dy*dy,t;if(dot>0){t=((p.x-x)*dx+(p.y-y)*dy)/dot;if(t>1){x=p2.x;y=p2.y}else if(t>0){x+=dx*t;y+=dy*t}}dx=p.x-x;dy=p.y-y;return sqDist?dx*dx+dy*dy:new L.Point(x,y)}};L.Polyline=L.Path.extend({options:{smoothFactor:1},initialize:function(latlngs,options){L.setOptions(this,options);this._setLatLngs(latlngs)},getLatLngs:function(){return this._latlngs},setLatLngs:function(latlngs){this._setLatLngs(latlngs);return this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(p){var minDistance=Infinity,minPoint=null,closest=L.LineUtil._sqClosestPointOnSegment,p1,p2;for(var j=0,jLen=this._parts.length;j<jLen;j++){var points=this._parts[j];for(var i=1,len=points.length;i<len;i++){p1=points[i-1];p2=points[i];var sqDist=closest(p,p1,p2,true);if(sqDist<minDistance){minDistance=sqDist;minPoint=closest(p,p1,p2)}}}if(minPoint){minPoint.distance=Math.sqrt(minDistance)}return minPoint},getCenter:function(){var i,halfDist,segDist,dist,p1,p2,ratio,points=this._rings[0],len=points.length;if(!len){return null}for(i=0,halfDist=0;i<len-1;i++){halfDist+=points[i].distanceTo(points[i+1])/2}if(halfDist===0){return this._map.layerPointToLatLng(points[0])}for(i=0,dist=0;i<len-1;i++){p1=points[i];p2=points[i+1];segDist=p1.distanceTo(p2);dist+=segDist;if(dist>halfDist){ratio=(dist-halfDist)/segDist;return this._map.layerPointToLatLng([p2.x-ratio*(p2.x-p1.x),p2.y-ratio*(p2.y-p1.y)])}}},getBounds:function(){return this._bounds},addLatLng:function(latlng,latlngs){latlngs=latlngs||this._defaultShape();latlng=L.latLng(latlng);latlngs.push(latlng);this._bounds.extend(latlng);return this.redraw()},_setLatLngs:function(latlngs){this._bounds=new L.LatLngBounds;this._latlngs=this._convertLatLngs(latlngs)},_defaultShape:function(){return L.Polyline._flat(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(latlngs){var result=[],flat=L.Polyline._flat(latlngs);for(var i=0,len=latlngs.length;i<len;i++){if(flat){result[i]=L.latLng(latlngs[i]);this._bounds.extend(result[i])}else{result[i]=this._convertLatLngs(latlngs[i])}}return result},_project:function(){this._rings=[];this._projectLatlngs(this._latlngs,this._rings);var w=this._clickTolerance(),p=new L.Point(w,-w);if(this._bounds.isValid()){this._pxBounds=new L.Bounds(this._map.latLngToLayerPoint(this._bounds.getSouthWest())._subtract(p),this._map.latLngToLayerPoint(this._bounds.getNorthEast())._add(p))}},_projectLatlngs:function(latlngs,result){var flat=latlngs[0]instanceof L.LatLng,len=latlngs.length,i,ring;if(flat){ring=[];for(i=0;i<len;i++){ring[i]=this._map.latLngToLayerPoint(latlngs[i])}result.push(ring)}else{for(i=0;i<len;i++){this._projectLatlngs(latlngs[i],result)}}},_clipPoints:function(){var bounds=this._renderer._bounds;this._parts=[];if(!this._pxBounds||!this._pxBounds.intersects(bounds)){return}if(this.options.noClip){this._parts=this._rings;return}var parts=this._parts,i,j,k,len,len2,segment,points;for(i=0,k=0,len=this._rings.length;i<len;i++){points=this._rings[i];for(j=0,len2=points.length;j<len2-1;j++){segment=L.LineUtil.clipSegment(points[j],points[j+1],bounds,j,true);if(!segment){continue}parts[k]=parts[k]||[];parts[k].push(segment[0]);if(segment[1]!==points[j+1]||j===len2-2){parts[k].push(segment[1]);k++}}}},_simplifyPoints:function(){var parts=this._parts,tolerance=this.options.smoothFactor;for(var i=0,len=parts.length;i<len;i++){parts[i]=L.LineUtil.simplify(parts[i],tolerance)}},_update:function(){if(!this._map){return}this._clipPoints();this._simplifyPoints();this._updatePath()},_updatePath:function(){
this._renderer._updatePoly(this)}});L.polyline=function(latlngs,options){return new L.Polyline(latlngs,options)};L.Polyline._flat=function(latlngs){return!L.Util.isArray(latlngs[0])||typeof latlngs[0][0]!=="object"&&typeof latlngs[0][0]!=="undefined"};L.PolyUtil={};L.PolyUtil.clipPolygon=function(points,bounds,round){var clippedPoints,edges=[1,4,2,8],i,j,k,a,b,len,edge,p,lu=L.LineUtil;for(i=0,len=points.length;i<len;i++){points[i]._code=lu._getBitCode(points[i],bounds)}for(k=0;k<4;k++){edge=edges[k];clippedPoints=[];for(i=0,len=points.length,j=len-1;i<len;j=i++){a=points[i];b=points[j];if(!(a._code&edge)){if(b._code&edge){p=lu._getEdgeIntersection(b,a,edge,bounds,round);p._code=lu._getBitCode(p,bounds);clippedPoints.push(p)}clippedPoints.push(a)}else if(!(b._code&edge)){p=lu._getEdgeIntersection(b,a,edge,bounds,round);p._code=lu._getBitCode(p,bounds);clippedPoints.push(p)}}points=clippedPoints}return points};L.Polygon=L.Polyline.extend({options:{fill:true},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){var i,j,p1,p2,f,area,x,y,center,points=this._rings[0],len=points.length;if(!len){return null}area=x=y=0;for(i=0,j=len-1;i<len;j=i++){p1=points[i];p2=points[j];f=p1.y*p2.x-p2.y*p1.x;x+=(p1.x+p2.x)*f;y+=(p1.y+p2.y)*f;area+=f*3}if(area===0){center=points[0]}else{center=[x/area,y/area]}return this._map.layerPointToLatLng(center)},_convertLatLngs:function(latlngs){var result=L.Polyline.prototype._convertLatLngs.call(this,latlngs),len=result.length;if(len>=2&&result[0]instanceof L.LatLng&&result[0].equals(result[len-1])){result.pop()}return result},_setLatLngs:function(latlngs){L.Polyline.prototype._setLatLngs.call(this,latlngs);if(L.Polyline._flat(this._latlngs)){this._latlngs=[this._latlngs]}},_defaultShape:function(){return L.Polyline._flat(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var bounds=this._renderer._bounds,w=this.options.weight,p=new L.Point(w,w);bounds=new L.Bounds(bounds.min.subtract(p),bounds.max.add(p));this._parts=[];if(!this._pxBounds||!this._pxBounds.intersects(bounds)){return}if(this.options.noClip){this._parts=this._rings;return}for(var i=0,len=this._rings.length,clipped;i<len;i++){clipped=L.PolyUtil.clipPolygon(this._rings[i],bounds,true);if(clipped.length){this._parts.push(clipped)}}},_updatePath:function(){this._renderer._updatePoly(this,true)}});L.polygon=function(latlngs,options){return new L.Polygon(latlngs,options)};L.Rectangle=L.Polygon.extend({initialize:function(latLngBounds,options){L.Polygon.prototype.initialize.call(this,this._boundsToLatLngs(latLngBounds),options)},setBounds:function(latLngBounds){this.setLatLngs(this._boundsToLatLngs(latLngBounds))},_boundsToLatLngs:function(latLngBounds){latLngBounds=L.latLngBounds(latLngBounds);return[latLngBounds.getSouthWest(),latLngBounds.getNorthWest(),latLngBounds.getNorthEast(),latLngBounds.getSouthEast()]}});L.rectangle=function(latLngBounds,options){return new L.Rectangle(latLngBounds,options)};L.CircleMarker=L.Path.extend({options:{fill:true,radius:10},initialize:function(latlng,options){L.setOptions(this,options);this._latlng=L.latLng(latlng);this._radius=this.options.radius},setLatLng:function(latlng){this._latlng=L.latLng(latlng);this.redraw();return this.fire("move",{latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(radius){this.options.radius=this._radius=radius;return this.redraw()},getRadius:function(){return this._radius},setStyle:function(options){var radius=options&&options.radius||this._radius;L.Path.prototype.setStyle.call(this,options);this.setRadius(radius);return this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng);this._updateBounds()},_updateBounds:function(){var r=this._radius,r2=this._radiusY||r,w=this._clickTolerance(),p=[r+w,r2+w];this._pxBounds=new L.Bounds(this._point.subtract(p),this._point.add(p))},_update:function(){if(this._map){this._updatePath()}},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)}});L.circleMarker=function(latlng,options){return new L.CircleMarker(latlng,options)};L.Circle=L.CircleMarker.extend({initialize:function(latlng,radius,options){L.setOptions(this,options);this._latlng=L.latLng(latlng);this._mRadius=radius},setRadius:function(radius){this._mRadius=radius;return this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var half=[this._radius,this._radiusY];return new L.LatLngBounds(this._map.layerPointToLatLng(this._point.subtract(half)),this._map.layerPointToLatLng(this._point.add(half)))},setStyle:L.Path.prototype.setStyle,_project:function(){var lng=this._latlng.lng,lat=this._latlng.lat,map=this._map,crs=map.options.crs;if(crs.distance===L.CRS.Earth.distance){var d=Math.PI/180,latR=this._mRadius/L.CRS.Earth.R/d,top=map.project([lat+latR,lng]),bottom=map.project([lat-latR,lng]),p=top.add(bottom).divideBy(2),lat2=map.unproject(p).lat,lngR=Math.acos((Math.cos(latR*d)-Math.sin(lat*d)*Math.sin(lat2*d))/(Math.cos(lat*d)*Math.cos(lat2*d)))/d;this._point=p.subtract(map.getPixelOrigin());this._radius=isNaN(lngR)?0:Math.max(Math.round(p.x-map.project([lat2,lng-lngR]).x),1);this._radiusY=Math.max(Math.round(p.y-top.y),1)}else{var latlng2=crs.unproject(crs.project(this._latlng).subtract([this._mRadius,0]));this._point=map.latLngToLayerPoint(this._latlng);this._radius=this._point.x-map.latLngToLayerPoint(latlng2).x}this._updateBounds()}});L.circle=function(latlng,radius,options){return new L.Circle(latlng,radius,options)};L.SVG=L.Renderer.extend({_initContainer:function(){this._container=L.SVG.create("svg");this._container.setAttribute("pointer-events","none");this._rootGroup=L.SVG.create("g");this._container.appendChild(this._rootGroup)},_update:function(){if(this._map._animatingZoom&&this._bounds){return}L.Renderer.prototype._update.call(this);var b=this._bounds,size=b.getSize(),container=this._container;if(!this._svgSize||!this._svgSize.equals(size)){this._svgSize=size;container.setAttribute("width",size.x);container.setAttribute("height",size.y)}L.DomUtil.setPosition(container,b.min);container.setAttribute("viewBox",[b.min.x,b.min.y,size.x,size.y].join(" "))},_initPath:function(layer){var path=layer._path=L.SVG.create("path");if(layer.options.className){L.DomUtil.addClass(path,layer.options.className)}if(layer.options.interactive){L.DomUtil.addClass(path,"leaflet-interactive")}this._updateStyle(layer)},_addPath:function(layer){this._rootGroup.appendChild(layer._path);layer.addInteractiveTarget(layer._path)},_removePath:function(layer){L.DomUtil.remove(layer._path);layer.removeInteractiveTarget(layer._path)},_updatePath:function(layer){layer._project();layer._update()},_updateStyle:function(layer){var path=layer._path,options=layer.options;if(!path){return}if(options.stroke){path.setAttribute("stroke",options.color);path.setAttribute("stroke-opacity",options.opacity);path.setAttribute("stroke-width",options.weight);path.setAttribute("stroke-linecap",options.lineCap);path.setAttribute("stroke-linejoin",options.lineJoin);if(options.dashArray){path.setAttribute("stroke-dasharray",options.dashArray)}else{path.removeAttribute("stroke-dasharray")}if(options.dashOffset){path.setAttribute("stroke-dashoffset",options.dashOffset)}else{path.removeAttribute("stroke-dashoffset")}}else{path.setAttribute("stroke","none")}if(options.fill){path.setAttribute("fill",options.fillColor||options.color);path.setAttribute("fill-opacity",options.fillOpacity);path.setAttribute("fill-rule",options.fillRule||"evenodd")}else{path.setAttribute("fill","none")}path.setAttribute("pointer-events",options.pointerEvents||(options.interactive?"visiblePainted":"none"))},_updatePoly:function(layer,closed){this._setPath(layer,L.SVG.pointsToPath(layer._parts,closed))},_updateCircle:function(layer){var p=layer._point,r=layer._radius,r2=layer._radiusY||r,arc="a"+r+","+r2+" 0 1,0 ";var d=layer._empty()?"M0 0":"M"+(p.x-r)+","+p.y+arc+r*2+",0 "+arc+-r*2+",0 ";this._setPath(layer,d)},_setPath:function(layer,path){layer._path.setAttribute("d",path)},_bringToFront:function(layer){L.DomUtil.toFront(layer._path)},_bringToBack:function(layer){L.DomUtil.toBack(layer._path)}});L.extend(L.SVG,{create:function(name){return document.createElementNS("http://www.w3.org/2000/svg",name)},pointsToPath:function(rings,closed){var str="",i,j,len,len2,points,p;for(i=0,len=rings.length;i<len;i++){points=rings[i];for(j=0,len2=points.length;j<len2;j++){p=points[j];str+=(j?"L":"M")+p.x+" "+p.y}str+=closed?L.Browser.svg?"z":"x":""}return str||"M0 0"}});L.Browser.svg=!!(document.createElementNS&&L.SVG.create("svg").createSVGRect);L.svg=function(options){return L.Browser.svg||L.Browser.vml?new L.SVG(options):null};L.Browser.vml=!L.Browser.svg&&function(){try{var div=document.createElement("div");div.innerHTML='<v:shape adj="1"/>';var shape=div.firstChild;shape.style.behavior="url(#default#VML)";return shape&&typeof shape.adj==="object"}catch(e){return false}}();L.SVG.include(!L.Browser.vml?{}:{_initContainer:function(){this._container=L.DomUtil.create("div","leaflet-vml-container")},_update:function(){if(this._map._animatingZoom){return}L.Renderer.prototype._update.call(this)},_initPath:function(layer){var container=layer._container=L.SVG.create("shape");L.DomUtil.addClass(container,"leaflet-vml-shape "+(this.options.className||""));container.coordsize="1 1";layer._path=L.SVG.create("path");container.appendChild(layer._path);this._updateStyle(layer)},_addPath:function(layer){var container=layer._container;this._container.appendChild(container);if(layer.options.interactive){layer.addInteractiveTarget(container)}},_removePath:function(layer){var container=layer._container;L.DomUtil.remove(container);layer.removeInteractiveTarget(container)},_updateStyle:function(layer){var stroke=layer._stroke,fill=layer._fill,options=layer.options,container=layer._container;container.stroked=!!options.stroke;container.filled=!!options.fill;if(options.stroke){if(!stroke){stroke=layer._stroke=L.SVG.create("stroke")}container.appendChild(stroke);stroke.weight=options.weight+"px";stroke.color=options.color;stroke.opacity=options.opacity;if(options.dashArray){stroke.dashStyle=L.Util.isArray(options.dashArray)?options.dashArray.join(" "):options.dashArray.replace(/( *, *)/g," ")}else{stroke.dashStyle=""}stroke.endcap=options.lineCap.replace("butt","flat");stroke.joinstyle=options.lineJoin}else if(stroke){container.removeChild(stroke);layer._stroke=null}if(options.fill){if(!fill){fill=layer._fill=L.SVG.create("fill")}container.appendChild(fill);fill.color=options.fillColor||options.color;fill.opacity=options.fillOpacity}else if(fill){container.removeChild(fill);layer._fill=null}},_updateCircle:function(layer){var p=layer._point.round(),r=Math.round(layer._radius),r2=Math.round(layer._radiusY||r);this._setPath(layer,layer._empty()?"M0 0":"AL "+p.x+","+p.y+" "+r+","+r2+" 0,"+65535*360)},_setPath:function(layer,path){layer._path.v=path},_bringToFront:function(layer){L.DomUtil.toFront(layer._container)},_bringToBack:function(layer){L.DomUtil.toBack(layer._container)}});if(L.Browser.vml){L.SVG.create=function(){try{document.namespaces.add("lvml","urn:schemas-microsoft-com:vml");return function(name){return document.createElement("<lvml:"+name+' class="lvml">')}}catch(e){return function(name){return document.createElement("<"+name+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}()}L.Canvas=L.Renderer.extend({onAdd:function(){L.Renderer.prototype.onAdd.call(this);this._layers=this._layers||{};this._draw()},_initContainer:function(){var container=this._container=document.createElement("canvas");L.DomEvent.on(container,"mousemove",L.Util.throttle(this._onMouseMove,32,this),this).on(container,"click dblclick mousedown mouseup contextmenu",this._onClick,this).on(container,"mouseout",this._handleMouseOut,this);this._ctx=container.getContext("2d")},_update:function(){if(this._map._animatingZoom&&this._bounds){return}this._drawnLayers={};L.Renderer.prototype._update.call(this);var b=this._bounds,container=this._container,size=b.getSize(),m=L.Browser.retina?2:1;L.DomUtil.setPosition(container,b.min);container.width=m*size.x;container.height=m*size.y;container.style.width=size.x+"px";container.style.height=size.y+"px";if(L.Browser.retina){this._ctx.scale(2,2)}this._ctx.translate(-b.min.x,-b.min.y)},_initPath:function(layer){this._layers[L.stamp(layer)]=layer},_addPath:L.Util.falseFn,_removePath:function(layer){layer._removed=true;this._requestRedraw(layer)},_updatePath:function(layer){this._redrawBounds=layer._pxBounds;this._draw(true);layer._project();layer._update();this._draw();this._redrawBounds=null},_updateStyle:function(layer){this._requestRedraw(layer)},_requestRedraw:function(layer){if(!this._map){return}this._redrawBounds=this._redrawBounds||new L.Bounds;this._redrawBounds.extend(layer._pxBounds.min).extend(layer._pxBounds.max);this._redrawRequest=this._redrawRequest||L.Util.requestAnimFrame(this._redraw,this)},_redraw:function(){this._redrawRequest=null;this._draw(true);this._draw();this._redrawBounds=null},_draw:function(clear){this._clear=clear;var layer;for(var id in this._layers){layer=this._layers[id];if(!this._redrawBounds||layer._pxBounds.intersects(this._redrawBounds)){layer._updatePath()}if(clear&&layer._removed){delete layer._removed;delete this._layers[id]}}},_updatePoly:function(layer,closed){var i,j,len2,p,parts=layer._parts,len=parts.length,ctx=this._ctx;if(!len){return}this._drawnLayers[layer._leaflet_id]=layer;ctx.beginPath();for(i=0;i<len;i++){for(j=0,len2=parts[i].length;j<len2;j++){p=parts[i][j];ctx[j?"lineTo":"moveTo"](p.x,p.y)}if(closed){ctx.closePath()}}this._fillStroke(ctx,layer)},_updateCircle:function(layer){if(layer._empty()){return}var p=layer._point,ctx=this._ctx,r=layer._radius,s=(layer._radiusY||r)/r;if(s!==1){ctx.save();ctx.scale(1,s)}ctx.beginPath();ctx.arc(p.x,p.y/s,r,0,Math.PI*2,false);if(s!==1){ctx.restore()}this._fillStroke(ctx,layer)},_fillStroke:function(ctx,layer){var clear=this._clear,options=layer.options;ctx.globalCompositeOperation=clear?"destination-out":"source-over";if(options.fill){ctx.globalAlpha=clear?1:options.fillOpacity;ctx.fillStyle=options.fillColor||options.color;ctx.fill(options.fillRule||"evenodd")}if(options.stroke&&options.weight!==0){ctx.globalAlpha=clear?1:options.opacity;layer._prevWeight=ctx.lineWidth=clear?layer._prevWeight+1:options.weight;ctx.strokeStyle=options.color;ctx.lineCap=options.lineCap;ctx.lineJoin=options.lineJoin;ctx.stroke()}},_onClick:function(e){var point=this._map.mouseEventToLayerPoint(e);for(var id in this._layers){if(this._layers[id]._containsPoint(point)){L.DomEvent._fakeStop(e);this._fireEvent(this._layers[id],e)}}},_onMouseMove:function(e){if(!this._map||this._map.dragging._draggable._moving||this._map._animatingZoom){return}var point=this._map.mouseEventToLayerPoint(e);this._handleMouseOut(e,point);this._handleMouseHover(e,point)},_handleMouseOut:function(e,point){var layer=this._hoveredLayer;if(layer&&(e.type==="mouseout"||!layer._containsPoint(point))){L.DomUtil.removeClass(this._container,"leaflet-interactive");this._fireEvent(layer,e,"mouseout");this._hoveredLayer=null}},_handleMouseHover:function(e,point){var id,layer;if(!this._hoveredLayer){for(id in this._drawnLayers){layer=this._drawnLayers[id];if(layer.options.interactive&&layer._containsPoint(point)){L.DomUtil.addClass(this._container,"leaflet-interactive");this._fireEvent(layer,e,"mouseover");this._hoveredLayer=layer;break}}}if(this._hoveredLayer){this._fireEvent(this._hoveredLayer,e)}},_fireEvent:function(layer,e,type){this._map._fireDOMEvent(e,type||e.type,[layer])},_bringToFront:L.Util.falseFn,_bringToBack:L.Util.falseFn});L.Browser.canvas=function(){return!!document.createElement("canvas").getContext}();L.canvas=function(options){return L.Browser.canvas?new L.Canvas(options):null};L.Polyline.prototype._containsPoint=function(p,closed){var i,j,k,len,len2,part,w=this._clickTolerance();if(!this._pxBounds.contains(p)){return false}for(i=0,len=this._parts.length;i<len;i++){part=this._parts[i];for(j=0,len2=part.length,k=len2-1;j<len2;k=j++){if(!closed&&j===0){continue}if(L.LineUtil.pointToSegmentDistance(p,part[k],part[j])<=w){return true}}}return false};L.Polygon.prototype._containsPoint=function(p){var inside=false,part,p1,p2,i,j,k,len,len2;if(!this._pxBounds.contains(p)){return false}for(i=0,len=this._parts.length;i<len;i++){part=this._parts[i];for(j=0,len2=part.length,k=len2-1;j<len2;k=j++){p1=part[j];p2=part[k];if(p1.y>p.y!==p2.y>p.y&&p.x<(p2.x-p1.x)*(p.y-p1.y)/(p2.y-p1.y)+p1.x){inside=!inside}}}return inside||L.Polyline.prototype._containsPoint.call(this,p,true)};L.CircleMarker.prototype._containsPoint=function(p){return p.distanceTo(this._point)<=this._radius+this._clickTolerance()};L.GeoJSON=L.FeatureGroup.extend({initialize:function(geojson,options){L.setOptions(this,options);this._layers={};if(geojson){this.addData(geojson)}},addData:function(geojson){var features=L.Util.isArray(geojson)?geojson:geojson.features,i,len,feature;if(features){for(i=0,len=features.length;i<len;i++){feature=features[i];if(feature.geometries||feature.geometry||feature.features||feature.coordinates){this.addData(feature)}}return this}var options=this.options;if(options.filter&&!options.filter(geojson)){return this}var layer=L.GeoJSON.geometryToLayer(geojson,options);if(!layer){return this}layer.feature=L.GeoJSON.asFeature(geojson);layer.defaultOptions=layer.options;this.resetStyle(layer);if(options.onEachFeature){options.onEachFeature(geojson,layer)}return this.addLayer(layer)},resetStyle:function(layer){layer.options=layer.defaultOptions;this._setLayerStyle(layer,this.options.style);return this},setStyle:function(style){return this.eachLayer(function(layer){this._setLayerStyle(layer,style)},this)},_setLayerStyle:function(layer,style){if(typeof style==="function"){style=style(layer.feature)}if(layer.setStyle){layer.setStyle(style)}}});L.extend(L.GeoJSON,{geometryToLayer:function(geojson,options){var geometry=geojson.type==="Feature"?geojson.geometry:geojson,coords=geometry?geometry.coordinates:null,layers=[],pointToLayer=options&&options.pointToLayer,coordsToLatLng=options&&options.coordsToLatLng||this.coordsToLatLng,latlng,latlngs,i,len;if(!coords&&!geometry){return null}switch(geometry.type){case"Point":latlng=coordsToLatLng(coords);return pointToLayer?pointToLayer(geojson,latlng):new L.Marker(latlng);case"MultiPoint":for(i=0,len=coords.length;i<len;i++){latlng=coordsToLatLng(coords[i]);layers.push(pointToLayer?pointToLayer(geojson,latlng):new L.Marker(latlng))}return new L.FeatureGroup(layers);case"LineString":case"MultiLineString":latlngs=this.coordsToLatLngs(coords,geometry.type==="LineString"?0:1,coordsToLatLng);return new L.Polyline(latlngs,options);case"Polygon":case"MultiPolygon":latlngs=this.coordsToLatLngs(coords,geometry.type==="Polygon"?1:2,coordsToLatLng);return new L.Polygon(latlngs,options);case"GeometryCollection":for(i=0,len=geometry.geometries.length;i<len;i++){var layer=this.geometryToLayer({geometry:geometry.geometries[i],type:"Feature",properties:geojson.properties},options);if(layer){layers.push(layer)}}return new L.FeatureGroup(layers);default:throw new Error("Invalid GeoJSON object.")}},coordsToLatLng:function(coords){return new L.LatLng(coords[1],coords[0],coords[2])},coordsToLatLngs:function(coords,levelsDeep,coordsToLatLng){var latlngs=[];for(var i=0,len=coords.length,latlng;i<len;i++){latlng=levelsDeep?this.coordsToLatLngs(coords[i],levelsDeep-1,coordsToLatLng):(coordsToLatLng||this.coordsToLatLng)(coords[i]);latlngs.push(latlng)}return latlngs},latLngToCoords:function(latlng){return latlng.alt!==undefined?[latlng.lng,latlng.lat,latlng.alt]:[latlng.lng,latlng.lat]},latLngsToCoords:function(latlngs,levelsDeep,closed){var coords=[];for(var i=0,len=latlngs.length;i<len;i++){coords.push(levelsDeep?L.GeoJSON.latLngsToCoords(latlngs[i],levelsDeep-1,closed):L.GeoJSON.latLngToCoords(latlngs[i]))}if(!levelsDeep&&closed){coords.push(coords[0])}return coords},getFeature:function(layer,newGeometry){return layer.feature?L.extend({},layer.feature,{geometry:newGeometry}):L.GeoJSON.asFeature(newGeometry)},asFeature:function(geoJSON){if(geoJSON.type==="Feature"){return geoJSON}return{type:"Feature",properties:{},geometry:geoJSON}}});var PointToGeoJSON={toGeoJSON:function(){return L.GeoJSON.getFeature(this,{type:"Point",coordinates:L.GeoJSON.latLngToCoords(this.getLatLng())})}};L.Marker.include(PointToGeoJSON);L.Circle.include(PointToGeoJSON);L.CircleMarker.include(PointToGeoJSON);L.Polyline.prototype.toGeoJSON=function(){var multi=!L.Polyline._flat(this._latlngs);var coords=L.GeoJSON.latLngsToCoords(this._latlngs,multi?1:0);return L.GeoJSON.getFeature(this,{type:(multi?"Multi":"")+"LineString",coordinates:coords})};L.Polygon.prototype.toGeoJSON=function(){var holes=!L.Polyline._flat(this._latlngs),multi=holes&&!L.Polyline._flat(this._latlngs[0]);var coords=L.GeoJSON.latLngsToCoords(this._latlngs,multi?2:holes?1:0,true);if(!holes){coords=[coords]}return L.GeoJSON.getFeature(this,{type:(multi?"Multi":"")+"Polygon",coordinates:coords})};L.LayerGroup.include({toMultiPoint:function(){var coords=[];this.eachLayer(function(layer){coords.push(layer.toGeoJSON().geometry.coordinates)});return L.GeoJSON.getFeature(this,{type:"MultiPoint",coordinates:coords})},toGeoJSON:function(){var type=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(type==="MultiPoint"){return this.toMultiPoint()}var isGeometryCollection=type==="GeometryCollection",jsons=[];this.eachLayer(function(layer){if(layer.toGeoJSON){var json=layer.toGeoJSON();jsons.push(isGeometryCollection?json.geometry:L.GeoJSON.asFeature(json))}});if(isGeometryCollection){return L.GeoJSON.getFeature(this,{geometries:jsons,type:"GeometryCollection"})}return{type:"FeatureCollection",features:jsons}}});L.geoJson=function(geojson,options){return new L.GeoJSON(geojson,options)};var eventsKey="_leaflet_events";L.DomEvent={on:function(obj,types,fn,context){if(typeof types==="object"){for(var type in types){this._on(obj,type,types[type],fn)}}else{types=L.Util.splitWords(types);for(var i=0,len=types.length;i<len;i++){this._on(obj,types[i],fn,context)}}return this},off:function(obj,types,fn,context){if(typeof types==="object"){for(var type in types){this._off(obj,type,types[type],fn)}}else{types=L.Util.splitWords(types);for(var i=0,len=types.length;i<len;i++){this._off(obj,types[i],fn,context)}}return this},_on:function(obj,type,fn,context){var id=type+L.stamp(fn)+(context?"_"+L.stamp(context):"");if(obj[eventsKey]&&obj[eventsKey][id]){return this}var handler=function(e){return fn.call(context||obj,e||window.event)};var originalHandler=handler;if(L.Browser.pointer&&type.indexOf("touch")===0){this.addPointerListener(obj,type,handler,id)}else if(L.Browser.touch&&type==="dblclick"&&this.addDoubleTapListener){this.addDoubleTapListener(obj,handler,id)}else if("addEventListener"in obj){if(type==="mousewheel"){obj.addEventListener("DOMMouseScroll",handler,false);obj.addEventListener(type,handler,false)}else if(type==="mouseenter"||type==="mouseleave"){handler=function(e){e=e||window.event;if(L.DomEvent._checkMouse(obj,e)){originalHandler(e)}};obj.addEventListener(type==="mouseenter"?"mouseover":"mouseout",handler,false)}else{if(type==="click"&&L.Browser.android){handler=function(e){return L.DomEvent._filterClick(e,originalHandler)}}obj.addEventListener(type,handler,false)}}else if("attachEvent"in obj){obj.attachEvent("on"+type,handler)}obj[eventsKey]=obj[eventsKey]||{};obj[eventsKey][id]=handler;return this},_off:function(obj,type,fn,context){var id=type+L.stamp(fn)+(context?"_"+L.stamp(context):""),handler=obj[eventsKey]&&obj[eventsKey][id];if(!handler){return this}if(L.Browser.pointer&&type.indexOf("touch")===0){this.removePointerListener(obj,type,id)}else if(L.Browser.touch&&type==="dblclick"&&this.removeDoubleTapListener){this.removeDoubleTapListener(obj,id)}else if("removeEventListener"in obj){if(type==="mousewheel"){obj.removeEventListener("DOMMouseScroll",handler,false);obj.removeEventListener(type,handler,false)}else{obj.removeEventListener(type==="mouseenter"?"mouseover":type==="mouseleave"?"mouseout":type,handler,false)}}else if("detachEvent"in obj){obj.detachEvent("on"+type,handler)}obj[eventsKey][id]=null;return this},stopPropagation:function(e){if(e.stopPropagation){e.stopPropagation()}else if(e.originalEvent){e.originalEvent._stopped=true}else{e.cancelBubble=true}L.DomEvent._skipped(e);return this},disableScrollPropagation:function(el){return L.DomEvent.on(el,"mousewheel MozMousePixelScroll",L.DomEvent.stopPropagation)},disableClickPropagation:function(el){var stop=L.DomEvent.stopPropagation;L.DomEvent.on(el,L.Draggable.START.join(" "),stop);return L.DomEvent.on(el,{click:L.DomEvent._fakeStop,dblclick:stop})},preventDefault:function(e){if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}return this},stop:function(e){return L.DomEvent.preventDefault(e).stopPropagation(e)},getMousePosition:function(e,container){if(!container){return new L.Point(e.clientX,e.clientY)}var rect=container.getBoundingClientRect();return new L.Point(e.clientX-rect.left-container.clientLeft,e.clientY-rect.top-container.clientTop)},getWheelDelta:function(e){var delta=0;if(e.wheelDelta){delta=e.wheelDelta/120}if(e.detail){delta=-e.detail/3}return delta},_skipEvents:{},_fakeStop:function(e){L.DomEvent._skipEvents[e.type]=true},_skipped:function(e){var skipped=this._skipEvents[e.type];this._skipEvents[e.type]=false;return skipped},_checkMouse:function(el,e){var related=e.relatedTarget;if(!related){return true}try{while(related&&related!==el){related=related.parentNode}}catch(err){return false}return related!==el},_filterClick:function(e,handler){var timeStamp=e.timeStamp||e.originalEvent.timeStamp,elapsed=L.DomEvent._lastClick&&timeStamp-L.DomEvent._lastClick;if(elapsed&&elapsed>100&&elapsed<500||e.target._simulatedClick&&!e._simulated){L.DomEvent.stop(e);return}L.DomEvent._lastClick=timeStamp;handler(e)}};L.DomEvent.addListener=L.DomEvent.on;L.DomEvent.removeListener=L.DomEvent.off;L.Draggable=L.Evented.extend({statics:{START:L.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},initialize:function(element,dragStartTarget,preventOutline){this._element=element;this._dragStartTarget=dragStartTarget||element;this._preventOutline=preventOutline},enable:function(){if(this._enabled){return}L.DomEvent.on(this._dragStartTarget,L.Draggable.START.join(" "),this._onDown,this);this._enabled=true},disable:function(){if(!this._enabled){return}L.DomEvent.off(this._dragStartTarget,L.Draggable.START.join(" "),this._onDown,this);this._enabled=false;this._moved=false},_onDown:function(e){this._moved=false;if(e.shiftKey||e.which!==1&&e.button!==1&&!e.touches){return}L.DomEvent.stopPropagation(e);if(this._preventOutline){L.DomUtil.preventOutline(this._element)}if(L.DomUtil.hasClass(this._element,"leaflet-zoom-anim")){return}L.DomUtil.disableImageDrag();L.DomUtil.disableTextSelection();if(this._moving){return}this.fire("down");var first=e.touches?e.touches[0]:e;this._startPoint=new L.Point(first.clientX,first.clientY);this._startPos=this._newPos=L.DomUtil.getPosition(this._element);L.DomEvent.on(document,L.Draggable.MOVE[e.type],this._onMove,this).on(document,L.Draggable.END[e.type],this._onUp,this)},_onMove:function(e){if(e.touches&&e.touches.length>1){this._moved=true;return}var first=e.touches&&e.touches.length===1?e.touches[0]:e,newPoint=new L.Point(first.clientX,first.clientY),offset=newPoint.subtract(this._startPoint);if(!offset.x&&!offset.y){return}if(L.Browser.touch&&Math.abs(offset.x)+Math.abs(offset.y)<3){return}L.DomEvent.preventDefault(e);if(!this._moved){this.fire("dragstart");this._moved=true;this._startPos=L.DomUtil.getPosition(this._element).subtract(offset);L.DomUtil.addClass(document.body,"leaflet-dragging");this._lastTarget=e.target||e.srcElement;L.DomUtil.addClass(this._lastTarget,"leaflet-drag-target")}this._newPos=this._startPos.add(offset);this._moving=true;L.Util.cancelAnimFrame(this._animRequest);this._lastEvent=e;this._animRequest=L.Util.requestAnimFrame(this._updatePosition,this,true,this._dragStartTarget)},_updatePosition:function(){var e={originalEvent:this._lastEvent};this.fire("predrag",e);L.DomUtil.setPosition(this._element,this._newPos);this.fire("drag",e)},_onUp:function(){L.DomUtil.removeClass(document.body,"leaflet-dragging");if(this._lastTarget){L.DomUtil.removeClass(this._lastTarget,"leaflet-drag-target");this._lastTarget=null}for(var i in L.Draggable.MOVE){L.DomEvent.off(document,L.Draggable.MOVE[i],this._onMove,this).off(document,L.Draggable.END[i],this._onUp,this)}L.DomUtil.enableImageDrag();L.DomUtil.enableTextSelection();if(this._moved&&this._moving){L.Util.cancelAnimFrame(this._animRequest);this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})}this._moving=false}});L.Handler=L.Class.extend({initialize:function(map){this._map=map},enable:function(){if(this._enabled){return}this._enabled=true;this.addHooks()},disable:function(){if(!this._enabled){return}this._enabled=false;this.removeHooks()},enabled:function(){return!!this._enabled}});L.Map.mergeOptions({dragging:true,inertia:!L.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:Infinity,easeLinearity:.2,worldCopyJump:false});L.Map.Drag=L.Handler.extend({addHooks:function(){if(!this._draggable){var map=this._map;this._draggable=new L.Draggable(map._mapPane,map._container);this._draggable.on({down:this._onDown,dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this);this._draggable.on("predrag",this._onPreDragLimit,this);if(map.options.worldCopyJump){this._draggable.on("predrag",this._onPreDragWrap,this);map.on("zoomend",this._onZoomEnd,this);map.whenReady(this._onZoomEnd,this)}}L.DomUtil.addClass(this._map._container,"leaflet-grab");this._draggable.enable()},removeHooks:function(){L.DomUtil.removeClass(this._map._container,"leaflet-grab");this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},_onDown:function(){this._map.stop()},_onDragStart:function(){var map=this._map;if(this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var bounds=L.latLngBounds(this._map.options.maxBounds);this._offsetLimit=L.bounds(this._map.latLngToContainerPoint(bounds.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(bounds.getSouthEast()).multiplyBy(-1).add(this._map.getSize()));this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else{this._offsetLimit=null}map.fire("movestart").fire("dragstart");if(map.options.inertia){this._positions=[];this._times=[]}},_onDrag:function(e){if(this._map.options.inertia){var time=this._lastTime=+new Date,pos=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(pos);this._times.push(time);if(time-this._times[0]>50){this._positions.shift();this._times.shift()}}this._map.fire("move",e).fire("drag",e)},_onZoomEnd:function(){var pxCenter=this._map.getSize().divideBy(2),pxWorldCenter=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=pxWorldCenter.subtract(pxCenter).x;this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(value,threshold){return value-(value-threshold)*this._viscosity},_onPreDragLimit:function(){if(!this._viscosity||!this._offsetLimit){return}var offset=this._draggable._newPos.subtract(this._draggable._startPos);var limit=this._offsetLimit;if(offset.x<limit.min.x){offset.x=this._viscousLimit(offset.x,limit.min.x)}if(offset.y<limit.min.y){offset.y=this._viscousLimit(offset.y,limit.min.y)}if(offset.x>limit.max.x){offset.x=this._viscousLimit(offset.x,limit.max.x)}if(offset.y>limit.max.y){offset.y=this._viscousLimit(offset.y,limit.max.y);
}this._draggable._newPos=this._draggable._startPos.add(offset)},_onPreDragWrap:function(){var worldWidth=this._worldWidth,halfWidth=Math.round(worldWidth/2),dx=this._initialWorldOffset,x=this._draggable._newPos.x,newX1=(x-halfWidth+dx)%worldWidth+halfWidth-dx,newX2=(x+halfWidth+dx)%worldWidth-halfWidth-dx,newX=Math.abs(newX1+dx)<Math.abs(newX2+dx)?newX1:newX2;this._draggable._absPos=this._draggable._newPos.clone();this._draggable._newPos.x=newX},_onDragEnd:function(e){var map=this._map,options=map.options,noInertia=!options.inertia||this._times.length<2;map.fire("dragend",e);if(noInertia){map.fire("moveend")}else{var direction=this._lastPos.subtract(this._positions[0]),duration=(this._lastTime-this._times[0])/1e3,ease=options.easeLinearity,speedVector=direction.multiplyBy(ease/duration),speed=speedVector.distanceTo([0,0]),limitedSpeed=Math.min(options.inertiaMaxSpeed,speed),limitedSpeedVector=speedVector.multiplyBy(limitedSpeed/speed),decelerationDuration=limitedSpeed/(options.inertiaDeceleration*ease),offset=limitedSpeedVector.multiplyBy(-decelerationDuration/2).round();if(!offset.x&&!offset.y){map.fire("moveend")}else{offset=map._limitOffset(offset,map.options.maxBounds);L.Util.requestAnimFrame(function(){map.panBy(offset,{duration:decelerationDuration,easeLinearity:ease,noMoveStart:true,animate:true})})}}}});L.Map.addInitHook("addHandler","dragging",L.Map.Drag);L.Map.mergeOptions({doubleClickZoom:true});L.Map.DoubleClickZoom=L.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(e){var map=this._map,oldZoom=map.getZoom(),zoom=e.originalEvent.shiftKey?Math.ceil(oldZoom)-1:Math.floor(oldZoom)+1;if(map.options.doubleClickZoom==="center"){map.setZoom(zoom)}else{map.setZoomAround(e.containerPoint,zoom)}}});L.Map.addInitHook("addHandler","doubleClickZoom",L.Map.DoubleClickZoom);L.Map.mergeOptions({scrollWheelZoom:true,wheelDebounceTime:40});L.Map.ScrollWheelZoom=L.Handler.extend({addHooks:function(){L.DomEvent.on(this._map._container,{mousewheel:this._onWheelScroll,MozMousePixelScroll:L.DomEvent.preventDefault},this);this._delta=0},removeHooks:function(){L.DomEvent.off(this._map._container,{mousewheel:this._onWheelScroll,MozMousePixelScroll:L.DomEvent.preventDefault},this)},_onWheelScroll:function(e){var delta=L.DomEvent.getWheelDelta(e);var debounce=this._map.options.wheelDebounceTime;this._delta+=delta;this._lastMousePos=this._map.mouseEventToContainerPoint(e);if(!this._startTime){this._startTime=+new Date}var left=Math.max(debounce-(+new Date-this._startTime),0);clearTimeout(this._timer);this._timer=setTimeout(L.bind(this._performZoom,this),left);L.DomEvent.stop(e)},_performZoom:function(){var map=this._map,delta=this._delta,zoom=map.getZoom();map.stop();delta=delta>0?Math.ceil(delta):Math.floor(delta);delta=Math.max(Math.min(delta,4),-4);delta=map._limitZoom(zoom+delta)-zoom;this._delta=0;this._startTime=null;if(!delta){return}if(map.options.scrollWheelZoom==="center"){map.setZoom(zoom+delta)}else{map.setZoomAround(this._lastMousePos,zoom+delta)}}});L.Map.addInitHook("addHandler","scrollWheelZoom",L.Map.ScrollWheelZoom);L.extend(L.DomEvent,{_touchstart:L.Browser.msPointer?"MSPointerDown":L.Browser.pointer?"pointerdown":"touchstart",_touchend:L.Browser.msPointer?"MSPointerUp":L.Browser.pointer?"pointerup":"touchend",addDoubleTapListener:function(obj,handler,id){var last,touch,doubleTap=false,delay=250;function onTouchStart(e){var count;if(L.Browser.pointer){count=L.DomEvent._pointersCount}else{count=e.touches.length}if(count>1){return}var now=Date.now(),delta=now-(last||now);touch=e.touches?e.touches[0]:e;doubleTap=delta>0&&delta<=delay;last=now}function onTouchEnd(){if(doubleTap&&!touch.cancelBubble){if(L.Browser.pointer){var newTouch={},prop,i;for(i in touch){prop=touch[i];newTouch[i]=prop&&prop.bind?prop.bind(touch):prop}touch=newTouch}touch.type="dblclick";handler(touch);last=null}}var pre="_leaflet_",touchstart=this._touchstart,touchend=this._touchend;obj[pre+touchstart+id]=onTouchStart;obj[pre+touchend+id]=onTouchEnd;obj.addEventListener(touchstart,onTouchStart,false);obj.addEventListener(touchend,onTouchEnd,false);return this},removeDoubleTapListener:function(obj,id){var pre="_leaflet_",touchend=obj[pre+this._touchend+id];obj.removeEventListener(this._touchstart,obj[pre+this._touchstart+id],false);obj.removeEventListener(this._touchend,touchend,false);return this}});L.extend(L.DomEvent,{POINTER_DOWN:L.Browser.msPointer?"MSPointerDown":"pointerdown",POINTER_MOVE:L.Browser.msPointer?"MSPointerMove":"pointermove",POINTER_UP:L.Browser.msPointer?"MSPointerUp":"pointerup",POINTER_CANCEL:L.Browser.msPointer?"MSPointerCancel":"pointercancel",_pointers:{},_pointersCount:0,addPointerListener:function(obj,type,handler,id){if(type==="touchstart"){this._addPointerStart(obj,handler,id)}else if(type==="touchmove"){this._addPointerMove(obj,handler,id)}else if(type==="touchend"){this._addPointerEnd(obj,handler,id)}return this},removePointerListener:function(obj,type,id){var handler=obj["_leaflet_"+type+id];if(type==="touchstart"){obj.removeEventListener(this.POINTER_DOWN,handler,false)}else if(type==="touchmove"){obj.removeEventListener(this.POINTER_MOVE,handler,false)}else if(type==="touchend"){obj.removeEventListener(this.POINTER_UP,handler,false);obj.removeEventListener(this.POINTER_CANCEL,handler,false)}return this},_addPointerStart:function(obj,handler,id){var onDown=L.bind(function(e){L.DomEvent.preventDefault(e);this._handlePointer(e,handler)},this);obj["_leaflet_touchstart"+id]=onDown;obj.addEventListener(this.POINTER_DOWN,onDown,false);if(!this._pointerDocListener){var pointerUp=L.bind(this._globalPointerUp,this);document.documentElement.addEventListener(this.POINTER_DOWN,L.bind(this._globalPointerDown,this),true);document.documentElement.addEventListener(this.POINTER_MOVE,L.bind(this._globalPointerMove,this),true);document.documentElement.addEventListener(this.POINTER_UP,pointerUp,true);document.documentElement.addEventListener(this.POINTER_CANCEL,pointerUp,true);this._pointerDocListener=true}},_globalPointerDown:function(e){this._pointers[e.pointerId]=e;this._pointersCount++},_globalPointerMove:function(e){if(this._pointers[e.pointerId]){this._pointers[e.pointerId]=e}},_globalPointerUp:function(e){delete this._pointers[e.pointerId];this._pointersCount--},_handlePointer:function(e,handler){e.touches=[];for(var i in this._pointers){e.touches.push(this._pointers[i])}e.changedTouches=[e];handler(e)},_addPointerMove:function(obj,handler,id){var onMove=L.bind(function(e){if((e.pointerType===e.MSPOINTER_TYPE_MOUSE||e.pointerType==="mouse")&&e.buttons===0){return}this._handlePointer(e,handler)},this);obj["_leaflet_touchmove"+id]=onMove;obj.addEventListener(this.POINTER_MOVE,onMove,false)},_addPointerEnd:function(obj,handler,id){var onUp=L.bind(function(e){this._handlePointer(e,handler)},this);obj["_leaflet_touchend"+id]=onUp;obj.addEventListener(this.POINTER_UP,onUp,false);obj.addEventListener(this.POINTER_CANCEL,onUp,false)}});L.Map.mergeOptions({touchZoom:L.Browser.touch&&!L.Browser.android23,bounceAtZoomLimits:true});L.Map.TouchZoom=L.Handler.extend({addHooks:function(){L.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){L.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(e){var map=this._map;if(!e.touches||e.touches.length!==2||map._animatingZoom||this._zooming){return}var p1=map.mouseEventToContainerPoint(e.touches[0]),p2=map.mouseEventToContainerPoint(e.touches[1]);this._centerPoint=map.getSize()._divideBy(2);this._startLatLng=map.containerPointToLatLng(this._centerPoint);if(map.options.touchZoom!=="center"){this._pinchStartLatLng=map.containerPointToLatLng(p1.add(p2)._divideBy(2))}this._startDist=p1.distanceTo(p2);this._startZoom=map.getZoom();this._moved=false;this._zooming=true;map.stop();L.DomEvent.on(document,"touchmove",this._onTouchMove,this).on(document,"touchend",this._onTouchEnd,this);L.DomEvent.preventDefault(e)},_onTouchMove:function(e){if(!e.touches||e.touches.length!==2||!this._zooming){return}var map=this._map,p1=map.mouseEventToContainerPoint(e.touches[0]),p2=map.mouseEventToContainerPoint(e.touches[1]),scale=p1.distanceTo(p2)/this._startDist;this._zoom=map.getScaleZoom(scale,this._startZoom);if(map.options.touchZoom==="center"){this._center=this._startLatLng;if(scale===1){return}}else{var delta=p1._add(p2)._divideBy(2)._subtract(this._centerPoint);if(scale===1&&delta.x===0&&delta.y===0){return}this._center=map.unproject(map.project(this._pinchStartLatLng).subtract(delta))}if(!map.options.bounceAtZoomLimits){if(this._zoom<=map.getMinZoom()&&scale<1||this._zoom>=map.getMaxZoom()&&scale>1){return}}if(!this._moved){map._moveStart(true);this._moved=true}L.Util.cancelAnimFrame(this._animRequest);var moveFn=L.bind(map._move,map,this._center,this._zoom,{pinch:true,round:false});this._animRequest=L.Util.requestAnimFrame(moveFn,this,true,map._container);L.DomEvent.preventDefault(e)},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=false;return}this._zooming=false;L.Util.cancelAnimFrame(this._animRequest);L.DomEvent.off(document,"touchmove",this._onTouchMove).off(document,"touchend",this._onTouchEnd);var zoom=this._zoom;zoom=this._map._limitZoom(zoom-this._startZoom>0?Math.ceil(zoom):Math.floor(zoom));this._map._animateZoom(this._center,zoom,true,true)}});L.Map.addInitHook("addHandler","touchZoom",L.Map.TouchZoom);L.Map.mergeOptions({tap:true,tapTolerance:15});L.Map.Tap=L.Handler.extend({addHooks:function(){L.DomEvent.on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){L.DomEvent.off(this._map._container,"touchstart",this._onDown,this)},_onDown:function(e){if(!e.touches){return}L.DomEvent.preventDefault(e);this._fireClick=true;if(e.touches.length>1){this._fireClick=false;clearTimeout(this._holdTimeout);return}var first=e.touches[0],el=first.target;this._startPos=this._newPos=new L.Point(first.clientX,first.clientY);if(el.tagName&&el.tagName.toLowerCase()==="a"){L.DomUtil.addClass(el,"leaflet-active")}this._holdTimeout=setTimeout(L.bind(function(){if(this._isTapValid()){this._fireClick=false;this._onUp();this._simulateEvent("contextmenu",first)}},this),1e3);this._simulateEvent("mousedown",first);L.DomEvent.on(document,{touchmove:this._onMove,touchend:this._onUp},this)},_onUp:function(e){clearTimeout(this._holdTimeout);L.DomEvent.off(document,{touchmove:this._onMove,touchend:this._onUp},this);if(this._fireClick&&e&&e.changedTouches){var first=e.changedTouches[0],el=first.target;if(el&&el.tagName&&el.tagName.toLowerCase()==="a"){L.DomUtil.removeClass(el,"leaflet-active")}this._simulateEvent("mouseup",first);if(this._isTapValid()){this._simulateEvent("click",first)}}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(e){var first=e.touches[0];this._newPos=new L.Point(first.clientX,first.clientY)},_simulateEvent:function(type,e){var simulatedEvent=document.createEvent("MouseEvents");simulatedEvent._simulated=true;e.target._simulatedClick=true;simulatedEvent.initMouseEvent(type,true,true,window,1,e.screenX,e.screenY,e.clientX,e.clientY,false,false,false,false,0,null);e.target.dispatchEvent(simulatedEvent)}});if(L.Browser.touch&&!L.Browser.pointer){L.Map.addInitHook("addHandler","tap",L.Map.Tap)}L.Map.mergeOptions({boxZoom:true});L.Map.BoxZoom=L.Handler.extend({initialize:function(map){this._map=map;this._container=map._container;this._pane=map._panes.overlayPane},addHooks:function(){L.DomEvent.on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){L.DomEvent.off(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_resetState:function(){this._moved=false},_onMouseDown:function(e){if(!e.shiftKey||e.which!==1&&e.button!==1){return false}this._resetState();L.DomUtil.disableTextSelection();L.DomUtil.disableImageDrag();this._startPoint=this._map.mouseEventToContainerPoint(e);L.DomEvent.on(document,{contextmenu:L.DomEvent.stop,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(e){if(!this._moved){this._moved=true;this._box=L.DomUtil.create("div","leaflet-zoom-box",this._container);L.DomUtil.addClass(this._container,"leaflet-crosshair");this._map.fire("boxzoomstart")}this._point=this._map.mouseEventToContainerPoint(e);var bounds=new L.Bounds(this._point,this._startPoint),size=bounds.getSize();L.DomUtil.setPosition(this._box,bounds.min);this._box.style.width=size.x+"px";this._box.style.height=size.y+"px"},_finish:function(){if(this._moved){L.DomUtil.remove(this._box);L.DomUtil.removeClass(this._container,"leaflet-crosshair")}L.DomUtil.enableTextSelection();L.DomUtil.enableImageDrag();L.DomEvent.off(document,{contextmenu:L.DomEvent.stop,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(e){if(e.which!==1&&e.button!==1){return}this._finish();if(!this._moved){return}setTimeout(L.bind(this._resetState,this),0);var bounds=new L.LatLngBounds(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(bounds).fire("boxzoomend",{boxZoomBounds:bounds})},_onKeyDown:function(e){if(e.keyCode===27){this._finish()}}});L.Map.addInitHook("addHandler","boxZoom",L.Map.BoxZoom);L.Map.mergeOptions({keyboard:true,keyboardPanOffset:80,keyboardZoomOffset:1});L.Map.Keyboard=L.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(map){this._map=map;this._setPanOffset(map.options.keyboardPanOffset);this._setZoomOffset(map.options.keyboardZoomOffset)},addHooks:function(){var container=this._map._container;if(container.tabIndex===-1){container.tabIndex="0"}L.DomEvent.on(container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this);this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks();L.DomEvent.off(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this);this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(this._focused){return}var body=document.body,docEl=document.documentElement,top=body.scrollTop||docEl.scrollTop,left=body.scrollLeft||docEl.scrollLeft;this._map._container.focus();window.scrollTo(left,top)},_onFocus:function(){this._focused=true;this._map.fire("focus")},_onBlur:function(){this._focused=false;this._map.fire("blur")},_setPanOffset:function(pan){var keys=this._panKeys={},codes=this.keyCodes,i,len;for(i=0,len=codes.left.length;i<len;i++){keys[codes.left[i]]=[-1*pan,0]}for(i=0,len=codes.right.length;i<len;i++){keys[codes.right[i]]=[pan,0]}for(i=0,len=codes.down.length;i<len;i++){keys[codes.down[i]]=[0,pan]}for(i=0,len=codes.up.length;i<len;i++){keys[codes.up[i]]=[0,-1*pan]}},_setZoomOffset:function(zoom){var keys=this._zoomKeys={},codes=this.keyCodes,i,len;for(i=0,len=codes.zoomIn.length;i<len;i++){keys[codes.zoomIn[i]]=zoom}for(i=0,len=codes.zoomOut.length;i<len;i++){keys[codes.zoomOut[i]]=-zoom}},_addHooks:function(){L.DomEvent.on(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){L.DomEvent.off(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(e){if(e.altKey||e.ctrlKey||e.metaKey){return}var key=e.keyCode,map=this._map;if(key in this._panKeys){if(map._panAnim&&map._panAnim._inProgress){return}map.panBy(this._panKeys[key]);if(map.options.maxBounds){map.panInsideBounds(map.options.maxBounds)}}else if(key in this._zoomKeys){map.setZoom(map.getZoom()+(e.shiftKey?3:1)*this._zoomKeys[key])}else if(key===27){map.closePopup()}else{return}L.DomEvent.stop(e)}});L.Map.addInitHook("addHandler","keyboard",L.Map.Keyboard);L.Handler.MarkerDrag=L.Handler.extend({initialize:function(marker){this._marker=marker},addHooks:function(){var icon=this._marker._icon;if(!this._draggable){this._draggable=new L.Draggable(icon,icon,true)}this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this).enable();L.DomUtil.addClass(icon,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this).disable();if(this._marker._icon){L.DomUtil.removeClass(this._marker._icon,"leaflet-marker-draggable")}},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._marker.closePopup().fire("movestart").fire("dragstart")},_onDrag:function(e){var marker=this._marker,shadow=marker._shadow,iconPos=L.DomUtil.getPosition(marker._icon),latlng=marker._map.layerPointToLatLng(iconPos);if(shadow){L.DomUtil.setPosition(shadow,iconPos)}marker._latlng=latlng;e.latlng=latlng;marker.fire("move",e).fire("drag",e)},_onDragEnd:function(e){this._marker.fire("moveend").fire("dragend",e)}});L.Control=L.Class.extend({options:{position:"topright"},initialize:function(options){L.setOptions(this,options)},getPosition:function(){return this.options.position},setPosition:function(position){var map=this._map;if(map){map.removeControl(this)}this.options.position=position;if(map){map.addControl(this)}return this},getContainer:function(){return this._container},addTo:function(map){this.remove();this._map=map;var container=this._container=this.onAdd(map),pos=this.getPosition(),corner=map._controlCorners[pos];L.DomUtil.addClass(container,"leaflet-control");if(pos.indexOf("bottom")!==-1){corner.insertBefore(container,corner.firstChild)}else{corner.appendChild(container)}return this},remove:function(){if(!this._map){return this}L.DomUtil.remove(this._container);if(this.onRemove){this.onRemove(this._map)}this._map=null;return this},_refocusOnMap:function(e){if(this._map&&e&&e.screenX>0&&e.screenY>0){this._map.getContainer().focus()}}});L.control=function(options){return new L.Control(options)};L.Map.include({addControl:function(control){control.addTo(this);return this},removeControl:function(control){control.remove();return this},_initControlPos:function(){var corners=this._controlCorners={},l="leaflet-",container=this._controlContainer=L.DomUtil.create("div",l+"control-container",this._container);function createCorner(vSide,hSide){var className=l+vSide+" "+l+hSide;corners[vSide+hSide]=L.DomUtil.create("div",className,container)}createCorner("top","left");createCorner("top","right");createCorner("bottom","left");createCorner("bottom","right")},_clearControlPos:function(){L.DomUtil.remove(this._controlContainer)}});L.Control.Zoom=L.Control.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"-",zoomOutTitle:"Zoom out"},onAdd:function(map){var zoomName="leaflet-control-zoom",container=L.DomUtil.create("div",zoomName+" leaflet-bar"),options=this.options;this._zoomInButton=this._createButton(options.zoomInText,options.zoomInTitle,zoomName+"-in",container,this._zoomIn);this._zoomOutButton=this._createButton(options.zoomOutText,options.zoomOutTitle,zoomName+"-out",container,this._zoomOut);this._updateDisabled();map.on("zoomend zoomlevelschange",this._updateDisabled,this);return container},onRemove:function(map){map.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){this._disabled=true;this._updateDisabled();return this},enable:function(){this._disabled=false;this._updateDisabled();return this},_zoomIn:function(e){if(!this._disabled){this._map.zoomIn(e.shiftKey?3:1)}},_zoomOut:function(e){if(!this._disabled){this._map.zoomOut(e.shiftKey?3:1)}},_createButton:function(html,title,className,container,fn){var link=L.DomUtil.create("a",className,container);link.innerHTML=html;link.href="#";link.title=title;L.DomEvent.on(link,"mousedown dblclick",L.DomEvent.stopPropagation).on(link,"click",L.DomEvent.stop).on(link,"click",fn,this).on(link,"click",this._refocusOnMap,this);return link},_updateDisabled:function(){var map=this._map,className="leaflet-disabled";L.DomUtil.removeClass(this._zoomInButton,className);L.DomUtil.removeClass(this._zoomOutButton,className);if(this._disabled||map._zoom===map.getMinZoom()){L.DomUtil.addClass(this._zoomOutButton,className)}if(this._disabled||map._zoom===map.getMaxZoom()){L.DomUtil.addClass(this._zoomInButton,className)}}});L.Map.mergeOptions({zoomControl:true});L.Map.addInitHook(function(){if(this.options.zoomControl){this.zoomControl=new L.Control.Zoom;this.addControl(this.zoomControl)}});L.control.zoom=function(options){return new L.Control.Zoom(options)};L.Control.Attribution=L.Control.extend({options:{position:"bottomright",prefix:'<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(options){L.setOptions(this,options);this._attributions={}},onAdd:function(map){this._container=L.DomUtil.create("div","leaflet-control-attribution");if(L.DomEvent){L.DomEvent.disableClickPropagation(this._container)}for(var i in map._layers){if(map._layers[i].getAttribution){this.addAttribution(map._layers[i].getAttribution())}}this._update();return this._container},setPrefix:function(prefix){this.options.prefix=prefix;this._update();return this},addAttribution:function(text){if(!text){return this}if(!this._attributions[text]){this._attributions[text]=0}this._attributions[text]++;this._update();return this},removeAttribution:function(text){if(!text){return this}if(this._attributions[text]){this._attributions[text]--;this._update()}return this},_update:function(){if(!this._map){return}var attribs=[];for(var i in this._attributions){if(this._attributions[i]){attribs.push(i)}}var prefixAndAttribs=[];if(this.options.prefix){prefixAndAttribs.push(this.options.prefix)}if(attribs.length){prefixAndAttribs.push(attribs.join(", "))}this._container.innerHTML=prefixAndAttribs.join(" | ")}});L.Map.mergeOptions({attributionControl:true});L.Map.addInitHook(function(){if(this.options.attributionControl){this.attributionControl=(new L.Control.Attribution).addTo(this)}});L.control.attribution=function(options){return new L.Control.Attribution(options)};L.Control.Scale=L.Control.extend({options:{position:"bottomleft",maxWidth:100,metric:true,imperial:true},onAdd:function(map){var className="leaflet-control-scale",container=L.DomUtil.create("div",className),options=this.options;this._addScales(options,className+"-line",container);map.on(options.updateWhenIdle?"moveend":"move",this._update,this);map.whenReady(this._update,this);return container},onRemove:function(map){map.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(options,className,container){if(options.metric){this._mScale=L.DomUtil.create("div",className,container)}if(options.imperial){this._iScale=L.DomUtil.create("div",className,container)}},_update:function(){var map=this._map,y=map.getSize().y/2;var maxMeters=map.distance(map.containerPointToLatLng([0,y]),map.containerPointToLatLng([this.options.maxWidth,y]));this._updateScales(maxMeters)},_updateScales:function(maxMeters){if(this.options.metric&&maxMeters){this._updateMetric(maxMeters)}if(this.options.imperial&&maxMeters){this._updateImperial(maxMeters)}},_updateMetric:function(maxMeters){var meters=this._getRoundNum(maxMeters),label=meters<1e3?meters+" m":meters/1e3+" km";this._updateScale(this._mScale,label,meters/maxMeters)},_updateImperial:function(maxMeters){var maxFeet=maxMeters*3.2808399,maxMiles,miles,feet;if(maxFeet>5280){maxMiles=maxFeet/5280;miles=this._getRoundNum(maxMiles);this._updateScale(this._iScale,miles+" mi",miles/maxMiles)}else{feet=this._getRoundNum(maxFeet);this._updateScale(this._iScale,feet+" ft",feet/maxFeet)}},_updateScale:function(scale,text,ratio){scale.style.width=Math.round(this.options.maxWidth*ratio)+"px";scale.innerHTML=text},_getRoundNum:function(num){var pow10=Math.pow(10,(Math.floor(num)+"").length-1),d=num/pow10;d=d>=10?10:d>=5?5:d>=3?3:d>=2?2:1;return pow10*d}});L.control.scale=function(options){return new L.Control.Scale(options)};L.Control.Layers=L.Control.extend({options:{collapsed:true,position:"topright",autoZIndex:true,hideSingleBase:false},initialize:function(baseLayers,overlays,options){L.setOptions(this,options);this._layers={};this._lastZIndex=0;this._handlingClick=false;for(var i in baseLayers){this._addLayer(baseLayers[i],i)}for(i in overlays){this._addLayer(overlays[i],i,true)}},onAdd:function(){this._initLayout();this._update();return this._container},addBaseLayer:function(layer,name){this._addLayer(layer,name);return this._update()},addOverlay:function(layer,name){this._addLayer(layer,name,true);return this._update()},removeLayer:function(layer){layer.off("add remove",this._onLayerChange,this);delete this._layers[L.stamp(layer)];return this._update()},_initLayout:function(){var className="leaflet-control-layers",container=this._container=L.DomUtil.create("div",className);container.setAttribute("aria-haspopup",true);if(!L.Browser.touch){L.DomEvent.disableClickPropagation(container).disableScrollPropagation(container)}else{L.DomEvent.on(container,"click",L.DomEvent.stopPropagation)}var form=this._form=L.DomUtil.create("form",className+"-list");if(this.options.collapsed){if(!L.Browser.android){L.DomEvent.on(container,{mouseenter:this._expand,mouseleave:this._collapse},this)}var link=this._layersLink=L.DomUtil.create("a",className+"-toggle",container);link.href="#";link.title="Layers";if(L.Browser.touch){L.DomEvent.on(link,"click",L.DomEvent.stop).on(link,"click",this._expand,this)}else{L.DomEvent.on(link,"focus",this._expand,this)}L.DomEvent.on(form,"click",function(){setTimeout(L.bind(this._onInputClick,this),0)},this);this._map.on("click",this._collapse,this)}else{this._expand()}this._baseLayersList=L.DomUtil.create("div",className+"-base",form);this._separator=L.DomUtil.create("div",className+"-separator",form);this._overlaysList=L.DomUtil.create("div",className+"-overlays",form);container.appendChild(form)},_addLayer:function(layer,name,overlay){layer.on("add remove",this._onLayerChange,this);var id=L.stamp(layer);this._layers[id]={layer:layer,name:name,overlay:overlay};if(this.options.autoZIndex&&layer.setZIndex){this._lastZIndex++;layer.setZIndex(this._lastZIndex)}},_update:function(){if(!this._container){return this}L.DomUtil.empty(this._baseLayersList);L.DomUtil.empty(this._overlaysList);var baseLayersPresent,overlaysPresent,i,obj,baseLayersCount=0;for(i in this._layers){obj=this._layers[i];this._addItem(obj);overlaysPresent=overlaysPresent||obj.overlay;baseLayersPresent=baseLayersPresent||!obj.overlay;baseLayersCount+=!obj.overlay?1:0}if(this.options.hideSingleBase){baseLayersPresent=baseLayersPresent&&baseLayersCount>1;this._baseLayersList.style.display=baseLayersPresent?"":"none"}this._separator.style.display=overlaysPresent&&baseLayersPresent?"":"none";return this},_onLayerChange:function(e){if(!this._handlingClick){this._update()}var overlay=this._layers[L.stamp(e.target)].overlay;var type=overlay?e.type==="add"?"overlayadd":"overlayremove":e.type==="add"?"baselayerchange":null;if(type){this._map.fire(type,e.target)}},_createRadioElement:function(name,checked){var radioHtml='<input type="radio" class="leaflet-control-layers-selector" name="'+name+'"'+(checked?' checked="checked"':"")+"/>";var radioFragment=document.createElement("div");radioFragment.innerHTML=radioHtml;return radioFragment.firstChild},_addItem:function(obj){var label=document.createElement("label"),checked=this._map.hasLayer(obj.layer),input;if(obj.overlay){input=document.createElement("input");input.type="checkbox";input.className="leaflet-control-layers-selector";input.defaultChecked=checked}else{input=this._createRadioElement("leaflet-base-layers",checked)}input.layerId=L.stamp(obj.layer);L.DomEvent.on(input,"click",this._onInputClick,this);var name=document.createElement("span");name.innerHTML=" "+obj.name;var holder=document.createElement("div");label.appendChild(holder);holder.appendChild(input);holder.appendChild(name);var container=obj.overlay?this._overlaysList:this._baseLayersList;container.appendChild(label);return label},_onInputClick:function(){var inputs=this._form.getElementsByTagName("input"),input,layer,hasLayer;var addedLayers=[],removedLayers=[];this._handlingClick=true;for(var i=inputs.length-1;i>=0;i--){input=inputs[i];layer=this._layers[input.layerId].layer;hasLayer=this._map.hasLayer(layer);if(input.checked&&!hasLayer){addedLayers.push(layer)}else if(!input.checked&&hasLayer){removedLayers.push(layer)}}for(i=0;i<removedLayers.length;i++){this._map.removeLayer(removedLayers[i])}for(i=0;i<addedLayers.length;i++){this._map.addLayer(addedLayers[i])}this._handlingClick=false;this._refocusOnMap()},_expand:function(){L.DomUtil.addClass(this._container,"leaflet-control-layers-expanded");var acceptableHeight=this._map._size.y-this._container.offsetTop*4;if(acceptableHeight<this._form.clientHeight){L.DomUtil.addClass(this._form,"leaflet-control-layers-scrollbar");this._form.style.height=acceptableHeight+"px"}},_collapse:function(){L.DomUtil.removeClass(this._container,"leaflet-control-layers-expanded")}});L.control.layers=function(baseLayers,overlays,options){return new L.Control.Layers(baseLayers,overlays,options)};L.PosAnimation=L.Evented.extend({run:function(el,newPos,duration,easeLinearity){this.stop();this._el=el;this._inProgress=true;this._duration=duration||.25;this._easeOutPower=1/Math.max(easeLinearity||.5,.2);this._startPos=L.DomUtil.getPosition(el);this._offset=newPos.subtract(this._startPos);this._startTime=+new Date;this.fire("start");this._animate()},stop:function(){if(!this._inProgress){return}this._step(true);this._complete()},_animate:function(){this._animId=L.Util.requestAnimFrame(this._animate,this);this._step()},_step:function(round){var elapsed=+new Date-this._startTime,duration=this._duration*1e3;if(elapsed<duration){this._runFrame(this._easeOut(elapsed/duration),round)}else{this._runFrame(1);this._complete()}},_runFrame:function(progress,round){var pos=this._startPos.add(this._offset.multiplyBy(progress));if(round){pos._round()}L.DomUtil.setPosition(this._el,pos);this.fire("step")},_complete:function(){L.Util.cancelAnimFrame(this._animId);this._inProgress=false;this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}});L.Map.include({setView:function(center,zoom,options){zoom=zoom===undefined?this._zoom:this._limitZoom(zoom);center=this._limitCenter(L.latLng(center),zoom,this.options.maxBounds);options=options||{};this.stop();if(this._loaded&&!options.reset&&options!==true){if(options.animate!==undefined){options.zoom=L.extend({animate:options.animate},options.zoom);options.pan=L.extend({animate:options.animate},options.pan)}var moved=this._zoom!==zoom?this._tryAnimatedZoom&&this._tryAnimatedZoom(center,zoom,options.zoom):this._tryAnimatedPan(center,options.pan);if(moved){clearTimeout(this._sizeTimer);return this}}this._resetView(center,zoom);return this},panBy:function(offset,options){offset=L.point(offset).round();options=options||{};if(!offset.x&&!offset.y){return this.fire("moveend")}if(options.animate!==true&&!this.getSize().contains(offset)){this._resetView(this.unproject(this.project(this.getCenter()).add(offset)),this.getZoom());return this}if(!this._panAnim){this._panAnim=new L.PosAnimation;this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)}if(!options.noMoveStart){this.fire("movestart")}if(options.animate!==false){L.DomUtil.addClass(this._mapPane,"leaflet-pan-anim");var newPos=this._getMapPanePos().subtract(offset);this._panAnim.run(this._mapPane,newPos,options.duration||.25,options.easeLinearity)}else{this._rawPanBy(offset);this.fire("move").fire("moveend")}return this},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){L.DomUtil.removeClass(this._mapPane,"leaflet-pan-anim");this.fire("moveend")},_tryAnimatedPan:function(center,options){var offset=this._getCenterOffset(center)._floor();if((options&&options.animate)!==true&&!this.getSize().contains(offset)){
return false}this.panBy(offset,options);return true}});L.Map.mergeOptions({zoomAnimation:true,zoomAnimationThreshold:4});var zoomAnimated=L.DomUtil.TRANSITION&&L.Browser.any3d&&!L.Browser.mobileOpera;if(zoomAnimated){L.Map.addInitHook(function(){this._zoomAnimated=this.options.zoomAnimation;if(this._zoomAnimated){this._createAnimProxy();L.DomEvent.on(this._proxy,L.DomUtil.TRANSITION_END,this._catchTransitionEnd,this)}})}L.Map.include(!zoomAnimated?{}:{_createAnimProxy:function(){var proxy=this._proxy=L.DomUtil.create("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(proxy);this.on("zoomanim",function(e){var prop=L.DomUtil.TRANSFORM,transform=proxy.style[prop];L.DomUtil.setTransform(proxy,this.project(e.center,e.zoom),this.getZoomScale(e.zoom,1));if(transform===proxy.style[prop]&&this._animatingZoom){this._onZoomTransitionEnd()}},this);this.on("load moveend",function(){var c=this.getCenter(),z=this.getZoom();L.DomUtil.setTransform(proxy,this.project(c,z),this.getZoomScale(z,1))},this)},_catchTransitionEnd:function(e){if(this._animatingZoom&&e.propertyName.indexOf("transform")>=0){this._onZoomTransitionEnd()}},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(center,zoom,options){if(this._animatingZoom){return true}options=options||{};if(!this._zoomAnimated||options.animate===false||this._nothingToAnimate()||Math.abs(zoom-this._zoom)>this.options.zoomAnimationThreshold){return false}var scale=this.getZoomScale(zoom),offset=this._getCenterOffset(center)._divideBy(1-1/scale);if(options.animate!==true&&!this.getSize().contains(offset)){return false}L.Util.requestAnimFrame(function(){this._moveStart(true)._animateZoom(center,zoom,true)},this);return true},_animateZoom:function(center,zoom,startAnim,noUpdate){if(startAnim){this._animatingZoom=true;this._animateToCenter=center;this._animateToZoom=zoom;L.DomUtil.addClass(this._mapPane,"leaflet-zoom-anim")}this.fire("zoomanim",{center:center,zoom:zoom,noUpdate:noUpdate})},_onZoomTransitionEnd:function(){this._animatingZoom=false;L.DomUtil.removeClass(this._mapPane,"leaflet-zoom-anim");this._move(this._animateToCenter,this._animateToZoom)._moveEnd(true)}});L.Map.include({flyTo:function(targetCenter,targetZoom,options){options=options||{};if(options.animate===false||!L.Browser.any3d){return this.setView(targetCenter,targetZoom,options)}this.stop();var from=this.project(this.getCenter()),to=this.project(targetCenter),size=this.getSize(),startZoom=this._zoom;targetCenter=L.latLng(targetCenter);targetZoom=targetZoom===undefined?startZoom:targetZoom;var w0=Math.max(size.x,size.y),w1=w0*this.getZoomScale(startZoom,targetZoom),u1=to.distanceTo(from),rho=1.42,rho2=rho*rho;function r(i){var b=(w1*w1-w0*w0+(i?-1:1)*rho2*rho2*u1*u1)/(2*(i?w1:w0)*rho2*u1);return Math.log(Math.sqrt(b*b+1)-b)}function sinh(n){return(Math.exp(n)-Math.exp(-n))/2}function cosh(n){return(Math.exp(n)+Math.exp(-n))/2}function tanh(n){return sinh(n)/cosh(n)}var r0=r(0);function w(s){return w0*(cosh(r0)/cosh(r0+rho*s))}function u(s){return w0*(cosh(r0)*tanh(r0+rho*s)-sinh(r0))/rho2}function easeOut(t){return 1-Math.pow(1-t,1.5)}var start=Date.now(),S=(r(1)-r0)/rho,duration=options.duration?1e3*options.duration:1e3*S*.8;function frame(){var t=(Date.now()-start)/duration,s=easeOut(t)*S;if(t<=1){this._flyToFrame=L.Util.requestAnimFrame(frame,this);this._move(this.unproject(from.add(to.subtract(from).multiplyBy(u(s)/u1)),startZoom),this.getScaleZoom(w0/w(s),startZoom))}else{this._move(targetCenter,targetZoom)._moveEnd(true)}}this._moveStart(true);frame.call(this);return this},flyToBounds:function(bounds,options){var target=this._getBoundsCenterZoom(bounds,options);return this.flyTo(target.center,target.zoom,options)}});L.Map.include({_defaultLocateOptions:{timeout:1e4,watch:false},locate:function(options){options=this._locateOptions=L.extend({},this._defaultLocateOptions,options);if(!("geolocation"in navigator)){this._handleGeolocationError({code:0,message:"Geolocation not supported."});return this}var onResponse=L.bind(this._handleGeolocationResponse,this),onError=L.bind(this._handleGeolocationError,this);if(options.watch){this._locationWatchId=navigator.geolocation.watchPosition(onResponse,onError,options)}else{navigator.geolocation.getCurrentPosition(onResponse,onError,options)}return this},stopLocate:function(){if(navigator.geolocation){navigator.geolocation.clearWatch(this._locationWatchId)}if(this._locateOptions){this._locateOptions.setView=false}return this},_handleGeolocationError:function(error){var c=error.code,message=error.message||(c===1?"permission denied":c===2?"position unavailable":"timeout");if(this._locateOptions.setView&&!this._loaded){this.fitWorld()}this.fire("locationerror",{code:c,message:"Geolocation error: "+message+"."})},_handleGeolocationResponse:function(pos){var lat=pos.coords.latitude,lng=pos.coords.longitude,latlng=new L.LatLng(lat,lng),bounds=latlng.toBounds(pos.coords.accuracy),options=this._locateOptions;if(options.setView){var zoom=this.getBoundsZoom(bounds);this.setView(latlng,options.maxZoom?Math.min(zoom,options.maxZoom):zoom)}var data={latlng:latlng,bounds:bounds,timestamp:pos.timestamp};for(var i in pos.coords){if(typeof pos.coords[i]==="number"){data[i]=pos.coords[i]}}this.fire("locationfound",data)}})})(window,document);"use strict";var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();function _defaults(obj,defaults){var keys=Object.getOwnPropertyNames(defaults);for(var i=0;i<keys.length;i++){var key=keys[i];var value=Object.getOwnPropertyDescriptor(defaults,key);if(value&&value.configurable&&obj[key]===undefined){Object.defineProperty(obj,key,value)}}return obj}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):_defaults(subClass,superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}(function(){var FloorViewer={version:"0.4.12"};function expose(){var oldFloorViewer=window.FloorViewer;var oldFV=window.FV;FloorViewer.noConflict=function(){window.FloorViewer=oldFloorViewer;return this};FloorViewer.noFV=function(){window.FV=oldFV;return this};window.FloorViewer=FloorViewer;window.FV=FloorViewer}if(typeof module==="object"&&typeof module.exports==="object"){module.exports=FloorViewer}else if(typeof define==="function"&&define.amd){define(FloorViewer)}if(typeof window!=="undefined"){expose()}FV.OrderedDict=function(){function OrderedDict(){_classCallCheck(this,OrderedDict);this.data={};this.order=[]}OrderedDict.prototype.set=function set(key,val){this.data[key]=val;this.order.push(key)};OrderedDict.prototype.get=function get(key){return this.data[key]};OrderedDict.prototype.remove=function remove(key){var index=_.indexOf(this.order,key);this.order.splice(index,1);delete this.data[key]};OrderedDict.prototype.at=function at(index){return this.data[this.order[index]]};OrderedDict.prototype.length=function length(){return this.order.length};OrderedDict.prototype.forEach=function forEach(fn,context){var key,val;for(var i=0,len=this.order.length;i<len;i++){key=this.order[i];val=this.data[key];fn.call(context,val,key,i)}return this};OrderedDict.prototype.sort=function sort(fn){var _this=this;this.array.sort(function(left,right){return fn(_this.data[left],_this.data[right])});return this};OrderedDict.prototype.clear=function clear(){this.data={};this.order=[];return this};return OrderedDict}();FV.orderedDict=function(){return new FV.OrderedDict};FV.SimpleHeat=function(){function SimpleHeat(){_classCallCheck(this,SimpleHeat);_.assign(this,{_max:1,_data:[],defaultRadius:25,defaultGradient:{.4:"blue",.6:"cyan",.7:"lime",.8:"yellow",1:"red"}})}SimpleHeat.prototype.setCanvas=function setCanvas(canvas){this._canvas=canvas;this._ctx=canvas._ctx;this._width=canvas._container.width;this._height=canvas._container.height};SimpleHeat.prototype.data=function data(_data){this._data=_data;return this};SimpleHeat.prototype.max=function max(_max){this._max=_max;return this};SimpleHeat.prototype.add=function add(point){this._data.push(point);return this};SimpleHeat.prototype.clear=function clear(){this._data=[];return this};SimpleHeat.prototype.radius=function radius(r){var blur=arguments.length<=1||arguments[1]===undefined?15:arguments[1];var circle=this._circle=document.createElement("canvas"),ctx=circle.getContext("2d"),r2=this._r=r+blur;circle.width=circle.height=r2*2;ctx.shadowOffsetX=ctx.shadowOffsetY=200;ctx.shadowBlur=blur;ctx.shadowColor="black";ctx.beginPath();ctx.arc(r2-200,r2-200,r,0,Math.PI*2,true);ctx.closePath();ctx.fill();return this};SimpleHeat.prototype.gradient=function gradient(grad){var canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),gradient=ctx.createLinearGradient(0,0,0,256);canvas.width=1;canvas.height=256;for(var i in grad){gradient.addColorStop(i,grad[i])}ctx.fillStyle=gradient;ctx.fillRect(0,0,1,256);this._grad=ctx.getImageData(0,0,1,256).data;return this};SimpleHeat.prototype.draw=function draw(){var _this2=this;var minOpacity=arguments.length<=0||arguments[0]===undefined?.05:arguments[0];var b=this._canvas._bounds,min=b.min,max=b.max,width=max.x-min.x,height=max.y-min.y,canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),colored=undefined;canvas.width=width;canvas.height=height;if(!this._circle){this.radius(this.defaultRadius)}if(!this._grad){this.gradient(this.defaultGradient)}var cw=this._circle.width,ch=this._circle.height,endpoints=[],collection={};_.each(this._data,function(p){ctx.globalAlpha=Math.max(p[2]/_this2._max,minOpacity);var x=p[0]-_this2._r-min.x,y=p[1]-_this2._r-min.y;ctx.drawImage(_this2._circle,x,y);if(!_.has(collection,x)){collection[x]=[];endpoints.push(x)}if(!_.has(collection,x+cw)){collection[x+cw]=[];endpoints.push(x+cw)}var rect=new FVRect(x,x+cw,y,y+ch);collection[x].push(rect);collection[x+cw].push(rect)});var nonoverlapping=this.separateRectangles(collection,endpoints);console.time("getting-image");colored=ctx.getImageData(0,0,width,height);console.timeEnd("getting-image");this._colorize(colored.data,this._grad);ctx.putImageData(colored,0,0,0,0,width,height);this._ctx.drawImage(canvas,0,0,width,height,min.x,min.y,width,height);canvas=null;return this};SimpleHeat.prototype.separateRectangles=function separateRectangles(collection,endpoints){var output=[],input=[];_.each(endpoints,function(point){_.each(collection[point],function(rect){if(input.indexOf(rect)>-1){output.push(null)}else{input.push(rect)}});_.each(input,function(rect){});console.log("Input: ",input)});return null};SimpleHeat.prototype.drawRoomsInView=function drawRoomsInView(roomsInView,layer,dataName){var minOpacity=arguments.length<=3||arguments[3]===undefined?.05:arguments[3];var data=[],map=this._canvas._map,b=this._canvas._bounds,r=this._r,maxZoom=map.getMaxZoom(),v=1/Math.pow(2,Math.max(0,Math.min(maxZoom-map.getZoom(),12))),cellSize=r/2,grid=[],panePos=map._getMapPanePos(),offsetX=panePos.x%cellSize,offsetY=panePos.y%cellSize,i,len,p,cell,x,y,j,len2,k,roomData,alt;for(i=0,len=roomsInView.length;i<len;i++){roomData=roomsInView[i].getLayerData(layer);if(!roomData||roomData[dataName]==0){continue}p=L.point(roomsInView[i].getLargestRectanglePixelBounds().getCenter());x=Math.floor((p.x-b.min.x-offsetX)/cellSize)+2;y=Math.floor((p.y-b.min.y-offsetY)/cellSize)+2;alt=roomData[dataName];k=alt*v;grid[y]=grid[y]||[];cell=grid[y][x];if(!cell){grid[y][x]=[p.x,p.y,k]}else{cell[0]=(cell[0]*cell[2]+p.x*k)/(cell[2]+k);cell[1]=(cell[1]*cell[2]+p.y*k)/(cell[2]+k);cell[2]+=k}}for(i=0,len=grid.length;i<len;i++){if(grid[i]){for(j=0,len2=grid[i].length;j<len2;j++){cell=grid[i][j];if(cell){data.push([Math.round(cell[0]),Math.round(cell[1]),Math.min(cell[2],1)])}}}}this.data(data).draw(minOpacity)};SimpleHeat.prototype._colorize=function _colorize(pixels,gradient){for(var i=3,len=pixels.length,j;i<len;i+=4){j=pixels[i]*4;if(j){pixels[i-3]=gradient[j];pixels[i-2]=gradient[j+1];pixels[i-1]=gradient[j+2]}}};return SimpleHeat}();var FVRect=function(){function FVRect(start,end,a,b){_classCallCheck(this,FVRect);this.start=start;this.end=end;this.a=a;this.b=b}FVRect.prototype.overlaps=function overlaps(rect){return false};return FVRect}();FV.largestRect=function(){var abs=Math.abs;var d3={};d3.extent=function(array,f){var i=-1,n=array.length,a,b,c;if(arguments.length===1){while(++i<n&&!((a=c=array[i])!=null&&a<=a))a=c=undefined;while(++i<n)if((b=array[i])!=null){if(a>b)a=b;if(c<b)c=b}}else{while(++i<n&&!((a=c=f.call(array,array[i],i))!=null&&a<=a))a=undefined;while(++i<n)if((b=f.call(array,array[i],i))!=null){if(a>b)a=b;if(c<b)c=b}}return[a,c]};d3.range=function(start,stop,step){if(arguments.length<3){step=1;if(arguments.length<2){stop=start;start=0}}if((stop-start)/step===Infinity)throw new Error("infinite range");var range=[],k=d3_range_integerScale(abs(step)),i=-1,j;start*=k,stop*=k,step*=k;if(step<0)while((j=start+step*++i)>stop)range.push(j/k);else while((j=start+step*++i)<stop)range.push(j/k);return range};function d3_range_integerScale(x){var k=1;while(x*k%1)k*=10;return k}var d3_subclass={}.__proto__?function(object,prototype){_defaults(object,prototype)}:function(object,prototype){for(var property in prototype)object[property]=prototype[property]};d3.geom={};d3.geom.polygon=function(coordinates){d3_subclass(coordinates,d3_geom_polygonPrototype);return coordinates};var d3_geom_polygonPrototype=d3.geom.polygon.prototype=[];d3_geom_polygonPrototype.area=function(){var i=-1,n=this.length,a,b=this[n-1],area=0;while(++i<n){a=b;b=this[i];area+=a[1]*b[0]-a[0]*b[1]}return area*.5};d3_geom_polygonPrototype.centroid=function(k){var i=-1,n=this.length,x=0,y=0,a,b=this[n-1],c;if(!arguments.length)k=-1/(6*this.area());while(++i<n){a=b;b=this[i];c=a[0]*b[1]-b[0]*a[1];x+=(a[0]+b[0])*c;y+=(a[1]+b[1])*c}return[x*k,y*k]};var intersectPoints,largestRect,lineIntersection,pointInPoly,pointInSegmentBox,polyInsidePoly,rayIntersectsSegment,rotatePoint,rotatePoly,segmentsIntersect,squaredDist;largestRect=function(poly,options){var aRatio,aRatios,angle,angleRad,angleStep,angles,area,aspectRatioStep,aspectRatios,bBox,boxHeight,boxWidth,centroid,events,height,i,insidePoly,left,maxArea,maxAspectRatio,maxHeight,maxRect,maxWidth,maxx,maxy,minAspectRatio,minSqDistH,minSqDistW,minx,miny,modifOrigins,origOrigin,origin,origins,p,p1H,p1W,p2H,p2W,rectPoly,right,rndPoint,rndX,rndY,tempPoly,tolerance,width,widthStep,x0,y0,_i,_j,_k,_l,_len,_len1,_len2,_len3,_ref,_ref1,_ref2,_ref3,_ref4,_ref5,_ref6,_ref7,_ref8;if(poly.length<3){console.error("polygon has to have at least 3 points");return null}events=[];aspectRatioStep=.5;angleStep=5;if(options==null){options={}}if(options.maxAspectRatio==null){options.maxAspectRatio=15}if(options.minWidth==null){options.minWidth=0}if(options.minHeight==null){options.minHeight=0}if(options.tolerance==null){options.tolerance=.02}if(options.nTries==null){options.nTries=20}if(options.angle!=null){if(options.angle instanceof Array){angles=options.angle}else if(typeof options.angle==="number"){angles=[options.angle]}else if(typeof options.angle==="string"&&!isNaN(options.angle)){angles=[Number(options.angle)]}}if(angles==null){angles=d3.range(-90,90+angleStep,angleStep)}if(options.aspectRatio!=null){if(options.aspectRatio instanceof Array){aspectRatios=options.aspectRatio}else if(typeof options.aspectRatio==="number"){aspectRatios=[options.aspectRatio]}else if(typeof options.aspectRatio==="string"&&!isNaN(options.aspectRatio)){aspectRatios=[Number(options.aspectRatio)]}}if(options.origin!=null){if(options.origin instanceof Array){if(options.origin[0]instanceof Array){origins=options.origin}else{origins=[options.origin]}}}area=Math.abs(d3.geom.polygon(poly).area());if(area===0){console.error("polygon has 0 area");return null}_ref=d3.extent(poly,function(d){return d[0]}),minx=_ref[0],maxx=_ref[1];_ref1=d3.extent(poly,function(d){return d[1]}),miny=_ref1[0],maxy=_ref1[1];tolerance=Math.min(maxx-minx,maxy-miny)*options.tolerance;tempPoly=function(){var _i,_len,_results;_results=[];for(_i=0,_len=poly.length;_i<_len;_i++){p=poly[_i];_results.push({x:p[0],y:p[1]})}return _results}();if(tolerance>0){tempPoly=L.LineUtil.simplify(tempPoly,tolerance);poly=function(){var _i,_len,_results;_results=[];for(_i=0,_len=tempPoly.length;_i<_len;_i++){p=tempPoly[_i];_results.push([p.x,p.y])}return _results}()}if(options.vdebug){events.push({type:"simplify",poly:poly})}_ref2=d3.extent(poly,function(d){return d[0]}),minx=_ref2[0],maxx=_ref2[1];_ref3=d3.extent(poly,function(d){return d[1]}),miny=_ref3[0],maxy=_ref3[1];bBox=[[minx,miny],[maxx,miny],[maxx,maxy],[minx,maxy]];_ref4=[maxx-minx,maxy-miny],boxWidth=_ref4[0],boxHeight=_ref4[1];widthStep=Math.min(boxWidth,boxHeight)/50;if(origins==null){origins=[];centroid=d3.geom.polygon(poly).centroid();if(pointInPoly(centroid,poly)){origins.push(centroid)}while(origins.length<options.nTries){rndX=Math.random()*boxWidth+minx;rndY=Math.random()*boxHeight+miny;rndPoint=[rndX,rndY];if(pointInPoly(rndPoint,poly)){origins.push(rndPoint)}}}if(options.vdebug){events.push({type:"origins",points:origins})}maxArea=0;maxRect=null;for(_i=0,_len=angles.length;_i<_len;_i++){angle=angles[_i];angleRad=-angle*Math.PI/180;if(options.vdebug){events.push({type:"angle",angle:angle})}for(i=_j=0,_len1=origins.length;_j<_len1;i=++_j){origOrigin=origins[i];_ref5=intersectPoints(poly,origOrigin,angleRad),p1W=_ref5[0],p2W=_ref5[1];_ref6=intersectPoints(poly,origOrigin,angleRad+Math.PI/2),p1H=_ref6[0],p2H=_ref6[1];modifOrigins=[];if(p1W!=null&&p2W!=null){modifOrigins.push([(p1W[0]+p2W[0])/2,(p1W[1]+p2W[1])/2])}if(p1H!=null&&p2H!=null){modifOrigins.push([(p1H[0]+p2H[0])/2,(p1H[1]+p2H[1])/2])}if(options.vdebug){events.push({type:"modifOrigin",idx:i,p1W:p1W,p2W:p2W,p1H:p1H,p2H:p2H,modifOrigins:modifOrigins})}for(_k=0,_len2=modifOrigins.length;_k<_len2;_k++){origin=modifOrigins[_k];if(options.vdebug){events.push({type:"origin",cx:origin[0],cy:origin[1]})}_ref7=intersectPoints(poly,origin,angleRad),p1W=_ref7[0],p2W=_ref7[1];minSqDistW=Math.min(squaredDist(origin,p1W),squaredDist(origin,p2W));maxWidth=2*Math.sqrt(minSqDistW);_ref8=intersectPoints(poly,origin,angleRad+Math.PI/2),p1H=_ref8[0],p2H=_ref8[1];minSqDistH=Math.min(squaredDist(origin,p1H),squaredDist(origin,p2H));maxHeight=2*Math.sqrt(minSqDistH);if(maxWidth*maxHeight<maxArea){continue}if(aspectRatios!=null){aRatios=aspectRatios}else{minAspectRatio=Math.max(1,options.minWidth/maxHeight,maxArea/(maxHeight*maxHeight));maxAspectRatio=Math.min(options.maxAspectRatio,maxWidth/options.minHeight,maxWidth*maxWidth/maxArea);aRatios=d3.range(minAspectRatio,maxAspectRatio+aspectRatioStep,aspectRatioStep)}for(_l=0,_len3=aRatios.length;_l<_len3;_l++){aRatio=aRatios[_l];left=Math.max(options.minWidth,Math.sqrt(maxArea*aRatio));right=Math.min(maxWidth,maxHeight*aRatio);if(right*maxHeight<maxArea){continue}if(right-left>=widthStep){if(options.vdebug){events.push({type:"aRatio",aRatio:aRatio})}}while(right-left>=widthStep){width=(left+right)/2;height=width/aRatio;x0=origin[0],y0=origin[1];rectPoly=[[x0-width/2,y0-height/2],[x0+width/2,y0-height/2],[x0+width/2,y0+height/2],[x0-width/2,y0+height/2]];rectPoly=rotatePoly(rectPoly,angleRad,origin);if(polyInsidePoly(rectPoly,poly)){insidePoly=true;maxArea=width*height;maxRect={cx:x0,cy:y0,width:width,height:height,angle:angle};left=width}else{insidePoly=false;right=width}if(options.vdebug){events.push({type:"rectangle",cx:x0,cy:y0,width:width,height:height,areaFraction:width*height/area,angle:angle,insidePoly:insidePoly})}}}}}}return[maxRect,maxArea,events]};squaredDist=function(a,b){var deltax,deltay;deltax=b[0]-a[0];deltay=b[1]-a[1];return deltax*deltax+deltay*deltay};rayIntersectsSegment=function(p,p1,p2){var a,b,mAB,mAP,_ref;_ref=p1[1]<p2[1]?[p1,p2]:[p2,p1],a=_ref[0],b=_ref[1];if(p[1]===b[1]||p[1]===a[1]){p[1]+=Number.MIN_VALUE}if(p[1]>b[1]||p[1]<a[1]){return false}else if(p[0]>a[0]&&p[0]>b[0]){return false}else if(p[0]<a[0]&&p[0]<b[0]){return true}else{mAB=(b[1]-a[1])/(b[0]-a[0]);mAP=(p[1]-a[1])/(p[0]-a[0]);return mAP>mAB}};pointInPoly=function(p,poly){var a,b,c,i,n;i=-1;n=poly.length;b=poly[n-1];c=0;while(++i<n){a=b;b=poly[i];if(rayIntersectsSegment(p,a,b)){c++}}return c%2!==0};pointInSegmentBox=function(p,p1,q1){var eps,px,py;eps=1e-9;px=p[0],py=p[1];if(px<Math.min(p1[0],q1[0])-eps||px>Math.max(p1[0],q1[0])+eps||py<Math.min(p1[1],q1[1])-eps||py>Math.max(p1[1],q1[1])+eps){return false}return true};lineIntersection=function(p1,q1,p2,q2){var cross1,cross2,denom,dx1,dx2,dy1,dy2,eps,px,py;eps=1e-9;dx1=p1[0]-q1[0];dy1=p1[1]-q1[1];dx2=p2[0]-q2[0];dy2=p2[1]-q2[1];denom=dx1*dy2-dy1*dx2;if(Math.abs(denom)<eps){return null}cross1=p1[0]*q1[1]-p1[1]*q1[0];cross2=p2[0]*q2[1]-p2[1]*q2[0];px=(cross1*dx2-cross2*dx1)/denom;py=(cross1*dy2-cross2*dy1)/denom;return[px,py]};segmentsIntersect=function(p1,q1,p2,q2){var p;p=lineIntersection(p1,q1,p2,q2);if(p==null){return false}return pointInSegmentBox(p,p1,q1)&&pointInSegmentBox(p,p2,q2)};polyInsidePoly=function(polyA,polyB){var aA,aB,bA,bB,iA,iB,nA,nB;iA=-1;nA=polyA.length;nB=polyB.length;bA=polyA[nA-1];while(++iA<nA){aA=bA;bA=polyA[iA];iB=-1;bB=polyB[nB-1];while(++iB<nB){aB=bB;bB=polyB[iB];if(segmentsIntersect(aA,bA,aB,bB)){return false}}}return pointInPoly(polyA[0],polyB)};rotatePoint=function(p,alpha,origin){var cosAlpha,sinAlpha,xshifted,yshifted;if(origin==null){origin=[0,0]}xshifted=p[0]-origin[0];yshifted=p[1]-origin[1];cosAlpha=Math.cos(alpha);sinAlpha=Math.sin(alpha);return[cosAlpha*xshifted-sinAlpha*yshifted+origin[0],sinAlpha*xshifted+cosAlpha*yshifted+origin[1]]};rotatePoly=function(poly,alpha,origin){var point,_i,_len,_results;_results=[];for(_i=0,_len=poly.length;_i<_len;_i++){point=poly[_i];_results.push(rotatePoint(point,alpha,origin))}return _results};intersectPoints=function(poly,origin,alpha){var a,b,closestPointLeft,closestPointRight,eps,i,idx,minSqDistLeft,minSqDistRight,n,p,shiftedOrigin,sqDist,x0,y0;eps=1e-9;origin=[origin[0]+eps*Math.cos(alpha),origin[1]+eps*Math.sin(alpha)];x0=origin[0],y0=origin[1];shiftedOrigin=[x0+Math.cos(alpha),y0+Math.sin(alpha)];idx=0;if(Math.abs(shiftedOrigin[0]-x0)<eps){idx=1}i=-1;n=poly.length;b=poly[n-1];minSqDistLeft=Number.MAX_VALUE;minSqDistRight=Number.MAX_VALUE;closestPointLeft=null;closestPointRight=null;while(++i<n){a=b;b=poly[i];p=lineIntersection(origin,shiftedOrigin,a,b);if(p!=null&&pointInSegmentBox(p,a,b)){sqDist=squaredDist(origin,p);if(p[idx]<origin[idx]){if(sqDist<minSqDistLeft){minSqDistLeft=sqDist;closestPointLeft=p}}else if(p[idx]>origin[idx]){if(sqDist<minSqDistRight){minSqDistRight=sqDist;closestPointRight=p}}}}return[closestPointLeft,closestPointRight]};return largestRect}();(function(){var mulTable=[1,57,41,21,203,34,97,73,227,91,149,62,105,45,39,137,241,107,3,173,39,71,65,238,219,101,187,87,81,151,141,133,249,117,221,209,197,187,177,169,5,153,73,139,133,127,243,233,223,107,103,99,191,23,177,171,165,159,77,149,9,139,135,131,253,245,119,231,224,109,211,103,25,195,189,23,45,175,171,83,81,79,155,151,147,9,141,137,67,131,129,251,123,30,235,115,113,221,217,53,13,51,50,49,193,189,185,91,179,175,43,169,83,163,5,79,155,19,75,147,145,143,35,69,17,67,33,65,255,251,247,243,239,59,29,229,113,111,219,27,213,105,207,51,201,199,49,193,191,47,93,183,181,179,11,87,43,85,167,165,163,161,159,157,155,77,19,75,37,73,145,143,141,35,138,137,135,67,33,131,129,255,63,250,247,61,121,239,237,117,29,229,227,225,111,55,109,216,213,211,209,207,205,203,201,199,197,195,193,48,190,47,93,185,183,181,179,178,176,175,173,171,85,21,167,165,41,163,161,5,79,157,78,154,153,19,75,149,74,147,73,144,143,71,141,140,139,137,17,135,134,133,66,131,65,129,1];var shgTable=[0,9,10,10,14,12,14,14,16,15,16,15,16,15,15,17,18,17,12,18,16,17,17,19,19,18,19,18,18,19,19,19,20,19,20,20,20,20,20,20,15,20,19,20,20,20,21,21,21,20,20,20,21,18,21,21,21,21,20,21,17,21,21,21,22,22,21,22,22,21,22,21,19,22,22,19,20,22,22,21,21,21,22,22,22,18,22,22,21,22,22,23,22,20,23,22,22,23,23,21,19,21,21,21,23,23,23,22,23,23,21,23,22,23,18,22,23,20,22,23,23,23,21,22,20,22,21,22,24,24,24,24,24,22,21,24,23,23,24,21,24,23,24,22,24,24,22,24,24,22,23,24,24,24,20,23,22,23,24,24,24,24,24,24,24,23,21,23,22,23,24,24,24,22,24,24,24,23,22,24,24,25,23,25,25,23,24,25,25,24,22,25,25,25,24,23,24,25,25,25,25,25,25,25,25,25,25,25,25,23,25,23,24,25,25,25,25,25,25,25,25,25,24,22,25,25,23,25,25,20,24,25,24,25,25,22,24,25,24,25,24,25,25,24,25,25,25,25,22,25,25,25,24,25,24,25,18];FV.boxBlurCanvasRGBA=function(canvas,topX,topY,width,height,radius,iterations){if(isNaN(radius)||radius<1)return;radius|=0;if(isNaN(iterations))iterations=1;iterations|=0;if(iterations>3)iterations=3;if(iterations<1)iterations=1;var context=canvas.getContext("2d");var imageData=context.getImageData(topX,topY,width,height);var pixels=imageData.data;var len;for(i=3,len=pixels.length;i<len;i+=4){if(pixels[i]>0){pixels[i]=255}}var rsum,gsum,bsum,asum,x,y,i,p,p1,p2,yp,yi,yw,pa;var wm=width-1;var hm=height-1;var rad1=radius+1;var mulSum=mulTable[radius];var shgSum=shgTable[radius];var r=[];var g=[];var b=[];var a=[];var vmin=[];var vmax=[];while(iterations-- >0){yw=yi=0;for(y=0;y<height;y++){rsum=pixels[yw]*rad1;gsum=pixels[yw+1]*rad1;bsum=pixels[yw+2]*rad1;asum=pixels[yw+3]*rad1;for(i=1;i<=radius;i++){p=yw+((i>wm?wm:i)<<2);rsum+=pixels[p++];gsum+=pixels[p++];bsum+=pixels[p++];asum+=pixels[p]}for(x=0;x<width;x++){r[yi]=rsum;g[yi]=gsum;b[yi]=bsum;a[yi]=asum;if(y==0){vmin[x]=((p=x+rad1)<wm?p:wm)<<2;vmax[x]=(p=x-radius)>0?p<<2:0}p1=yw+vmin[x];p2=yw+vmax[x];rsum+=pixels[p1++]-pixels[p2++];gsum+=pixels[p1++]-pixels[p2++];bsum+=pixels[p1++]-pixels[p2++];asum+=pixels[p1]-pixels[p2];yi++}yw+=width<<2}for(x=0;x<width;x++){yp=x;rsum=r[yp]*rad1;gsum=g[yp]*rad1;bsum=b[yp]*rad1;asum=a[yp]*rad1;for(i=1;i<=radius;i++){yp+=i>hm?0:width;rsum+=r[yp];gsum+=g[yp];bsum+=b[yp];asum+=a[yp]}yi=x<<2;for(y=0;y<height;y++){pixels[yi+3]=pa=asum*mulSum>>>shgSum;if(pa>0){pa=255/pa;pixels[yi]=(rsum*mulSum>>>shgSum)*pa;pixels[yi+1]=(gsum*mulSum>>>shgSum)*pa;pixels[yi+2]=(bsum*mulSum>>>shgSum)*pa}else{pixels[yi]=pixels[yi+1]=pixels[yi+2]=0}if(x==0){vmin[y]=((p=y+rad1)<hm?p:hm)*width;vmax[y]=(p=y-radius)>0?p*width:0}p1=x+vmin[y];p2=x+vmax[y];rsum+=r[p1]-r[p2];gsum+=g[p1]-g[p2];bsum+=b[p1]-b[p2];asum+=a[p1]-a[p2];yi+=width<<2}}}context.putImageData(imageData,topX,topY)}})();(function(root){var asap=typeof setImmediate==="function"&&setImmediate||function(fn){setTimeout(fn,1)};function bind(fn,thisArg){return function(){fn.apply(thisArg,arguments)}}var isArray=Array.isArray||function(value){return Object.prototype.toString.call(value)==="[object Array]"};function Promise(fn){if(typeof this!=="object")throw new TypeError("Promises must be constructed via new");if(typeof fn!=="function")throw new TypeError("not a function");this._state=null;this._value=null;this._deferreds=[];doResolve(fn,bind(resolve,this),bind(reject,this))}function handle(deferred){var me=this;if(this._state===null){this._deferreds.push(deferred);return}asap(function(){var cb=me._state?deferred.onFulfilled:deferred.onRejected;if(cb===null){(me._state?deferred.resolve:deferred.reject)(me._value);return}var ret;try{ret=cb(me._value)}catch(e){deferred.reject(e);return}deferred.resolve(ret)})}function resolve(newValue){try{if(newValue===this)throw new TypeError("A promise cannot be resolved with itself.");if(newValue&&(typeof newValue==="object"||typeof newValue==="function")){var then=newValue.then;if(typeof then==="function"){doResolve(bind(then,newValue),bind(resolve,this),bind(reject,this));return}}this._state=true;this._value=newValue;finale.call(this)}catch(e){reject.call(this,e)}}function reject(newValue){this._state=false;this._value=newValue;finale.call(this)}function finale(){for(var i=0,len=this._deferreds.length;i<len;i++){handle.call(this,this._deferreds[i])}this._deferreds=null}function Handler(onFulfilled,onRejected,resolve,reject){this.onFulfilled=typeof onFulfilled==="function"?onFulfilled:null;this.onRejected=typeof onRejected==="function"?onRejected:null;this.resolve=resolve;this.reject=reject}function doResolve(fn,onFulfilled,onRejected){var done=false;try{fn(function(value){if(done)return;done=true;onFulfilled(value)},function(reason){if(done)return;done=true;onRejected(reason)})}catch(ex){if(done)return;done=true;onRejected(ex)}}Promise.prototype["catch"]=function(onRejected){return this.then(null,onRejected)};Promise.prototype.then=function(onFulfilled,onRejected){var me=this;return new Promise(function(resolve,reject){handle.call(me,new Handler(onFulfilled,onRejected,resolve,reject))})};Promise.all=function(){var args=Array.prototype.slice.call(arguments.length===1&&isArray(arguments[0])?arguments[0]:arguments);return new Promise(function(resolve,reject){if(args.length===0)return resolve([]);var remaining=args.length;function res(i,val){try{if(val&&(typeof val==="object"||typeof val==="function")){var then=val.then;if(typeof then==="function"){then.call(val,function(val){res(i,val)},reject);return}}args[i]=val;if(--remaining===0){resolve(args)}}catch(ex){reject(ex)}}for(var i=0;i<args.length;i++){res(i,args[i])}})};Promise.resolve=function(value){if(value&&typeof value==="object"&&value.constructor===Promise){return value}return new Promise(function(resolve){resolve(value)})};Promise.reject=function(value){return new Promise(function(resolve,reject){reject(value)})};Promise.race=function(values){return new Promise(function(resolve,reject){for(var i=0,len=values.length;i<len;i++){values[i].then(resolve,reject)}})};Promise._setImmediateFn=function _setImmediateFn(fn){asap=fn};if(typeof module!=="undefined"&&module.exports){module.exports=Promise}else if(!root.Promise){root.Promise=Promise}})(window);FV.Util={cssColor:function cssColor(c,opacity){var color;if(_.has(c,"red")){color=[c.red,c.green,c.blue]}else{color=[c[0],c[1],c[2]]}if(opacity){color.push(opacity);return"rgba("+color.join()+")"}return"rgb("+color.join()+")"},addBoundsPadding:function addBoundsPadding(bounds,bufferRatio){var sw=bounds._southWest,ne=bounds._northEast,padding=Math.max(Math.abs(sw.lat-ne.lat),Math.abs(sw.lng-ne.lng))*bufferRatio;return new L.LatLngBounds(new L.LatLng(sw.lat-padding,sw.lng-padding),new L.LatLng(ne.lat+padding,ne.lng+padding))},verifyAttributes:function verifyAttributes(obj,name,attributes){var i=attributes.length,missing=[];while(i--){if(obj[attributes[i]]===undefined){missing.push(attributes[i])}}if(missing.length){throw Error("AttributeError: `"+name+"` is missing the following attributes: ["+missing+"] ")}return true},computeMapBounds:function computeMapBounds(map,bounds,scale,zoom){var epsilon=1e-10,sw=[bounds.x+epsilon,bounds.y],ne=[bounds.x+bounds.width,bounds.y-bounds.height+epsilon];sw=map.unproject(new L.Point(sw[0]*scale,sw[1]*scale),zoom);ne=map.unproject(new L.Point(ne[0]*scale,ne[1]*scale),zoom);return new L.LatLngBounds(sw,ne)},unprojectPoints:function unprojectPoints(points,scale,zoom){var transformation=new L.Transformation(1,0,-1,0);return points.map(function(point){point=new L.Point(point.x*scale,point.y*scale);point=transformation.untransform(point,Math.pow(2,zoom));return[point.y,point.x]})},computeLargestRectangle:function computeLargestRectangle(points){var lr=FV.largestRect(points,{
angle:-90});var cx=lr[0].cy,cy=lr[0].cx,halfWidth=lr[0].width/2,halfHeight=lr[0].height/2;return L.latLngBounds([[cy-halfHeight,cx-halfWidth],[cy+halfHeight,cx+halfWidth]])},noop:function noop(){}};FV.noop=FV.Util.noop;FV.include=function(classObj,props){return _.assign(classObj.prototype,props)};FV.include(CanvasRenderingContext2D,{fvPolygon:function fvPolygon(points){var _this3=this;_.each(points,function(p,index){return _this3[index?"lineTo":"moveTo"](p.x,p.y)});var s=points[0];this.lineTo(s.x,s.y)},_FVfillStroke:function _FVfillStroke(style){this.save();this.globalCompositeOperation="source-over";if(style.fill){this.globalAlpha=style.fillOpacity;this.fillStyle=style.fillColor||style.color;this.fill(style.fillRule||"evenodd")}if(style.stroke&&style.weight!==0){this.globalAlpha=style.opacity;this.lineWidth=style.weight;this.strokeStyle=style.color;this.lineCap=style.lineCap;this.lineJoin=style.lineJoin;if(style.strokeAlign==="inner"){this.save();this.clip();this.lineWidth*=2;this.stroke();this.restore()}else{this.stroke()}}this.restore()},FVfitString:function FVfitString(str,maxWidth){var ellipsis=arguments.length<=2||arguments[2]===undefined?"…":arguments[2];var ellipsisWidth=this.measureText(ellipsis).width;var width=this.measureText(str).width;if(width<=maxWidth||width<=ellipsisWidth){return str}var len=str.length;while(width>=maxWidth-ellipsisWidth&&len-- >0){str=str.substring(0,len);width=this.measureText(str).width}return str+ellipsis}});FV.Room=function(_L$Evented){_inherits(Room,_L$Evented);function Room(map,data){_classCallCheck(this,Room);_L$Evented.call(this);this.options={draggable:false,interactive:true,selected:false};_.assign(this,data);this._map=map;this._layerData={};this._layerHandle={};this._containsPoint=L.Polygon.prototype._containsPoint}Room.prototype.getLayerData=function getLayerData(layer){return this._layerData[L.stamp(layer)]};Room.prototype.getLayerDataByHandle=function getLayerDataByHandle(handle){return this._layerHandle[handle]};Room.prototype.initLayerData=function initLayerData(layer){var id=L.stamp(layer);var data={};this._layerData[id]=data;if(layer.options.handle){this._layerHandle[layer.options.handle]=data}return this._layerData[id]};Room.prototype.removeLayerData=function removeLayerData(layer){var id=L.stamp(layer);if(this._layerData[id]){delete this._layerData[id];if(layer.options.handle){delete this._layerHandle[layer.options.handle]}}return this};Room.prototype.getBounds=function getBounds(){return this._bounds};Room.prototype.getPixelBounds=function getPixelBounds(){return this._pixelBounds};Room.prototype.getClippedPixelBounds=function getClippedPixelBounds(){return this._clippedPixelBounds};Room.prototype.getLargestRectangleBounds=function getLargestRectangleBounds(){return this._largestRectBounds};Room.prototype.getLargestRectanglePixelBounds=function getLargestRectanglePixelBounds(){return this._largestRectPixelBounds};Room.prototype.getPoints=function getPoints(){return this._latlngs};Room.prototype.getPixelPoints=function getPixelPoints(){return this._parts[0]};Room.prototype._postInit=function _postInit(scale,zoom){var points=FV.Util.unprojectPoints(this.metaData.points,scale,zoom);var lrBounds=FV.Util.computeLargestRectangle(points);var bounds=new L.LatLngBounds;var latlngs=[];for(var i=0,len=points.length;i<len;i++){latlngs.push(L.latLng(points[i]));bounds.extend(latlngs[i])}this._bounds=bounds;this._latlngs=latlngs;this._largestRectBounds=lrBounds};Room.prototype._project=function _project(){var map=this._map;this._rings=[];L.Polyline.prototype._projectLatlngs.call(this,this._latlngs,this._rings);var w=L.Browser.touch?10:0;var p=new L.Point(w,-w);var sw=map.latLngToLayerPoint(this._bounds.getSouthWest());var ne=map.latLngToLayerPoint(this._bounds.getNorthEast());this._pxBounds=new L.Bounds(sw._subtract(p),ne._add(p));this._pixelBounds=new L.Bounds(sw,ne);this._largestRectPixelBounds=map.latLngBoundsToLayerBounds(this._largestRectBounds)};Room.prototype._clipPoints=function _clipPoints(){var map=this._map;var w=map.options.roomClipPadding;var p=new L.Point(w,w);var bounds=map.subCanvas._bounds;bounds=new L.Bounds(bounds.min.subtract(p),bounds.max.add(p));this._parts=[];if(!this._pxBounds.intersects(bounds)){return}if(map.options.noClip){this._parts=this._rings;return}for(var i=0,len=this._rings.length,clipped=undefined;i<len;i++){clipped=L.PolyUtil.clipPolygon(this._rings[i],bounds,true);if(clipped.length){this._parts.push(clipped)}}};Room.prototype._simplifyPoints=function _simplifyPoints(){var parts=this._parts;var tolerance=this._map.options.smoothFactor;for(var i=0,len=parts.length;i<len;i++){parts[i]=L.LineUtil.simplify(parts[i],tolerance)}};Room.prototype._clipPixelBounds=function _clipPixelBounds(){var bounds=this._map.subCanvas._bounds;var cb=this._clippedPixelBounds=new L.Bounds(this._pixelBounds.min.clone(),this._pixelBounds.max.clone());cb.min.x=Math.max(cb.min.x,bounds.min.x);cb.min.y=Math.max(cb.min.y,bounds.min.y);cb.max.x=Math.min(cb.max.x,bounds.max.x);cb.max.y=Math.min(cb.max.y,bounds.max.y)};Room.prototype._update=function _update(){this._clipPoints();this._simplifyPoints();this._clipPixelBounds()};Room.prototype._clickTolerance=function _clickTolerance(){return L.Browser.touch?10:0};return Room}(L.Evented);FV.Map=function(_L$Map){_inherits(Map,_L$Map);function Map(id,floor,options){var _this4=this;_classCallCheck(this,Map);var opt=_.assign({extraData:null,centerOn:[],centerBy:"id",centerPadding:.2,select:[],selectBy:"id",ping:0,pingBy:"id",pingOptions:{},roomClipPadding:5,canvasPaddingRatio:.4,noClip:false,smoothFactor:1,crs:L.CRS.Simple,attributionControl:false},options);_L$Map.call(this,id,opt);this._initCanvases();var drawing=floor.drawing;var rooms=floor.rooms;this.floor=floor;this.tileInfo=drawing.tileInfo;this._roomsReady=false;this.roomById={};this.roomByName={};this.rooms=[];this.roomsInView=[];this._subLayers=new FV.OrderedDict;this._overlayLayers=new FV.OrderedDict;this._layerHandles={};this._hasTileLayer=false;this.mapBounds=FV.Util.computeMapBounds(this,drawing.bounds,this.tileInfo.scale,this.tileInfo.maxZoom);this.roomBounds=FV.Util.computeMapBounds(this,drawing.roomBounds,this.tileInfo.scale,this.tileInfo.maxZoom);this._preProcessRoomsData(rooms);this.onRoomsReady=this._processLowPriorityRooms(20);this.on("zoomend",this._projectRooms);this.on("moveend",this._discoverRooms);this.on("zoom",this._updateTransforms);this.on("zoomanim",this._zoomAnim);this.on("viewreset",this._reset);this.on("roomclick",this._roomClick);this.on("click",this._mapClick);this.onRoomsReady.then(function(){if(opt.ping){var room=null;if(opt.pingBy==="name"){room=_this4.roomByName[opt.ping]}else{room=_this4.roomById[opt.ping]}if(room){room._update();_this4.pingRoom(room,opt.pingOptions)}}})}Map.prototype.latLngBoundsToLayerBounds=function latLngBoundsToLayerBounds(latLngBounds){return new L.Bounds(this.latLngToLayerPoint(latLngBounds.getNorthWest()),this.latLngToLayerPoint(latLngBounds.getSouthEast()))};Map.prototype._getCanvasLayers=function _getCanvasLayers(){if(this._hasTileLayer){return this._overlayLayers}return this._subLayers};Map.prototype._getCanvas=function _getCanvas(){if(this._hasTileLayer){return this.overlayCanvas}return this.subCanvas};Map.prototype.addLayer=function addLayer(layer){if(layer.options.handle){this._layerHandles[layer.options.handle]=layer}if(layer instanceof FV.CanvasLayer){var id=L.stamp(layer);var layers=this._getCanvasLayers();if(layers.get(id)){return layer}layers.set(id,layer);layer._mapToAdd=this;layer._canvas=this._getCanvas();if(layer.beforeAdd){layer.beforeAdd(this)}this.whenReady(layer._layerAdd,layer);return this}else if(layer instanceof FV.TileLayer){this._hasTileLayer=true}return L.Map.prototype.addLayer.call(this,layer)};Map.prototype.removeLayer=function removeLayer(layer){if(layer instanceof FV.CanvasLayer){var id=L.stamp(layer);var layers=this._getCanvasLayers(layer);if(!layers.get(id)){return this}if(this._loaded){layer.onRemove(this);if(layer.afterRemove){layer.afterRemove(this)}}if(layer.getAttribution&&this.attributionControl){this.attributionControl.removeAttribution(layer.getAttribution())}if(layer.getEvents){this.off(layer.getEvents(),layer)}layers.remove(id);if(this._loaded){this.fire("layerremove",{layer:layer});layer.fire("remove")}layer._map=null;return this}return L.Map.prototype.removeLayer.call(this,layer)};Map.prototype.hasLayer=function hasLayer(layer){if(layer instanceof FV.CanvasLayer){var id=L.stamp(layer);var layers=this._getCanvasLayers(layer);return layers.get(id)}return!!layer&&L.stamp(layer)in this._layers};Map.prototype.getLayerByHandle=function getLayerByHandle(handle){return this._layerHandles[handle]};Map.prototype.eachSubLayer=function eachSubLayer(method,context){this._subLayers.forEach(method,context)};Map.prototype.eachOverlayLayer=function eachOverlayLayer(method,context){this._overlayLayers.forEach(method,context)};Map.prototype._zoomAnim=function _zoomAnim(e){this.subCanvas._animateZoom(e);this.overlayCanvas._animateZoom(e);this.animationCanvas._animateZoom(e)};Map.prototype._projectRooms=function _projectRooms(){this.rooms.forEach(function(room){return room._project()})};Map.prototype._discoverRooms=function _discoverRooms(){var _this5=this;L.Util.cancelAnimFrame(this._discoverRoomsRequest);this._discoverRoomsRequest=L.Util.requestAnimFrame(function(){console.time("drawing");_this5.subCanvas._update();_this5.overlayCanvas._update();_this5.animationCanvas._update();var bounds=_this5.subCanvas._bounds;_this5.roomsInView=[];_.each(_this5.rooms,function(room){if(room._pxBounds&&room._pxBounds.intersects(bounds)){room._update();_this5.roomsInView.push(room)}});_this5.eachSubLayer(function(layer){layer.draw(_this5.roomsInView,_this5.subCanvas._ctx)});_this5.eachOverlayLayer(function(layer){layer.draw(_this5.roomsInView,_this5.overlayCanvas._ctx)});console.timeEnd("drawing")})};Map.prototype._updateTransforms=function _updateTransforms(){this.subCanvas._updateTransform();this.overlayCanvas._updateTransform();this.animationCanvas._updateTransform()};Map.prototype._reset=function _reset(){this._projectRooms();this._discoverRooms();this._updateTransforms()};Map.prototype._refreshLayers=function _refreshLayers(){var _this6=this;console.time("refreshing");this.subCanvas._update();this.overlayCanvas._update();this.eachSubLayer(function(layer){layer.draw(_this6.roomsInView,_this6.subCanvas._ctx)});this.eachOverlayLayer(function(layer){layer.draw(_this6.roomsInView,_this6.overlayCanvas._ctx)});console.timeEnd("refreshing")};Map.prototype._roomClick=function _roomClick(e){var room=e.room;var onClick=function onClick(layer){if(layer.options.interactive&&layer.onRoomClick){layer.onRoomClick(room,e)}};this._subLayers.forEach(onClick);this._overlayLayers.forEach(onClick)};Map.prototype._mapClick=function _mapClick(e){var room=e.room;var onClick=function onClick(layer){if(layer.options.interactive&&layer.onMapClick){layer.onMapClick(room,e)}};this._subLayers.forEach(onClick);this._overlayLayers.forEach(onClick)};Map.prototype._preProcessRoomsData=function _preProcessRoomsData(rooms){var _this7=this;var opt=this.options;var centerBy=opt.centerBy;var centerOn=opt.centerOn;var ratio=opt.centerPadding;if(!_.isArray(centerOn)){centerOn=[centerOn]}this._highPriority=[];this._lowPriority=[];rooms.forEach(function(room){if(!room.metaData||!room.metaData.points||room.metaData.points.length===0){return null}var obj=new FV.Room(_this7,room);_this7.roomById[room.id]=obj;_this7.roomByName[room.name]=obj;var foundIndex=_.findIndex(centerOn,function(item){return room[centerBy].toString()===item.toString()});if(foundIndex>-1){_this7._highPriority.push(obj)}else{_this7._lowPriority.push(obj)}});var bounds=undefined;if(this._highPriority.length){this._highPriority.forEach(function(room){room._postInit(_this7.tileInfo.scale,_this7.tileInfo.maxZoom);_this7.rooms.push(room)});bounds=this.getEdgeBounds(this.rooms)}else{bounds=this.mapBounds;ratio=0}var size=this.getSize();this.fitBounds(bounds,{padding:[size.x*ratio,size.y*ratio],maxZoom:this.tileInfo.maxZoom});opt.minZoom=this.tileInfo.minZoom;opt.maxZoom=this.tileInfo.maxZoom;this._projectRooms()};Map.prototype._processLowPriorityRooms=function _processLowPriorityRooms(size){var chunks=_.chunk(this._lowPriority,size);var self=this;var opt=this.options;var cursor=chunks.length-1;return new Promise(function(resolve){(function loop(){_.forEach(chunks[cursor],function(room){room._postInit(self.tileInfo.scale,self.tileInfo.maxZoom);self.rooms.push(room)});cursor--;if(cursor>-1){L.Util.requestAnimFrame(loop)}else{self._roomsReady=true;self._projectRooms();self.selectRoom.by(opt.selectBy,opt.select,{skipRefresh:true});resolve({roomById:self.roomById,map:self})}})()})};Map.prototype._initCanvases=function _initCanvases(){var padding=this.options.canvasPaddingRatio;this.subCanvas=new FV.SubCanvas({padding:padding});this.overlayCanvas=new FV.OverlayCanvas({padding:padding});this.animationCanvas=new FV.AnimationCanvas({padding:padding});this.addLayer(this.subCanvas);this.addLayer(this.overlayCanvas);this.addLayer(this.animationCanvas)};Map.prototype._initPanes=function _initPanes(){var panes=this._panes={};this._paneRenderers={};this._mapPane=this.createPane("mapPane",this._container);L.DomUtil.setPosition(this._mapPane,new L.Point(0,0));this.createPane("subPane");this.createPane("tilePane");this.createPane("shadowPane");this.createPane("overlayPane");this.createPane("animationPane");this.createPane("markerPane");this.createPane("popupPane");if(!this.options.markerZoomAnimation){L.DomUtil.addClass(panes.markerPane,"leaflet-zoom-hide");L.DomUtil.addClass(panes.shadowPane,"leaflet-zoom-hide")}};Map.prototype.addDynamicHandler=function addDynamicHandler(name,HandlerClass){if(!HandlerClass){return this}var handler=this[name]=new HandlerClass(this);this._handlers.push(handler);if(this.options[name]&&this.options[name]!=="false"){handler.enable(this.options[name])}return this};return Map}(L.Map);FV.map=function(id,drawing,rooms,options){return new FV.Map(id,drawing,rooms,options)};FV.Map.include({pingRoom:function pingRoom(room){var options=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];L.Util.cancelAnimFrame(this._pingRoomFrame);var canvas=this.animationCanvas._container;var ctx=this.animationCanvas._ctx;var start=Date.now();var duration=options.duration?1e3*options.duration:1e3*8;var pulses=(options.pulses?options.pulses:3)/2;var screenRatio=options.screenRatio?options.screenRatio:1/3;var color=options.color?options.color.join():"255,0,0";ctx.save();ctx.lineWidth=5;ctx.lineCap="round";ctx.lineJoin="round";function easeOut(t){return 1-Math.pow(1-t,2)}function scalePoints(points,scale,center){return _.map(points,function(point){return point.subtract(center).multiplyBy(scale).add(center)})}function frame(){if(ctx.lineWidth!==5){ctx.lineWidth=5;ctx.lineCap="round";ctx.lineJoin="round"}var t=(Date.now()-start)/duration;var s=easeOut(t);var bounds=room.getClippedPixelBounds();var center=bounds.getCenter();var size=bounds.getSize();var roomSize=Math.max(size.x,size.y);var b=this.animationCanvas._bounds;var bSize=b.getSize();var screenSize=Math.max(bSize.x,bSize.y)*screenRatio;var targetScale=screenSize/roomSize;if(t<=1){this._pingRoomFrame=L.Util.requestAnimFrame(frame,this);var amp=targetScale/2;var per=pulses*2*Math.PI*s;var ref=amp*Math.cos(per);var increasing=Math.sin(per)>0;var alpha=amp-ref;var beta=amp+ref;var scale=increasing?alpha:beta;var invScale=increasing?beta:alpha;var points=scalePoints(room.getPixelPoints(),scale+1,center);ctx.clearRect(b.min.x,b.min.y,canvas.width,canvas.height);ctx.fillStyle="rgba("+color+","+.2*invScale/targetScale+")";ctx.strokeStyle="rgba("+color+","+.7*invScale/targetScale+")";ctx.beginPath();ctx.fvPolygon(points);ctx.fill();ctx.stroke();ctx.closePath()}else{ctx.clearRect(b.min.x,b.min.y,canvas.width,canvas.height);ctx.restore()}}frame.call(this)}});FV.Map.include({getEdgeBounds:function getEdgeBounds(rooms){var options=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];var mapBounds=this.roomBounds;var mapHeight=mapBounds.getNorth()-mapBounds.getSouth();var mapWidth=mapBounds.getEast()-mapBounds.getWest();var ele=this._container;var eleBounds=ele.getBoundingClientRect();var aspectRatio=eleBounds.width/eleBounds.height;var bounds=new L.LatLngBounds;_.each(rooms,function(room){return bounds.extend(room._bounds)});var vDistN=mapBounds.getNorth()-bounds.getNorth();var vDistS=bounds.getSouth()-mapBounds.getSouth();var hDistE=mapBounds.getEast()-bounds.getEast();var hDistW=bounds.getWest()-mapBounds.getWest();var sw=bounds.getSouthWest();var ne=bounds.getNorthEast();var minRatio=options.minRatio||[1/3,1/3];var mapSize=[mapBounds.getEast()-mapBounds.getWest(),mapBounds.getNorth()-mapBounds.getSouth()];var min=[mapSize[0]*minRatio[0],mapSize[1]*minRatio[1]];var padding=options.padding||.25;if(!_.isArray(padding)){padding=[padding,padding]}var half="south";var quadrant=0;if(vDistN<vDistS){ne.lat+=vDistN;sw.lat-=vDistN*padding[1];if(sw.lat>mapBounds.getNorth()-min[1]){sw.lat=mapBounds.getNorth()-min[1]}half="top"}else{ne.lat+=vDistS*padding[1];sw.lat-=vDistS;if(ne.lat<mapBounds.getSouth()+min[1]){ne.lat=mapBounds.getSouth()+min[1]}}if(hDistW<hDistE){ne.lng+=hDistW*padding[0];sw.lng-=hDistW;if(ne.lng<mapBounds.getWest()+min[0]){ne.lng=mapBounds.getWest()+min[0]}quadrant=half==="top"?2:3}else{ne.lng+=hDistE;sw.lng-=hDistE*padding[0];if(sw.lng>mapBounds.getEast()-min[0]){sw.lng=mapBounds.getEast()-min[0]}quadrant=half==="top"?1:4}if(!aspectRatio){return bounds}var width=bounds.getEast()-bounds.getWest();var height=bounds.getNorth()-bounds.getSouth();var vertical=Math.min(width/aspectRatio,mapHeight)-height;var horizontal=Math.min(height*aspectRatio,mapWidth)-width;if(quadrant===1){if(vertical>horizontal){sw.lat-=vertical}else{sw.lng-=horizontal}}else if(quadrant===2){if(vertical>horizontal){sw.lat-=vertical}else{ne.lng+=horizontal}}else if(quadrant===3){if(vertical>horizontal){ne.lat+=vertical}else{ne.lng+=horizontal}}else if(quadrant===4){if(vertical>horizontal){ne.lat+=vertical}else{sw.lng-=horizontal}}else{throw Error("invalid quadrant: ",quadrant)}return bounds}});FV.Map.include({toDataURL:function toDataURL(options){var _this8=this;options=options||{};var dWidth=options.width||this.subCanvas._container.width;var dHeight=options.height||this.subCanvas._container.height;var b=this.subCanvas._bounds,copyCanvas=document.createElement("canvas"),size=b.getSize(),m=L.Browser.retina?2:1;copyCanvas.width=m*size.x;copyCanvas.height=m*size.y;copyCanvas.style.width=size.x+"px";copyCanvas.style.height=size.y+"px";var copyCanvasCtx=copyCanvas.getContext("2d");if(L.Browser.retina){copyCanvasCtx.scale(2,2)}copyCanvasCtx.translate(-b.min.x,-b.min.y);this.eachSubLayer(function(layer){layer.draw(_this8.roomsInView,copyCanvasCtx)});var tileLayer=this.getLayerByHandle("tile");_.forOwn(tileLayer._tiles,function(tile){var tileBounds=tileLayer._tileCoordsToBounds(tile.coords);var pxBounds=new L.Bounds(_this8.latLngToLayerPoint(tileBounds.getSouthWest()),_this8.latLngToLayerPoint(tileBounds.getNorthEast()));var tileSize=tileLayer.getTileSize();var imageObj=new Image;imageObj.setAttribute("crossOrigin","anonymous");imageObj.src=tile.el.currentSrc;imageObj.onload=function(){var imageWidth=pxBounds.max.x-pxBounds.min.x,imageHeight=pxBounds.max.y-pxBounds.min.y}});this.eachOverlayLayer(function(layer){layer.draw(_this8.roomsInView,copyCanvasCtx)});var canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");canvas.width=dWidth;canvas.height=dHeight;ctx.drawImage(copyCanvas,0,0,dWidth,dHeight);return canvas.toDataURL()}});FV.Map.include({panToRoom:function panToRoom(room,options){return this.panTo(room.getLargestRectangleBounds().getCenter(),options)},flyToRoom:function flyToRoom(room,options){var opt=_.assign({animate:true,maxZoom:this.tileInfo.maxZoom,padding:[10,10]},options);return this.flyToBounds(room.getBounds(),opt)},goToRoom:function goToRoom(room,options){var opt=_.assign({animate:true,maxZoom:this.tileInfo.maxZoom,padding:[10,10]},options);return this.fitBounds(room.getBounds(),opt)}});FV.Map.mergeOptions({searchRoom:true});FV.Map.SearchRoom=function(_L$Handler){_inherits(SearchRoom,_L$Handler);function SearchRoom(map){_classCallCheck(this,SearchRoom);_L$Handler.call(this,map);this._rooms=[]}SearchRoom.prototype.enable=function enable(){_L$Handler.prototype.enable.call(this)};SearchRoom.prototype.disable=function disable(){_L$Handler.prototype.disable.call(this)};SearchRoom.prototype.addHooks=function addHooks(){};SearchRoom.prototype.removeHooks=function removeHooks(){};SearchRoom.prototype.getRooms=function getRooms(){return this._rooms};SearchRoom.prototype.inList=function inList(room){return this._rooms.indexOf(room)>-1};SearchRoom.prototype.by=function by(prop,roomsArg,options){var map=this._map;var rooms=roomsArg;if(!_.isArray(rooms)){rooms=[rooms]}if(rooms.length){this._rooms=_.filter(map.rooms,function(room){var index=_.findIndex(rooms,function(item){return item.toString()===room[prop].toString()});return index>-1})}else{this._rooms=[]}this._executeOptions(options);return this._rooms};SearchRoom.prototype.byName=function byName(rooms,options){return this.by("name",rooms,options)};SearchRoom.prototype.byId=function byId(rooms,options){return this.by("id",rooms,options)};SearchRoom.prototype._executeOptions=function _executeOptions(){var options=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];var rooms=this._rooms;var map=this._map;var bounds=null;var ratio=0;if(options.zoom==="to"||options.zoom==="fly"){bounds=new L.LatLngBounds;_.each(rooms,function(room){return bounds.extend(room._bounds)});ratio=map.options.centerPadding}else if(options.zoom==="expand"){bounds=map.getBounds();_.each(rooms,function(room){return bounds.extend(room._bounds)})}else if(options.zoom==="pivot"){var selectedRooms=map.selectRoom.getRooms();if(selectedRooms.length){bounds=new L.LatLngBounds;_.each(selectedRooms,function(room){return bounds.extend(room._bounds)})}else{bounds=map.getBounds()}_.each(rooms,function(room){return bounds.extend(room._bounds)});ratio=map.options.centerPadding}else if(options.zoom==="edge"){bounds=map.getEdgeBounds(rooms,options);ratio=options.padding||.1}if(bounds&&rooms.length){var size=map.getSize();var method=options.zoom==="fly"?"flyToBounds":"fitBounds";map[method](bounds,_.assign({animate:true,padding:[size.x*ratio,size.y*ratio],minZoom:map.tileInfo.minZoom,maxZoom:map.tileInfo.maxZoom},options))}else if(!options.skipRefresh){map._refreshLayers()}};return SearchRoom}(L.Handler);FV.Map.addInitHook("addHandler","searchRoom",FV.Map.SearchRoom);FV.Map.mergeOptions({selectMode:false,selectRoom:"single"});FV.Map.SelectRoom=function(_L$Handler2){_inherits(SelectRoom,_L$Handler2);function SelectRoom(map){_classCallCheck(this,SelectRoom);_L$Handler2.call(this,map);this._rooms=[];this._singleMode=false;this._holdShift=false;this._atLeastOne=false;this._flags={_holdShift:"hold-shift",_atLeastOne:"at-least-one"}}SelectRoom.prototype.enable=function enable(){var mode_=arguments.length<=0||arguments[0]===undefined?"single":arguments[0];var parts=mode_.split(",");var mode=parts[0];if(mode==="false"){return this.disable()}this._map.options.selectRoom=mode;this._singleMode=mode!=="multi";this._setFlags(parts);_L$Handler2.prototype.enable.call(this)};SelectRoom.prototype.setFlags=function setFlags(flags){var parts=flags.split(",");this._setFlags(parts)};SelectRoom.prototype._setFlags=function _setFlags(parts){var _this9=this;_.each(parts,function(flag){_.each(_this9._flags,function(flagStr,prop){if(flagStr===flag){_this9[prop]=true}else if("!"+flagStr===flag){_this9[prop]=false}})})};SelectRoom.prototype.disable=function disable(){this._map.options.selectRoom="false";_L$Handler2.prototype.disable.call(this)};SelectRoom.prototype.addHooks=function addHooks(){this._map.on("click",this.onMapClick,this)};SelectRoom.prototype.removeHooks=function removeHooks(){this._map.off("click",this.onMapClick,this)};SelectRoom.prototype.getRooms=function getRooms(){return this._rooms};SelectRoom.prototype.isSelected=function isSelected(room){return this._rooms.indexOf(room)>-1};SelectRoom.prototype.by=function by(prop,rooms_,options){var map=this._map;var rooms=rooms_;if(!_.isArray(rooms)){if(!rooms){rooms=[]}else{rooms=[rooms]}}if(rooms.length){this._rooms=_.filter(map.rooms,function(room){var index=_.findIndex(rooms,function(item){return item.toString()===room[prop].toString()});room.options.selected=index>-1;return room.options.selected});this._map.options.selectMode=true}else{_.each(this._rooms,function(selectedRoom){selectedRoom.options.selected=false});this._rooms=[];this._map.options.selectMode=false}this._executeOptions(options);return this._rooms};SelectRoom.prototype.byName=function byName(rooms,options){return this.by("name",rooms,options)};SelectRoom.prototype.byId=function byId(rooms,options){return this.by("id",rooms,options)};SelectRoom.prototype.onMapClick=function onMapClick(e){var shiftKey=e.originalEvent.shiftKey;var room=e.room;var map=this._map;if(this._holdShift){shiftKey=true}if(this.isSelected(room)){if(!this._singleMode&&shiftKey){room.options.selected=false;_.remove(this._rooms,function(selectedRoom){return selectedRoom===room});map.options.selectMode=!!this._rooms.length;map._refreshLayers()}else if(this._rooms.length>1){_.each(this._rooms,function(selectedRoom){selectedRoom.options.selected=false});this._rooms=[room];room.options.selected=true;map._refreshLayers()}return}if(!room||!room.options.interactive){if(this._rooms.length&&(!shiftKey||this._singleMode)){_.each(this._rooms,function(selectedRoom){selectedRoom.options.selected=false});if(this._atLeastOne){var size=this._rooms.length;this._rooms=[this._rooms[size-1]];this._rooms[0].options.selected=true;map.options.selectMode=true}else{this._rooms=[];map.options.selectMode=false}map._refreshLayers()}return}if(this._singleMode||!shiftKey){_.each(this._rooms,function(selectedRoom){selectedRoom.options.selected=false})}room.options.selected=true;if(!this._singleMode&&shiftKey){this._rooms.push(room)}else{this._rooms=[room]}map.options.selectMode=true;map._refreshLayers()};SelectRoom.prototype._executeOptions=function _executeOptions(){var options=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];var rooms=this._rooms;var map=this._map;var bounds=null;var ratio=0;if(options.zoom==="to"||options.zoom==="fly"){bounds=new L.LatLngBounds;_.each(rooms,function(room){return bounds.extend(room._bounds)});ratio=map.options.centerPadding}else if(options.zoom==="expand"){bounds=map.getBounds();_.each(rooms,function(room){return bounds.extend(room._bounds)})}else if(options.zoom==="edge"){bounds=map.getEdgeBounds(rooms,options);ratio=options.padding||.1}if(bounds&&rooms.length){var size=map.getSize();var method=options.zoom==="fly"?"flyToBounds":"fitBounds";map[method](bounds,_.assign({animate:true,padding:[size.x*ratio,size.y*ratio],minZoom:map.tileInfo.minZoom,maxZoom:map.tileInfo.maxZoom},options))}else if(!options.skipRefresh){map._refreshLayers()}};return SelectRoom}(L.Handler);FV.Map.addInitHook("addDynamicHandler","selectRoom",FV.Map.SelectRoom);FV.Map.mergeOptions({viewBounds:.8});FV.Map.ViewBounds=function(_L$Handler3){_inherits(ViewBounds,_L$Handler3);function ViewBounds(map){_classCallCheck(this,ViewBounds);_L$Handler3.call(this,map)}ViewBounds.prototype.enable=function enable(){var padding=arguments.length<=0||arguments[0]===undefined?.5:arguments[0];if(padding===null){return this.disable()}this._map.options.viewBounds=padding;if(this._map.getZoom()){this.setMapViewBounds()}_L$Handler3.prototype.enable.call(this)};ViewBounds.prototype.disable=function disable(){this._map.options.viewBounds=null;this._map.setMaxBounds(null);this._map.options.maxBounds=null;_L$Handler3.prototype.disable.call(this)};ViewBounds.prototype.addHooks=function addHooks(){this._map.on("zoomend",this.setMapViewBounds,this)};ViewBounds.prototype.removeHooks=function removeHooks(){this._map.off("zoomend",this.setMapViewBounds,this)};ViewBounds.prototype.setMapViewBounds=function setMapViewBounds(){var map=this._map;var bounds=map.getBounds();var viewWidth=bounds.getEast()-bounds.getWest();var viewHeight=bounds.getNorth()-bounds.getSouth();var ratioX=map.options.viewBounds;var ratioY=ratioX;var pixel=map.unproject(new L.Point(1,1),map.getZoom());pixel=pixel.lng;if(_.isArray(ratioX)){ratioX=ratioX[0];ratioY=ratioY[1]}var sw=map.mapBounds._southWest;var ne=map.mapBounds._northEast;var mapWidth=ne.lng-sw.lng;var mapHeight=ne.lat-sw.lat;var paddingWidth=viewWidth*ratioX;var paddingHeight=viewHeight*ratioY;var newMapWidth=mapWidth+paddingWidth*2;var newMapHeight=mapHeight+paddingHeight*2;if(newMapWidth<viewWidth){paddingWidth+=(viewWidth-newMapWidth)/2+pixel}if(newMapHeight<viewHeight){paddingHeight+=(viewHeight-newMapHeight)/2+pixel}var newBounds=new L.LatLngBounds(new L.LatLng(sw.lat-paddingHeight,sw.lng-paddingWidth),new L.LatLng(ne.lat+paddingHeight,ne.lng+paddingWidth));map.setMaxBounds(newBounds)};return ViewBounds}(L.Handler);FV.Map.addInitHook("addDynamicHandler","viewBounds",FV.Map.ViewBounds);FV.AnimationCanvas=function(_L$Canvas){_inherits(AnimationCanvas,_L$Canvas);function AnimationCanvas(options){_classCallCheck(this,AnimationCanvas);options=_.assign({pane:"animationPane"},options);_L$Canvas.call(this,options);this.getEvents=null}AnimationCanvas.prototype.onAdd=function onAdd(){L.Renderer.prototype.onAdd.call(this)};AnimationCanvas.prototype._onClick=function _onClick(e){var map=this._map,point=map.mouseEventToLayerPoint(e),rooms=map.roomsInView,index=_.findIndex(rooms,function(room){return room._containsPoint(point)}),room=index>-1?rooms[index]:null;L.DomEvent._fakeStop(e);if((e.type==="click"||e.type==="preclick")&&!e._simulated&&map._draggableMoved(map)){return}var data={originalEvent:e,room:room,layerData:null};if(room){data.layerData=room._layerHandle}if(e.type!=="keypress"){data.containerPoint=map.mouseEventToContainerPoint(e);data.layerPoint=map.containerPointToLayerPoint(data.containerPoint);data.latlng=map.layerPointToLatLng(data.layerPoint)}map.fire(e.type,data);if(room&&room.options.interactive){map.fire("room"+e.type,data)}};AnimationCanvas.prototype._onMouseMove=function _onMouseMove(e){if(!this._map||this._map.dragging._draggable&&this._map.dragging._draggable._moving||this._map._animatingZoom){return}var point=this._map.mouseEventToLayerPoint(e);this._handleMouseOut(e,point);this._handleMouseHover(e,point)};AnimationCanvas.prototype._handleMouseOut=function _handleMouseOut(e,point){var room=this._hoveredRoom;if(room&&(e.type==="mouseout"||!room._containsPoint(point))){L.DomUtil.removeClass(this._container,"leaflet-interactive");this._hoveredRoom=null}};AnimationCanvas.prototype._handleMouseHover=function _handleMouseHover(e,point){if(!this._hoveredRoom){var rooms=this._map.roomsInView,index=_.findIndex(rooms,function(room){return room._containsPoint(point)});if(index>-1&&rooms[index].options.interactive){var room=rooms[index];L.DomUtil.addClass(this._container,"leaflet-interactive");this._hoveredRoom=room}}if(this._hoveredRoom){}};return AnimationCanvas}(L.Canvas);FV.CanvasLayer=function(_L$Layer){_inherits(CanvasLayer,_L$Layer);function CanvasLayer(options){_classCallCheck(this,CanvasLayer);options=_.assign({interactive:false,handle:null},options);_L$Layer.call(this);L.setOptions(this,options);L.stamp(this);this.roomById={};this._assignDataCallsCount=0}CanvasLayer.prototype.addTo=function addTo(map){map.addLayer(this);return this};CanvasLayer.prototype.removeFrom=function removeFrom(map){map.removeLayer(this);return this};CanvasLayer.prototype.getCanvas=function getCanvas(){return this._canvas};CanvasLayer.prototype.getLayerRoomData=function getLayerRoomData(roomId){if(!this.roomById[roomId]){this.roomById[roomId]={};if(this.initLayerRoomData){_.assign(this.roomById[roomId],this.initLayerRoomData())}}return this.roomById[roomId];
};CanvasLayer.prototype.assignData=function assignData(){var _this10=this;this._assignDataCallsCount+=1;this._map.rooms.forEach(function(room){var roomData=room.getLayerData(_this10);var layerData=_this10.roomById[room.id];if(layerData){_.assign(roomData,layerData)}if(_this10.onDataAssign){_this10.onDataAssign(roomData,room)}});this.fire("dataassigned");this._map._discoverRooms()};CanvasLayer.prototype.initRoom=function initRoom(room){var roomData=room.initLayerData(this);if(this.initLayerRoomData){_.assign(roomData,this.initLayerRoomData(room))}var layerData=this.roomById[room.id];if(layerData){_.assign(roomData,layerData)}};CanvasLayer.prototype.resetData=function resetData(){var _this11=this;if(this.initLayerRoomData){_.forOwn(this.roomById,function(room){_.assign(room,_this11.initLayerRoomData())})}};CanvasLayer.prototype.clearData=function clearData(){this.roomsById={}};CanvasLayer.prototype.onAdd=function onAdd(map){var _this12=this;if(map._roomsReady){_.each(map.rooms,this.initRoom.bind(this));this.assignData()}else{if(map._highPriority.length){_.each(map._highPriority,this.initRoom.bind(this));map._discoverRooms()}map.onRoomsReady.then(function(){_.each(map._lowPriority,_this12.initRoom.bind(_this12));_this12.assignData()})}};CanvasLayer.prototype.onRemove=function onRemove(map){var _this13=this;map.onRoomsReady.then(function(){_.each(map.rooms,function(room){return room.removeLayerData(_this13)});map._discoverRooms()})};CanvasLayer.prototype._layerAdd=function _layerAdd(e){var map=e.target;if(!map.hasLayer(this)){return}this._map=map;this.onAdd(map);if(this.getAttribution&&this._map.attributionControl){this._map.attributionControl.addAttribution(this.getAttribution())}if(this.getEvents){map.on(this.getEvents(),this)}this.fire("add");map.fire("layeradd",{layer:this})};CanvasLayer.prototype.createStyles=function createStyles(obj,base){var _this14=this;base=base||{fill:true,stroke:true,weight:0,color:"#000",fillColor:"lightgray",fillOpacity:1,lineJoin:"miter",strokeAlign:"inner"};this.styles={};_.each(obj,function(val,name){_this14.styles[name]=_.assign({},base,val)})};CanvasLayer.prototype.createSubStyles=function createSubStyles(data,map){var _this15=this;map=map||{S:{stroke:true,weight:4},N:{fillOpacity:.5}};_.each(data,function(val,name){_.each(val,function(obj,status){_this15.styles[name+"-"+status]=_.assign({},_this15.styles[name],map[status],obj)})})};return CanvasLayer}(L.Layer);FV.OverlayCanvas=function(_L$Canvas2){_inherits(OverlayCanvas,_L$Canvas2);function OverlayCanvas(options){_classCallCheck(this,OverlayCanvas);options=_.assign({pane:"overlayPane"},options);_L$Canvas2.call(this,options);this.getEvents=null}OverlayCanvas.prototype.onAdd=function onAdd(){L.Renderer.prototype.onAdd.call(this)};OverlayCanvas.prototype._initContainer=function _initContainer(){this._container=document.createElement("canvas");this._ctx=this._container.getContext("2d")};return OverlayCanvas}(L.Canvas);FV.SubCanvas=function(_L$Canvas3){_inherits(SubCanvas,_L$Canvas3);function SubCanvas(options){_classCallCheck(this,SubCanvas);options=_.assign({pane:"subPane"},options);_L$Canvas3.call(this,options);this.getEvents=null}SubCanvas.prototype.onAdd=function onAdd(){L.Renderer.prototype.onAdd.call(this)};SubCanvas.prototype._initContainer=function _initContainer(){this._container=document.createElement("canvas");this._ctx=this._container.getContext("2d")};return SubCanvas}(L.Canvas);FV.MailLayer=function(_FV$CanvasLayer){_inherits(MailLayer,_FV$CanvasLayer);function MailLayer(options){var _this16=this;_classCallCheck(this,MailLayer);var purple=["#5E4085","#513874","#432E5F","#36254C"];options=_.assign({handle:"mail",labelSizes:[8,11,14,17,20],fontName:["Arial","Arial"],fillStyle:["rgba(221,221,221,0.3)",purple[3]],strokeStyle:["rgba(100,100,100,1)","rgba(255,255,255,1)"],textStrokeStyle:["rgba(200,200,200,1)","rgba(255,255,255,1)"]},options);_FV$CanvasLayer.call(this,options);this.purpleScale=["#D1C4E9","#B39DDB","#9575CD","#7E57C2","#673AB7","#5E35B1","#512DA8","#4527A0","#311B92"];this.styles={noMail:{fill:true,fillOpacity:.7,fillColor:"#EDE7F6",color:"#EDE7F6",weight:1,stroke:true,strokeAlign:"inner"},withMail:{fill:true,fillOpacity:1,fillColor:"#DDD",color:"#DDD",weight:1,stroke:true,strokeAlign:"inner"},selected:{fill:true,fillOpacity:1,fillColor:purple[0],color:"rgb(0,0,0)",weight:5,stroke:true,strokeAlign:"inner"}};_.each(this.purpleScale,function(purple,index){_this16.styles["withMail"+index]={fill:true,fillOpacity:1,fillColor:purple,color:purple,weight:1,stroke:true}});this._totalMailItems=0;this._maxMailItemsPerRoom=0}MailLayer.prototype.getStyles=function getStyles(){return this.styles};MailLayer.prototype.getStyleKey=function getStyleKey(room){var roomData=room.getLayerData(this),ratio=roomData.mailItems.length/this._maxMailItemsPerRoom,index=Math.floor(ratio*this.purpleScale.length);if(!room.options.interactive){return"noMail"}if(room.options.selected){return"selected"}if(roomData.mailItems.length){if(ratio==1){index-=1}return"withMail"+index}else{return"noMail"}};MailLayer.prototype.initLayerRoomData=function initLayerRoomData(){return{mailItems:[]}};MailLayer.prototype.addData=function addData(data){var _this17=this;_.forEach(data,function(mail){var roomId=mail.toUser.room.id,layerRoomData=_this17.getLayerRoomData(roomId);Array.prototype.push.apply(layerRoomData.mailItems,mail.items);_this17._totalMailItems+=layerRoomData.mailItems.length;_this17._maxMailItemsPerRoom=Math.max(_this17._maxMailItemsPerRoom,layerRoomData.mailItems.length)});return this};MailLayer.prototype.onDataAssign=function onDataAssign(roomData,room){room.options.interactive=!!roomData.mailItems.length};MailLayer.prototype.draw=function draw(roomsInView,ctx){var _this18=this;ctx.save();_.each(roomsInView,function(room){var roomData=room.getLayerData(_this18);_this18.drawOnRoom(roomData,ctx,room)});ctx.restore()};MailLayer.prototype.drawOnRoom=function drawOnRoom(roomData,ctx,room){var itemsLength=roomData.mailItems.length;if(itemsLength<1||room.users.length<1){return}var opt=this.options,lr,xPos,yPos,lrWidth,lrHeight,xPadding,yPadding,label,radius,roomLabelHeight,mailPadding=10;lr=room._lr;xPos=lr.center[0];yPos=lr.center[1];lrWidth=lr.dim[0];lrHeight=lr.dim[1];xPadding=Math.min(10,lrWidth*.1);yPadding=Math.min(10,lrHeight*.1);lrWidth-=xPadding*2;lrHeight-=yPadding*2;var selected=room.options.selected;label=this._labelDim(itemsLength,ctx,[lrWidth,lrHeight],selected);if(label){ctx.textAlign="center";ctx.textBaseline="middle";radius=(lrWidth<lrHeight?lrWidth:lrHeight)/2*.8;radius=label[1]<radius?label[1]:radius;roomLabelHeight=2*radius+mailPadding+radius*.8;if(lrHeight>roomLabelHeight){yPos=yPos-roomLabelHeight/2+radius;this._drawNumberOfItems(ctx,itemsLength,xPos,yPos,radius,selected);ctx.font=""+radius*.8+"px Arial";yPos=yPos+radius+mailPadding+radius*.8/2;ctx.fillStyle=opt.textStrokeStyle[selected?1:0];ctx.fillText(ctx.FVfitString(room.name,lrWidth),xPos,yPos)}else{this._drawNumberOfItems(ctx,itemsLength,xPos,yPos,radius,selected)}}};MailLayer.prototype._drawNumberOfItems=function _drawNumberOfItems(ctx,number,cx,cy,radius,selected){var opt=this.options;var status=selected?1:0;ctx.fillStyle=opt.fillStyle[status];ctx.beginPath();ctx.arc(cx,cy,radius,0,2*Math.PI);ctx.fill();ctx.font=""+radius+"px "+opt.fontName[status];ctx.fillStyle=opt.textStrokeStyle[status];ctx.fillText(number.toString(),cx,cy)};MailLayer.prototype._setUserLabelStyle=function _setUserLabelStyle(ctx,room,labelInfo){ctx.font=""+labelInfo[1]/2+"px "+this.options.fontName};MailLayer.prototype._labelDim=function _labelDim(text,ctxt,bounds,selected){var opt=this.options,width,height,validWidth=null,validHeight=null,labelSizes=opt.labelSizes,i=0,len=labelSizes.length;while(i<len){height=labelSizes[i];ctxt.font=""+height+"px "+opt.fontName[selected?1:0];width=ctxt.measureText(text).width;if(width<bounds[0]&&height<bounds[1]){validWidth=width;validHeight=height;++i}else{break}}if(validWidth!==null){ctxt.font=""+validHeight+"px "+opt.fontName[selected?1:0];return[validWidth,validHeight]}};return MailLayer}(FV.CanvasLayer);FV.OccupancyLayer=function(_FV$CanvasLayer2){_inherits(OccupancyLayer,_FV$CanvasLayer2);function OccupancyLayer(){var options=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];_classCallCheck(this,OccupancyLayer);var opt=_.assign({handle:"occupancy"},options);_FV$CanvasLayer2.call(this,opt);this._computeStyles()}OccupancyLayer.prototype.initLayerRoomData=function initLayerRoomData(){return{reservable:null,occupiable:null,capacity:0}};OccupancyLayer.prototype.addData=function addData(data){var _this19=this;_.forEach(data.rooms,function(room){var roomData=_this19.getLayerRoomData(room.id);roomData.reservable=room.reservable;roomData.occupiable=room.type.occupiable;roomData.capacity=room.capacity});return this};OccupancyLayer.prototype.onDataAssign=function onDataAssign(roomData,room){room.options.interactive=roomData.occupiable};OccupancyLayer.prototype.draw=function draw(){};OccupancyLayer.prototype.getStyles=function getStyles(){return this.styles};OccupancyLayer.prototype.getStyleKey=function getStyleKey(room){var roomData=room.getLayerData(this);var info="";if(this._map.options.selectMode){info+=room.options.selected?"-S":"-N"}if(!roomData.occupiable){return"disabled"+info}if(room.users.length){return"inUse"+info}return"vacant"+info};OccupancyLayer.prototype._computeStyles=function _computeStyles(){this.createStyles({disabled:{fillOpacity:.3},inUse:{fillColor:"#80C680"},vacant:{fillColor:"#FFF"}});this.createSubStyles({disabled:{S:{fillOpacity:.5},N:{fillOpacity:.1}},vacant:{S:{},N:{}},inUse:{S:{},N:{}}})};return OccupancyLayer}(FV.CanvasLayer);FV.ReservationsLayer=function(_FV$CanvasLayer3){_inherits(ReservationsLayer,_FV$CanvasLayer3);function ReservationsLayer(options){_classCallCheck(this,ReservationsLayer);options=_.assign({handle:"reservations"},options);_FV$CanvasLayer3.call(this,options);this._computeStyles()}ReservationsLayer.prototype.initLayerRoomData=function initLayerRoomData(){return{reservable:null,occupiable:null,capacity:0,reservations:null}};ReservationsLayer.prototype.addData=function addData(data){var _this20=this;_.forEach(data.rooms,function(room){var roomData=_this20.getLayerRoomData(room.id);roomData.reservable=room.reservable;roomData.occupiable=room.type.occupiable;roomData.capacity=room.capacity;roomData.reservations=room.anonymousReservations});return this};ReservationsLayer.prototype.onDataAssign=function onDataAssign(roomData,room){room.options.interactive=roomData.reservable};ReservationsLayer.prototype.draw=function draw(){};ReservationsLayer.prototype.getStyles=function getStyles(){return this.styles};ReservationsLayer.prototype.getStyleKey=function getStyleKey(room){var roomData=room.getLayerData(this);var info="";if(this._map.options.selectMode){info+=room.options.selected?"-S":"-N"}if(!roomData.reservable){return"disabled"+info}if(!roomData.reservations.length){return"vacant"+info}if(!roomData.occupiable){return"atCapacity"+info}var total=0;_.each(roomData.reservations,function(reservation){total+=reservation.numberOfPeople});if(total==roomData.capacity){return"atCapacity"+info}return"atCapacity"+info};ReservationsLayer.prototype._computeStyles=function _computeStyles(){this.createStyles({disabled:{fillOpacity:.3},atCapacity:{fillColor:"#D32F2F"},reservable:{fillColor:"#FFB74D"},vacant:{fillColor:"#80C680"}});this.createSubStyles({disabled:{S:{fillOpacity:.5},N:{fillOpacity:.1}},vacant:{S:{},N:{}},atCapacity:{S:{},N:{}},reservable:{S:{},N:{}}})};return ReservationsLayer}(FV.CanvasLayer);FV.RoomAssignmentLayer=function(_FV$CanvasLayer4){_inherits(RoomAssignmentLayer,_FV$CanvasLayer4);function RoomAssignmentLayer(options){_classCallCheck(this,RoomAssignmentLayer);options=_.assign({handle:"roomassignment"},options);_FV$CanvasLayer4.call(this,options);this._computeStyles()}RoomAssignmentLayer.prototype.initLayerRoomData=function initLayerRoomData(){return{reservable:null,occupiable:null,capacity:0}};RoomAssignmentLayer.prototype.addData=function addData(data){var _this21=this;_.forEach(data.rooms,function(room){var roomData=_this21.getLayerRoomData(room.id);roomData.reservable=room.reservable;roomData.occupiable=room.type.occupiable;roomData.capacity=room.capacity});return this};RoomAssignmentLayer.prototype.onDataAssign=function onDataAssign(roomData,room){room.options.interactive=roomData.occupiable};RoomAssignmentLayer.prototype.draw=function draw(){};RoomAssignmentLayer.prototype.getStyles=function getStyles(){return this.styles};RoomAssignmentLayer.prototype.getStyleKey=function getStyleKey(room){var roomData=room.getLayerData(this);var info="";if(this._map.options.selectMode){info+=room.options.selected?"-S":"-N"}if(!roomData.occupiable){return"disabled"+info}if(room.users.length){if(room.users.length>=roomData.capacity){return"atCapacity"+info}else{return"inUse"+info}}return"vacant"+info};RoomAssignmentLayer.prototype._computeStyles=function _computeStyles(){this.createStyles({disabled:{fillOpacity:.3},atCapacity:{fillColor:"#f44336"},inUse:{fillColor:"#4CAF50"},vacant:{fillColor:"#90CAF9"}});this.createSubStyles({disabled:{S:{fillOpacity:.5},N:{fillOpacity:.1}},vacant:{S:{},N:{}},atCapacity:{S:{},N:{}},inUse:{S:{},N:{}}})};return RoomAssignmentLayer}(FV.CanvasLayer);FV.RoomNameLayer=function(_FV$CanvasLayer5){_inherits(RoomNameLayer,_FV$CanvasLayer5);function RoomNameLayer(options){_classCallCheck(this,RoomNameLayer);options=_.assign({handle:"roomname",labelSizes:[6,8,11,14,25],fontName:"Arial",colorNormal:"rgba(0, 0, 0, 1)",colorDisabled:"rgba(119, 117, 116, 1)",colorDisabledNotSelected:"rgba(119, 117, 116, 0.6)",colorSelectMode:"rgba(0, 0, 0, 0.3)",nameAlign:"center",nameOffset:0,userAlign:"center",userOffset:0,userLabelPadding:2,lrPadding:0,lrPaddingRatio:0,userLabelRatio:.6,nameUserSpacing:5},options);_FV$CanvasLayer5.call(this,options);this.on("dataassigned",this._computeLabelWidths)}RoomNameLayer.prototype.initLayerRoomData=function initLayerRoomData(){return{maxWidthAt20:0,nameWidthAt20:0,cx:0,cy:0,width:0,height:0}};RoomNameLayer.prototype.getLabelWidth=function getLabelWidth(room,height){var roomData=room.getLayerData(this);return Math.ceil(height*roomData.nameWidthAt20/20)};RoomNameLayer.prototype.getMaxWidth=function getMaxWidth(room,height){var roomData=room.getLayerData(this);return Math.ceil(height*roomData.maxWidthAt20/20)};RoomNameLayer.prototype.draw=function draw(rooms,ctx){var _this22=this;ctx.save();var opt=this.options,sizes=opt.labelSizes,total=sizes.length,toDraw=_.filter(rooms,function(room){var roomData=_this22._computeRectDim(room),width=_this22.getLabelWidth(room,sizes[0]);return width<roomData.width&&sizes[0]<roomData.height}),i=1;this._userLabels={};this.selectMode=this._map.options.selectMode;ctx.textBaseline="middle";ctx.textAlign="center";ctx.globalAlpha=1;if(this.selectMode){ctx.fillStyle=opt.colorSelectMode;ctx.strokeStyle=opt.colorSelectMode}else{ctx.fillStyle=opt.colorNormal;ctx.strokeStyle=opt.colorNormal}var _loop=function(){var onNextIteration=[];_this22._userLabels[sizes[i-1]]=[];ctx.font=sizes[i-1]+"px "+opt.fontName;_.each(toDraw,function(room){var roomData=room.getLayerData(_this22),width=_this22.getLabelWidth(room,sizes[i]);if(width<roomData.width&&sizes[i]<roomData.height){onNextIteration.push(room)}else{_this22._drawLabel(room,ctx,sizes[i-1])}});toDraw=onNextIteration;i++};while(i<total){_loop()}this._userLabels[sizes[i-1]]=[];ctx.font=sizes[i-1]+"px "+opt.fontName;_.each(toDraw,function(room){_this22._drawLabel(room,ctx,sizes[i-1])});this._drawUsers(ctx);ctx.restore()};RoomNameLayer.prototype._drawLabel=function _drawLabel(room,ctx,height){var opt=this.options,rOpt=room.options,roomData=room.getLayerData(this),usersLen=room.users.length;ctx.save();if(this.selectMode&&rOpt.selected){ctx.fillStyle=opt.colorNormal;ctx.strokeStyle=opt.colorNormal}else if(!rOpt.interactive){ctx.fillStyle=opt.colorDisabled;ctx.strokeStyle=opt.colorDisabled}if(usersLen&&opt.userLabelRatio){var userLabelHeight=Math.ceil(height*opt.userLabelRatio),spaces=Math.floor((roomData.height-height)/(userLabelHeight+opt.userLabelPadding*2)),numUsersToDisplay=Math.min(spaces,usersLen),roomLabelHeight=(userLabelHeight+opt.userLabelPadding*2)*numUsersToDisplay+height,center=this._getNameCenter(room,height),yPos=roomData.cy-roomLabelHeight/2+height/2;ctx.fillText(room.name,center,yPos);yPos+=height/2;this._userLabels[height].push({room:room,yPos:yPos,numUsersToDisplay:numUsersToDisplay})}else{ctx.fillText(room.name,roomData.cx,roomData.cy)}if(rOpt.selected||!rOpt.interactive){ctx.restore()}};RoomNameLayer.prototype._getNameCenter=function _getNameCenter(room,height){var opt=this.options,roomData=room.getLayerData(this),center=roomData.cx,width=this.getLabelWidth(room,height),maxWidth=Math.min(this.getMaxWidth(room,height),roomData.width);if(opt.nameAlign=="left"){center=center-maxWidth/2+width/2}else if(opt.nameAlign=="right"){center=center+maxWidth/2-width/2}if(opt.nameOffset>0){center+=Math.min(opt.nameOffset,roomData.cx+roomData.width/2-(center+width/2))}else if(opt.nameOffset<0){center+=Math.max(opt.nameOffset,roomData.cx-roomData.width/2-(center-width/2))}return center};RoomNameLayer.prototype._drawUsers=function _drawUsers(ctx){var _this23=this;var opt=this.options;ctx.save();_.forOwn(this._userLabels,function(array,height){var userLabelHeight=Math.floor(height*opt.userLabelRatio);ctx.font=userLabelHeight+"px "+opt.fontName;ctx.textAlign=opt.userAlign;_.each(array,function(item){var yPos=item.yPos;var room=item.room;var rOpt=room.options;var _getUserCenter2=_this23._getUserCenter(room,height);var _getUserCenter22=_slicedToArray(_getUserCenter2,2);var center=_getUserCenter22[0];var strWidth=_getUserCenter22[1];if(strWidth>0){if(_this23.selectMode&&rOpt.selected){ctx.save();ctx.fillStyle=opt.colorNormal;ctx.strokeStyle=opt.colorNormal}else if(!rOpt.interactive){ctx.save();ctx.fillStyle=opt.colorDisabled;ctx.strokeStyle=opt.colorDisabled}yPos+=userLabelHeight/4+opt.nameUserSpacing;for(var i=0;i<item.numUsersToDisplay;++i){ctx.fillText(ctx.FVfitString(room.users[i].name,strWidth),center,yPos);yPos+=userLabelHeight+opt.userLabelPadding}if(rOpt.selected||!rOpt.interactive){ctx.restore()}}})});ctx.restore()};RoomNameLayer.prototype._getUserCenter=function _getUserCenter(room,height){var opt=this.options,roomData=room.getLayerData(this),center=roomData.cx,maxWidth=Math.min(this.getMaxWidth(room,height),roomData.width),strWidth=maxWidth,allowedWidth=0;if(opt.userAlign=="left"){center-=maxWidth/2;if(opt.userOffset>0){center+=opt.userOffset;allowedWidth=Math.floor(roomData.cx+roomData.width/2-center);strWidth=Math.min(strWidth,allowedWidth)}else if(opt.userOffset<0){center+=Math.max(opt.userOffset,roomData.cx-roomData.width/2-center)}}else if(opt.userAlign=="right"){center+=maxWidth/2;if(opt.userOffset>0){center+=Math.min(opt.userOffset,roomData.cx+roomData.width/2-center)}else if(opt.userOffset<0){center+=opt.userOffset;allowedWidth=Math.floor(center-(roomData.cx-roomData.width/2));strWidth=Math.min(strWidth,allowedWidth)}}return[center,strWidth]};RoomNameLayer.prototype._computeLabelWidths=function _computeLabelWidths(){var _this24=this;var ctx=this.getCanvas()._ctx;ctx.font="20px "+this.options.fontName;_.each(this._map.rooms,function(room){var roomData=room.getLayerData(_this24),width=ctx.measureText(room.name).width,widths=_.map(room.users,function(user){return ctx.measureText(user.name).width});widths.push(width);roomData.nameWidthAt20=Math.ceil(width);roomData.maxWidthAt20=_.max(widths)})};RoomNameLayer.prototype._computeRectDim=function _computeRectDim(room){var opt=this.options,roomData=room.getLayerData(this),lr=room.getLargestRectanglePixelBounds(),size=lr.getSize(),center=lr.getCenter(),lrWidth=size.x,lrHeight=size.y,xPadding=Math.min(opt.lrPadding,lrWidth*opt.lrPaddingRatio),yPadding=Math.min(opt.lrPadding,lrHeight*opt.lrPaddingRatio);lrWidth-=xPadding*2;lrHeight-=yPadding*2;roomData.cx=center.x;roomData.cy=center.y;roomData.width=lrWidth;roomData.height=lrHeight;return roomData};return RoomNameLayer}(FV.CanvasLayer);FV.RoomPolygonLayer=function(_FV$CanvasLayer6){_inherits(RoomPolygonLayer,_FV$CanvasLayer6);function RoomPolygonLayer(options){_classCallCheck(this,RoomPolygonLayer);_FV$CanvasLayer6.call(this,_.assign({handle:"roomPolygon",inheritStyle:null},options))}RoomPolygonLayer.prototype.beforeAdd=function beforeAdd(map){this.generateRoomStyles(map)};RoomPolygonLayer.prototype.getStyles=function getStyles(){return this.styles};RoomPolygonLayer.prototype.generateRoomStyles=function generateRoomStyles(map){var _this25=this;this.styles={};map.onRoomsReady.then(function(){var disabled="D";_this25.styles[disabled]={fill:true,fillOpacity:.9,fillColor:"lightgray",stroke:false};_.each(map.rooms,function(room){var color=FV.Util.cssColor(room.type.color);if(!_.has(room,color)){_this25.styles[color]={fill:true,fillOpacity:.5,fillColor:color,stroke:true,opacity:.5,weight:1,color:color,strokeAlign:"inner",lineJoin:"miter"};_this25.styles[color+",S"]={fill:true,fillOpacity:.9,fillColor:color,stroke:true,weight:4,color:"#000",strokeAlign:"inner",lineJoin:"miter"};_this25.styles[color+",N"]={fill:true,fillOpacity:.2,fillColor:color,stroke:false}}})})};RoomPolygonLayer.prototype.getStyleKey=function getStyleKey(room){if(!room.options.interactive){return"D"}var key=FV.Util.cssColor(room.type.color);if(room._map.options.selectMode){if(room.options.selected){key+=",S"}else{key+=",N"}}return key};RoomPolygonLayer.prototype.draw=function draw(roomsInView,ctx){ctx.save();var layer=this._map.getLayerByHandle(this.options.inheritStyle)||this;if(!layer.getStyleKey||!layer.getStyles){throw Error("layer is missing one of these methods: [getStyleKey, getStyles]")}var groups={};_.each(roomsInView,function(room){var key=layer.getStyleKey(room);if(!_.has(groups,key)){groups[key]=[]}groups[key].push(room)});var styles=layer.getStyles();_.forOwn(groups,function(rooms,key){ctx.beginPath();_.each(rooms,function(room){var points=room.getPixelPoints();if(points&&points.length){ctx.fvPolygon(points)}});var style=styles[key];if(style){ctx._FVfillStroke(style);ctx.closePath()}});ctx.restore()};return RoomPolygonLayer}(FV.CanvasLayer);FV.SRHeatLayer=function(_FV$CanvasLayer7){_inherits(SRHeatLayer,_FV$CanvasLayer7);function SRHeatLayer(options){_classCallCheck(this,SRHeatLayer);_FV$CanvasLayer7.call(this,_.assign({handle:"srheat",hostUrl:"",control:true,legend:true,interactive:true},options));this.requests=[];this.requestTypes={};this.requestByType={};this.requestByRoomId={};this._heat=new FV.SimpleHeat}SRHeatLayer.prototype.onRoomClick=function onRoomClick(room,data){var requests=this.requestByRoomId[room.id];if(requests&&requests.length){this._map.openPopup(this._requestToHTML(room,requests),data.latlng)}};SRHeatLayer.prototype.beforeAdd=function beforeAdd(){this._heat.setCanvas(this.getCanvas());this._heat.radius(this.options.radius||this._heat.defaultRadius,this.options.blur);if(this.options.gradient){this._heat.gradient(this.options.gradient)}if(this.options.max){this._heat.max(this.options.max)}};SRHeatLayer.prototype.initLayerRoomData=function initLayerRoomData(){return{data:0}};SRHeatLayer.prototype.addData=function addData(data){var _this26=this;_.each(data,function(request){var typeId=request.type.id;var typeName=request.type.name;if(request.room){_this26.requests.push(request);var roomId=request.room.id;if(!_.has(_this26.requestByRoomId,roomId)){_this26.requestByRoomId[roomId]=[]}_this26.requestByRoomId[roomId].push(request);if(!_.has(_this26.requestTypes,typeId)){_this26.requestTypes[typeId]={id:typeId,name:typeName,count:0}}_this26.requestTypes[typeId].count+=1;if(!_.has(_this26.requestByType,typeName)){_this26.requestByType[typeName]=[]}_this26.requestByType[typeName].push(request)}});this.fire("dataadded");this.selectRequest();return this};SRHeatLayer.prototype.selectRequest=function selectRequest(){var _this27=this;var requestType=arguments.length<=0||arguments[0]===undefined?"":arguments[0];var requests=requestType?this.requestByType[requestType]:this.requests;this.resetData();_.each(requests,function(request){var roomId=request.room.id,layerRoomData=_this27.getLayerRoomData(roomId);if(layerRoomData){layerRoomData.data+=request.priority.id}});if(this._map&&this._map._roomsReady){this.assignData()}};SRHeatLayer.prototype.onDataAssign=function onDataAssign(roomData,room){var dataSlapRatio=5;var randomize=false;var data=roomData.data*dataSlapRatio;if(roomData.data===0&&randomize){data=Math.floor(Math.random()*20+1)}roomData.data=data;var requestsByRoom=this.requestByRoomId[room.id];if(!requestsByRoom||requestsByRoom.length==0||data==0){}else{}};SRHeatLayer.prototype.draw=function draw(roomsInView){this._heat.drawRoomsInView(roomsInView,this,"data")};SRHeatLayer.prototype._requestToHTML=function _requestToHTML(room,requestList){var _this28=this;var endPoint="/maintenance/MaintenanceProductionView.cfm";var roomHtml='<div class="headerStripBar" style="display: inline">'+'<span class="label">Room: </span>'+'<span class="title">'+room.name+"</span>"+'<span class="title"> ('+room.type.name+")</span>"+"</div>";if(room.users&&room.users.length){roomHtml+='<div class="dataSection" style="display: block">'+'<span class="label">Users: </span>';_.each(room.users,function(user){roomHtml+='<a class="link" href="#">'+user.name+"</a> "});roomHtml+="</div>"}if(requestList&&requestList.length){roomHtml+='<div class="listHeaderBar">'+'<table class="listTable" style="display: table;"><tbody><tr>'+'<th>Id</th><th>Priority</th><th style="width: 100%;">Type</th>'+"</tr></tbody></table>"+'</div><div class="listBox" style="height: '+Math.min(requestList.length*25,80)+'px; overflow: auto;">'+'<table class="listTable" style="display: table;"><tbody>';_.each(requestList,function(roomRequest){roomHtml+='<tr><td><a class="link" href="'+_this28.options.hostUrl+endPoint+"?requestid="+roomRequest.id+"&centerid="+roomRequest.center.id+'" target="requestInfo">'+roomRequest.id+"</a>"+"</td><td>"+roomRequest.priority.id+'</td><td style="width: 100%">'+roomRequest.type.name+"</td></tr>"});roomHtml+="</tbody></table></div>"}return roomHtml};return SRHeatLayer}(FV.CanvasLayer);FV.SearchLayer=function(_FV$CanvasLayer8){_inherits(SearchLayer,_FV$CanvasLayer8);function SearchLayer(options){_classCallCheck(this,SearchLayer);options=_.assign({weight:10,opacity:.6,blur:0},options);_FV$CanvasLayer8.call(this,options);this.canvas=document.createElement("canvas");this.ctx=this.canvas.getContext("2d")}SearchLayer.prototype.draw=function draw(roomsInView,ctx){var _this29=this;var rooms=this._map.searchRoom.getRooms();if(!rooms.length){return}ctx.save();var opt=this.options,b=this._canvas._bounds,size=b.getSize(),min=b.min,width=size.x,height=size.y,m=L.Browser.retina?2:1;this.canvas.width=width;this.canvas.height=height;this.canvas.style.width=width+"px";this.canvas.style.height=height+"px";this.ctx.save();this.ctx.translate(-min.x,-min.y);if(opt.blur){this.ctx.drawImage(this._map.subCanvas._container,0,0,m*width,m*height,min.x,min.y,width,height);this.ctx.drawImage(this._map.overlayCanvas._container,0,0,m*width,m*height,min.x,min.y,width,height);FV.boxBlurCanvasRGBA(this.canvas,0,0,width,height,opt.blur)}this.ctx.globalAlpha=opt.opacity;this.ctx.fillRect(min.x,min.y,width,height);this.ctx.globalCompositeOperation="destination-out";_.each(rooms,function(room){if(_.indexOf(roomsInView,room)==-1){return}var points=room.getPixelPoints();_.each(points,function(p,index){return _this29.ctx[index?"lineTo":"moveTo"](p.x,p.y)});var s=points[0];_this29.ctx.lineTo(s.x,s.y)});this.ctx.globalAlpha=1;this.ctx.fill();if(opt.weight){this.ctx.lineWidth=opt.weight;this.ctx.lineJoin="round";this.ctx.lineCap="round";this.ctx.stroke()}this.ctx.restore();ctx.drawImage(this.canvas,0,0,width,height,min.x,min.y,width,height);ctx.restore()};return SearchLayer}(FV.CanvasLayer);FV.TileLayer=function(_L$TileLayer){_inherits(TileLayer,_L$TileLayer);function TileLayer(options){_classCallCheck(this,TileLayer);options=_.assign({attribution:"",continuousWorld:false,noWrap:true,reuseTiles:true},options);_L$TileLayer.call(this,null,options)}TileLayer.prototype.beforeAdd=function beforeAdd(map){var info=map.tileInfo;this._url=info.url+"/{z}/tile_{x}_{y}.png";L.setOptions(this,{scale:info.scale,minZoom:info.minZoom,maxZoom:info.maxZoom,maxNativeZoom:info.maxZoom,bounds:map.mapBounds})};return TileLayer}(L.TileLayer);FV.tileLayer=function(options){return new FV.TileLayer(options)};FV.SearchUserRoomLayerControl=function(_L$Control){_inherits(SearchUserRoomLayerControl,_L$Control);function SearchUserRoomLayerControl(layer,options){var _this30=this;_classCallCheck(this,SearchUserRoomLayerControl);_L$Control.call(this,_.assign({position:"topleft"},options));this.layer=layer;layer.on("dataadded",function(){_this30.updateControl()})}SearchUserRoomLayerControl.prototype.onAdd=function onAdd(map){var _this31=this;this.map=map;window.a=this;var div=L.DomUtil.create("div","info legend");var searchInputEle=L.DomUtil.create("input");searchInputEle.type="text";searchInputEle.placeholder="Search ...";div.innerHTML="\n      <h3>"+map.floor.building.name+"</h3>\n      <h4>Floor "+map.floor.name+"</h4>\n    ";var resultsEle=L.DomUtil.create("div");div.appendChild(searchInputEle);div.appendChild(resultsEle);searchInputEle.addEventListener("change",function(){var query=searchInputEle.value;_this31.fvUtil.http("/external/api/rest/v2/spacepinger/search",{user:query,room:query}).then(function(response){var inFloor=[];var byUser=[];var byRoom=[];_.each(response.data,function(item){if(item.floor===map.floor.id&&map.roomById[item.room]){inFloor.push(item)}else if(item.kind=="user"){byUser.push(item)}else{byRoom.push(item)}});_this31.generateLinks(resultsEle,inFloor,byUser,byRoom)})});return div};SearchUserRoomLayerControl.prototype.updateControl=function updateControl(){if(!this._container){return}};SearchUserRoomLayerControl.prototype.generateLinks=function generateLinks(div,inFloor,byUser,byRoom){var _this32=this;div.innerHTML="";var inFloorEle=L.DomUtil.create("div","in-floor");var inFloorList=L.DomUtil.create("ul");inFloorEle.appendChild(inFloorList);_.each(inFloor,function(item){var listEle=L.DomUtil.create("li");var buttonEle=L.DomUtil.create("button");listEle.appendChild(buttonEle);inFloorList.appendChild(listEle);if(item.kind==="user"){buttonEle.innerHTML=item.name+" - "+item.roomName}else{buttonEle.innerHTML=""+item.roomName}buttonEle.addEventListener("mouseover",function(){_this32.map.searchRoom.byId(item.room,{zoom:"edge"})});buttonEle.addEventListener("mouseout",function(){_this32.map.searchRoom.byName([])});buttonEle.addEventListener("click",function(){console.log("Great...",item.roomName)})});var byUserEle=L.DomUtil.create("div","in-floor");var byUserList=L.DomUtil.create("ul");byUserEle.appendChild(byUserList);_.each(byUser,function(item){var listEle=L.DomUtil.create("li");var buttonEle=L.DomUtil.create("button");listEle.appendChild(buttonEle);inFloorList.appendChild(listEle);if(item.kind==="user"){buttonEle.innerHTML=item.name+" - "+item.roomName}else{buttonEle.innerHTML=""+item.roomName}buttonEle.addEventListener("click",function(){_this32.ctrl.mapCtrl.setFloorId(item.floor,{pingBy:"id",ping:item.room,center:item.room});console.log("Great...",item.roomName)})});div.appendChild(inFloorEle);div.appendChild(byUserEle)};return SearchUserRoomLayerControl}(L.Control);FV.ServiceRequestHeatLayerControl=function(_L$Control2){_inherits(ServiceRequestHeatLayerControl,_L$Control2);function ServiceRequestHeatLayerControl(layer,options){var _this33=this;_classCallCheck(this,ServiceRequestHeatLayerControl);_L$Control2.call(this,_.assign({position:"topright"},options));if(layer instanceof FV.SRHeatLayer){this.layer=layer}else{throw Error("FV.ServiceRequestHeatLayerControl requires a layer of type FV.SRHeatLayer")}layer.on("dataadded",function(){_this33.updateControl()})}ServiceRequestHeatLayerControl.prototype.onAdd=function onAdd(){
var layer=this.layer;var div=L.DomUtil.create("div","info legend");var select=L.DomUtil.create("select","",div);this._setSelect(select,layer);select.onmousedown=select.ondblclick=L.DomEvent.stopPropagation;select.addEventListener("change",function(e){var typeName=e.srcElement.value;if(typeName=="All"){layer.selectRequest()}else{layer.selectRequest(typeName)}});return div};ServiceRequestHeatLayerControl.prototype.updateControl=function updateControl(){if(!this._container){return}var select=this._container.firstChild;while(select.firstChild){select.removeChild(select.firstChild)}this._setSelect(select,this.layer)};ServiceRequestHeatLayerControl.prototype._setSelect=function _setSelect(select,layer){var option=L.DomUtil.create("option","",select);option.value="All";option.text="All ("+layer.requests.length+")";_.forOwn(layer.requestTypes,function(type){option=L.DomUtil.create("option","",select);option.value=type.name;option.text=type.name+" ("+type.count+")"})};return ServiceRequestHeatLayerControl}(L.Control)})();"use strict";var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();function _defaults(obj,defaults){var keys=Object.getOwnPropertyNames(defaults);for(var i=0;i<keys.length;i++){var key=keys[i];var value=Object.getOwnPropertyDescriptor(defaults,key);if(value&&value.configurable&&obj[key]===undefined){Object.defineProperty(obj,key,value)}}return obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):_defaults(subClass,superClass)}(function(){var ngFV=angular.module("i.floor-viewer",[]);ngFV.constant("MODULE_VERSION","0.4.12");var FVC={};FV.DelegateService=function(methodNames){if(methodNames.indexOf("$getByHandle")>-1){throw new Error("Method '$getByHandle' is implicitly added to each delegate service. Do not list it as a method.")}function trueFn(){return true}return["$log",function($log){function DelegateInstance(instances,handle){this._instances=instances;this.handle=handle}methodNames.forEach(function(methodName){DelegateInstance.prototype[methodName]=instanceMethodCaller(methodName)});function DelegateService(){this._instances=[]}DelegateService.prototype=DelegateInstance.prototype;DelegateService.prototype._registerInstance=function(instance,handle,filterFn){var instances=this._instances;instance.$$delegateHandle=handle;instance.$$filterFn=filterFn||trueFn;instances.push(instance);return function deregister(){var index=instances.indexOf(instance);if(index!==-1){instances.splice(index,1)}}};DelegateService.prototype.$getByHandle=function(handle){return new DelegateInstance(this._instances,handle)};return new DelegateService;function instanceMethodCaller(methodName){return function caller(){var handle=this.handle;var args=arguments;var foundInstancesCount=0;var returnValue;this._instances.forEach(function(instance){if((!handle||handle==instance.$$delegateHandle)&&instance.$$filterFn(instance)){foundInstancesCount++;var ret=instance[methodName].apply(instance,args);if(foundInstancesCount===1){returnValue=ret}}});if(!foundInstancesCount&&handle){return $log.warn('Delegate for handle "'+handle+'" could not find a '+'corresponding element with delegate-handle="'+handle+'"! '+methodName+"() was not called!\n"+"Possible cause: If you are calling "+methodName+"() immediately, and "+'your element with delegate-handle="'+handle+'" is a child of your '+"controller, then your element may not be compiled yet. Put a $timeout "+"around your call to "+methodName+"() and try again.")}return returnValue}}}]};var fvMapController=function(_L$Evented){_inherits(fvMapController,_L$Evented);function fvMapController($scope,$element,$attrs,fvDelegate,fvUtil,$q,$log){_classCallCheck(this,fvMapController);_L$Evented.call(this);angular.extend(this,{$scope:$scope,$element:$element,$attrs:$attrs,fvDelegate:fvDelegate,fvUtil:fvUtil,$q:$q,$log:$log});this.map=null;this.element=null;this.mapOptions=null;this.options=null;this.layerControllers=[];this.layerControllersHandles={};this.controlControllers=[];this._map=$q.defer();this._mapStatus=0}fvMapController.prototype.getMap=function getMap(){return this._map.promise};fvMapController.prototype._makeErrorFV=function _makeErrorFV(){this.element.innerHTML='<div class="err-message">Unable To Load Floor Plan</div>';this.element.classList.add("error")};fvMapController.prototype.setFloorId=function setFloorId(floorId,mapOptions){var _this=this;var opt=this.options;_.assign(this.mapOptions,mapOptions);if(opt.floorId!==floorId){if(this._mapStatus!==0){this._map=this.$q.defer();this._mapStatus=0}this.element.innerHTML='<div class="loading-message">Loading ...</div>';this.element.classList.remove("error");opt.floorId=floorId;this.fvUtil.cancelRequests();this.requestData(floorId).then(function(response){_this.element.innerHTML="";_this._makeFV(response.data);_this.fire("setfloorend")},function(response){_this._makeErrorFV(response);_this.$log.error("Floor Request Error: ",response)});this.fire("setfloorstart",{floorId:floorId})}};fvMapController.prototype._makeFV=function _makeFV(floor){if(this.map){this.map.remove()}if(this.options.fireResizeEvent){window.dispatchEvent(new Event("resize"))}try{console.log("Using options: ",this.mapOptions);this.map=FV.map(this.element,floor,this.mapOptions)}catch(e){this._makeErrorFV(e);this._map.reject(e);this._mapStatus=2;throw e}this.element.removeAttribute("tabIndex");if(this.options.onRoomClick){this.map.on("roomclick",this.options.onRoomClick)}this._map.resolve(this.map);this._mapStatus=1};fvMapController.prototype._preCompile=function _preCompile(ele,opt,fvOpt){var _this2=this;this.element=ele;this.options=opt;this.mapOptions=fvOpt;var deregisterInstance=this.fvDelegate._registerInstance(this,opt.delegateHandle);this.$scope.$on("$destroy",function(){deregisterInstance();_this2.off();if(_this2.map){_this2.map.remove()}});if(opt.requestData){this.requestData=opt.requestData}};fvMapController.prototype._postCompile=function _postCompile(){var floorId=this.options.floorId;this.options.floorId=null;if(floorId){this.setFloorId(floorId)}};fvMapController.prototype.addLayerController=function addLayerController(controller){this.layerControllers.push(controller);var handle=controller.layer.options.handle;if(handle){this.layerControllersHandles[handle]=controller}};fvMapController.prototype.getLayerControllerByHandle=function getLayerControllerByHandle(handle){var layerCtrl=this.layerControllersHandles[handle];if(!layerCtrl){throw Error('The layer controller with handle "'+handle+'" has not been added to the map controller.')}return layerCtrl};fvMapController.prototype.addControlController=function addControlController(controller){this.controlControllers.push(controller)};fvMapController.prototype.requestData=function requestData(floorId){return this.fvUtil.http(this.fvUtil.restEndPoint+"/floors/"+floorId,{selector:{building:[],rooms:{users:["firstName","lastName"],metaData:{points:["x","y"]},type:{color:["red","green","blue"]}},drawing:{tileInfo:["minZoom","maxZoom","scale","url"],bounds:["x","y","width","height"],roomBounds:["x","y","width","height"]}}})};return fvMapController}(L.Evented);ngFV.controller("fvMapController",fvMapController);ngFV.directive("fvMap",["fvUtil",function fvMap(fvUtil){var SCOPE={delegateHandle:"@",floorId:"=",fireResizeEvent:"=",requestData:"=",onRoomClick:"=",selectRoom:"@",center:"=",centerBy:"@",select:"=",selectBy:"@",ping:"=",pingBy:"@",pingOptions:"=",zooming:"=",padding:"=",options:"="};return{restrict:"AE",scope:SCOPE,transclude:true,template:'<div ng-transclude></div><div class="floor-viewer-container"></div>',controller:"fvMapController",compile:function compile(){return{pre:this.pre,post:this.post}},pre:function pre(scope,element,attr,fvCtrl){var mapElement=element[0].querySelector(".floor-viewer-container");var _fvUtil$getAttributes=fvUtil.getAttributes(scope,_.keys(SCOPE),{delegateHandle:undefined,floorId:null,fireResizeEvent:false,requestData:null,onRoomClick:null,zooming:false,padding:.4,selectRoom:"single",selectBy:"id",select:[],pingBy:"id",ping:0,pingOptions:{},centerBy:"id",center:[]},{selectRoom:"selectRoom",zooming:"zoomControl",padding:"canvasPaddingRatio",selectBy:"selectBy",select:"select",pingBy:"pingBy",ping:"ping",pingOptions:"pingOptions",centerBy:"centerBy",center:"centerOn"});var _fvUtil$getAttributes2=_slicedToArray(_fvUtil$getAttributes,2);var options=_fvUtil$getAttributes2[0];var mapOptions=_fvUtil$getAttributes2[1];fvCtrl._preCompile(mapElement,options,mapOptions)},post:function post($scope,$element,$attr,fvCtrl){fvCtrl._postCompile()}}}]);FVC.CanvasLayerController=function(){function CanvasLayerController($scope,$element,$attrs,fvUtil,$log){_classCallCheck(this,CanvasLayerController);angular.extend(this,{$scope:$scope,$element:$element,$attrs:$attrs,fvUtil:fvUtil,$log:$log});this.mapCtrl=null;this.layer=null}CanvasLayerController.prototype.addTo=function addTo(mapCtrl){this.mapCtrl=mapCtrl;mapCtrl.addLayerController(this);mapCtrl.on("setfloorstart",this._onSetFloorStart,this);mapCtrl.on("setfloorend",this._onSetFloorEnd,this)};CanvasLayerController.prototype._onSetFloorStart=function _onSetFloorStart(e){var _this3=this;this.layer._assignDataCallsCount=0;if(this.requestData){this.requestData(e.floorId).then(function(data){var layer=_this3.layer;layer.addData(data);if(layer._assignDataCallsCount>0){layer.assignData()}},function(r){_this3.$log.error("ERROR: ",r)})}};CanvasLayerController.prototype._onSetFloorEnd=function _onSetFloorEnd(){this.layer.addTo(this.mapCtrl.map)};CanvasLayerController.prototype.getLayer=function getLayer(){return this.layer};return CanvasLayerController}();FVC.MailLayerController=function(_FVC$CanvasLayerController){_inherits(MailLayerController,_FVC$CanvasLayerController);function MailLayerController($scope,$element,$attrs,fvUtil,$log){_classCallCheck(this,MailLayerController);_FVC$CanvasLayerController.call(this,$scope,$element,$attrs,fvUtil,$log)}MailLayerController.prototype.init=function init(options,layerOptions){this.options=options;this.layerOptions=layerOptions;this.layer=new FV.MailLayer(layerOptions)};MailLayerController.prototype.requestData=function requestData(floorId){var _this4=this;return this.fvUtil.http("/external/api/rest/v2/mail/items/inbound",{floorId:floorId,limit:500,selector:{$:["center","courier","dateCreated","dateUpdated","fromName","itemType","name","notes","route","statuses","trackingNumber"],packageType:["code","dateCreated","name","sortOrder"],toUser:{$:["name","firstName","lastName"],mailStop:["route"],room:{$:["name","description"],floor:["building","drawingAvailable"]}}}}).then(function(response){return _this4._itemsToDeliveries(response.data)})};MailLayerController.prototype._itemsToDeliveries=function _itemsToDeliveries(items){var _this5=this;var toUserId=arguments.length<=1||arguments[1]===undefined?null:arguments[1];return _(items).filter(function(i){return i.itemType==="INBOUND"&&(toUserId?i.toUser.id==toUserId:true)}).groupBy(function(item){return item.toUser?item.toUser.id:0}).map(function(groupedItems,userId){if(userId===0){return}var delivery=_.assign({userId:_.parseInt(userId),toUser:groupedItems[0].toUser,items:groupedItems},_this5._getItemMeta(groupedItems[0]));delivery.searchKeys=["toUser.name","floor.name","building.name"].map(function(p){var key=_.get(delivery,p,"");return key!=="Unknown"?key.toLowerCase():""}).concat(_(groupedItems).map("trackingNumber").value());return delivery}).value()};MailLayerController.prototype._getItemMeta=function _getItemMeta(item){var room=_.get(item,"toUser.room",{id:999999,name:"Unknown"});var floor=_.get(item,"toUser.room.floor",{id:999999,name:"Unknown"});var building=_.get(item,"toUser.room.floor.building",{id:999999,name:"Unknown"});var mailStop=_.get(item,"toUser.mailStop",{id:999999,name:"Unknown"});var route=_.get(mailStop,"route",{id:999999,name:"Unknown"});return{room:room,floor:floor,building:building,mailStop:mailStop,route:route}};return MailLayerController}(FVC.CanvasLayerController);ngFV.controller("MailLayerController",FVC.MailLayerController);ngFV.directive("fvMailLayer",["fvUtil",function(fvUtil){var SCOPE={handle:"@",options:"="};return{require:["fvMailLayer","^fvMap"],restrict:"EA",scope:SCOPE,controller:"MailLayerController",link:function link(scope,element,attrs,_ref){var _ref2=_slicedToArray(_ref,2);var mailCtrl=_ref2[0];var mapCtrl=_ref2[1];var _fvUtil$getAttributes3=fvUtil.getAttributes(scope,_.keys(SCOPE),{handle:"mail"},{handle:"handle"});var _fvUtil$getAttributes32=_slicedToArray(_fvUtil$getAttributes3,2);var options=_fvUtil$getAttributes32[0];var layerOptions=_fvUtil$getAttributes32[1];mailCtrl.init(options,layerOptions);mailCtrl.addTo(mapCtrl)}}}]);FVC.OccupancyLayerController=function(_FVC$CanvasLayerController2){_inherits(OccupancyLayerController,_FVC$CanvasLayerController2);function OccupancyLayerController($scope,$element,$attrs,fvUtil,$log){_classCallCheck(this,OccupancyLayerController);_FVC$CanvasLayerController2.call(this,$scope,$element,$attrs,fvUtil,$log)}OccupancyLayerController.prototype.init=function init(options,layerOptions){this.options=options;this.layerOptions=layerOptions;this.layer=new FV.OccupancyLayer(layerOptions)};OccupancyLayerController.prototype.requestData=function requestData(floorId){var _this6=this;return this.fvUtil.http(this.fvUtil.restEndPoint+"/floors/"+floorId,{selector:{rooms:{$:["reservable","capacity"],type:["occupiable"]}}}).then(function(response){return response.data},function(response){_this6.$log.error("Occupancy Error: ",response)})};return OccupancyLayerController}(FVC.CanvasLayerController);ngFV.controller("OccupancyLayerController",FVC.OccupancyLayerController);ngFV.directive("fvOccupancyLayer",["fvUtil",function fvOccupancyLayer(fvUtil){var SCOPE={handle:"@",options:"="};return{require:["fvOccupancyLayer","^fvMap"],restrict:"EA",scope:SCOPE,controller:"OccupancyLayerController",link:function link(scope,element,attrs,_ref3){var _ref32=_slicedToArray(_ref3,2);var occupancyCtrl=_ref32[0];var mapCtrl=_ref32[1];var _fvUtil$getAttributes4=fvUtil.getAttributes(scope,_.keys(SCOPE),{handle:"occupancy"},{handle:"handle"});var _fvUtil$getAttributes42=_slicedToArray(_fvUtil$getAttributes4,2);var options=_fvUtil$getAttributes42[0];var layerOptions=_fvUtil$getAttributes42[1];occupancyCtrl.init(options,layerOptions);occupancyCtrl.addTo(mapCtrl)}}}]);FVC.ReservationsLayerController=function(_FVC$CanvasLayerController3){_inherits(ReservationsLayerController,_FVC$CanvasLayerController3);function ReservationsLayerController($scope,$element,$attrs,fvUtil,$log,$interval){_classCallCheck(this,ReservationsLayerController);_FVC$CanvasLayerController3.call(this,$scope,$element,$attrs,fvUtil,$log);this.$interval=$interval}ReservationsLayerController.prototype.init=function init(options,layerOptions){var _this7=this;this.options=options;this.layerOptions=layerOptions;this.layer=new FV.ReservationsLayer(layerOptions);this.$interval(function(){_this7.updateData()},10*1e3)};ReservationsLayerController.prototype.requestData=function requestData(floorId){var _this8=this;return this.fvUtil.http(this.fvUtil.restEndPoint+"/floors/"+floorId,{selector:{rooms:{$:["reservable","capacity"],type:["occupiable"],anonymousReservations:["startDate","endDate","numberOfPeople"]}}}).then(function(response){return response.data},function(response){_this8.$log.error("Reservations Error: ",response)})};ReservationsLayerController.prototype.updateData=function updateData(){var _this9=this;this.$log.log("... updating reservations");var floorId=this.layer._map.floor.id;this.layer.resetData();if(this.requestData){this.requestData(floorId).then(function(data){var layer=_this9.layer;layer.addData(data);layer.assignData()},function(r){_this9.$log.error("ERROR: ",r)})}};return ReservationsLayerController}(FVC.CanvasLayerController);ngFV.controller("ReservationsLayerController",FVC.ReservationsLayerController);ngFV.directive("fvReservationsLayer",["fvUtil",function fvReservationsLayer(fvUtil){var SCOPE={handle:"@",options:"="};return{require:["fvReservationsLayer","^fvMap"],restrict:"EA",scope:SCOPE,controller:"ReservationsLayerController",link:function link(scope,element,attrs,_ref4){var _ref42=_slicedToArray(_ref4,2);var reservationsCtrl=_ref42[0];var mapCtrl=_ref42[1];var _fvUtil$getAttributes5=fvUtil.getAttributes(scope,_.keys(SCOPE),{handle:"reservations"},{handle:"handle"});var _fvUtil$getAttributes52=_slicedToArray(_fvUtil$getAttributes5,2);var options=_fvUtil$getAttributes52[0];var layerOptions=_fvUtil$getAttributes52[1];reservationsCtrl.init(options,layerOptions);reservationsCtrl.addTo(mapCtrl)}}}]);FVC.RoomAssignmentLayerController=function(_FVC$CanvasLayerController4){_inherits(RoomAssignmentLayerController,_FVC$CanvasLayerController4);function RoomAssignmentLayerController($scope,$element,$attrs,fvUtil,$log){_classCallCheck(this,RoomAssignmentLayerController);_FVC$CanvasLayerController4.call(this,$scope,$element,$attrs,fvUtil,$log)}RoomAssignmentLayerController.prototype.init=function init(options,layerOptions){this.options=options;this.layerOptions=layerOptions;this.layer=new FV.RoomAssignmentLayer(layerOptions)};RoomAssignmentLayerController.prototype.requestData=function requestData(floorId){var _this10=this;return this.fvUtil.http(this.fvUtil.restEndPoint+"/floors/"+floorId,{selector:{rooms:{$:["reservable","capacity"],type:["occupiable"]}}}).then(function(response){return response.data},function(response){_this10.$log.error("RoomAssignment Error: ",response)})};return RoomAssignmentLayerController}(FVC.CanvasLayerController);ngFV.controller("RoomAssignmentLayerController",FVC.RoomAssignmentLayerController);ngFV.directive("fvRoomAssignmentLayer",["fvUtil",function fvRoomAssignmentLayer(fvUtil){var SCOPE={handle:"@",options:"="};return{require:["fvRoomAssignmentLayer","^fvMap"],restrict:"EA",scope:SCOPE,controller:"RoomAssignmentLayerController",link:function link(scope,element,attrs,_ref5){var _ref52=_slicedToArray(_ref5,2);var roomAssignmentCtrl=_ref52[0];var mapCtrl=_ref52[1];var _fvUtil$getAttributes6=fvUtil.getAttributes(scope,_.keys(SCOPE),{handle:"roomassignment"},{handle:"handle"});var _fvUtil$getAttributes62=_slicedToArray(_fvUtil$getAttributes6,2);var options=_fvUtil$getAttributes62[0];var layerOptions=_fvUtil$getAttributes62[1];roomAssignmentCtrl.init(options,layerOptions);roomAssignmentCtrl.addTo(mapCtrl)}}}]);FVC.RoomNameLayerController=function(_FVC$CanvasLayerController5){_inherits(RoomNameLayerController,_FVC$CanvasLayerController5);function RoomNameLayerController($scope,$element,$attrs,fvUtil,$log){_classCallCheck(this,RoomNameLayerController);_FVC$CanvasLayerController5.call(this,$scope,$element,$attrs,fvUtil,$log)}RoomNameLayerController.prototype.init=function init(options,layerOptions){this.options=options;this.layerOptions=layerOptions;this.layer=new FV.RoomNameLayer(layerOptions)};return RoomNameLayerController}(FVC.CanvasLayerController);ngFV.controller("RoomNameLayerController",FVC.RoomNameLayerController);ngFV.directive("fvRoomNameLayer",["fvUtil",function(fvUtil){var SCOPE={handle:"@",options:"=",sizes:"=",font:"@"};return{require:["fvRoomNameLayer","^fvMap"],restrict:"EA",scope:SCOPE,controller:"RoomNameLayerController",link:function link(scope,element,attrs,_ref6){var _ref62=_slicedToArray(_ref6,2);var roomNameCtrl=_ref62[0];var mapCtrl=_ref62[1];var _fvUtil$getAttributes7=fvUtil.getAttributes(scope,_.keys(SCOPE),{handle:"roomname",sizes:[6,8,11,14,25],font:"Arial"},{handle:"handle",sizes:"labelSizes",font:"fontName"});var _fvUtil$getAttributes72=_slicedToArray(_fvUtil$getAttributes7,2);var options=_fvUtil$getAttributes72[0];var layerOptions=_fvUtil$getAttributes72[1];roomNameCtrl.init(options,layerOptions);roomNameCtrl.addTo(mapCtrl)}}}]);FVC.RoomPolygonLayerController=function(_FVC$CanvasLayerController6){_inherits(RoomPolygonLayerController,_FVC$CanvasLayerController6);function RoomPolygonLayerController($scope,$element,$attrs,fvUtil,$log){_classCallCheck(this,RoomPolygonLayerController);_FVC$CanvasLayerController6.call(this,$scope,$element,$attrs,fvUtil,$log)}RoomPolygonLayerController.prototype.init=function init(options,layerOptions){this.options=options;this.layerOptions=layerOptions;this.layer=new FV.RoomPolygonLayer(layerOptions)};return RoomPolygonLayerController}(FVC.CanvasLayerController);ngFV.controller("RoomPolygonLayerController",FVC.RoomPolygonLayerController);ngFV.directive("fvRoomPolygonLayer",["fvUtil",function(fvUtil){var SCOPE={inheritStyle:"@",handle:"@",options:"="};return{require:["fvRoomPolygonLayer","^fvMap"],restrict:"EA",scope:SCOPE,controller:"RoomPolygonLayerController",link:function link(scope,element,attrs,_ref7){var _ref72=_slicedToArray(_ref7,2);var roomPolygonCtrl=_ref72[0];var mapCtrl=_ref72[1];var _fvUtil$getAttributes8=fvUtil.getAttributes(scope,_.keys(SCOPE),{inheritStyle:null,handle:"roompolygon"},{inheritStyle:"inheritStyle",handle:"handle"});var _fvUtil$getAttributes82=_slicedToArray(_fvUtil$getAttributes8,2);var options=_fvUtil$getAttributes82[0];var layerOptions=_fvUtil$getAttributes82[1];roomPolygonCtrl.init(options,layerOptions);roomPolygonCtrl.addTo(mapCtrl)}}}]);FVC.SRHeatLayerController=function(_FVC$CanvasLayerController7){_inherits(SRHeatLayerController,_FVC$CanvasLayerController7);function SRHeatLayerController($scope,$element,$attrs,fvUtil,$log){_classCallCheck(this,SRHeatLayerController);_FVC$CanvasLayerController7.call(this,$scope,$element,$attrs,fvUtil,$log)}SRHeatLayerController.prototype.init=function init(options,layerOptions){this.options=options;this.layerOptions=layerOptions;this.layer=new FV.SRHeatLayer(layerOptions)};SRHeatLayerController.prototype.requestData=function requestData(floorId){return this.fvUtil.http("/external/api/rest/v2/maintenance/requests",{floorId:floorId,limit:2e3,selector:{$:["type","priority","center"],room:["floor"],asset:{$:["name"],room:["floor"]},requester:{room:["floor"]}}}).then(function(response){return response.data},function(response){console.error("SR-Heat-Layer Error: ",response)})};return SRHeatLayerController}(FVC.CanvasLayerController);ngFV.controller("SRHeatLayerController",FVC.SRHeatLayerController);ngFV.directive("fvSrHeatLayer",["fvUtil",function(fvUtil){var SCOPE={handle:"@",options:"="};return{require:["fvSrHeatLayer","^fvMap"],restrict:"EA",scope:SCOPE,controller:"SRHeatLayerController",link:function link(scope,element,attrs,_ref8){var _ref82=_slicedToArray(_ref8,2);var srCtrl=_ref82[0];var mapCtrl=_ref82[1];var _fvUtil$getAttributes9=fvUtil.getAttributes(scope,_.keys(SCOPE),{handle:"srheat"},{handle:"handle"});var _fvUtil$getAttributes92=_slicedToArray(_fvUtil$getAttributes9,2);var options=_fvUtil$getAttributes92[0];var layerOptions=_fvUtil$getAttributes92[1];layerOptions.hostUrl=fvUtil.hostUrl;srCtrl.init(options,layerOptions);srCtrl.addTo(mapCtrl)}}}]);FVC.SearchLayerController=function(_FVC$CanvasLayerController8){_inherits(SearchLayerController,_FVC$CanvasLayerController8);function SearchLayerController($scope,$element,$attrs,fvUtil,$log){_classCallCheck(this,SearchLayerController);_FVC$CanvasLayerController8.call(this,$scope,$element,$attrs,fvUtil,$log)}SearchLayerController.prototype.init=function init(options,layerOptions){this.options=options;this.layerOptions=layerOptions;this.layer=new FV.SearchLayer(layerOptions)};return SearchLayerController}(FVC.CanvasLayerController);ngFV.controller("SearchLayerController",FVC.SearchLayerController);ngFV.directive("fvSearchLayer",["fvUtil",function(fvUtil){var SCOPE={blur:"=",weight:"=",opacity:"=",handle:"@",options:"="};return{require:["fvSearchLayer","^fvMap"],restrict:"EA",scope:SCOPE,controller:"SearchLayerController",link:function link(scope,element,attrs,_ref9){var _ref92=_slicedToArray(_ref9,2);var searchCtrl=_ref92[0];var mapCtrl=_ref92[1];var _fvUtil$getAttributes10=fvUtil.getAttributes(scope,_.keys(SCOPE),{blur:0,weight:10,opacity:.6,handle:"search"},{blur:"blur",weight:"weight",opacity:"opacity",handle:"handle"});var _fvUtil$getAttributes102=_slicedToArray(_fvUtil$getAttributes10,2);var options=_fvUtil$getAttributes102[0];var layerOptions=_fvUtil$getAttributes102[1];searchCtrl.init(options,layerOptions);searchCtrl.addTo(mapCtrl)}}}]);FVC.TileLayerController=function(_FVC$CanvasLayerController9){_inherits(TileLayerController,_FVC$CanvasLayerController9);function TileLayerController($scope,$element,$attrs,fvUtil,$log){_classCallCheck(this,TileLayerController);_FVC$CanvasLayerController9.call(this,$scope,$element,$attrs,fvUtil,$log)}TileLayerController.prototype.init=function init(options,layerOptions){this.options=options;this.layerOptions=layerOptions;this.layer=new FV.TileLayer(layerOptions)};return TileLayerController}(FVC.CanvasLayerController);ngFV.controller("TileLayerController",FVC.TileLayerController);ngFV.directive("fvTileLayer",["fvUtil",function fvTileLayer(fvUtil){var SCOPE={handle:"@",options:"="};return{require:["fvTileLayer","^fvMap"],restrict:"EA",scope:SCOPE,controller:"TileLayerController",link:function link(scope,element,attrs,_ref10){var _ref102=_slicedToArray(_ref10,2);var tileCtrl=_ref102[0];var mapCtrl=_ref102[1];var _fvUtil$getAttributes11=fvUtil.getAttributes(scope,_.keys(SCOPE),{handle:"tile"},{handle:"handle"});var _fvUtil$getAttributes112=_slicedToArray(_fvUtil$getAttributes11,2);var options=_fvUtil$getAttributes112[0];var layerOptions=_fvUtil$getAttributes112[1];tileCtrl.init(options,layerOptions);tileCtrl.addTo(mapCtrl)}}}]);ngFV.service("fvDelegate",FV.DelegateService(["setFloorId","getMap","getLayerControllerByHandle"]));var FVUtil=function(){function FVUtil($http,$q){_classCallCheck(this,FVUtil);angular.extend(this,{$http:$http,$q:$q});this.hostUrl="";this.headers={};this.restEndPoint="/external/api/rest/v2";this.requestCanceler=$q.defer()}FVUtil.prototype.config=function config(host,authHeaders){this.hostUrl=host;this.headers=authHeaders};FVUtil.prototype.cancelRequests=function cancelRequests(){this.requestCanceler.resolve();this.requestCanceler=this.$q.defer()};FVUtil.prototype.toQuery=function toQuery(params){var _this11=this;return _.map(params,function(val,key){var value=_.isObject(val)?_this11.yogify(val):val;return[key,value].join("=")}).join("&")};FVUtil.prototype.http=function http(endpoint,params,options){params=this.toQuery(params);var url=this.hostUrl+endpoint+"?"+params;return this.$http(_.assign({url:url,method:"GET",headers:this.headers,cache:false,timeout:this.requestCanceler.promise},options||{}))};FVUtil.prototype.yogify=function yogify(selector){var _this12=this;if(_.isArray(selector)){return selector.join()}var obj=_.mapValues(selector,function(val){return _this12.yogify(val)});return _.map(_.pairs(obj),function(item){if(!item[1]){return item[0]}else if(item[0]==="$"){return item[1]}else{return item[0]+"("+item[1]+")"}}).join()};FVUtil.prototype.unyogify=function unyogify(selector){var _this13=this;var root={},data=this._splitSelector(selector);_.each(data,function(_ref11){var _ref112=_slicedToArray(_ref11,3);var value=_ref112[0];var key=_ref112[1];var array=_ref112[2];if(key){if(!array){root[key]=_this13.unyogify(value)}else{root[key]=value.split(",")}}else if(root.$){root.$.push(value)}else{root.$=[value]}});return root};FVUtil.prototype._splitSelector=function _splitSelector(selector){var result=[],buff="",key="",array=true,level=0;_.each(selector,function(char){if(char===","&&level===0){result.push([buff,key,array]);buff="";key="";array=true}else if(char==="("){level+=1;if(level===1){key=buff;buff=""}else{array=false;buff+=char}}else if(char===")"){level-=1;if(level){buff+=char}}else{buff+=char}});if(buff){result.push([buff,key,array])}return result};FVUtil.prototype.handleAttributes=function handleAttributes($scope,$attrs,dAttrs,attMap){var ignore=arguments.length<=4||arguments[4]===undefined?["style"]:arguments[4];var objAttrs={},dirAttrs=_.extend({},dAttrs);_.each(_.keys(attMap),function(name){var optProp=attMap[name];objAttrs[optProp[0]]=optProp[1]});_.each(_.keys($attrs.$attr),function(name){if(_.include(ignore,name)){return}var value=$attrs[name];if(name.charAt(0)==="@"){name=name.substr(1)}else{value=$scope.$eval(value)}if(_.has(dAttrs,name)){dirAttrs[name]=value}else if(_.has(attMap,name)){objAttrs[attMap[name][0]]=value}else{objAttrs[name]=value}});return[dirAttrs,objAttrs]};FVUtil.prototype.getAttributes=function getAttributes(scope,keys,defaults,optMap){var directiveOptions={};_.each(keys,function(att){directiveOptions[att]=scope[att]});directiveOptions=_.defaults(directiveOptions,defaults);var objectOptions={};_.forOwn(optMap,function(val,att){objectOptions[val]=directiveOptions[att]});objectOptions=_.extend(objectOptions,directiveOptions.options);return[directiveOptions,objectOptions]};FVUtil.FVUtilFactory=function FVUtilFactory($http,$q){return new FVUtil($http,$q)};return FVUtil}();ngFV.factory("fvUtil",FVUtil.FVUtilFactory);FVC.ControlController=function(){function ControlController($scope,$element,$attrs,fvUtil,$log){_classCallCheck(this,ControlController);angular.extend(this,{$scope:$scope,$element:$element,$attrs:$attrs,fvUtil:fvUtil,$log:$log});this.mapCtrl=null;this.control=null;this.options=null;this.controlOptions=null}ControlController.prototype.addTo=function addTo(mapCtrl){var _this14=this;this.mapCtrl=mapCtrl;mapCtrl.addControlController(this);mapCtrl.on("setfloorend",function(){_this14.onAdd(mapCtrl);_this14.control.addTo(mapCtrl.map)})};ControlController.prototype.getControl=function getControl(){return this.control};return ControlController}();FVC.fvLayersControlController=function(_FVC$ControlController){_inherits(fvLayersControlController,_FVC$ControlController);function fvLayersControlController($scope,$element,$attrs,fvUtil,$log){_classCallCheck(this,fvLayersControlController);_FVC$ControlController.call(this,$scope,$element,$attrs,fvUtil,$log)}fvLayersControlController.prototype.init=function init(options,controlOptions){this.options=options;this.controlOptions=controlOptions};fvLayersControlController.prototype.onAdd=function onAdd(mapCtrl){var _this15=this;var baseLayers=this.options.baseLayers.split(",");var overlays=this.options.overlays.split(",");var base={},over={};_.each(baseLayers,function(item){var _getNameHandlePair=_this15.getNameHandlePair(item);var _getNameHandlePair2=_slicedToArray(_getNameHandlePair,2);var name=_getNameHandlePair2[0];var handle=_getNameHandlePair2[1];var layerCtrl=mapCtrl.getLayerControllerByHandle(handle);base[name]=layerCtrl.getLayer()});overlays=_.map(overlays,function(item){var _getNameHandlePair3=_this15.getNameHandlePair(item);var _getNameHandlePair32=_slicedToArray(_getNameHandlePair3,2);var name=_getNameHandlePair32[0];var handle=_getNameHandlePair32[1];var layerCtrl=mapCtrl.getLayerControllerByHandle(handle);over[name]=layerCtrl.getLayer()});this.control=new L.Control.Layers(base,over,this.controlOptions)};fvLayersControlController.prototype.getNameHandlePair=function getNameHandlePair(item){var name,handle;if(item.indexOf(":")==-1){handle=item;name=_.capitalize(handle.trim())}else{var _item$split=item.split(":");
var _item$split2=_slicedToArray(_item$split,2);name=_item$split2[0];handle=_item$split2[1]}return[name.trim(),handle.trim()]};return fvLayersControlController}(FVC.ControlController);ngFV.controller("fvLayersControlController",FVC.fvLayersControlController);ngFV.directive("fvLayersControl",["fvUtil",function(fvUtil){var SCOPE={handle:"@",baseLayers:"@",overlays:"@",options:"="};return{require:["fvLayersControl","^fvMap"],restrict:"EA",scope:SCOPE,controller:"fvLayersControlController",link:function link(scope,element,attrs,_ref12){var _ref122=_slicedToArray(_ref12,2);var controlCtrl=_ref122[0];var mapCtrl=_ref122[1];var _fvUtil$getAttributes12=fvUtil.getAttributes(scope,_.keys(SCOPE),{handle:"layers-control",baseLayers:"",overlays:""},{handle:"handle"});var _fvUtil$getAttributes122=_slicedToArray(_fvUtil$getAttributes12,2);var options=_fvUtil$getAttributes122[0];var controlOptions=_fvUtil$getAttributes122[1];controlCtrl.init(options,controlOptions);controlCtrl.addTo(mapCtrl)}}}]);FVC.fvSearchUserRoomControlController=function(_FVC$ControlController2){_inherits(fvSearchUserRoomControlController,_FVC$ControlController2);function fvSearchUserRoomControlController($scope,$element,$attrs,fvUtil,$log){_classCallCheck(this,fvSearchUserRoomControlController);_FVC$ControlController2.call(this,$scope,$element,$attrs,fvUtil,$log)}fvSearchUserRoomControlController.prototype.init=function init(options,controlOptions){this.options=options;this.controlOptions=controlOptions};fvSearchUserRoomControlController.prototype.onAdd=function onAdd(mapCtrl){var layerHandle=this.options.layer.trim();var layerCtrl=mapCtrl.getLayerControllerByHandle(layerHandle);var layer=layerCtrl.getLayer();this.control=new FV.SearchUserRoomLayerControl(layer,this.layerOptions);this.control.fvUtil=this.fvUtil;this.control.ctrl=this};return fvSearchUserRoomControlController}(FVC.ControlController);ngFV.controller("fvSearchUserRoomControlController",FVC.fvSearchUserRoomControlController);ngFV.directive("fvSearchUserRoomControl",["fvUtil",function fvSearchUserRoomControl(fvUtil){var SCOPE={handle:"@",layer:"@",options:"="};return{require:["fvSearchUserRoomControl","^fvMap"],restrict:"EA",scope:SCOPE,controller:"fvSearchUserRoomControlController",link:function link(scope,element,attrs,_ref13){var _ref132=_slicedToArray(_ref13,2);var controlCtrl=_ref132[0];var mapCtrl=_ref132[1];var _fvUtil$getAttributes13=fvUtil.getAttributes(scope,_.keys(SCOPE),{handle:"searchuserroom-control",layer:"tile"},{handle:"handle"});var _fvUtil$getAttributes132=_slicedToArray(_fvUtil$getAttributes13,2);var options=_fvUtil$getAttributes132[0];var controlOptions=_fvUtil$getAttributes132[1];controlCtrl.init(options,controlOptions);controlCtrl.addTo(mapCtrl)}}}]);FVC.fvServiceRequestHeatControlController=function(_FVC$ControlController3){_inherits(fvServiceRequestHeatControlController,_FVC$ControlController3);function fvServiceRequestHeatControlController($scope,$element,$attrs,fvUtil,$log){_classCallCheck(this,fvServiceRequestHeatControlController);_FVC$ControlController3.call(this,$scope,$element,$attrs,fvUtil,$log)}fvServiceRequestHeatControlController.prototype.init=function init(options,controlOptions){this.options=options;this.controlOptions=controlOptions};fvServiceRequestHeatControlController.prototype.onAdd=function onAdd(mapCtrl){var layerHandle=this.options.layer.trim();var layerCtrl=mapCtrl.getLayerControllerByHandle(layerHandle);var layer=layerCtrl.getLayer();this.control=new FV.ServiceRequestHeatLayerControl(layer,this.layerOptions)};return fvServiceRequestHeatControlController}(FVC.ControlController);ngFV.controller("fvServiceRequestHeatControlController",FVC.fvServiceRequestHeatControlController);ngFV.directive("fvServiceRequestHeatControl",["fvUtil",function(fvUtil){var SCOPE={handle:"@",layer:"@",options:"="};return{require:["fvServiceRequestHeatControl","^fvMap"],restrict:"EA",scope:SCOPE,controller:"fvServiceRequestHeatControlController",link:function link(scope,element,attrs,_ref14){var _ref142=_slicedToArray(_ref14,2);var controlCtrl=_ref142[0];var mapCtrl=_ref142[1];var _fvUtil$getAttributes14=fvUtil.getAttributes(scope,_.keys(SCOPE),{handle:"servicerequestheat-control",layer:"srheat"},{handle:"handle"});var _fvUtil$getAttributes142=_slicedToArray(_fvUtil$getAttributes14,2);var options=_fvUtil$getAttributes142[0];var controlOptions=_fvUtil$getAttributes142[1];controlCtrl.init(options,controlOptions);controlCtrl.addTo(mapCtrl)}}}])})();
